var selectorClass=function(){this.multiple=true;this.selected=false;this.query_id=false;this.caller=false;this.type=false;this.containerID='selected_container';this.elementTagName='LI';this.onSelect=false;this.waits=false;this.msgColor='#009900';this.errColor='#990000';this.zIndex=false};selectorClass.prototype.open=function(type,query_id,multiple,caller,onSelect,extraGet,type_group_id,noPush,zIndex,onClose){this.multiple=multiple;this.type=type;this.query_id=query_id;this.onSelect=onSelect;this.extraGet=extraGet;this.caller=caller;this.zIndex=zIndex;if(type==="text"||type==="textplain"){this.containerID='selected_container_tr'}if(this.multiple){this.showSelected(type_group_id,noPush,extraGet,onClose)}else{this.showDataBrowser(extraGet,type_group_id,noPush)}};selectorClass.prototype.showSelected=function(type_group_id,noPush,extraGet,onClose){var popup=new PopupWindow('selected');var controller=this.type.replace('_','-');if(this.type==='textplain'){controller='text-plain'}if(this.type==='json_meta_global'){controller='json-meta'}popup.url='/-/cms/v1/'+controller+'/'+'?act=list&popup=1&multiple='+this.multiple+'&'+access+'&query_id='+this.query_id+'&type_group_id='+(type_group_id?type_group_id:0)+(extraGet?'&'+extraGet:'');var s=util.scrollOffset();popup.x=80;popup.y=s.y+30;popup.modal=true;popup.drag=true;popup.onClose=function(){selector.instances.pop();if(type_group_id!==0||type_group_id!=''){popupController.reloadLastPopup()}if(typeof onClose==='function'){onClose()}};popupController.showPopup(popup)};selectorClass.prototype.showDataBrowser=function(extraGet,type_group_id,noPush){var self=this;this.waits=true;if(!type_group_id){type_group_id=0}type_group_id=(type_group_id+"").split(',');$.map(type_group_id,function(val,i){return parseInt(val)});type_group_id=type_group_id.join(',');var params='';var api_url='/-/cms/v1/';var controller=this.type.replace('_','-');if(this.type==='json_meta'){params=(type_group_id!="0"?'&act=indexGroup':'')}if(this.type==='textplain'){controller='text-plain'}if(this.type==='json_meta_global'){controller='json-meta'}if(this.type==='content_lp'){controller='lp';params='&content=1'}var popup=new PopupWindow('databrowser');popup.url=api_url+controller+'/'+'?popup=1&selector=1&multiple='+this.multiple+params+'&'+access+(extraGet?'&'+extraGet:'')+'&type_group_id='+(type_group_id?type_group_id:0);popup.center=true;popup.drag=true;popup.modal=true;popup.zIndex=this.zIndex;if(!noPush){selector.instances.push(this)};popup.onClose=function(){self.waits=false;ImageController.image_selector_name=null;selector.instances.pop()};popupController.showPopup(popup);popupController.getLastPopup().onAfterReload=function(){selector.callBack(self.type)};selector.callBack(self.type)};selectorClass.prototype.add=function(object_id,obj){if(!this.multiple&&this.onSelect){this.onSelect(object_id,obj,this.extraGet);return}var selected=document.getElementById(this.containerID);if(!selected){alert('not found containers');return false}var obj=util.getElement(obj,this.elementTagName);if(obj){if(!this.exists(obj)){var clone=obj.cloneNode(true);selected.appendChild(clone);util.msg(JS_ADDED_TO_LIST,this.msgColor)}else{util.msg(s3.loc('JS_FILE_EXIST'),this.msgColor)}fadeController.init(obj)}};selectorClass.prototype.exists=function(obj){return selector.exists(obj)};var selector={containerID:'selected_container',elementTagName:'LI',instances:[],open:function(type,query_id,multiple,caller,onSelect,extraGet,type_group_id,zIndex,onClose){if(type==='users'){type='user'}if(type==='article2_lenta'){type='article2'}if(type==='json_meta_global'){type='json_meta'}if(type==='catalog'){type='catalog_links'}var s=new selectorClass();this.instances.push(s);s.open(type,query_id,multiple,caller,onSelect,extraGet,type_group_id,true,zIndex,onClose)},showDataBrowser:function(extraGet,type_group_id){var s=selector.getInstance();s.showDataBrowser(extraGet,type_group_id)},showSelected:function(type_group_id){var s=selector.getInstance();s.showSelected(type_group_id)},focused:function(){var d=popupController.getLastPopup();if(d&&d.obj.id=="selected")return true;return false},exists:function(obj){var s=selector.getInstance();var selected=document.getElementById(s.containerID);if(!selected){return false}var e=selected.getElementsByTagName(s.elementTagName);for(i=0;i<e.length;i++){if(e[i].id==obj.id){return true}}return false},getIds:function(){var s=selector.getInstance();var matches,d=document.getElementById(s.containerID);if(!d)return false;var elements=d.getElementsByTagName(s.elementTagName);if(!elements.length){s.elementTagName='TR';elements=d.getElementsByTagName(s.elementTagName)}if(!elements.length)return false;var res=new Array();for(var i=0;i<elements.length;i++){matches=elements[i].id.match(/[a-z_]+(\d+)/);if(matches[1])res.push(matches[1])}return res.join(',')},taken:function(obj,caller){var s=selector.getInstance();if(obj&&obj.tagName==='TR'){s.elementTagName='TR'}if(!s.waits)return false;if(!caller||caller.className=="objectEdit"||caller.className=="image-edit"||$(caller).hasClass('allow-edit')||(s.multiple&&caller.className=="objectContainer"))return false;var object_id=s3.getObjectId(obj);if(object_id)s.add(object_id,obj);return true},add:function(object_id,obj){var s=selector.getInstance();s.add(object_id,obj)},onSelect:function(object_id,node,extra_params){var s=selector.getInstance();s.onSelect(object_id,node,extra_params)},save2query:function(object_id,node,extra_params){var s=selector.getInstance();var ids=(!s.multiple&&object_id)?object_id:selector.getIds();var url="/-/cms/v1/page/content/?act=save&"+access;if(typeof extra_params=="object"){for(var k in extra_params){url+="&"+k+"="+extra_params[k]}}util.makePostRequest(url,"&query_id="+s.query_id+"&ids="+ids);popupController.closeLastPopup();popupController.reloadLastPopup();util.msg('OK !',s.msgColor)},save2gallery2:function(object_id,node,extra_params){var s=selector.getInstance();var ids=(!s.multiple&&object_id?object_id:selector.getIds())||'';var url="/-/cms/v1/gallery2/?act=add_images&"+access;if(typeof extra_params=="object"){for(var k in extra_params){url+="&"+k+"="+extra_params[k]}}var response=util.makePostRequest(url,"&ids="+ids+"&object_id="+object_id);if(response.error){return false}popupController.closeLastPopup();popupController.reloadLastPopup();var lastPopup=popupController.getPreviousPopup();if(lastPopup){lastPopup.reload()}else{s3.reloadContent()}util.msg(response.text,s.msgColor)},removeJsonAnketa:function(control_name){$('#anketa-'+control_name).html('');$('#anketa-value-'+control_name).val('');$('#anketa-item-'+control_name).css('display','none');$('#anketa-select-'+control_name).show()},getInstance:function(){if(this.instances.length<=0){this.instances.push(new selectorClass())}return this.instances[this.instances.length-1]},callBack:function(type){if(this.callBackFuncs[type])this.callBackFuncs[type]()},callBackFuncs:{image:function(){imagePageOnLoad()},gallery_image:function(){imagePageOnLoad()}}};var imageControl=null;function showSelectedImage(ids){if(ids&&ids!=""&&imageControl){var tempp=Number(ids);if(!isNaN(tempp)&&tempp>0){imageControl.value=tempp;imageControl=document.getElementById(imageControl.id+"_src");if(imageControl){imageControl.src=images_dir+tempp+"_"+thumb_format_id+"."+thumb_format_ext}}}}function showImagePopup(controlName){imageControl=document.getElementById(controlName);if(imageControl){var imageObjectId;if(imageControl.value=="")imageObjectId=0;else imageObjectId=imageControl.value;dataNavigatorResult="";dataNavigatorFunction=showSelectedImage;openDataNavigator(1,"image",0,0,0,0)}}var pageController={page_id:0,selected:false,selectedClassName:"",update:false,divContextMenu:"pageController",divPageInfo:"divPageInfo",classBranchExpanded:'branch-expanded',classBranchCollapsed:'branch-collapsed',timerPageInfo:null,cookieSelectorState:'PAGE_SELECTOR_STATE_',group_editing:false,current_menu_id:0,handleEditingPage:function(ctx,mainPageId,pageId,templateId,content,lpPresetId,isFirstOpening,template_preset_id=0){const self=ctx;const isEditedContent=$(self.elements.content).val()!==content;const isEditedTemplate=$(self.elements.template_id).val()!==templateId.toString();const isEditedLpPresetId=$(self.elements.lp_preset_id).val()!==lpPresetId.toString();if(isEditedTemplate&&isEditedLpPresetId){lpPresetId=$(self.elements.lp_preset_id).val()}const editingPage=function(){const url='/-/cms/v1/page/?act=edit&'+S3_ACCESS+'&first_opening='+isFirstOpening.toString();let onSuccessCallback=null;if(lpPresetId&&isStaffUser){const getEditorUrl=function(page_id,plugin_query){if(hasAccessToLpNewEditor){const editorUrl=new URL(site_root_url+'/-/cms/v1/lp/editor/?'+S3_ACCESS);editorUrl.searchParams.set('page_id',page_id);editorUrl.searchParams.set('access_granted','1');return editorUrl};const editorUrl=new URL(site_root_url+'/-/cms/v1/lp/?act=index&mode=live_edit&'+S3_ACCESS);editorUrl.searchParams.set('page_id',page_id);editorUrl.searchParams.set('query_id',plugin_query.query_id);editorUrl.searchParams.set('query_type_id',plugin_query.query_type_id);editorUrl.searchParams.set('access_granted','1');editorUrl.searchParams.set('template_preset_id',template_preset_id);if(plugin_query.query_type_id==='92'){editorUrl.searchParams.set('content_lp',String(true))}return editorUrl};onSuccessCallback=function(response){if(response.error||!response.text){return false}try{const responseData=JSON.parse(response.text);const{key:page_id,plugin_query}=responseData;if(!plugin_query&&!page_id||!plugin_query.query_id||!plugin_query.query_type_id){return false}const editorUrl=getEditorUrl(page_id,plugin_query);window.open(editorUrl,'_blank').focus()}catch(e){console.warn(e);return false}}}return postAjaxForm(url,self,null,onSuccessCallback)};const confirmCallback=function(){popupController.closeLastPopup();editingPage()};if(Number(pageId)&&isEditedContent||isEditedTemplate){if(mainPageId===pageId){if(isStaffUser){s3.confirm(s3.loc('CONFIRM_CHANGE_PAGE_TYPE_OR_TEMPLATE'),confirmCallback);return false}s3.alertHTML(s3.loc('ERROR_CHANGING_MAIN_PAGE_TYPE_OR_TEMPLATE'));return false}s3.confirm(s3.loc('CONFIRM_CHANGE_PAGE_TYPE_OR_TEMPLATE'),confirmCallback);return false}return editingPage()},changeAccessMode:function(obj){var mode=obj.value,hiddenFieldValue=$('#page_hidden').val();if(mode=="group"){document.getElementById("accessGroupDiv").className="";document.getElementById("accessUserDiv").className="hidden";if(hiddenFieldValue!=1){pageController.showElements('#visibleByAccessWrap','#userGroupAccessNote')}pageController.hideElements('#userAccessNote','#registeredAccessNote')}else if(mode=="user"){document.getElementById("accessGroupDiv").className="hidden";document.getElementById("accessUserDiv").className="";pageController.hideElements('#userGroupAccessNote','#registeredAccessNote');if(hiddenFieldValue!=1){pageController.showElements('#visibleByAccessWrap','#userAccessNote')}}else if(mode=="registered"){pageController.hideElements('#userGroupAccessNote','#userAccessNote');if(hiddenFieldValue!=1){pageController.showElements('#visibleByAccessWrap','#registeredAccessNote')}}else{document.getElementById("accessGroupDiv").className="hidden";document.getElementById("accessUserDiv").className="hidden";pageController.hideElements('#visibleByAccessWrap');$('#visibleByAccess').removeAttr('checked').prop('checked',false).parent().removeClass('active');$('#page_hidden').val(0)}},changeVisibilityMode:function(mode,is_checked){var hiddenField=$('#page_hidden'),hiddenFieldValue=hiddenField.val();switch(mode){case 1:if(is_checked){$('#visibleByAccessWrap').removeClass('invisible');hiddenField.val(0)}else{if(hiddenFieldValue==2){$('#visibleByAccess').removeAttr('checked').prop('checked',false).parent().removeClass('active')}$('#visibleByAccessWrap').addClass('invisible');hiddenField.val(mode)}break;case 2:if(is_checked){if(hiddenFieldValue==1){$('#page_hidden_btn').removeAttr('checked').prop('checked',false).parent().removeClass('active')}hiddenField.val(mode)}else{hiddenField.val(0)}break}},menuContextMenu:function(obj){if(!treeStorage.updated){var coords=util.findPos(obj);var popup=new PopupWindow('menuContextMenu');popup.x=coords[0]+10;popup.y=coords[1]+15;popup.timeout=10000;popupController.showPopup(popup)}else{pageController.saveStructureFirstAlert()}},menuDeleteMenu:function(menu_id,success_text){var url="/-/cms/v1/menu/?act=delete&"+access+"&menu_id="+menu_id;var r=util.makeGetRequest(url);try{if(r.error==false){if(r.code==2){var s=r.text.trim();if(/^JS_.*/.test(s))s=eval(s);window.setTimeout(function(){s3.alertHTML(s)},10)}else if(r.code==1){popupController.closeLastPopup();location.hash='/-/cms/v1/menu/?act=view&'+access;s3.loadContent('/-/cms/v1/menu/?act=view&'+access);if(success_text){util.msg(success_text)}}}}catch(e){}},menuDefaultMenu:function(menu_id){var url="/-/cms/v1/menu/?act=set_default&"+access+"&menu_id="+menu_id;var r=util.makeGetRequest(url);try{if(r.error==false){util.msg(s3.loc('JS_CHANGES_SAVED'))}}catch(e){}},remove:function(){if(this.checkLocked(this.page_id)){return}popupController.closeLastPopup();var div=$('#page'+pageController.page_id);var f=function(){popupController.closeLastPopup();var url="/-/cms/v1/page/?act=delete&"+access+"&page_id="+pageController.page_id;if(util.touchUrl(url)){$('.page-'+pageController.page_id).each(function(){var parent_node,node,parent;node=$.ui.dynatree.getNode($(this));parent=$(this).parents('li:first');parent_node=node.getParent();node.removeChildren();if(parent.is('.dynatree-lastsib')&&parent.prev().size()){parent.prev().addClass('dynatree-lastsib')}node.remove();if(parent_node.hasChildren()===undefined||parent_node.hasChildren()===false){parent_node.expand(false);parent_node.removeChildren();parent_node.data.isFolder=false;parent_node.data.isLazy=false;parent_node.render()}});pageController.updatePagesCount()}};s3.confirm((div.hasClass('dynatree-has-children')?s3.loc('JS_CONFIRM_DELETE_PARENT_PAGE'):s3.loc('JS_CONFIRM_DELETE')),f,div.get(0))},save:function(res,mode){var node=undefined,node_data=undefined,node_child=undefined,children_list=undefined;if(mode!='add'&&mode!='edit'&&mode!='copy'){var matches=res.match(/this,\ *(\d+)/);if(matches&&!matches[1]){s3.alertHTML('ERROR: pageController.save(), 1');return false}var new_page_id=matches[1]}if(mode=='edit'){node_data=JSON.parse(res);$('.page-'+this.page_id).each(function(){node=$.ui.dynatree.getNode($(this));node.data=node_data;node.data.addClass=node.data.addClass.replace('added','');node.render()});popupController.closeLastPopup()}else if(mode=='add'||mode=='copy'){node=$.ui.dynatree.getNode($('#page'+this.page_id)),node_data=JSON.parse(res);if(node.isLazy()){if(node.isExpanded()){node.addChild(node_data)}else{node.reloadChildren();children_list=node.getChildren();node_child=children_list[children_list.length-1];node_child.data.addClass+=' added';node_child.render()}}else{node.addChild(node_data)}node.expand(true);this.page_id=node_data['key'];setTimeout(function(){$('.page-'+node_data['key']+'.added').each(function(){node=$.ui.dynatree.getNode($(this));node.data.addClass=node.data.addClass.replace('added','');node.render()})},5000);if(mode=='copy'){window.test=node;var notification=s3.loc('JS_PAGE_COPY_CREATED_MESSAGE').replace("%page%",node.data.title);if(typeof node_data.notification!='undefined'){notification+='<br />'+node_data.notification}s3.alertHTML(notification,false,s3.loc('JS_PAGE_COPY_CREATED_MESSAGE'))}else{if(node_data['type']=='page'){this.editContent()}else{popupController.closeLastPopup()}}$('.pages_num').html(parseInt($('.pages_num').text())+1)}else{var d=document.createElement('DIV');d.id='page'+new_page_id;d.className="branch-end";d.innerHTML=res;var p=this.getPage();var s=util.getLastChild(p,'DIV');if(s)s.className="branch";p.appendChild(d);this.page_id=new_page_id;if(res.match(/ico-page/)){this.editContent()}else{popupController.closeLastPopup()}var href=util.getElementsByClassName(d,'SPAN','pageName');if(href.length>0)fadeController.init(href[0],1)}},addRoot:function(page_id){if(!treeStorage.updated){this.page_id=page_id;this.selected=false;this.edit('add')}else{pageController.saveStructureFirstAlert()}},makeHomeConfirm:function(msg){popupController.closeLastPopup();var f=function(){pageController.makeHome()};s3.confirm(msg,f)},setPageLink:function(link){var d=document.getElementById('url_link');if(!d)return false;d.value=link},insertFile:function(object_id){var r=util.makeGetRequest("/-/cms/v1/file/?act=src&"+access+"&object_id="+object_id);if(r.error)return false;pageController.setPageLink(r.text);popupController.closeLastPopup()},choosePageType:function(root_page_id){root_page_id=root_page_id||this.page_id;var url="/-/cms/v1/template/library/?"+access+'&fast_create=1'+'&root_page_id='+root_page_id;openAjaxForm(url)},createPageByType:function(parent,page_id,template_id,add_access,page_type,lp_preset_id='',template_preset_id=0){const params={'page_template_id':template_id,'first_opening':1,page_type,lp_preset_id,template_preset_id};templateLibraryController.tooltipHide();this.page_id=parent;if(add_access){var access_url="/-/cms/v1/template/library/?act=toggle&"+access;$.post(access_url,{template_id:template_id,template_preset_id:template_preset_id},function(){popupController.closeLastPopup();pageController.edit('add',JSON.stringify(params))})}else{popupController.closeLastPopup();this.edit('add',JSON.stringify(params))}},changePageType:function(template_id,page_type_name,page_type,add_access,lp_preset_id=''){templateLibraryController.tooltipHide();if(add_access){var access_url="/-/cms/v1/template/library/?act=toggle&"+access;$.post(access_url,{template_id,lp_preset_id},function(){popupController.closeLastPopup();S3PageController.selectPageViewType(template_id,page_type_name,page_type,lp_preset_id)})}else{popupController.closeLastPopup();S3PageController.selectPageViewType(template_id,page_type_name,page_type,lp_preset_id)}},insertPage:function(url){pageController.setPageLink(url);popupController.closeLastPopup()},makeHome:function(){popupController.closeLastPopup();if(this.selectedClassName.indexOf('link')>0||this.selectedClassName.indexOf('verification')>0){return}var r=util.makeGetRequest("/-/cms/v1/page/?act=set_home&"+access+"&page_id="+this.page_id);if(r.error)return;var node;$('.dynatree-node.home').each(function(){node=$.ui.dynatree.getNode($(this));node.data.addClass=node.data.addClass.replace(' home','');node.render()});$('.page-'+this.page_id).each(function(){node=$.ui.dynatree.getNode($(this));node.data.addClass+=' home';node.render()})},getPage:function(){return document.getElementById('page'+this.page_id)},editContent:function(){if(this.checkLocked(this.page_id)){return false}popupController.closeLastPopup();this.highlight(this.selected);if(this.selectedClassName.indexOf('link')>0||this.selectedClassName.indexOf('verification')>0){return false}var popup=new PopupWindow('editPageWindow');popup.url="/-/cms/v1/page/?act=edit&"+access+"&page_id="+this.page_id+"&tab=page_content_data";popup.x=5;popup.y=0;popup.right=true;popup.center=true;popup.modal=true;popup.onClose=this.pageDeselectInterface;popup.drag=true;popup.onSuccessPost=function(){popupController.closeLastPopup()};if(!popupController.showPopup(popup)){}},editJSON:function(menu_id){if(this.checkLocked(this.page_id)){return}this.highlight(this.selected);popupController.closeLastPopup();if(this.selectedClassName.indexOf('link')>0||this.selectedClassName.indexOf('verification')>0){return false}var popup=new PopupWindow('editPageWindow');popup.url="/-/cms/v1/page/content/?act=json&"+access+"&page_id="+this.page_id+"&menu_id="+menu_id;popup.x=5;popup.y=0;popup.right=true;popup.center=true;popup.modal=true;popup.onClose=this.pageDeselectInterface;popup.drag=true;popup.onSuccessPost=function(){popupController.closeLastPopup()};popupController.showPopup(popup)},changeTemplate:function(){if(this.checkLocked(this.page_id)){return}this.highlight(this.selected);popupController.closeLastPopup();if(this.selectedClassName.indexOf('link')>0||this.selectedClassName.indexOf('verification')>0){return false}var popup=new PopupWindow('editPageWindow');popup.url="/-/cms/v1/page/?act=change_template&"+access+"&page_id="+this.page_id;popup.x=5;popup.y=0;popup.right=true;popup.center=true;popup.modal=true;popup.onClose=this.pageDeselectInterface;popup.drag=true;popup.onSuccessPost=function(){popupController.closeLastPopup()};popupController.showPopup(popup)},edit:function(mode,params){if(this.checkLocked(this.page_id)){return}var additional_params='';if(params){params=$.parseJSON(params);if(!$.isEmptyObject(params)){for(param_key in params){if(params[param_key]!=''){additional_params+='&'+param_key+'='+params[param_key]}}}}popupController.closeLastPopup();this.highlight(this.selected);var parent=0;var page_id=this.page_id;if(mode=='add'){parent=page_id;page_id=0}if(mode=='edit_data'){var target_tab="";mode='edit'}else{var target_tab="&tab=page_properties"}var url="/-/cms/v1/page/?act=edit&"+access+"&parent="+parent+"&page_id="+page_id+target_tab+additional_params;if(this.group_editing){url+='&group_editing=1'}var onSubmit=function(r){pageController.save(r.text,mode)};var onContentReady=function(){};openAjaxForm(url,onSubmit,pageController.pageDeselectInterface,null,null,onContentReady)},copy:function(){popupController.closeLastPopup();if(this.selectedClassName.indexOf('link')>0||this.selectedClassName.indexOf('verification')>0){return}var url="/-/cms/v1/page/?act=copy&"+access+"&page_id="+this.page_id;if(this.group_editing){url+="&group_editing=1"}var r=util.makeGetRequest(url);if(r.error)return;pageController.save(r.text,'copy')},toggleLock:function(){popupController.closeLastPopup();this.highlight(this.selected);var page_id=this.page_id;var url="/-/cms/v1/page/?act=toggle_lock&"+access+"&page_id="+page_id;var r=util.makeGetRequest(url);if(r&&!r.error){$('.page-'+page_id).each(function(){var node=$.ui.dynatree.getNode($(this));if(r.text=='remove-ico'){if(node.data.access_mode=='all'){node.data.locked=false}node.data.addClass=node.data.addClass.replace('pageLocked','')}else if(r.text=='add-ico'){node.data.locked=true;node.data.addClass=node.data.addClass+' pageLocked'}node.render()});pageController.highlight(false)}},highlight:function(obj){if(this.selected)this.selected.className=this.selectedClassName;if(obj==false)return;this.selected=obj;this.selectedClassName=obj.className;obj.className="pageContextMenu"},pageDeselectInterface:function(){pageController.highlight(false)},contextMenu:function(obj,new_page_id,event){if(!treeStorage.updated){var popup_context=$('#'+this.divContextMenu).clone(),popup_context_id=this.divContextMenu+'_'+new_page_id,nodeMenuId=obj.dataset.menuId||0,offset=$(obj).parent().offset();popup_context.attr('id',popup_context_id);$(obj).parent().find('#'+popup_context_id).remove();$(obj).after(popup_context);this.page_id=new_page_id;if($(obj).hasClass('link')){$('#'+popup_context_id+' li.hide[data-json-params="true"]').removeClass('hide')}if($(obj).hasClass('link')||$(obj).hasClass('verification')){$('#'+popup_context_id+' .hide').hide()}else{$('#'+popup_context_id+' .hide').show()}if($(obj).hasClass('copyAllowed')){$('#'+popup_context_id+' .pageCopy').show()}else{$('#'+popup_context_id+' .pageCopy').hide()}if(nodeMenuId){$('#'+popup_context_id+' .menu-move-item-'+nodeMenuId).hide()}if(!pageController.update){S3ContextMenuController.openContextMenu('#'+popup_context_id,false,event,$(obj))}else{pageController.saveStructureFirstAlert()}}else{pageController.saveStructureFirstAlert()}},saveStructureFirstAlert:function(){s3.alert(s3.loc('JS_SAVE_OR_CANCEL_PAGE_ORDER_CHANGES_FIRST'),null)},getMenuModified:function(menu_id,menu_modified,page_id){var last_menu_modified='';$.ajax({type:"POST",url:'/-/cms/v1/menu/?act=get_modified&'+access,data:{'object_type':'menu','action':'modified','object_id':menu_id},async:false,success:function(data){var div=$('#page'+pageController.page_id);var f=function(){pageController.reloadMenu();popupController.closeLastPopup()};if(menu_modified!==data){s3.confirm(s3.loc('JS_MENU_CHANGED'),f,div.get(0))}last_menu_modified=data}});return last_menu_modified},reloadMenu:function(){pageController.update=false;s3.reloadContent()},moveToMenu:function(menu_id){if($('input.tree_changes').val()!=''&&$('input.tree_changes').parent().is(':visible')){s3.alert('Сперва сохраните порядок страниц');return}if(this.checkLocked(this.page_id)){return}popupController.closeLastPopup();this.highlight(this.selected);var page_id=this.page_id,target_menu_id=menu_id,url="/-/cms/v1/menu/?act=move&"+access+"&page_id="+page_id+"&target_menu_id="+target_menu_id;var r=util.makeGetRequest(url);if(r&&!r.error){pageController.highlight(false);$('.page-'+pageController.page_id).each(function(){var parent_node,node,parent;node=$.ui.dynatree.getNode($(this));parent=$(this).parents('li:first');parent_node=node.getParent();if(pageController.current_menu_id===target_menu_id){pageController.reloadMenu();return}node.removeChildren();if(parent.is('.dynatree-lastsib')&&parent.prev().size()){parent.prev().addClass('dynatree-lastsib')}node.remove();if(parent_node.hasChildren()===undefined||parent_node.hasChildren()===false){parent_node.expand(false);parent_node.removeChildren();parent_node.data.isFolder=false;parent_node.data.isLazy=false;parent_node.render()}});this.updatePagesCount()}},updatePagesCount:function(){var url="/-/cms/v1/menu/?act=get_page_count&"+access+"&menu_id=",r,item=$('.pages_num');url=url+item.attr('menu_id');r=util.makeGetRequest(url);if(r&&!r.error){item.html(r.text)}},checkLocked:function(page_id){var node=$.ui.dynatree.getNode($('.page-'+page_id));if(node&&node.data.addClass.indexOf('pageLocked')!=-1&&node.data.locked){s3.alert(s3.loc('JS_PAGE_LOCKED'));return true}return false},showPageInfo:function(page_id,obj){var self=pageController;if(self.timerPageInfo){clearTimeout(self.timerPageInfo)}self.timerPageInfo=window.setTimeout(function(){var e=util.getObject('pageInfo'+page_id);if(!e){return}var div=util.getObject(self.divPageInfo);if(!div){return}window.setTimeout(function(){var pos=util.findPos(obj);div.style.top=pos[1]-20;div.style.left=pos[0]+20;div.innerHTML=e.innerHTML;div.style.display='block'},3)},10)},hidePageInfo:function(){var self=pageController;if(self.timerPageInfo){window.clearTimeout(self.timerPageInfo)}window.setTimeout(function(){var div=util.getObject(self.divPageInfo);if(!div){return}div.style.display='none'},300)},expandDynatree:function(state){var node,childrens,self=this;if(popupController.getLastPopup()){childrens=$(popupController.getLastPopup().obj).find('.dynatree-has-children')}else{childrens=$('.dynatree-has-children')}childrens.each(function(){node=$.ui.dynatree.getNode($(this));if(!node.isExpanded()&&state==true){node.expand(true);self.expandDynatree(state)}else if(state==false){node.expand(false)}else{return}})},selectDynatreeBranch:function(state,choose_branch,clicked_folder_id,folder_id){var node,children,self=this;if(popupController.getLastPopup()){children=$(popupController.getLastPopup().obj).find('.folder-'+folder_id).parent().find('.dynatree-has-children')}else{children=$('.folder-'+folder_id+'.dynatree-has-children')}node=$.ui.dynatree.getNode($(this));if(children.hasClass('selected')){children.removeClass('selected')}else{children.addClass('selected')}children.each(function(){node=$.ui.dynatree.getNode($(this));if(!node.isExpanded()){node.expand(true);self.selectDynatreeBranch(state,choose_branch,clicked_folder_id,node.data.key)}if(state===true){var inputs=$(this).parent().find('input');$('#folder-branch-'+node.data.key+' a').text(s3.loc(choose_branch?'JS_CHOOSE_FOLDER':'JS_RESET_FOLDER'));$('#folder-branch-'+node.data.key).data('selected',!choose_branch);inputs.each(function(){var folder_id=$(this).val();if(parseInt(folder_id)!==parseInt(clicked_folder_id)&&((choose_branch&&$(this).attr('checked')==='checked')||(!choose_branch&&$(this).attr('checked')!=='checked'))){$('.s3-tree-wrapper-in.popup .folder-'+folder_id).find('span.checkbox label').click()}})}else if(state===false){node.expand(false)}else{return false}})},hideElements:function(){for(i=0;i<arguments.length;++i){$(arguments[i]).addClass('hidden')}},showElements:function(){for(i=0;i<arguments.length;++i){$(arguments[i]).removeClass('hidden')}},toggleElement:function(obj,target,duration){duration=(duration?duration:300);$(obj).toggleClass('toggled');$(target).slideToggle(duration,function(){if($(target).is(':visible')){var target_pos=$(target).offset().top;if(target_pos>$(window).height()+$(window).scrollTop()-50){$('html, body').animate({scrollTop:target_pos-50},500)}}})},setDefaultCMSPage:function(cookie_name,cookie_value){util.createCookie(cookie_name,cookie_value,24);util.msg(s3.loc('JS_SAVED'),'green')},saveCookie:function(name,value){util.createCookie(name,value,24);util.msg(s3.loc('JS_SAVED'),'green')},highlightPage:function(page_id,parents){if(parents.length){var parent_node;for(var i=0;i<parents.length;i++){parent_node=$.ui.dynatree.getNode($('#page'+parents[i]));parent_node.expand(true)}var page_node=$.ui.dynatree.getNode($('#page'+page_id)),target_page=$(page_node.span)}else{var page_node=$.ui.dynatree.getNode($('#page'+page_id)),target_page=$(page_node.span)}if(target_page.position().top>$(window).height()+$(window).scrollTop()-50){$('html, body').animate({scrollTop:target_page.position().top-50},500,function(){target_page.addClass('focused z-index')})}else{target_page.addClass('focused z-index')}setTimeout(function(){$(document).on('click',function(){target_page.removeClass('focused').addClass('accent');target_page.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){target_page.removeClass('z-index')})})},50)},transliterateFields:function(id1,id2){let fieldOne=$(`#${id1}`);let fieldTwo=$(`#${id2}`);let fieldOneValue=fieldOne.val();$.ajax({type:"POST",dataType:'json',url:'/-/cms/v1/page/?act=suggestUrlByText&'+access,data:{text:fieldOneValue},success:function(data){fieldTwo.val(data.url)}})}};pageController.toggleExpanded=function(obj){var parent=util.getParent(obj,'DIV');if(!parent)return;var isExpanded=(parent.className.indexOf(this.classBranchExpanded)!=-1?true:false);if(isExpanded){util.removeClass(parent,this.classBranchExpanded);util.addClass(parent,this.classBranchCollapsed);obj.src='/my/s3/images/ico-expand.gif'}else{util.addClass(parent,this.classBranchExpanded);util.removeClass(parent,this.classBranchCollapsed);obj.src='/my/s3/images/ico-collapse.gif'}};pageController.expandAll=function(obj,menuId){this.toggleExpandedAll(obj,true);util.createCookie(this.cookieSelectorState+menuId,'expanded',0.5)};pageController.collapseAll=function(obj,menuId){this.toggleExpandedAll(obj,false);util.createCookie(this.cookieSelectorState+menuId,'collapsed',0.5)};pageController.toggleExpandedAll=function(obj,expand){obj=util.getObject(obj);if(!obj)return;var classFrom,classTo,src;if(expand){classFrom=this.classBranchCollapsed;classTo=this.classBranchExpanded;src='/my/s3/images/ico-collapse.gif'}else{classFrom=this.classBranchExpanded;classTo=this.classBranchCollapsed;src='/my/s3/images/ico-expand.gif'}var a=util.getElementsByClassName(obj,'IMG','page-expand-collapse');var div;for(var i=0;i<a.length;i++){div=util.getParent(a[i],'DIV');util.removeClass(div,classFrom);util.addClass(div,classTo);a[i].src=src}};function accessSelectUser(object_id,obj){popupController.closeLastPopup();var z=$(obj).find('span.user_name').get(0);if(!z.innerHTML){z=$(obj).find('span b, span a').get(0)}var d;d=document.getElementById("access_user_id");d.value=object_id;d=document.getElementById("user_name");d.innerHTML=z.innerHTML;$('#accessUserSelect').addClass('hidden');$('#accessUserId').removeClass('hidden')}function accessDropUser(obj){$('#access_user_id').val('');$('#accessUserSelect').removeClass('hidden');$('#accessUserId').addClass('hidden')}function accessSelectFolder(obj,type_id){var res=function(i){var href=document.getElementById('folder'+i);var name=(href)?href.innerHTML:'';var d;d=document.getElementById('group_name');if(d)d.innerHTML=name;d=document.getElementById('access_group_id');if(d)d.value=i;popupController.closeLastPopup()};treeController.load('select2',type_id,0,obj,res);$('#accessGroupSelect').addClass('hidden');$('#accessGroupId').removeClass('hidden')}function accessDropFolder(obj){$(obj).remove();$('#access_group_id').val('');$('#accessGroupSelect').removeClass('hidden');$('#accessGroupId').addClass('hidden')}function selectElement(type,obj,object_id,form_name){var name=$('#'+type+object_id+'_name').text();if(!$('#pp_'+type+object_id).length){var img=$('<img>').attr({src:'/shared/shop2/statusx_op.gif',title:s3.loc('JS_DELETE'),width:'8',alt:s3.loc('JS_DELETE')});var inp=$('<input>').attr({type:'hidden',name:type+'s[]',value:object_id});var itm=$('<span>').text(name);var nbs='&nbsp;';var amt=$('<a>').attr({id:'pp_'+type+object_id,class:'discountSelectItem pp_'+type+object_id,onclick:'util.detachElement(this);'}).append(itm).append(nbs).append(img).append(inp);$('#'+form_name+'_'+type+'s').append(amt);util.msg(s3.loc('JS_ADDED'))}$(obj.parentElement.getElementsByClassName('objectAction')).replaceWith($('<span>'+s3.loc('JS_ADDED')+'</span>').css({float:'right',color:'#777777'}));return false}$(document).on("change",'#page_key_field',function(){var importMode=$('#page_import_mode select'),pageMenu=$('#page_menu select');if(!importMode){return}if($(this).find('option:selected').val()=='page_id'){importMode.find('option').eq(1).attr('disabled',true);importMode.find('option').eq(0).attr('selected',true);if(pageMenu){pageMenu.attr('disabled',true)}}else{importMode.find('option').eq(1).attr('disabled',false);if(pageMenu){pageMenu.attr('disabled',false)}}if(pageMenu){pageMenu.trigger("liszt:updated")}importMode.trigger("liszt:updated")});var templateLibraryController={proxyBlocks:[],};templateLibraryController.open=function(){var url="/-/cms/v1/template/library/?"+access;openAjaxForm(url,false,this.tooltipHide.bind(this));var last=popupController.getLastPopup();if(last&&last.obj){$(last.obj).on('click',function(e){e.stopPropagation()})}return false};templateLibraryController.search=function(obj){var keyword=obj.elements.keyword.value.toLowerCase().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").trim();if(!keyword||templateLibraryController.isProcessed){return false}templateLibraryController.isProcessed=true;var resultsCount=0;$('.template-library__search-results').find('.template-library__row').empty();$('.template-library__listScroll').find('.template-library__card').each(function(){if($(this).data('tpl-name').toString().toLowerCase().search(keyword)>=0||$(this).data('tpl-filename').toString().toLowerCase().search(keyword)>=0){$('.template-library__search-results').find('.template-library__row').append($(this).clone());resultsCount++}});$('.template-library__group-select').addClass('template-library__group-select--hidden');$('.template-library__listScroll--main-list').addClass('template-library__listScroll--hidden');$('.template-library__to-group-list').removeClass('template-library__to-group-list--hidden');$('.template-library__search-results').removeClass('template-library__search-results--hidden').S3ChangeControls();if(resultsCount==0){$('.template-library__search-results').find('.template-library__row').html('<div class="template-library__message">'+s3.loc('JS_NOTHING_FOUND')+'</div>')}templateLibraryController.isProcessed=false;$('.template-library__group').removeClass('template-library__group--active');return false};templateLibraryController.searchHide=function(){$('.template-library__group-select').removeClass('template-library__group-select--hidden');$('.template-library__listScroll').removeClass('template-library__listScroll--hidden').scrollTop(0);$('.template-library__to-group-list').addClass('template-library__to-group-list--hidden');$('.template-library__search-results').addClass('template-library__search-results--hidden')};templateLibraryController.scrollToTemplateGroup=function(groups_container,group_selector,scrollspeed){if(scrollspeed!==0&&!scrollspeed){scrollspeed=500}if(groups_container&&group_selector){groups_container.animate({scrollTop:group_selector.position().top+groups_container.scrollTop()-50},scrollspeed,"easeOutQuint")}};templateLibraryController.templatePreviewUploadCall=function(event,template_id,template_preset_id){event.stopPropagation();var controller=template_preset_id?'template/preset':'template/library';var url='/-/cms/v1/'+controller+'/?act=edit_preview&'+access+'&template_id='+template_id+'&template_preset_id='+template_preset_id;openAjaxForm(url,function(){popupController.closeLastPopup();s3.reloadVisibleContent()})};templateLibraryController.templateEditCall=function(event,template_id,template_preset_id){event.stopPropagation();const controller=template_preset_id?'template/preset':'template/library';const url='/-/cms/v1/'+controller+'/?act=edit&'+access+'&template_id='+template_id+'&template_preset_id='+template_preset_id;openAjaxForm(url,function(){popupController.closeLastPopup();s3.reloadVisibleContent()})};templateLibraryController.templateDeleteCall=function(event,template_id,template_preset_id){event.stopPropagation();const act='delete';const controller=template_preset_id?'template/preset':'template/library';const url=`/-/cms/v1/`+controller+`/?act=${act}&${access}&template_id=${template_id}&template_preset_id=${template_preset_id}`;s3.confirmGreen(s3.loc('JS_CONFIRM_DELETE'),function(){if(util.touchUrl(url)){util.msg(s3.loc('JS_DELETED'));popupController.closeLastPopup();if(popupController.getLastPopup()){popupController.closeLastPopup()}s3.reloadVisibleContent()}},null,'red')};templateLibraryController.templateAddCall=function(event){event.stopPropagation();var url='/-/cms/v1/template/library/?act=add&'+access;openAjaxForm(url,function(){popupController.closeLastPopup();s3.reloadVisibleContent()})};templateLibraryController.templateAddPresetCall=function(event){event.stopPropagation();var url='/-/cms/v1/template/preset/?act=add&'+access;openAjaxForm(url,function(){popupController.closeLastPopup();s3.reloadVisibleContent()})};templateLibraryController.toggleAccess=function(obj,template_id,template_preset_id){var $card=$(obj).closest('.template-library__card');var url="/-/cms/v1/template/library/?act=toggle&"+access;$.post(url,{template_id:template_id,template_preset_id:template_preset_id},function(res){if(!res){return}res=JSON.parse(res);if($.type(res.item)=='string'){$card.replaceWith(res.item)}if($.type(res.list)=='string'){var $list=$(res.list);$('.template-panel').replaceWith($list);$list.show()}res.message&&alert(res.message);if(res.access){popupController.closeLastPopup();templateLibraryController.tooltipHide();S3PageController.selectPageViewType.silentMode=true;$('.template-panel__item--focused').trigger('click');S3PageController.selectPageViewType.silentMode=false}});return false};templateLibraryController.toggleTab=function($tabs,$activeTab,$tabTitles,$activeTabTitle){var hiddenClass='template-library--hidden';var activeClass='template-library--active';$tabTitles.removeClass(activeClass);$activeTabTitle.addClass(activeClass);if($activeTab){$tabs.addClass(hiddenClass);$activeTab.removeClass(hiddenClass);$tabs.removeClass(activeClass);$activeTab.addClass(activeClass)}else{$tabs.removeClass(hiddenClass);$tabs.removeClass(activeClass)}};templateLibraryController.listScrollInit=function(scrollContainer,scrollRow,scrollSelect){scrollContainer.on('scroll',$.debounce(300,function(){if(!$(this).is(':animated')){$(this).find(scrollRow).each(function(){if($(this).position().top-50<0&&$(this).height()-50+$(this).position().top>0){var val="#"+$(this).attr('id');scrollSelect.val(val).trigger("chosen:updated").trigger("liszt:updated")}})}}))};templateLibraryController.toggleListView=function(view_type){switch(view_type){case'extended':$('.template-library__list').removeClass('template-library__list--simple template-library__list--medium');break;case'medium':$('.template-library__list').removeClass('template-library__list--simple').addClass('template-library__list--medium');break;case'simple':$('.template-library__list').removeClass('template-library__list--medium').addClass('template-library__list--simple');break}util.createCookie('template_library_view',view_type,24)};templateLibraryController.getTooltip=function(){var $tooltip=this.$tooltip;if(!$tooltip){$tooltip=$('<div class="template-library__tooltip"></div>');$(document.body).append($tooltip);this.$tooltip=$tooltip}return $tooltip};templateLibraryController.tooltipHide=function(){this.getTooltip().hide()};templateLibraryController.tooltip=(function(event,el,content){var $el=$(el);if($el.data('has-tooltip')||!content){return}$el.data('has-tooltip',true);var winWidth;var winHeight;var $window=$(window);var $tooltip=this.getTooltip();$el.on({mouseenter:function(){winWidth=$window.width();winHeight=$window.height();$tooltip.html(content);$tooltip.show()},mouseleave:function(){$tooltip.hide();$tooltip.html('')},mousemove:function(e){var left=e.pageX;var top=e.pageY;var scrollTop=$(document).scrollTop();var width=$tooltip.outerWidth(true);var height=$tooltip.outerHeight(true);if(left+width>winWidth){left-=width}top-=height;if(top<scrollTop){top=scrollTop}$tooltip.css({left:left,top:top})}});$el.trigger('mouseenter',event);$el.trigger('mousemove',event)}).bind(templateLibraryController);templateLibraryController.translit=(function(){var map={'Ё':'yo','Й':'y','Ц':'c','У':'u','К':'k','Е':'e','Н':'n','Г':'g','Ш':'sh','Щ':'sch','З':'z','Х':'h','Ъ':'-','Ф':'f','Ы':'y','В':'v','А':'a','П':'p','Р':'r','О':'o','Л':'l','Д':'d','Ж':'zh','Э':'e','Я':'ya','Ч':'ch','С':'s','М':'m','И':'i','Т':'t','Ь':'-','Б':'b','Ю':'yu',' ':'_','ё':'yo','й':'y','ц':'c','у':'u','к':'k','е':'e','н':'n','г':'g','ш':'sh','щ':'sch','з':'z','х':'h','ъ':'-','ф':'f','ы':'y','в':'v','а':'a','п':'p','р':'r','о':'o','л':'l','д':'d','ж':'zh','э':'e','я':'ya','ч':'ch','с':'s','м':'m','и':'i','т':'t','ь':'-','б':'b','ю':'yu','(':'-',')':'-'};return function(word){return word.split('').map(function(char){if(typeof map[char]!=='undefined'){return map[char]}return char}).join('')}})();templateLibraryController.searchPresetBlocksCall=function(form){let url=popupController.getLastPopup().url;url+=formcontents(form);popupController.reloadLastPopup(url)};templateLibraryController.addBlockToPreset=function(block){this.proxyBlocks.push(block);util.msg(s3.loc('JS_ADDED'))};templateLibraryController.deleteBlockFromPreset=function(index){if(this.proxyBlocks.indexOf(index)){s3.confirmGreen(s3.loc('JS_TEMPLATE_PRESETS_DELETE_BLOCK_CONFIRM'),function(){popupController.closeLastPopup();templateLibraryController.proxyBlocks.splice(index,1)},null,'red')}};templateLibraryController.presetBlocksInit=function(blocks,preset_id){this.proxyBlocks=new Proxy(blocks,{deleteProperty:function(target,property){delete target[property];templateLibraryController.renderPresetBlockList(target);return true},set:function(target,property,value,receiver){target[property]=value;templateLibraryController.renderPresetBlockList(target);return true}});templateLibraryController.renderPresetBlockList(blocks);$('.template-preset-form__blocks-list').sortable({cursor:"move",placeholder:"s3_sortable_placeholder",handle:'.handle',items:"li:not(.controls)"}).on("sortupdate",function(event,ui){const fromIndex=$(ui.item).data('index');const toIndex=$(ui.item).index()-1;const element=templateLibraryController.proxyBlocks[fromIndex];templateLibraryController.proxyBlocks.splice(fromIndex,1);templateLibraryController.proxyBlocks.splice(toIndex,0,element)});this.presetId=+preset_id};templateLibraryController.getBlockItemTpl=function(block,index){return`<li data-index="${index}"class="data-list-item"><input type="hidden"name="blocks[${index}][layout_id]"value="${block.layout_id}"><input type="hidden"name="blocks[${index}][lp_block_preset_id]"value="${block.lp_block_preset_id ?? 0}"><span class="item-col handle"></span><span class="item-col name">${block.name}</span><span class="item-col id"><span>/</span><span>ID:${block.layout_id}</span></span><span class="right"><span class="col-btn"title="${s3.loc('DELETE')}"onClick="templateLibraryController.deleteBlockFromPreset(${index})"><span class="s3-ico i-delete-svg"></span></span></span></li>`};templateLibraryController.renderPresetBlockList=function(blocks=[]){const container=$('.template-preset-form__blocks-list');if(container.get(0)){container.find('li.data-list-item').remove();blocks.forEach((block,index)=>{container.append(templateLibraryController.getBlockItemTpl(block,index))})}};templateLibraryController.groupAddBlocksToPreset=function(selector){const container=$(selector);if(!container.get(0)){return}const selected=container.find('.s3-table-list__tr.active');if(!selected.length){s3.alert(s3.loc('JS_NO_OBJECTS_CHOSEN_ERROR'));return}selected.each(function(){templateLibraryController.addBlockToPreset({layout_id:$(this).data('layout-id'),name:$(this).data('name')})});util.msg(s3.loc('JS_ADDED'));popupController.reloadLastPopup()};templateLibraryController.openPresetBlocksPopup=function(){const url=`/-/cms/v1/template/preset/?act=select_block_layout&${access}&preset_id=${this.presetId}`;s3.openModalPopup(url)};templateLibraryController.changePresetId=function(e){this.presetId=+e.value};templateLibraryController.sortGroupsInit=function(){let $this=$(document).find('#template_library_groups');if($this.hasClass('ui-sortable')){return}$($this).sortable({cursor:"move",placeholder:"s3_sortable_placeholder",handle:'.handle',items:"li:not(.controls)"}).on("sortupdate",function(){var positions=$($this).sortable('toArray',{attribute:'data-id'});$.post('/-/cms/v1/template/library/?act=sort_groups&'+access,{positions:positions}).success(function(){s3.reloadContent()})})};var translateController={view:'short',ru:['ua','et']};translateController.init=function(){$('.template-translate .s3-rb.active').trigger('click')};translateController.open=function(object_id,type){var url=s3.makeURL('/-/cms/v1/template/?act=translate&',{popup:1,object_id:object_id,type:type,mode:'view'});s3.openModalPopup(url,false)};translateController.save=function(object_id,type,form){var url=s3.makeURL('/-/cms/v1/template/?act=translate&',{object_id:object_id,type:type,mode:'save'});var $form=$(form);$.post(url,$form.serializeObject()).done(function(res){s3.processResponse(res,{$replace:$form})});return false};translateController.remove=function(object_id,type,button){if(!confirm('Уверены?')){return false}var $button=$(button);var $row=$button.closest('tr');var $form=$row.closest('form');var values={};$row.find('input').each(function(i,node){var $node=$(node);var name=$node.attr('name').replace(/^d\[\d+\]\[([^\]]+)\]$/,'d[$1]');values[name]=$node.val()});var url=s3.makeURL('/-/cms/v1/template/?act=translate&',{object_id:object_id,type:type,mode:'remove'});$.post(url,values).done(function(res){s3.processResponse(res,{$replace:$form})});return false};translateController.setView=function(view,input){$('.template-translate').removeClass('template-translate--'+this.view).addClass('template-translate--'+view);this.view=view};translateController.donor=function(el,lang){var $el=$(el);var val=$el.val();var group=$el.data('group');var prev=$el.data('prev');var self=this;$el.data('prev',val);$('.template-translate__text-input[data-group="'+group+'"]').each(function(){var $this=$(this);var code=$this.data('lang_code');if(code=='ru'||code=='en'){return}if(lang=='ru'){if($.inArray(code,self.ru)!==-1){setValue($this,val)}return}if(lang=='en'){if($.inArray(code,self.ru)===-1){setValue($this,val)}return}});function setValue($el,value){var val=$el.val();if(val==''||val==prev){$el.val(value)}}};translateController.addKey=function(object_id,type){var key=prompt('Введите ключ','');if(key){var url=s3.makeURL('/-/cms/v1/template/?act=translate&',{mode:'add',object_id:object_id,type:type});$.post(url,{key:key}).done(function(res){s3.processResponse(res,{$replace:$('.template-translate__table').closest('form')})})}};translateController.search=function(object_id,type,form){var keyword=$.trim(form.elements.keyword.value);var url=s3.makeURL('/-/cms/v1/template/?act=translate&',{mode:'search',object_id:object_id,type:type,keyword:keyword});$.get(url).done(function(res){s3.processResponse(res,{$replace:$('.template-translate__table').closest('form')})});return false};translateController.control={toggle:function(ctx){$(ctx).closest('.s3-input-text-group').find('.s3-input-text-group__item--hidden').toggle()}};function sizeme(){var s="";s+="\ndocument.body.scrollHeight: "+document.body.scrollHeight;s+="\ndocument.documentElement.clientHeight: "+document.documentElement.clientHeight;s+="\nwindow.screen.height: "+window.screen.height;s+="\ndocument.body.offsetHeight: "+document.body.offsetHeight;s+="\nwindow.innerHeight: "+window.innerHeight;s+="\ndocument.body.clientHeight: "+document.body.clientHeight;var size=util.clientSize();s+="\n\nMath.max(document.body.scrollHeight,size.h): ("+document.body.scrollHeight+","+size.h+")";alert(s)}function showInnerHtml(){var p=popupController.getLastPopup().obj.innerHTML;var popup=new PopupWindow('a');popup.x=200;popup.y=50;popupController.showPopup(popup);popupController.setLastPopupContent("<textarea style='width:700;height:400;padding:10px;border: 1px solid black'>"+p+"</textarea>")}function switchDivLink(a,id,textOn,textOff){var d=document.getElementById(id);var s=util.getStyle(d,'display');if(s=='none'){a.innerHTML=textOff;d.style.display='block'}else{a.innerHTML=textOn;d.style.display='none'}}function openDataNavigator(typeCode,plugin_id,query_id,object_id,multiple,selector,title,type_group_id,global,onClose){var func=false;var script=(multiple)?'index':'edit';if(typeof onClose!=='function'){onClose=false}if(!object_id){if(type_group_id>0){script='edit_group_item';func=function(r){popupController.closeLastPopup();popupController.reloadLastPopup()}}else if(!plugin_id||multiple){func=function(r){popupController.closeLastPopup();popupController.reloadLastPopup()}}else{func=function(r){popupController.reloadPreviousPopup();popupController.setLastPopupContent(r.text,r.url)}}}else{if(type_group_id>0){script='edit_group_item';func=function(r){popupController.closeLastPopup();popupController.reloadLastPopup()}}else if(plugin_id>0&&!multiple){script='view'}else{func=function(r){popupController.closeLastPopup()}}}var global=global?1:0;var controller=typeCode.replace('_','-');var params='';if(selector){var url='/-/cms/v1/selector/?popup=1&code='+typeCode+'&multiple='+multiple+'&object_id='+object_id+'&'+access+'&query_id='+query_id+'&global='+global+'&act='+script}else{if(typeCode==='catalog'){controller='catalog-links'}if(typeCode==='article2_lenta'){controller='article2'}if(typeCode==='json_meta_global'){typeCode='json_meta';controller='json-meta'}if(typeCode==='textplain'){controller='text-plain'}if(typeCode==='content_lp'){controller='lp';params='&content=1'}if(typeCode==='json_meta'&&script==='edit_group_item'){controller='json';script='editItem'}var url='/-/cms/v1/'+controller+'/?act='+snakeToCamel(script)+'&popup=1&multiple='+multiple+'&object_id='+object_id+'&'+access+'&query_id='+query_id+'&global='+global+'&title='+encodeURIComponent(title)+'&type_group_id='+type_group_id+params;if(!multiple){var onCloseAlert=function(r){popupController.reloadLastPopup()}}}openAjaxForm(url,func,onClose,undefined,undefined,undefined,onCloseAlert)}function snakeToCamel(str){return str.replace(/(?!^)_(.)/g,(_,char)=>char.toUpperCase())}function register(e){var code=false;if(!e)var e=window.event;if(e.keyCode)code=e.keyCode;else if(e.which)code=e.which;if(code==27){if(tinyMCE&&tinymce.activeEditor&&tinymce.activeEditor.windowManager&&tinymce.activeEditor.windowManager.windows.length){tinymce.activeEditor.windowManager.close()}else if(typeof CKEDITOR!=='undefined'&&CKEDITOR&&CKEDITOR.dialog.getCurrent()){CKEDITOR.dialog.getCurrent().hide()}else{if(window.popups[window.popups.length-1]==='s3'||S3PopUp.getLastPopup().s3PopupType==='dynamic'){if(window.popups[window.popups.length-2]==='s3-react'){e.stopImmediatePropagation()}S3PopUp.closeLastPopup()}ContextHelp._close()}if(util.readCookie('offset_submit')){Shop2Controller.closeShop2SearchFull()}}}function openAjaxForm(url,onSubmit,onClose,onUpdate,putParams,onContentReady,onCloseAlert){var popup=new PopupWindow('ajaxPopupWindow_'+popupController.popups.length);popup.url=url;popup.drag=true;popup.modal=true;popup.center=true;popup.onSuccessPost=onSubmit;popup.onClose=onClose;popup.onUpdate=onUpdate;popup.onContentReady=onContentReady;popup.onCloseAlert=onCloseAlert;if(putParams){popup.putParams=typeof putParams=='string'?putParams:$.param(putParams)}popupController.showPopup(popup);return popup}function getQueryValue(q,k){var pairs=q.split('&');for(var i=0;i<pairs.length;i++){var a=pairs[i].split('=');if(a[0]==k)return a[1]}return false}function formcontents(form){return getFormDataAsString(form)}function getFormDataAsString(form){let fieldsThatConvertToJson=[];let formData=formParamsHelpers.getFormData(form);const input=form.elements[formParamsHelpers.FIELDS_POST_JSON];if(input){fieldsThatConvertToJson=input.value.split(',').filter(Boolean)}if(!fieldsThatConvertToJson.length){return formParamsHelpers.convertFormDataToString(formData)}const regexList=fieldsThatConvertToJson.map((field)=>{const fieldName=field.trim().replace(/[\-\[\]{}()*+?.,\\^$|]/g,"\\$&");return new RegExp('^('+fieldName+'){1}(?:\\[[a-z\\d\\_\\/\\:\\-]*\\])*$')});let formDataObject=formParamsHelpers.convertFormDataToObject(formData,regexList);formData=formParamsHelpers.removeValuesFromFormData(formData,regexList);let params=formParamsHelpers.convertFormDataToString(formData);fieldsThatConvertToJson.forEach((field)=>{if(formDataObject.hasOwnProperty(field)){params+="&"+field+"="+encodeURIComponent(JSON.stringify(formDataObject[field]))}});return params}function getFormData(form){var url="";for(var i=0;i<form.elements.length;i++){if(form.elements[i].disabled==true){continue}if(form.elements[i].type)switch(form.elements[i].type.toLowerCase()){case"button":break;case"reset":break;case"submit":break;case"radio":if(form.elements[i].checked)url+=form.elements[i].name+"="+encodeURIComponent(form.elements[i].value)+"&";break;case"checkbox":if(form.elements[i].getAttribute('data-send-name')=="always"){if(form.elements[i].checked){url+=form.elements[i].name+"=1&"}else{url+=form.elements[i].name+"=0&"}}else if(form.elements[i].checked){url+=form.elements[i].name+"="+encodeURIComponent(form.elements[i].value)+"&"}break;case"select-one":if(form.elements[i].selectedIndex!=-1)url+=form.elements[i].name+"="+encodeURIComponent(form.elements[i].options[form.elements[i].selectedIndex].value)+"&";break;case"select-multiple":for(var v=0;v<form.elements[i].options.length;++v){if(form.elements[i].options[v].selected)url+=form.elements[i].name+"="+encodeURIComponent(form.elements[i].options[v].value)+"&"}break;case"textarea":if(form.elements[i].id.indexOf('default_map_data')!=-1){var str=form.elements[i].id;str=str.replace(/default_map_data/,"");amMap.getMapObj(str).getZoomInfo()}else if(form.elements[i].className=="mceEditor"&&form.elements[i].id&&(tinyMCE||CKEDITOR)){if(tinyMCE){url+=form.elements[i].name+"="+encodeURIComponent(tinymceController.getContent(form.elements[i]))+"&"}else{url+=form.elements[i].name+"="+encodeURIComponent(ckeditorController.getContent(form.elements[i]))+"&"}}else{url+=form.elements[i].name+"="+encodeURIComponent(form.elements[i].value)+"&"}break;default:url+=form.elements[i].name+"="+encodeURIComponent(form.elements[i].value)+"&";break}}url=url.substr(0,(url.length-1));return url}function contentload(url){if(url!='')contentLastUrl=url;var r=util.makeGetRequest(contentLastUrl);if(r.error==true){s3.alert("Error. Content load.")}else{contentset(r.text)}}var _processing_post_ajax_form=0;function setProcessingPostAjaxForm(mode){_processing_post_ajax_form=mode};function postAjaxForm(url,f,update,onSuccess){if(_processing_post_ajax_form){return false}_processing_post_ajax_form=1;let params=formcontents(f);var r=util.makePostRequest(url,params);if(!r||r.error==true){window.setTimeout("_processing_post_ajax_form=0",0)}else{if(util.readCookie('need_save_json_changes')){util.eraseCookie('need_save_json_changes')}if(r.close){if(update){popupController.updatePostLastPopup(r)}else{popupController.successPostLastPopup(r)}}else{if(popupController.getLastPopup()){popupController.setLastPopupContent(r.text)}else{if(r.text&&r.url){s3.setContent(r.text,r.url)}else{s3.reloadContent()}}}try{let responseText=JSON.parse(r.text);if(responseText.warning){s3.alert(responseText.warning)}}catch(e){}if(onSuccess){if(typeof onSuccess=="string"){util.msg(onSuccess)}else if(typeof onSuccess=="function"){onSuccess(r)}}}window.setTimeout("_processing_post_ajax_form=0",0);return false};function showHideDiv(obj_id,obj_link){var obj=document.getElementById(obj_id);if(obj&&obj_link){if(obj.style.display=='none'){obj.style.display='block';obj_link.style.backgroundColor='white'}else{obj.style.display='none';obj_link.style.backgroundColor=''}}}(function(){var _st=window.setTimeout})();if(typeof RegExp.escape!="function"){RegExp.escape=function(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}}if(typeof String.prototype.trim!="function"){String.prototype.trim=function(){return this.replace(/^[\t\s\n\r]+/,'').replace(/[\t\s\n\r]+$/,'')}}function openHTMLContent(selector,blank){blank=(typeof blank==="undefined")?true:blank;var obj=util.getObject(selector);if(!obj){return}var div=document.createElement('div');div.innerHTML=obj.innerHTML;$(div).find('fieldset').replaceWith(function(){$(this).replaceWith("<div>"+$(this).html()+"</div>")});if(blank){w=window.open('','_blank')}else{var w=window.open('',selector,'width=700,height=600,toolbar=0,directories=0,menubar=0,status=0,resizable=1,location=0,scrollbars=yes,copyhistory=0,top=10,left=10')}w.document.write('<html><head>');w.document.write('<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>');w.document.write('</head><body>');w.document.write(div.innerHTML);w.document.write('</body></html>');w.document.close();w.focus()}function printContent(obj,blank){blank=(typeof blank==="undefined")?true:blank;obj=util.getObject(obj);if(!obj)return;var div=document.createElement('div');div.innerHTML=obj.innerHTML;$(div).find('fieldset').replaceWith(function(){$(this).replaceWith("<div>"+$(this).html()+"</div>")});if(blank){w=window.open('','_blank')}else{var w=window.open('','printme','width=700,height=600,toolbar=0,directories=0,menubar=0,status=0,resizable=1,location=0,scrollbars=yes,copyhistory=0,top=10,left=10')}w.document.write('<html><head>');w.document.write('<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>');w.document.write('<link rel="stylesheet" href="'+location.protocol+"//"+location.host+'/my/s3/css/staff2.css" type="text/css" charset="utf-8"/>');w.document.write('<link rel="stylesheet" href="'+location.protocol+"//"+location.host+'/my/s3/css/redesign/shop2.order.css?rnd='+Date.now()+'" type="text/css" charset="utf-8"/>');w.document.write('<style>.prn-hidden{display: none !important} table {border: 1px solid #666666 !important} .no-print-order-comment{display: none !important;} </style>');w.document.write('</head><body>');w.document.write(div.innerHTML);w.document.write('</body></html>');w.document.close();w.focus();w.setTimeout(function(){w.print()},1000)}let formParamsHelpers={FIELDS_POST_JSON:'fields_post_json',getFormData:function(form){const formData=[];for(let i=0;i<form.elements.length;i++){if(form.elements[i].disabled===true||!form.elements[i].type||(!form.elements[i].name&&!form.elements[i].value)){continue}switch(form.elements[i].type.toLowerCase()){case"button":break;case"reset":break;case"submit":break;case"radio":if(form.elements[i].checked){formData.push({name:form.elements[i].name,value:form.elements[i].value})}break;case"checkbox":if(form.elements[i].getAttribute('data-send-name')==='always'){if(form.elements[i].checked){formData.push({name:form.elements[i].name,value:'1'})}else{formData.push({name:form.elements[i].name,value:'0'})}}else if(form.elements[i].checked){formData.push({name:form.elements[i].name,value:form.elements[i].value})}break;case"select-one":if(form.elements[i].selectedIndex!==-1){formData.push({name:form.elements[i].name,value:form.elements[i].options[form.elements[i].selectedIndex].value})}break;case"select-multiple":for(let v=0;v<form.elements[i].options.length;++v){if(form.elements[i].options[v].selected){formData.push({name:form.elements[i].name,value:form.elements[i].options[v].value})}}break;case"textarea":if(form.elements[i].id.indexOf('default_map_data')!==-1){let str=form.elements[i].id;str=str.replace(/default_map_data/,"");amMap.getMapObj(str).getZoomInfo()}else if(form.elements[i].className==="mceEditor"&&form.elements[i].id&&(tinyMCE||CKEDITOR)){if(tinyMCE){formData.push({name:form.elements[i].name,value:tinymceController.getContent(form.elements[i])})}else{formData.push({name:form.elements[i].name,value:ckeditorController.getContent(form.elements[i])})}}else{formData.push({name:form.elements[i].name,value:form.elements[i].value})}break;default:formData.push({name:form.elements[i].name,value:form.elements[i].value});break}}return formData},convertFormDataToObject:function(formData,regexList=[]){let objectData={},pushCounters={};const patterns={"validate":/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_\/:\-]+)\])*$/,"key":/[a-zA-Z0-9_\/:\-]+|(?=\[\])/g,"push":/^$/,};function build(base,key,value){base[key]=value;return base}function pushCounter(key){if(pushCounters[key]===undefined){pushCounters[key]=0}return pushCounters[key]++}$.each(formData,function(){if(regexList.length&&!util.isMatch(this.name,regexList)){return}if(!patterns.validate.test(this.name)){return}let k,keys=this.name.match(patterns.key),merge=this.value,reverse_key=this.name;while((k=keys.pop())!==undefined){reverse_key=reverse_key.replace(new RegExp("["+k.replace(/-/g,'\\-')+"]$"),'');if(k.match(patterns.push)){merge=build([],pushCounter(reverse_key),merge)}else{merge=build({},k,merge)}}objectData=$.extend(true,objectData,merge)});return objectData},convertFormDataToString:function(formData){let params='';formData.forEach((value)=>{params+="&"+value.name+"="+encodeURIComponent(value.value)});return params},removeValuesFromFormData:function(formData,regexList){regexList.push(new RegExp('^'+formParamsHelpers.FIELDS_POST_JSON));return formData.filter((element)=>{if(util.isMatch(element.name,regexList)){return}return element})},};function dec2hex(dec){dec=Math.floor(dec);var hexChars="0123456789ABCDEF";var a=dec%16;var b=(dec-a)/16;var hex=""+hexChars.charAt(b)+hexChars.charAt(a);while(hex.length<2)hex="0"+hex;return hex}function hex2dec(hex){var hexChars="0123456789ABCDEF";var dec=0;var a=0;hex=hex.toUpperCase();for(var i=0;i<hex.length;i++){a=hexChars.indexOf(hex.charAt(i));dec+=a*Math.pow(16,hex.length-i-1)}return dec}var fadeController={timerID:0,delta:false,step:0,current:false,iteration:0,iterations:false,steps:0,end:false,timeout:0,elementBackgroundColor:false,visibleBackgroundColor:false,init:function(obj){if(this.timerID){this.stop()}this.element=util.getObject(obj);if(!this.element)return;var el_bg_color=util.getStyle(this.element,'backgroundColor');var parent_bg_color=util.getParentStyle(this.element,'backgroundColor','transparent');if(!el_bg_color||!parent_bg_color){return}this.elementBackgroundColor=this.color(el_bg_color);this.visibleBackgroundColor=this.color(parent_bg_color);this.current=this.rgb(this.visibleBackgroundColor);this.iterations=new Array();var effects=new Array;effects[0]=[[1,0,'#cccccc'],[20,30,false]];effects[1]=[[20,30,'#ffff00'],[1,500,'#ffff00'],[20,50,false]];var effect=(arguments[1])?arguments[1]:0;this.iterations=effects[effect];this.iteration=0;this.nextIteration()},nextIteration:function(){if(this.iteration>=this.iterations.length){this.stop();return}this.step=0;this.steps=this.iterations[this.iteration][0];this.timeout=this.iterations[this.iteration][1];this.end=this.iterations[this.iteration][2]?this.rgb(this.iterations[this.iteration][2]):this.rgb(this.visibleBackgroundColor);this.delta=new Array((this.end[0]-this.current[0])/this.steps,(this.end[1]-this.current[1])/this.steps,(this.end[2]-this.current[2])/this.steps);this.fade();this.iteration++},rgb:function(color){return new Array(hex2dec(color.substr(1,2)),hex2dec(color.substr(3,2)),hex2dec(color.substr(5,2)))},color:function(color){var matches=color.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(matches){color="#"+dec2hex(matches[1])+dec2hex(matches[2])+dec2hex(matches[3])}return color},stop:function(){if(this.timerID)window.clearTimeout(this.timerID);this.element.style.backgroundColor=''},fade:function(){if(this.step>=this.steps){this.nextIteration();return}this.current[0]+=this.delta[0];this.current[1]+=this.delta[1];this.current[2]+=this.delta[2];var color="#"+dec2hex(this.current[0])+dec2hex(this.current[1])+dec2hex(this.current[2]);this.element.style.backgroundColor=color;this.step++;this.timerID=window.setTimeout('fadeController.fade()',this.timeout)}};var uploader={elementTagName:'',container:null,folder_id:null,obj:null,thumbnail:'',lang:{errUpload:JS_ERROR_UPLOAD,errFileMaxTotalFileSizeExceeded:JS_ERROR_FILE_MAX_TOTAL_FILE_SIZE_B_EXCEEDED,errFileMaxFileSizeExceeded:JS_ERROR_FILE_MAX_FILE_SIZE_B_EXCEEDED,errFileIsNotImage:JS_ERROR_UPLOAD_NON_IMAGE_FILETYPE,errNoFile:JS_ERROR_UPLOAD_NO_FILE,errNoImageURL:JS_ERROR_UPLOAD_NON_IMAGE_URL,errLimitExcceded:JS_ERROR_STORAGE_LIMIT_EXCCEDED},checkForHTML5FileAPI:function(){if(!(window.File&&window.FileReader&&window.FileList&&window.FormData))return false;return true},uploadObject:function(obj,tagName,containerID,url,upload_url,folderId,postParams){var self=this;url=util.urlParamReplace(url,'upload_type',1);this.editObject(obj,tagName,containerID,url,folderId);upload_url=util.urlParamReplace(upload_url,'upload_type','');this.initHTML5Upload(upload_url,"file",postParams);popupController.getLastPopup().onAfterReload=function(){self.initHTML5Upload(upload_url,"image",postParams)};return false},uploadObjectAndReloadContent:function(obj,tagName,containerID,url,upload_url,folderId,postParams){var self=this;url=util.urlParamReplace(url,'upload_type',1);this.editObject(obj,tagName,containerID,url,folderId);upload_url=util.urlParamReplace(upload_url,'upload_type','');this.initHTML5Upload(upload_url,"file",postParams,s3.reloadContent);popupController.getLastPopup().onAfterReload=function(){self.initHTML5Upload(upload_url,"file",postParams,s3.reloadContent)};return false},uploadImageObject:function(obj,tagName,containerID,url,upload_url,folderId,postParams){var self=this;url=util.urlParamReplace(url,'upload_type',1);this.editObject(obj,tagName,containerID,url,folderId);upload_url=util.urlParamReplace(upload_url,'upload_type','');self.initHTML5Upload(upload_url,"image",postParams);popupController.getLastPopup().onAfterReload=function(){self.initHTML5Upload(upload_url,"image",postParams)};return false},importImages:function(popupUrl,uploadUrl,postParams,completeCallback){openAjaxForm(util.urlParamReplace(popupUrl,'popup',1),false,false);var self=this;var p=popupController.getLastPopup();p.onAfterReload=function(){self.initHTML5Upload(uploadUrl,"image",postParams,completeCallback)};p.onAfterReload()},editObject:function(obj,tagName,containerID,url,folder_id){this.elementTagName=tagName;this.obj=util.getElement(obj,this.elementTagName);this.folder_id=folder_id;if(selector.taken(this.obj,obj))return false;if(containerID=='UL'||containerID=='DIV'||containerID=='TBODY'){var e=util.getElement(obj,tagName);this.container=util.getParent(e,containerID)}else{this.container=util.getObject(containerID)}if(!this.container)return false;openAjaxForm(url,false,false);return false},start:function(){var popup=new PopupWindow('loading');popup.modal=true;popup.center=true;popup.onClose=function(){$(popupController.getLastPopup().obj).find("form:visible [type=submit]").show()};popupController.showPopup(popup)},urlStart:function(url_form){var self=this;var filenames=[];$(url_form).find('[name="files[]"]').each(function(index,el){if(el.value)filenames.push(el.value)});$(url_form).find('[type=submit]').hide();$.post('/-/cms/v1/image/?act=file_test&'+S3_ACCESS+"&time="+(new Date).getTime(),{'filenames':filenames}).done(function(result){if(result=="unique"){var send_form=$(url_form).clone();send_form.removeAttr("onsubmit").hide();send_form.insertAfter($(url_form));send_form.submit();send_form.remove();self.start()}else{var ind=0;var mode="";var confirm=true;var popup=new PopupWindow('popupWindow_'+popupController.popups.length);popup.modal=true;popup.drag=true;popup.center=true;popupController.showPopup(popup);popup.setContent(result);$(popup.obj).find('.upload-continue').click(function(){popup.onClose=false;mode=$(popup.obj).find("[name=action]:checked").val();confirm=!$(popup.obj).find("[name=to_all]").is(':checked');$(url_form).find('[name="files[]"]').filter(function(){return this.value==encodeURI($(popup.obj).find('.confirm-group-'+ind+' .uploading-file').attr('src'))}).siblings('[name="modes[]"]').val(mode);ind++;confirm_next()});$(popup.obj).find('.upload-skip').click(function(){$(url_form).find('[name="files[]"]').filter(function(){return this.value==encodeURI($(popup.obj).find('.confirm-group-'+ind+' .uploading-file').attr('src'))}).val("");ind++;confirm_next()});$(popup.obj).find('.upload-cancel').click(function(){popupController.closeLastPopup();$(url_form).find('[type=submit]').show()});function show_confirm(){$(popup.obj).find(".confirm-group").hide();if($(popup.obj).find(".confirm-group-"+ind).length){$(popup.obj).find(".confirm-group-"+ind).show()}else{confirm=false;confirm_next()}}function confirm_next(){if(confirm){show_confirm()}else{$(popup.obj).find('.confirm-group .uploading-file:gt('+(ind-1)+')').each(function(i,el){$(url_form).find('[name="files[]"]').filter(function(){return this.value==$(popup.obj).find('.confirm-group-'+(ind+i)+' .uploading-file').attr('src')}).siblings('[name="modes[]"]').val(mode)});popupController.closeLastPopup();var send_form=$(url_form).clone();send_form.removeAttr("onsubmit").hide();send_form.insertAfter($(url_form));send_form.submit();send_form.remove();self.start()}}show_confirm()}}).fail(function(){var send_form=$(url_form).clone();send_form.removeAttr("onsubmit");send_form.submit();self.start()})},insertUploadedItem:function(container,uploaded){var dropTarget;if(!uploaded)return;if(container){dropTarget=$('.image-drag-and-drop-message');$(container).prev().remove();ImageController.getImageCount(container)}var self=this,ul=document.createElement('UL'),imgs=$('img.image, [class^=s3ImageMakerObj]');ul.innerHTML=uploaded.innerHTML;if(popupController.getPreviousPopup()){imgs.add($(popupController.getPreviousPopup().obj).find('[onclick^=selectFormImage] img'))}imgs.each(function(index,element){$(element).prop('src',$(element).prop('src')+($(element).prop('src').indexOf('?')>-1?'&':'?')+(new Date()).getTime())});util.detachElement(uploaded);delete uploaded;if(self.obj){var attr_id=$(self.obj).attr("id");if(attr_id&&$('[id='+attr_id+']').size()>1){$('[id='+attr_id+']').each(function(){$(this).before(ul.innerHTML);$(this).remove()})}else{var child=util.getFirstChild(ul,self.elementTagName);if(!child)return false;self.obj.parentNode.insertBefore(child,self.obj);util.detachElement(this.obj);fadeController.init(child);$(child).S3ChangeControls()}}else while(util.getFirstChild(ul,self.elementTagName)){$('#'+$(uploaded).find('li:first').attr('id')).remove();$(ul).find('>'+self.elementTagName).each(function(){$(container).prepend(this);fadeController.init(this);$(this).S3ChangeControls();if(ImageController.image_selector_name){$(this).find('.image-label label').checkboxClickFunction(null,true,null,0)}})}if(dropTarget){dropTarget.insertBefore(container)}if($(uploaded).find('>li').length){ImageController.updateSelector(container);FileController.updateSelector(container);$(dropTarget).removeClass('dragging')}delete ul},done:function(){popupController.closeLastPopup();popupController.closeLastPopup();var server=frames['server'];var uploaded=server.document.getElementById('uploaded');var container=util.getObject(this.container);if(!uploaded)return false;treeController.reloadTree();this.insertUploadedItem(container,uploaded)},errorExt:function(){popupController.closeLastPopup();s3.alert(s3.loc('JS_BAD_EXTENSION'))},errorMaxTotalFileSize:function(sizeLimit,unit){popupController.closeLastPopup();if(!unit){unit='K';sizeLimit=Math.ceil(sizeLimit/1024)}s3.alert(this.lang.errFileMaxTotalFileSizeExceeded+': '+sizeLimit+unit)},errorMaxFileSize:function(sizeLimit,unit){popupController.closeLastPopup();if(!unit){unit='K';sizeLimit=Math.ceil(sizeLimit/1024)}s3.alert(this.lang.errFileMaxFileSizeExceeded+': '+sizeLimit+unit)},error:function(str){$('#uploadStatusBlock').find('span.upload-ico').addClass('error');popupController.closeLastPopup();s3.alert(str)},declOfNum:function(number,titles){if(titles.length==2){return(number==1?titles[0]:titles[1])}var cases=[2,0,1,1,1,2];return titles[(number%100>4&&number%100<20)?2:cases[(number%10<5)?number%10:5]]},initHTML5Upload:function(uploadurl,type,postParams,completeCallback){var lp=popupController.getLastPopup().obj;var self=this;var tabs=$(lp).find('#tabs');var popupTitle=$(lp).find('.bluepopup-wrapper > table td.draggable_title span.title');var fList=$('#fsUploadProgress');var fsUploadCountFiles=$('#fsUploadCountFiles');var uploadStatusBlock=$('#uploadStatusBlock');var uploaderStatus=$('#uploaderStatus');var uploaderStatusSize=$('#uploaderStatusSize');var uploaderStatusBar=$('#uploaderStatusBar');var uploaderStatusMessage=$('#uploaderStatusMessage');var uploadErrors=$('#fsUploadErrors');var uploadAllButton=$('#upload-all');var uploadMoreButton=$('#upload-more');var uploadCancelButton=$('#cancel-all');var uploadCloseButton=$('#upload-close');var uploadReadyButton=$('#upload-ready');var folderSelector=$('#folderSelector');var watermark=$('.watermark-ignore');var uploadURIButton=$('#uploadURIButton');var textSpan=$(lp).find('.s3-file').find('.file-text');var fileButton=$(lp).find('.s3-file').find('.s3-btn');var imageLoad=type=='image'?true:false;var fileItemCount=0;var fileChoosen=0;var filesSize=0;var fileUploadedCount=0;var fileUploadedSize=0;var fileUploadedSize2=0;var wasLoaded=false;var errorsMessages='';var filesHash={};var UriTab=$(lp).find('.tabs-header [data-input-value=uri]');var fileTestUrl='/-/cms/v1/'+type+'/file_test.php?'+S3_ACCESS;var uploadButtonsWrapper=$('#uploadButtonsWrapper');var uploadDropBlock=$('#uploadDropBlock');var confirm=true;var cancelAllUploads=false;var fileInput=$('#file-field');var dropZone=$(document);var maxFileSize=$('#max_file_size').val();var global=parseInt(fileInput.attr('data-global'));var dropFileUploadBlock=$('#dropFileUploadModal');if(!maxFileSize)maxFileSize=500000;if(ImageController.image_selector_name){uploadurl+='&multiselect=1'}fileInput.fileUploader({url:uploadurl,fileTestUrl:fileTestUrl,notTest:true,global:global,limit:1000,uploadedForm:$('#uploadContFS'),dropBox:dropZone,dropDiv:dropFileUploadBlock,onDrop:function(file){var uploadItemFile=addFileToQueue(file,type);util.centerElement(popupController.getLastPopup().obj);if(!imageLoad){$(fList).attr('style','width:'+$(fList).width()+'px')}$(uploaderStatus).removeAttr('style');$(uploaderStatus).html(s3.loc('JS_UPLOAD_UPLOADED_FILES2',{count:0,max:fileItemCount}));$(uploaderStatusSize).removeAttr('style');$(uploaderStatusSize).html(Math.round((fileUploadedSize+fileUploadedSize2)/1024)+' KB / '+Math.round(filesSize/1024)+' KB');$(uploaderStatusBar).removeAttr('style');$(uploaderStatusBar).children('div:first').attr('style','width: 0%');$(uploaderStatus).html('');$(uploadErrors).html('');$(uploadErrors).html(errorsMessages);if(!fileItemCount){buttonSwitch(false);fileInput.trigger(':clear')}else{var filesText=self.declOfNum(fileItemCount,s3.loc('JS_FILE_FORMS').split('|'));$(fsUploadCountFiles).find('strong').html(fileItemCount+' '+filesText+' / '+Math.round(filesSize/1024)+' KB');folderSelector.show();watermark.show();if(file){var fileName=file.name,fileSize=Math.round(file.size/1024)+' KB',oFReader=new FileReader(),fileLi='<li data-ind="'+uploadItemFile.ind+'" class="box wait-upload-file fileItem'+uploadItemFile.ind+'"><span class="progress"></span><span class="image"><img src="" alt=""></span><span class="title"><span class="name">'+fileName+'<span class="size">'+fileSize+'</span></span></span><span class="percent"><span class="s3-oah-ico"></span></span></li>';$(fsUploadCountFiles).find('ul:first').append(fileLi);oFReader.readAsDataURL(file);oFReader.onloadend=function(oFREvent){$(fsUploadCountFiles).find('ul:first li.fileItem'+uploadItemFile.ind).find('img')[0].src=oFREvent.target.result}}$(fsUploadCountFiles).show();fileButton.parent().hide();fileButton.removeClass('green');buttonSwitch(true);uploadDropBlock.hide()}textSpan.html(s3.loc('JS_FILES_TOTAL')+' : <strong>'+fileChoosen+'</strong>');return false},onSelect:function(file){var uploadItemFile=addFileToQueue(file,type);var fileName=uploadItemFile.file.name,fileSize=Math.round(uploadItemFile.file.size/1024)+' KB',oFReader=new FileReader(),fileLi='<li data-ind="'+uploadItemFile.ind+'" class="box wait-upload-file fileItem'+uploadItemFile.ind+'"><span class="progress"></span><span class="image"><img src="" alt=""></span><span class="title"><span class="name">'+fileName+'<span class="size">'+fileSize+'</span></span></span><span class="percent"><span class="s3-oah-ico"></span></span></li>';$(fsUploadCountFiles).find('ul:first').append(fileLi);if(file){oFReader.readAsDataURL(file);oFReader.onloadend=function(oFREvent){$(fsUploadCountFiles).find('ul:first li.fileItem'+uploadItemFile.ind).find('img')[0].src=oFREvent.target.result}}return false},onSelectFinally:function(){util.centerElement(popupController.getLastPopup().obj);if(!imageLoad){$(fList).attr('style','width:'+$(fList).width()+'px')}uploadStatusBlock.find('span.upload-ico').removeClass('done');uploadStatusBlock.find('span.upload-ico').removeClass('error');var filesText=self.declOfNum(fileItemCount,s3.loc('JS_FILE_FORMS').split('|'));$(fsUploadCountFiles).show();folderSelector.show();watermark.show();fileButton.parent().hide();uploadDropBlock.hide();$(uploaderStatus).removeAttr('style');$(uploaderStatus).html(s3.loc('JS_UPLOAD_UPLOADED_FILES2',{count:0,max:fileItemCount}));$(uploaderStatusSize).removeAttr('style');$(uploaderStatusSize).html(Math.round((fileUploadedSize+fileUploadedSize2)/1024)+' KB / '+Math.round(filesSize/1024)+' KB');$(uploaderStatusBar).removeAttr('style');$(uploaderStatusBar).children('div:first').attr('style','width: 0%');$(uploaderStatusMessage).html('');if(!fileItemCount){buttonSwitch(false);fileInput.trigger(':clear');$(uploadErrors).parent().show();$(uploadStatusBlock).find('.upload-ico').hide();$(uploaderStatus).hide();$(uploaderStatusBar).hide();$(uploaderStatusSize).hide()}else{buttonSwitch(true)}$(uploadErrors).append(errorsMessages);errorsMessages='';textSpan.html(s3.loc('JS_FILES_TOTAL')+' : <strong>'+fileChoosen+'</strong>');fileInput.upload();return false},onAllComplete:function(){window._last_popup_blocked=0;confirm=true;UriTab.show();showLoadedMessage();$('#uploadContFS')[0].reset();wasLoaded=true;buttonSwitch(false);errorsMessages='';treeController.reloadTree();fileInput.trigger(':clear');uploadCloseButton.hide();uploadURIButton.show();folderSelector.show();uploadReadyButton.show();watermark.show();uploadDropBlock.hide();fileButton.removeClass('disabled');if(fileUploadedCount==fileItemCount){uploaderStatus.html(JS_UPLOAD_ALL_FILES_DONE)}else{uploaderStatus.html(s3.loc('JS_UPLOAD_UPLOADED_FILES2',{count:fileUploadedCount,max:fileItemCount}))}fileUploadedCount=0;$(uploadStatusBlock).hide();$(uploadMoreButton).show();if(typeof completeCallback=='function'){completeCallback()}}});buttonSwitch(false);function buttonSwitch(fileSelected){if(fileSelected){$(uploadAllButton).show();$(uploadCancelButton).show();$(uploadCloseButton).hide()}else{$(uploadAllButton).hide();$(uploadCancelButton).hide();$(uploadMoreButton).hide();$(uploadReadyButton).hide();$(uploadCloseButton).hide();fileInput.removeAttr("disabled")}}function clearContent(){fileInput.resetAll();fileItemCount=0;fileChoosen=0;filesHash={};fileUploadedCount=0;filesSize=0;fileUploadedSize=0;fileUploadedSize2=0;fList.empty();buttonSwitch(false);$(uploaderStatus).hide();$(uploaderStatusBar).hide();$(uploaderStatusSize).hide();uploadErrors.html('');errorsMessages='';uploadCloseButton.hide();window._last_popup_blocked=0;fileButton.removeClass('disabled');fileButton.parent().show();fileButton.text(JS_BROWSE_FILES);$(fsUploadCountFiles).hide();$(fsUploadCountFiles).find('strong').html('');uploadStatusBlock.find('span.upload-ico').removeClass('done');uploadStatusBlock.find('span.upload-ico').removeClass('error');tabs.removeClass('loaded');$(popupTitle).text(JS_UPLOAD_ADD_TITLE);$(uploadStatusBlock).hide();$(uploadButtonsWrapper).removeClass('center');folderSelector.show();watermark.show();$(fsUploadCountFiles).find('ul').empty();uploadDropBlock.show()}function stopLoad(){cancelAllUploads=true;wasLoaded=true;confirm=true;UriTab.show();fileInput.abort();fileInput.resetAll();fileItemCount=0;fileChoosen=0;filesHash={};fileUploadedCount=0;filesSize=0;fileUploadedSize=0;fileUploadedSize2=0;fList.empty();buttonSwitch(false);uploadCloseButton.show();window._last_popup_blocked=0;showCanceledMessage();folderSelector.hide();watermark.hide();uploadURIButton.show();fileButton.removeClass('disabled');$(uploadStatusBlock).show();var files=$(fsUploadCountFiles).find('li.box');if(files.length){files.each(function(){if(!($(this).hasClass('done-upload-file')||$(this).hasClass('error-upload-file'))){$(this).addClass('skiped-upload-file').find('span.percent').html(''+s3.loc('JS_SKIPPED')+'<span class="s3-oah-ico"></span>')}})}}function updateProgressCount(){if(!wasLoaded){$(uploaderStatus).html(s3.loc('JS_UPLOAD_UPLOADED_FILES2',{count:fileUploadedCount,max:fileItemCount}));if(fileItemCount<=0){$(uploaderStatus).attr('style','display: none');buttonSwitch(false)}}}function updateProgressBar(file,loaded,total){if(!wasLoaded){var currentPercent=Math.ceil((fileUploadedSize+fileUploadedSize2)*100/filesSize);var currentUploadedSize=(fileUploadedSize+fileUploadedSize2)>filesSize?filesSize:fileUploadedSize+fileUploadedSize2;currentUploadedSize=Math.round((currentUploadedSize)/1024)+' KB / '+Math.round(filesSize/1024)+' KB';var percent=Math.ceil((loaded/total)*100),uploadSize=percent*Math.round(file.size/1024)/100;$(fsUploadCountFiles).find('li.fileItem'+file.ind).removeClass('wait-upload-file');$(fsUploadCountFiles).find('li.fileItem'+file.ind).find('span.progress').attr('style','width: '+percent+'%');$(fsUploadCountFiles).find('li.fileItem'+file.ind).find('span.percent').text(percent+'%');$(uploaderStatusSize).html(currentUploadedSize);$(uploaderStatusBar).children('div:first').attr('style','width: '+currentPercent+'%');if(file.skiped){$(fsUploadCountFiles).find('li.fileItem'+file.ind).addClass('skiped-upload-file');$(fsUploadCountFiles).find('li.fileItem'+file.ind).find('span.percent').html(''+s3.loc('JS_SKIPPED')+'<span class="s3-oah-ico"></span>')}if(fileItemCount<=0){$(uploaderStatusBar).attr('style','display: none');buttonSwitch(false)}}}function showLoadedMessage(){$(uploaderStatus).html(s3.loc('JS_UPLOAD_DONE'))}function showCanceledMessage(){$(uploaderStatus).html(s3.loc('Загрузка файлов была отменена'))}function addFileToQueue(file,type){if(wasLoaded){clearContent();wasLoaded=false}if(!file)return;var fileHash=file.size+(file.lastModifiedDate?file.lastModifiedDate.getTime():'')+file.name;if(filesHash[fileHash]){return}filesHash[fileHash]=true;fileChoosen++;if(file.size>maxFileSize){var errorText=s3.loc('JS_FILE_SIZE_TOO_LARGE')+' ('+Math.ceil(file.size/1024)+'K)';errorsMessages+='<p>&ndash; файл: '+file.name+' '+errorText+'</p>';return}if(type=='image'&&!file.type.match(/image.*/)){errorsMessages+='<p>&ndash; файл: '+file.name+' ('+s3.loc('JS_ERROR_UPLOAD_NON_IMAGE_FILETYPE')+')</p>';return}filesSize+=file.size;fileItemCount++;var uploadItem={file:file,name:file.name.replace(/\.\w{3,4}$/,''),ind:fileItemCount,skiped:false,onCheck:function(result){if(result=='unique'||!confirm){if(result!='unique'&&mode=='skip'){fileInput.skip(parseInt(this.ind))}else{fileInput.continue()}}else{var f=this;var popup=new PopupWindow('popupWindow_'+popupController.popups.length);popup.modal=true;popup.drag=true;popup.center=true;popupController.showPopup(popup);popup.setContent(result);window._last_popup_blocked=0;if(cancelAllUploads){$(popup.obj).find('.upload-continue, .upload-skip').hide()}if(window.URL&&window.URL.createObjectURL){var blobURL=window.URL.createObjectURL(this.file);$(popup.obj).find('.uploading-file').attr('src',blobURL)}$(popup.obj).find('.upload-continue').click(function(){popup.onClose=false;mode=$(popup.obj).find("[name=action]:checked").val();confirm=!$(popup.obj).find("[name=to_all]").is(':checked');popupController.closeLastPopup();window._last_popup_blocked=1;fileInput.continue(mode)});$(popup.obj).find('.upload-skip').click(function(){popup.onClose=false;mode='skip';confirm=!$(popup.obj).find("[name=to_all]").is(':checked');popupController.closeLastPopup();window._last_popup_blocked=1;fileInput.skip(parseInt(f.ind))});$(popup.obj).find('.upload-cancel').click(function(){popupController.closeLastPopup();stopLoad();$('#uploadContFS')[0].reset();fileInput.trigger(':clear')});popup.onClose=function(){stopLoad();$('#uploadContFS')[0].reset();fileInput.trigger(':clear')}}},onSkip:function(){this.skiped=true;uploadErrors.append('<p>&ndash; файл: '+file.name+' (пропущен)</p>');++fileUploadedCount;fileUploadedSize+=file.size;fileUploadedSize2=0;updateProgressCount();updateProgressBar(this,100,100);fileInput.upload(parseInt(this.ind)+1)},onComplete:function(successfully,data,errorCode){if(successfully){++fileUploadedCount;if(uploader.container){var ul=util.getElementFromText(data,"UL");if(ul){$(fsUploadCountFiles).find("li.fileItem"+this.ind).addClass('done-upload-file').find('span.percent').html(s3.loc('JS_SUCCESSFULLY')+'<span class="s3-oah-ico"></span>');uploader.insertUploadedItem(uploader.container,ul)}else{var data_array=data.split('~~~');$(fsUploadCountFiles).find("li.fileItem"+this.ind).addClass('error-upload-file');$(fsUploadCountFiles).find("li.fileItem"+this.ind).find('span.percent').html(s3.loc('JS_ERROR')+'<span class="s3-oah-ico s3-tooltip" title="'+data_array[0]+'"></span>').tooltip({tooltipClass:"custom-tooltip-styling small",position:{my:"left-5 top",at:"left bottom+5"}});uploadErrors.append('<p>&ndash; файл: '+file.name+' '+data_array[0]+'</p>');fileUploadedCount--}}fileUploadedSize+=file.size;fileUploadedSize2=0;updateProgressCount()}if(errorCode){$(fsUploadCountFiles).find("li.fileItem"+this.ind).addClass('error-upload-file');$(fsUploadCountFiles).find("li.fileItem"+this.ind).find('span.percent').html(s3.loc('JS_ERROR')+'<span class="s3-oah-ico s3-tooltip" title="'+errorCode+'"></span>').tooltip({tooltipClass:"custom-tooltip-styling small",position:{my:"left-5 top",at:"left bottom+5"}});uploadErrors.append('<p>&ndash; файл: '+file.name+' ('+errorCode+')</p>')}if(!cancelAllUploads){fileInput.upload(parseInt(this.ind)+1)}},onProgress:function(proress,total){fileUploadedSize2=proress;updateProgressBar(this,proress,total)}};fileInput.fileAdd(uploadItem);return uploadItem}uploadAllButton.click(function(){window.setTimeout("window._last_popup_blocked = 1",0);UriTab.hide();fileInput.upload();uploadAllButton.hide();uploadCloseButton.hide();folderSelector.hide();watermark.hide();uploadURIButton.hide();fileInput.attr("disabled",true);fileButton.addClass('disabled');tabs.addClass('loaded');$(popupTitle).text(JS_LOADING);$(uploadStatusBlock).removeAttr('style');$(uploadButtonsWrapper).addClass('center')});uploadMoreButton.click(function(){if(window._last_popup_blocked){stopLoad()}else{clearContent()}$('#uploadContFS')[0].reset();fileInput.trigger(':clear')});uploadCancelButton.click(function(){if(window._last_popup_blocked){stopLoad()}else{clearContent()}$('#uploadContFS')[0].reset();fileInput.trigger(':clear')});popupController.getLastPopup().onClose=function(){fileInput.unBindDrop()};if(fileInput.length&&postParams&&postParams.uploadParams&&postParams.uploadParams.drop){fileInput.handleFileSelect(postParams.uploadParams.drop)}}};function uploadAddItem(container,rowTagName){var objContainer=document.getElementById(container);if(!objContainer)return false;var objSrc=null;for(objSrc=objContainer.firstChild;objSrc;objSrc=objSrc.nextSibling){if(objSrc.tagName){if(rowTagName!=undefined&&objSrc.tagName!=rowTagName)continue;break}}if(!objSrc)return false;var objNew=objSrc.cloneNode(true);objNew=objContainer.appendChild(objNew);var inputs=objNew.getElementsByTagName("INPUT");for(var i=0;i<inputs.length;++i){if(inputs[i].type=='file'){inputs[i].parentNode.innerHTML=inputs[i].parentNode.innerHTML}else if(inputs[i].type=='text')inputs[i].value=''}}function uploadRemoveItem(obj,src){if(obj.id==src)return false;var p=obj.parentNode;if(p.getElementsByTagName(obj.tagName).length>1){obj.parentNode.removeChild(obj)}}function uploadSwapType(contTo,contFrom){try{contTo=util.getObject(contTo);contFrom=util.getObject(contFrom);if(!(contTo&&contFrom)){throw 0}var parentFrom=contFrom.parentNode;var parentTo=contTo.parentNode;parentTo.appendChild(parentFrom.replaceChild(contTo,contFrom));return true}catch(e){}return false}var util={apply:function(object,config,defaults){if(defaults){util.apply(object,defaults)}if(object&&config&&typeof config=='object'){var i;for(i in config){object[i]=config[i]}}return object},getObject:function(obj){if(!obj)return null;if(typeof(obj)=='string')obj=document.getElementById(obj);return obj},moveElementBy:function(a,deltaX,deltaY){a=this.getObject(a);if(a&&a.style.display=='block'){a.style.top=(parseInt(a.style.top)+deltaY)+"px";a.style.left=(parseInt(a.style.left)+deltaX)+"px"}},urlParamReplace:function(url,param_name,param_value){if(url.indexOf("&"+param_name+"=")!=-1||url.indexOf("?"+param_name+"=")!=-1){var pattern=RegExp.quote(param_name)+'\\=[^\\&]*';var replace="";if(param_value!=''||param_value===0){replace=param_name+"="+encodeURIComponent(param_value);url=url.replace(eval(new String('/([&?])'+pattern+'/').toString()),'$1'+replace)}else{replace='';url=url.replace(eval(new String('/[?]'+pattern+'\\&/').toString()),'?'+replace);url=url.replace(eval(new String('/[&?]'+pattern+'/').toString()),replace)}}else if(param_value!=''){if(url.indexOf('?')==-1)url=url+"?";else url=url+"&";url=url+param_name+"="+encodeURIComponent(param_value)}return url},getUrlParam:function(url,paramName){if(url.indexOf("?")>-1){var allParams=url=url.split("?")[1].split('&');for(var i=0;i<allParams.length;i++){if(allParams[i].split('=')[0]==paramName)return allParams[i].split('=')[1]}}return false},log:function(msg){if(document&&document.body){var d=document.createElement("DIV");d.style.position='absolute';d.style.top=(coordinatesController.y+Math.round(Math.random()*100))+'px';d.style.left=(coordinatesController.x+Math.round(Math.random()*100))+'px';d.style.border="1px solid black";d.style.padding="3px";d.style.backgroundColor='#FFFFFF';d.innerHTML=msg;d.style.zIndex=80000;document.body.appendChild(d);window.setTimeout(function(){util.detachElement(d)},3000)}else{alert("LOG: "+msg)}},msg:function(msg){var color=arguments[1]?arguments[1]:"#000000",msg_at_cursor=arguments[2]?arguments[2]:false;if(document&&document.body){var d=document.createElement("DIV");if(msg_at_cursor){d.style.top=coordinatesController.y+15+'px';d.style.left=coordinatesController.x-5+'px';d.className='popup-message';d.style.color=color}else{d.style.left='50%';d.style.bottom='50%';d.className='xhr-msg'}d.innerHTML="&nbsp;"+msg+"&nbsp;";if(!msg_at_cursor){setTimeout(function(){d.style.marginLeft=(-d.offsetWidth/2)+"px";d.style.zIndex=80000;d.style.opacity=1},1)}document.body.appendChild(d);window.setTimeout(function(){util.detachElement(d);delete d},1000)}},getElementFromText:function(text,element_tag){d=document.createElement("DIV");if(element_tag=='TR'){text='<table><tbody>'+text+'</tbody></table>';d.innerHTML=text;d=d.getElementsByTagName('TBODY')[0]}else{d.innerHTML=text}d=this.getFirstChild(d,element_tag);if(!d)return null;util.detachElement(d);return d},createCookie:function(name,value,days,domain){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString()}else var expires="";document.cookie=name+"="+encodeURIComponent(value)+expires+"; path=/"+(domain?';domain='+encodeURIComponent(domain):'')},readCookie:function(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length)}return null},eraseCookie:function(name){this.createCookie(name,"",-1)},getLastChild:function(obj,tagname){obj=obj.lastChild;if(obj&&obj.nodeName!=tagname)return util.getPreviousSibling(obj,tagname);return obj},getLastChildExcept:function(obj,tagname,exc_obj){obj=this.getLastChild(obj,tagname);while(obj&&obj==exc_obj)obj=this.getPreviousSibling(obj,tagname);return obj},focusFirstVisibleControl:function(obj_id){var obj=obj_id;if(typeof(obj_id)=='string')obj=document.getElementById(obj_id);if(obj&&obj.nodeName!="FORM"){var forms=obj.getElementsByTagName("FORM");if(forms.length==0)return false;obj=forms[0]}if($(obj).hasClass('no-autofocus')){return false}try{if(obj&&obj.nodeName=="FORM"){if(tinyMCE){tinymceController.focusControls(obj)}for(var i=0;i<obj.elements.length;i++)if(obj.elements[i].type!="button"&&obj.elements[i].type!="reset"&&obj.elements[i].type!="submit"&&obj.elements[i].type!="select-one"&&obj.elements[i].type!="hidden"&&obj.elements[i].style.display!="none"&&obj.elements[i].parentNode.style.display!="none"){obj.elements[i].focus();break}for(var i=0;i<obj.elements.length;i++){if(obj.elements[i].type=="text"&&obj.elements[i].className=='init-calendar'){var date_val=$("#"+obj.elements[i].id).val();$("#"+obj.elements[i].id).datepicker({showOn:"both",buttonImage:"/my/s3/images/calendar/cal.gif",buttonImageOnly:true});$("#"+obj.elements[i].id).datepicker("option","dateFormat","dd.mm.yy");if(tinyMCE){$.datepicker.regional[tinymceController.lang_code]}else if(CKEDITOR){$.datepicker.regional[ckeditorController.lang_code]}$("#"+obj.elements[i].id).datepicker("setDate",date_val)}if(obj.elements[i].type=="textarea"&&obj.elements[i].className=='x-edit'){xedit.bind(obj.elements[i],function(){s3.submitTemplate(obj)})}}for(var i=0;i<obj.elements.length;i++){if(obj.elements[i].type=="text"){if(obj.elements[i].id.indexOf('google_map_lat')!=-1){var str=obj.elements[i].id;str=str.replace(/google_map_lat/,"");googleMapInitialize(str)}else if(obj.elements[i].id.indexOf('yandex_map_lat')!=-1){var str=obj.elements[i].id;str=str.replace(/yandex_map_lat/,"");yandexMapInitialize(str)}else if(obj.elements[i].id.indexOf('ammap_movie_lat')!=-1){var str=obj.elements[i].id;str=str.replace(/ammap_movie_lat/,"");amMap.initAmMap(str)}}}}}catch(ex){}},getFirstChild:function(obj,tagname){obj=obj.firstChild;if(obj&&obj.nodeName!=tagname)return util.getNextSibling(obj,tagname);return obj},getFirstChildExcept:function(obj,tagname,exc_obj){obj=this.getFirstChild(obj,tagname);while(obj&&obj==exc_obj)obj=this.getNextSibling(obj,tagname);return obj},readStyle:function(obj,styleProp){if(obj){if(obj.style[styleProp]){return obj.style[styleProp]}else if(obj.currentStyle){return obj.currentStyle[styleProp]}else if(window.getComputedStyle){return document.defaultView.getComputedStyle(obj,null).getPropertyValue(styleProp)}}return null},getParentStyle:function(x,styleProp,ignore){var res=this.getStyle(x,styleProp);if(res&&res!=ignore)return res;if(!x.parentNode)return false;return this.getParentStyle(x.parentNode,styleProp,ignore)},getElementsByClassName:function(obj,strTagName,strClassName){var elements=(strTagName=="*"&&obj.all)?obj.all:obj.getElementsByTagName(strTagName.toUpperCase());var res=new Array();var element,self=this;for(var i=0;i<elements.length;i++){element=elements[i];if(self.hasClass(element,strClassName)){res.push(element)}}return(res)},getElementByIdAndTagName:function(src_obj,tagName,id){if(src_obj){tagName=tagName.toUpperCase();elements=src_obj.getElementsByTagName(tagName);var i;for(i=0;i<elements.length;i++)if(elements[i].id==id)return elements[i]}return null},getStyle:function(obj,styleProp){res=this.readStyle(obj,styleProp);if(res)return res;var styleProp2=styleProp;var s;if(styleProp.indexOf("-")>-1){s=styleProp.split("-");styleProp2=s[0].toLowerCase();for(var i=1;i<s.length;i++){styleProp2+=s[i].substr(0,1).toUpperCase()+s[i].substring(1,s[i].length).toLowerCase()}styleProp=styleProp.toLowerCase()}else{if(styleProp.toLowerCase()!=styleProp){styleProp2="";for(var i=0;i<styleProp.length;i++){if(styleProp.charCodeAt(i)<91&&styleProp.charCodeAt(i)>64)styleProp2+="-";styleProp2+=styleProp.charAt(i)}styleProp2=styleProp2.toLowerCase()}}if(styleProp2!=styleProp)return this.readStyle(obj,styleProp2);return null},getComputedStyle:function(el,styleProp){var x=(typeof el=='string'?document.getElementById(el):el);if(x.currentStyle)var y=x.currentStyle[styleProp];else if(window.getComputedStyle)var y=document.defaultView.getComputedStyle(x,null).getPropertyValue(styleProp);return y},scrollOffset:function(){var a=new Object();a.x=0;a.y=0;if(window.pageXOffset){a.x=window.pageXOffset;a.y=window.pageYOffset}else{var sl=0,st=0;try{if(typeof browserController!='undefined'&&!browserController.isMSIE&&document.compatMode&&document.compatMode=='CSS1Compat'){sl=document.body.parentNode.scrollLeft;st=document.body.parentNode.scrollTop}else{sl=document.body.scrollLeft;st=document.body.scrollTop}}catch(e){}if(sl>=0){a.x=sl}if(st>=0){a.y=st|$('body').scrollTop()}}return a},clientSize:function(){var a=new Object();a.h=0;a.w=0;if($.browser.msie&&$.browser.version>=9.0){a.h=$(window).height();a.w=$(window).width()}else if(window.innerHeight>=0){a.h=window.innerHeight;a.w=window.innerWidth}else if(document.documentElement&&document.compatMode=='CSS1Compat'){a.h=document.documentElement.clientHeight;a.w=document.documentElement.clientWidth}else if(document.body.clientHeight>=0){a.h=document.body.clientHeight;a.w=document.body.clientWidth}return a},getMargins:function(obj){var marg=new Object();if(obj){marg.top=parseInt(this.getStyle(obj,"marginTop"));if(isNaN(marg.top))marg.top=0;marg.left=parseInt(this.getStyle(obj,"marginLeft"));if(isNaN(marg.left))marg.left=0;marg.right=parseInt(this.getStyle(obj,"marginRight"));if(isNaN(marg.right))marg.right=0;marg.bottom=parseInt(this.getStyle(obj,"marginBottom"));if(isNaN(marg.bottom))marg.bottom=0}return marg},getBorders:function(obj){var bord=new Object();if(obj){bord.top=parseInt(this.getStyle(obj,"borderTopWidth"));if(isNaN(bord.top))bord.top=0;bord.left=parseInt(this.getStyle(obj,"borderLeftWidth"));if(isNaN(bord.left))bord.left=0;bord.right=parseInt(this.getStyle(obj,"borderRightWidth"));if(isNaN(bord.right))bord.right=0;bord.bottom=parseInt(this.getStyle(obj,"borderBottomWidth"));if(isNaN(bord.bottom))bord.bottom=0}return bord},getPaddings:function(obj){var padd=new Object();if(obj){padd.top=parseInt(this.getStyle(obj,"padding-top"));if(isNaN(padd.top))padd.top=0;padd.left=parseInt(this.getStyle(obj,"paddingLeft"));if(isNaN(padd.left))padd.left=0;padd.right=parseInt(this.getStyle(obj,"padding-right"));if(isNaN(padd.right))padd.right=0;padd.bottom=parseInt(this.getStyle(obj,"paddingBottom"));if(isNaN(padd.bottom))padd.bottom=0}return padd},getNextSibling:function(obj,tagname){obj=obj.nextSibling;while(obj&&(obj.nodeName!=tagname))obj=obj.nextSibling;return obj},getNextSiblingExcept:function(obj,tagname,exc_obj){obj=this.getNextSibling(obj,tagname);while(obj&&obj==exc_obj)obj=this.getNextSibling(obj,tagname);return obj},getPreviousSiblingExcept:function(obj,tagname,exc_obj){obj=this.getPreviousSibling(obj,tagname);while(obj&&obj==exc_obj)obj=this.getPreviousSibling(obj,tagname);return obj},isParent:function(obj,parent){if(!parent)return false;while(obj&&obj.nodeName!="BODY"){if(obj.parentNode==parent)return true;obj=obj.parentNode}return false},getPreviousSibling:function(obj,tagname){obj=obj.previousSibling;while(obj&&(obj.nodeName!=tagname))obj=obj.previousSibling;return obj},getParent:function(obj,tagname){obj=obj.parentNode;return this.getElement(obj,tagname)},getElement:function(obj,tagname){while(obj&&(obj.nodeName!=tagname))obj=obj.parentNode;return obj},detachElement:function(obj){if(obj&&obj.parentNode){return obj.parentNode.removeChild(obj)};return null},getEventTarget:function(e){if(!e)e=window.event;if(e.target){if(e.target.nodeType==3)e.target=e.target.parentNode;return e.target}else if(e.srcElement)return e.srcElement},findPos:function(obj){var x=0;var y=0;var xScrollOffset=0;var yScrollOffset=0;var par=obj;if(!window.opera||(window.opera&&(window.opera.version()=='10.51'||window.opera.version()>=11))){while(par&&par.nodeName!="BODY"){if(par.scrollLeft)xScrollOffset=xScrollOffset+par.scrollLeft;if(par.scrollTop)yScrollOffset=yScrollOffset+par.scrollTop;par=par.parentNode}}if(obj.offsetParent){while(obj.offsetParent){y+=obj.offsetTop;x+=obj.offsetLeft;obj=obj.offsetParent}x=x-xScrollOffset;y=y-yScrollOffset}else{if(obj.x)x+=obj.x;if(obj.y)y+=obj.y}return(new Array(x,y))},addEvent:function(object,event,handler,useCapture){if(object instanceof Array){for(var _i=0;_i<object.length;_i++){util.addEvent(object[_i],event,handler,useCapture)}}else{if(event instanceof Array){for(var _j=0;_j<event.length;_j++){util.addEvent(object,event[_j],handler,useCapture)}}else{if(typeof object==="object"){if(object.addEventListener){object.addEventListener(event,handler,!!useCapture)}else if(object.attachEvent){object.attachEvent('on'+event,handler)}else{object["on"+event]=handler}}}}},cancelEvent:function(event){if(typeof event.cancelBubble==="undefined")event.cancelBubble=true;if(event.stopPropagation)event.stopPropagation();if(event.preventDefault)event.preventDefault();event.returnValue=false;return false},showProperties:function(obj){var res="Свойства объекта: "+obj.nodeName+"<br>\n";if(obj){for(var i in obj){if(typeof(obj[i])!='function'&&i!='innerHTML'){res=res+i+": "+obj[i]+"<br>\n"}}}return res},getOverStatus:function(drag_obj,obj){var status=new Object();status.srcX=parseInt(drag_obj.style.left);status.srcY=parseInt(drag_obj.style.top);var src_cX=status.srcX+drag_obj.offsetWidth/2;var src_cY=status.srcY+drag_obj.offsetHeight/2;var a=this.findPos(obj);status.objX=a[0];status.objY=a[1];var obj_cX=status.objX+obj.offsetWidth/2;var obj_cY=status.objY+obj.offsetHeight/2;status.over=false;status.overTop=false;status.overBottom=false;status.overLeft=false;status.overRight=false;status.overX=false;status.overY=false;status.top=false;status.left=false;status.beforeX=false;status.afterX=false;status.beforeY=false;status.afterY=false;if(status.srcX>=status.objX&&status.srcX<status.objX+obj.offsetWidth){status.overLeft=true;if(status.srcX<status.objX+obj.offsetWidth/2)status.beforeX=true}if(status.srcX+drag_obj.offsetWidth>=status.objX&&status.srcX+drag_obj.offsetWidth<status.objX+obj.offsetWidth){status.overRight=true;if(status.srcX+drag_obj.offsetWidth>=status.objX+obj.offsetWidth/2)status.afterX=true}if(status.srcY>status.objY&&status.srcY<=status.objY+obj.offsetHeight){status.overTop=true;if(status.srcY<status.objY+obj.offsetHeight/2)status.beforeY=true}if(status.srcY+drag_obj.offsetHeight>=status.objY&&status.srcY+drag_obj.offsetHeight<status.objY+obj.offsetHeight){status.overBottom=true;if(status.srcY+drag_obj.offsetHeight>status.objY+obj.offsetHeight/2)status.afterY=true}if(((obj.offsetWidth<drag_obj.offsetWidth&&obj_cX>status.srcX&&obj_cX<status.srcX+drag_obj.offsetWidth)||(obj.offsetWidth>=drag_obj.offsetWidth&&src_cX>status.objX&&src_cX<status.objX+obj.offsetWidth))&&((obj.offsetHeight<drag_obj.offsetHeight&&obj_cY>status.srcY&&obj_cY<status.srcY+drag_obj.offsetHeight)||(obj.offsetHeight>=drag_obj.offsetHeight&&src_cY>status.objY&&src_cY<status.objY+obj.offsetHeight))){if(src_cX<obj_cX)status.left=true;if(src_cY<obj_cY)status.top=true;status.over=true;if(status.overLeft||status.overRight)status.overX=true;if(status.overTop||status.overBottom)status.overY=true}return status},showElement:function(obj){obj=util.getObject(obj);if(obj)obj.style.display='block'},showElements:function(){for(i=0;i<arguments.length;++i)util.showElement(arguments[i])},hideElements:function(){for(i=0;i<arguments.length;++i)util.hideElement(arguments[i])},hideElement:function(obj){obj=util.getObject(obj);if(obj)obj.style.display='none'},centerElement:function(obj){if(obj){var s=util.scrollOffset(obj);var cs=this.clientSize();if(obj.offsetHeight>cs.h){obj.style.top=(1+s.y)+'px'}else{obj.style.top=(50+s.y)+'px'}if(obj.offsetWidth>cs.w){obj.style.left=(2+s.x)+'px'}else{obj.style.left=(s.x+(cs.w-obj.offsetWidth)/2)+'px'}}},getRequest:function(){var request=false;if(window.XMLHttpRequest){request=new XMLHttpRequest();if(request.overrideMimeType){request.overrideMimeType('text/html')}}else{if(window.ActiveXObject){request=new ActiveXObject("Msxml2.XMLHTTP")}}if(!request){alert("Can't create XMLHTTP request")}return request},makePostRequest:function(url,parameters,onCloseAlert){var loader,request=this.getRequest();if(request){loader=document.getElementById("ajax-loader");if(loader){loader.style.display="block"}request.open('POST',url,false);request.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");if(parameters){parameters=parameters+"&"}parameters=parameters+(parameters.indexOf('&xhr=1')==-1?"xhr=1&":"")+"rnd="+Math.round(Math.random()*10000);request.send(parameters);request=this.parseRequestResult(request);if(loader){loader.style.display="none"}if(!request||request.error){s3.alertHTML(s3.formatError(request.text),onCloseAlert)}else{popupController.childsPopupsHasChanged()}}return request},parseRequestResult:function(req){if(typeof req!=='object'){return{'error':true,'text':'invalid input'}}var result={};result.error=true;result.text='';result.details='';result.close=false;result.code=0;result.reason=req.getResponseHeader('X-Reason');if(req.status==503){var l,msg='Сайт на техническом обслуживании.\nПовторите действие через несколько минут.';if(l=document.cookie.match(/lang_id=\d+/g)){if(l[0].split('=')[1]>1){msg='Service Temporarily Unavailable.\nRetry after a few minutes.'}}return{'error':true,'text':msg}}else if(req.status==500){result.text=s3.loc('JS_ERROR_UNKNOWN')}else if(req.status==403){if(result.reason=='acl-deny'){result.text=ACLController.getToolTipContent(req.getResponseHeader('X-Acl').split(';')[0])}else{result.text='Нет доступа.\nВозможно, изменился IP-адрес. Повторите вход в СУ.\nПоследний IP: '+util.readCookie('CMS_IP_'+ver_id)}}else if(req.status==404){result.text='Страница не найдена'}else if(req.status==200){result.url=req.getResponseHeader('Content-Location');if(req.responseText.length>0){var firstChar=req.responseText.charAt(0);result.text=req.responseText.substring(1,req.responseText.length);if(firstChar=='1'){result.error=false;result.code=1}else if(firstChar=='2'){result.error=false;result.close=true;result.code=2}else if(firstChar=='3'){result.error=false;result.close=true;result.code=3;s3.alert(result.text)}else if(firstChar=='4'){result.error=false;result.code=4;var popup=new PopupWindow('ajaxPopupWindow_'+popupController.popups.length);popup.drag=true;popup.modal=true;popup.center=true;popup.created=true;var obj=document.createElement('DIV');obj.id=popup.elementId;obj.style.position='absolute';obj.style.display='none';obj.innerHTML=result.text;document.body.appendChild(obj);popupController.showPopup(popup);var d=popupController.getPreviousPopup();if(d)popupController.reloadPreviousPopup(null);else s3.reloadContent()}else{result.text=req.responseText}}else{result.error=false}}return result},makeGetRequest:function(url,onCloseAlert){var loader,request=this.getRequest();if(request){url=this.urlParamReplace(url,'rnd',Math.round(Math.random()*10000));if(url.indexOf('&xhr=1')==-1){url+="&xhr=1"}loader=document.getElementById("ajax-loader");if(loader){loader.style.display="block"}request.open('GET',url,false);request.send('');request=this.parseRequestResult(request);if(loader){loader.style.display="none"}if(!request||request.error){s3.alertHTML(s3.formatError(request.text),onCloseAlert)}}return request},makePutRequest:function(url,parameters,onCloseAlert){var loader,request=this.getRequest();if(request){loader=document.getElementById("ajax-loader");if(loader){loader.style.display="block"}request.open('PUT',url,false);request.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");if(parameters){parameters=parameters+"&"}parameters=parameters+(parameters.indexOf('&xhr=1')==-1?"xhr=1&":"")+"rnd="+Math.round(Math.random()*10000);request.send(parameters);request=this.parseRequestResult(request);if(loader){loader.style.display="none"}if(!request||request.error){s3.alertHTML(s3.formatError(request.text),onCloseAlert)}}return request},makeAsynchPostRequest:function(url,params,callback){var request=this.getRequest();if(request){url=this.urlParamReplace(url,'rnd',Math.round(Math.random()*10000));request.onreadystatechange=function(){util.requestOnChange(request,callback)};request.open('POST',url,true);request.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");request.send(params)}return request},makeAsynchGetRequest:function(url,callback){var request=this.getRequest();if(request){url=this.urlParamReplace(url,'rnd',Math.round(Math.random()*10000));request.onreadystatechange=function(){util.requestOnChange(request,callback)};request.open('GET',url,true);request.send('')}return request},requestOnChange:function(req,func){if(req.readyState==4){var result=false;if(req.status==200){result={error:false,data:req.responseText}}try{if(func)func(result)}catch(ex){}}},touchUrl:function(url){var r=this.makeGetRequest(url);if(!r)return false;return!r.error},loadString:function(url){var r=this.makeGetRequest(url);if(!r||r.error)return false;return r.text},addClass:function(obj,className){if(obj){if(!obj.className){obj.className=className}else if(obj.className.indexOf(className)==-1){obj.className+=" "+className}}},removeClass:function(obj,className){if(typeof obj.className=="string"){obj.className=obj.className.replace(new RegExp(' ?'+className,'g'),'')}},hasClass:function(obj,className){if(typeof obj.className!=='string'){return false}return(obj.className.indexOf(className)!=-1?true:false)},loadObject:function(obj,url){if(typeof obj=='string')obj=util.getObject(obj);if(!obj)return;obj.innerHTML=s3.loc('JS_LOADING');var r=util.makeGetRequest(url);if(r.error){s3.alertHTML(s3.formatError(r.text));return}obj.innerHTML=r.text},walk:function(obj,f,t){if(!obj)return;for(var i=0;i<obj.childNodes.length;i++){var c=obj.childNodes[i];f.call(t,c);if(c.childNodes&&c.childNodes.length>0){util.walk(c,f,t)}}},resetForm:function(form,only_visible){var elements=form.elements;var field_type;for(var i=0;i<elements.length;i++){field_type=elements[i].type.toLowerCase();switch(field_type){case"text":case"password":case"textarea":elements[i].value="";break;case"hidden":if(!only_visible)elements[i].value="";break;case"radio":case"checkbox":if(elements[i].checked){elements[i].checked=false}break;case"select-one":case"select-multi":elements[i].selectedIndex=-1;break;default:break}}},submitFormFromIframe:function(container){var s3Form=container;if(s3Form){s3Form.find('.s3-btn-save').click()}},initCountdown:function(container,interval,onComplete){if(!interval){interval=1e3}var timer=setInterval(function(){if(!container){clearInterval(timer);return}var seconds=parseInt(container.innerHTML);if(isNaN(seconds)||seconds==0){clearInterval(timer);container.innerHTML='0';setTimeout(function(){onComplete()},interval);return}container.innerHTML=--seconds},interval)},isMatch:function(value,regexList){return regexList.some((regex)=>regex.test(value))},loadCss:function(href,removeAfterLoad=false,settings=null){let link=document.createElement('link');link.href=href;link.type='text/css';link.rel='stylesheet';if(settings){for(const settingsKey in settings){link[settingsKey]=settings[settingsKey]}}document.head.append(link);if(removeAfterLoad){link.remove()}},changeStyleControlIfValueASet:function(control,controlType=''){const val=$(control).val();if(val){switch(controlType){case'select2':$(control).next().find('.select2-selection').css({'background':'#C0F1CD'});break;default:$(control).css({'background':'#C0F1CD'})}}else{switch(controlType){case'select2':$(control).next().find('.select2-selection').css({'background':'#fff'});break;default:$(control).css({'background':'#fff'})}}}};util.customEvent={o:$({}),on:function(){this.o.on.apply(this.o,arguments)},trigger:function(){this.o.trigger.apply(this.o,arguments)},off:function(){this.o.off.apply(this.o,arguments)}};var coordinatesController={x:0,y:0,lastX:0,lastY:0,deltaX:0,deltaY:0,left:false,up:false,handlers:[],init:function(){document.onmousemove=this.getMouseXYInterface},getMouseXYInterface:function(e){return coordinatesController.getMouseXY(e)},getMouseXY:function(e){var so=util.scrollOffset();if(typeof browserController!='undefined'&&browserController.isMSIE){this.x=event.clientX+so.x;this.y=event.clientY+so.y}else{this.x=e.pageX;this.y=e.pageY}if(this.x<0){this.x=0}if(this.y<0){this.y=0}this.left=false;this.up=false;this.deltaX=this.x-this.lastX;this.deltaY=this.y-this.lastY;if(this.deltaX<0){this.left=true}if(this.deltaY<0){this.up=true}this.lastX=this.x;this.lastY=this.y;for(var i in this.handlers){this.handlers[i].fn.call(this.handlers[i].scope,e,this.x,this.y,this.left,this.up)}return true},addHandler:function(_handler,name,scope){name=name||'anonymous';this.handlers.push({fn:_handler,name:name.toLowerCase(),scope:scope||this})},removeHandler:function(name){name=name.toLowerCase();for(var i in this.handlers){if(this.handlers[i].name==name){this.handlers.splice(i,1);break}}}};if(!window.dragDropSource)window.dragDropSource={};function dragDropSource(borderControlId,dragElementTagName,tree){this.borderId=borderControlId;this.border=null;this.tag=dragElementTagName;this.empty=document.createElement(this.tag);this.empty.style.border="1px dashed black";this.drag=null;this.offsetX=0;this.offsetY=0;this.allowedClasses=new Object();this.notAllowedIdis=new Object();this.classCheck=null;this.idCheck=null;this.treeBasicCheck=true;this.triggerElementId=null;this.triggerElementClassName=null;this.triggerElementTagName=null;this.emptyClassName;this.branchClassName;this.branchExpandedClassName="";this.branchCollapsedClassName="";this.srcExpand='/my/s3/images/ico-expand.gif';this.srcCollapse='/my/s3/images/ico-collapse.gif';this.branchEndClassName;this.xStep=10;this.yStep=10;this.oldX=0;this.oldY=0;this.minX=0;this.minY=0;this.maxX=0;this.maxY=0;this.tree=tree;this.marging=null;this.padding=null;this.horizontal=false;this.emptyBorder=null;this.onUpdate=null;this.dragParent=null;this.dragNextSibling=null;this.inaction=false};dragDropSource.prototype={addBanUndockElement:function(element_id){this.banUndockList.element_id=1},isValid:function(obj){if(!obj)return false;if(this.empty==obj)return true;if(obj.nodeName!=this.tag)return false;if(this.idCheck&&obj.id&&this.notAllowedIdis.obj.id)return false;if(this.classCheck){if(!obj.className)return false;if(!this.allowedClasses.obj.className)return false}if(this.tree&&this.treeBasicCheck){if(!obj.className)return false;if(obj.className.indexOf(this.branchClassName)==-1&&obj.className!=this.branchEndClassName)return false}return true},getBorder:function(){if(this.borderId.indexOf('^')==0){this.border=$("[id^="+this.borderId.replace('^','')+"]:last").get(0)}else{this.border=document.getElementById(this.borderId)}return this.border},undock:function(obj,x,y){if(this.inaction)return false;obj=this.getElement(obj);if(!this.drag&&obj){this.inaction=true;this.drag=obj;this.dragParent=this.drag.parentNode;this.dragNextSibling=util.getNextSibling(this.drag,this.tag);this.margin=util.getMargins(this.drag);this.padding=util.getPaddings(this.drag);this.empty=this.drag.cloneNode(false);if(this.emptyClassName)this.empty.className=this.emptyClassName;this.empty.style.backgroundColor="transparent";if(!this.tree){this.empty.style.width=obj.offsetWidth}else{this.empty.style.width=200}this.empty.style.height=obj.offsetHeight;var coords=util.findPos(obj);this.offsetX=x+this.margin.left-coords[0];this.offsetY=y+this.margin.top-coords[1];util.detachElement(this.empty);this.oldX=x;this.oldY=y;this.moveObj(x,y);this.drag.parentNode.insertBefore(this.empty,this.drag);if(!this.tree){this.empty.style.width=obj.offsetWidth-(this.empty.offsetWidth-obj.offsetWidth)}this.empty.style.height=obj.offsetHeight-(this.empty.offsetHeight-obj.offsetHeight);this.moveObj(x,y);if(this.tree&&this.branchClassName&&this.branchEndClassName){this.drag.className=this.drag.className.replace(new RegExp("\\b"+this.branchClassName+"(?!-[\\w-])\\b"),this.branchEndClassName);var a;if(!util.getNextSiblingExcept(this.drag,this.tag,this.empty))a=util.getPreviousSiblingExcept(this.drag,this.tag,this.empty);if(a){a.className=this.branchEndClassName;a.className=a.className.replace(new RegExp("\\b"+this.branchClassName+"(?!-[\\w-])\\b"),this.branchEndClassName)}}util.detachElement(this.drag);var p=popupController.getLastPopup();if(p)this.drag.style.zIndex=parseInt(p.obj.style.zIndex)+1;else this.drag.style.zIndex=1000;this.drag.style.position='absolute';document.body.appendChild(this.drag);this.countMaxXY();this.inaction=false;return true}return false},countMaxXY:function(){this.getBorder();if(!this.border)return false;var coords=util.findPos(this.border);this.minX=coords[0]-this.drag.offsetWidth;if(this.minX<0)this.minX=0;this.minY=coords[1]-this.drag.offsetHeight;if(this.minY<0)this.minY=0;this.maxX=coords[0]+this.border.offsetWidth;this.maxY=coords[1]+this.border.offsetHeight;var obj;if(this.border.offsetWidth==0){obj=this.getFirstChild(this.border);var tempMaxX=0;while(obj){coords=util.findPos(obj);if(tempMaxX>coords[0]+obj.offsetWidth)break;if(this.maxX<coords[0]+obj.offsetWidth)this.maxX=coords[0]+obj.offsetWidth;tempMaxX=coords[0]+obj.offsetWidth;obj=this.getNextSibling(obj)}}obj=this.getLastChild(this.border);if(obj){coords=util.findPos(obj);if(this.maxY<coords[1]+obj.offsetHeight)this.maxY=coords[1]+obj.offsetHeight}if(!this.tree){var _tempY=0;obj=this.getFirstChild(this.border);while(obj){coords=util.findPos(obj);if(coords[1]==_tempY){this.horizontal=true;break}_tempY=coords[1];obj=this.getNextSibling(obj)}}},dock:function(){if(this.drag){if(this.inaction)return false;this.inaction=true;if(!this.empty.parentNode){util.detachElement(this.drag);this.dragParent.insertBefore(this.drag,this.dragNextSibling)}else if(this.empty.parentNode.nodeName!="#document-fragment"){util.detachElement(this.drag);this.empty.parentNode.insertBefore(this.drag,this.empty)}if(this.tree&&this.branchClassName&&this.branchEndClassName){var parent;if(util.getNextSiblingExcept(this.drag,this.tag,this.empty)){this.drag.className=this.drag.className.replace(new RegExp("\\b"+this.branchEndClassName+"(?!-[\\w-])\\b"),this.branchClassName)}else{a=util.getPreviousSiblingExcept(this.drag,this.tag,this.empty);if(a){a.className=a.className.replace(new RegExp("\\b"+this.branchEndClassName+"(?!-[\\w-])\\b"),this.branchClassName)}}}util.detachElement(this.empty);this.drag.style.position='';this.drag.style.zIndex='';this.drag.style.left='';this.drag.style.top='';if(this.onUpdate&&(this.dragParent!=this.drag.parentNode||this.dragNextSibling!=util.getNextSibling(this.drag,this.tag))){this.onUpdate(this.drag);popupController.childsPopupsHasChanged()}this.drag=null;this.inaction=false}return true},insertEmptyAfter:function(obj){_next=this.getNextSibling(obj);if(_next){if(_next!=this.empty){util.detachElement(this.empty);_next.parentNode.insertBefore(this.empty,_next)}}else{util.detachElement(this.empty);obj.parentNode.appendChild(this.empty)}},getLastChild:function(obj){if(!obj)return null;obj=obj.lastChild;while(obj){if(this.isValid(obj))return obj;obj=obj.previousSibling}return null},getFirstChild:function(obj){if(!obj)return null;obj=obj.firstChild;while(obj){if(this.isValid(obj))return obj;obj=obj.nextSibling}return null},getNextSibling:function(obj){if(!obj)return null;obj=obj.nextSibling;while(obj){if(this.isValid(obj))return obj;obj=obj.nextSibling}return null},getPreviousSibling:function(obj){if(!obj)return null;obj=obj.previousSibling;while(obj){if(this.isValid(obj))return obj;obj=obj.previousSibling}return null},getParent:function(obj){if(!obj)return null;return this.getElement(obj.parentNode)},getElement:function(obj){while(obj){if(obj==this.border)return null;if(this.isValid(obj))return obj;obj=obj.parentNode}return null},moveObj:function(x,y){if(this.drag){this.drag.style.left=(x-this.offsetX)+'px';this.drag.style.top=(y-this.offsetY)+'px'}},setInterval:function(t,f,n){window.dragDropSource[t]=setInterval(f,n)},clearInterval:function(t){if(window.dragDropSource[t]){clearInterval(window.dragDropSource[t]);window.dragDropSource[t]=null}},timerActive:function(t){return window.dragDropSource[t]},move:function(x,y,left,up){var self=this;if(!this.inaction){this.inaction=true;this.moveObj(x,y);if(Math.abs(x-this.oldX)>this.xStep||Math.abs(y-this.oldY)>this.yStep){if(x-this.offsetX>this.minX&&x-this.offsetX<this.maxX&&y-this.offsetY>this.minY&&y-this.offsetY<this.maxY){scrollContainer=document.getElementById(self.scrollContainer);if(scrollContainer&&!(window.timerScrollBottom&&window.timerScrollTop)){var scPos=util.findPos(scrollContainer.parentNode);var scH=parseInt(util.getComputedStyle(scrollContainer,"height"));var scD=scPos[1]+scH-8;scrollContainer.scrollTop+=y-self.oldY;if(scD<parseInt(self.drag.style.top)){self.clearInterval('timerScrollTop');if(!self.timerActive('timerScrollBottom')){self.setInterval('timerScrollBottom',function(){if(self.drag){if(scD<parseInt(self.drag.style.top)){scrollContainer.scrollTop+=self.xStep<<4}}else{self.clearInterval('timerScrollBottom')}},150)}}else if(scPos[1]+20>parseInt(self.drag.style.top)){self.clearInterval('timerScrollBottom');if(!self.timerActive('timerScrollTop')){self.setInterval('timerScrollTop',function(){if(self.drag){if(scPos[1]>parseInt(self.drag.style.top)){scrollContainer.scrollTop-=self.xStep<<4}}else{self.clearInterval('timerScrollTop')}},150)}}else{self.clearInterval('timerScrollTop');self.clearInterval('timerScrollBottom')}};var obj=this.getOverElement(left,up);if(obj){if(this.tree){if(this.branchCollapsedClassName&&obj.obj.className&&obj.obj.className.indexOf(this.branchCollapsedClassName)!=-1){this.toggleBranchExpanded(obj.obj,true)}var child=this.getFirstChild(obj.obj);if(child){var coords=util.findPos(child);var half_width=(coords[1]-obj.status.objY)/2;if((child!=this.empty)&&(up&&obj.status.srcY>obj.status.objY+half_width)||(!up&&obj.status.srcY+this.drag.offsetHeight>obj.status.objY+half_width)){util.detachElement(this.empty);try{obj.obj.insertBefore(this.empty,child)}catch(ex){}}else if((up&&obj.status.srcY<=obj.status.objY+half_width)||(!up&&obj.status.srcY+this.drag.offsetHeight<=obj.status.objY+half_width)){util.detachElement(this.empty);try{obj.obj.parentNode.insertBefore(this.empty,obj.obj)}catch(ex){}}}else{if(obj.obj!=this.empty){if((obj.status.beforeY)){util.detachElement(this.empty);try{obj.obj.parentNode.insertBefore(this.empty,obj.obj)}catch(ex){}}else if((obj.status.afterY)){util.detachElement(this.empty);if(obj.status.srcX-obj.status.objX>this.padding.left+this.margin.left){obj.obj.appendChild(this.empty)}else{var next=this.getNextSibling(obj.obj);if(next){try{obj.obj.parentNode.insertBefore(this.empty,next)}catch(ex){}}else{obj.obj.parentNode.appendChild(this.empty)}}}}else{var delta=obj.status.srcX-obj.status.objX;if(Math.abs(delta)>this.padding.left+this.margin.left){var n=Math.ceil(Math.abs(delta/(this.padding.left+this.margin.left)));var i=0;var tmp_obj;var last_obj;if(delta>0){tmp_obj=this.getPreviousSibling(this.empty);if(tmp_obj){var before;while(i<n-2){last_obj=this.getLastChild(tmp_obj);if(!last_obj){before=true;break}tmp_obj=last_obj;i++}util.detachElement(this.empty);tmp_obj.appendChild(this.empty)}}else{tmp_obj=this.empty.parentNode;if(tmp_obj){while(i<n){if(this.getNextSibling(tmp_obj))break;if(tmp_obj==this.border)break;last_obj=tmp_obj;tmp_obj=tmp_obj.parentNode;i++}if(last_obj){util.detachElement(this.empty);last_obj.appendChild(this.empty)}}}}}}}else if(obj.obj!=this.empty){var prev_empty=false;var next_empty=false;if(this.getPreviousSibling(obj.obj)==this.empty)prev_empty=true;if(!prev_empty&&this.getNextSibling(obj.obj)==this.empty)next_empty=true;if(prev_empty||next_empty){if((this.horizontal&&obj.status.beforeX&&left)||(!this.horizontal&&obj.status.beforeY&&up)){if(!prev_empty){util.detachElement(this.empty);obj.obj.parentNode.insertBefore(this.empty,obj.obj)}}else if((this.horizontal&&obj.status.afterX&&!left)||(!this.horizontal&&obj.status.afterY&&!up)){if(!next_empty){this.insertEmptyAfter(obj.obj)}}}else{if((this.horizontal&&obj.status.left)||(!this.horizontal&&obj.status.top)){util.detachElement(this.empty);obj.obj.parentNode.insertBefore(this.empty,obj.obj)}else{this.insertEmptyAfter(obj.obj)}}}}}this.oldX=x;this.oldY=y}this.inaction=false}},toggleBranchExpanded:function(obj,expand){obj=util.getObject(obj);if(!obj)return;var classFrom,classTo,src;if(expand){classFrom=this.branchCollapsedClassName;classTo=this.branchExpandedClassName;src=this.srcCollapse}else{classFrom=this.branchExpandedClassName;classTo=this.branchCollapsedClassName;src=this.srcExpand}var f=function(node){if(!node)return;if(node.className&&util.hasClass(node,classFrom)){node.className=node.className.replace(new RegExp("\\b"+classFrom+"(?!-[\\w-])\\b"),classTo)}else if(node.tagName=="IMG"&&node.className.indexOf("expand-collapse")!=-1){node.src=src}};f(obj);util.walk(obj,f,null)},getOverElement:function(left,up){var obj=null;if(this.drag){if(!this.tree)obj=this.getOverElementList(left,up);else obj=this.getOverElementTree(left,up)}return obj},getOverElementList:function(left,up){var status=null;var ttt=this.getFirstChild(this.empty.parentNode);while(ttt){if(ttt!=this.empty){status=util.getOverStatus(this.drag,ttt);if(status.over){var b=new Object();b.status=status;b.obj=ttt;return b}}ttt=this.getNextSibling(ttt)}return null},getOverElementTree:function(left,up){var ttt=this.getFirstChild(this.border);var status;var lastOver=null;while(ttt){status=util.getOverStatus(this.drag,ttt);if((up&&status.overTop)||(!up&&status.overBottom)){var b=new Object();b.status=status;b.obj=ttt;lastOver=b;var obj=this.getFirstChild(ttt);if(obj){ttt=obj;continue}}ttt=this.getNextSibling(ttt)}return lastOver},mouseMove:function(e,x,y,left,up){this.move(x,y,left,up)}};function dragSource(dragElementId){this.blocker=null;this.border=null;this.dragElementId=dragElementId;this.inaction=false;this.offsetX=0;this.offsetY=0;this.scrollContainer=null;this.triggerElementClassName=null;this.triggerElementId=null;this.triggerElementTagName=null}dragSource.prototype={getBorder:function(){this.border=document.getElementById(this.dragElementId);return this.border},undock:function(obj,x,y){if(this.inaction)return false;this.inaction=true;var margin=util.getMargins(this.border);var coords=util.findPos(this.border);this.offsetX=x+margin.left-coords[0];this.offsetY=y+margin.top-coords[1];this.moveObj(x,y);this.border.style.position='absolute';this.inaction=false;return true},dock:function(){if(!this.inaction){this.inaction=true;this.inaction=false}return true},moveObj:function(x,y){if(this.border){this.border.style.left=(x-this.offsetX)+'px';this.border.style.top=(y-this.offsetY)+'px';if(popupController){popupController.adjustSpecifiedPopupBlocker(this.border.id)}if(tinymceController){tinymceController.hideAllMenus()}}},move:function(x,y,left,up){if(this.inaction)return false;this.inaction=true;this.moveObj(x,y);this.inaction=false},mouseMove:function(e,x,y,left,up){this.move(x,y,left,up)}};var dragController={dragging:false,source:null,sources:new Object(),mousePressed:false,mousePressedSrc:null,init:function(){coordinatesController.addHandler(this.mouseMoveInterface);document.body.onmousedown=this.mouseDownInterface;document.onmouseup=this.mouseUpInterface},mouseMoveInterface:function(e,x,y,left,up){try{return dragController.mouseMove(e,x,y,left,up)}catch(ex){alert(ex)}},mouseMove:function(e,x,y,left,up){if(this.dragging&&this.source){this.source.mouseMove(e,x,y,left,up)}},mouseDownInterface:function(e){try{if(!popupController.mouseDownInterface(e)){return false}return dragController.mouseDown(e)}catch(ex){alert(ex)}},mouseDown:function(e){if(!this.dragging){var src=util.getEventTarget(e);if(src.nodeName=="A"||src.nodeName=="INPUT"||src.nodeName=="TEXTAREA"||src.nodeName=="SELECT"||src.nodeName=="SPAN"||src.onclick!=undefined||src.className=='clickable'){return true}if(src){for(var i in this.sources){if(this.sources[i]&&util.isParent(src,this.sources[i].getBorder())){if((this.sources[i].triggerElementId&&this.sources[i].triggerElementId!=src.id)||(this.sources[i].triggerElementClassName&&this.sources[i].triggerElementClassName!=src.className)||(this.sources[i].triggerElementTagName&&this.sources[i].triggerElementTagName!=src.nodeName)){if(src.className=='draggable'){continue}return true}if(this.sources[i].undock(src,coordinatesController.x,coordinatesController.y)){this.dragging=true;if(!window.getSelection&&!document.getSelection)if(document.selection)document.selection.empty();document.body.onselectstart=function(){return false};document.body.ondrag=function(){return false};this.source=this.sources[i]}break}}}}if(this.dragging)return false;return true},mouseUpInterface:function(e){try{return dragController.mouseUp(e)}catch(ex){alert(ex)}},mouseUp:function(e){if(this.dragging){if(this.source){if(this.source.dock()){this.source=null;this.dragging=false;document.body.ondrag=function(){return true};document.body.onselectstart=function(){return true}}}}return true},addSource:function(index,_source,retIfExists){if(retIfExists&&this.sources[index])return;this.sources[index]=_source},removeSource:function(i){this.sources[i]=null}};var resizeController={handlers:{},init:function(){window.onresize=this.onResizeInterface},onResizeInterface:function(e){resizeController.onResize(e)},onResize:function(e){for(var i in this.handlers)if(this.handlers[i])this.handlers[i](e)},addHandler:function(name,handler){if(name!=""&&handler)this.handlers[name]=handler},removeHandler:function(name){if(name!="")this.handlers[name]=null}};var scrollController={handlers:{},init:function(){window.onscroll=this.onScrollInterface},onScrollInterface:function(e){scrollController.onScroll(e)},onScroll:function(e){for(var i in this.handlers)if(this.handlers[i])this.handlers[i](e)},addHandler:function(name,handler){if(name!=""&&handler)this.handlers[name]=handler},removeHandler:function(name){if(name!="")this.handlers[name]=null}};function PopupWindow(elementId){var c=util.getObject(elementId);while(c&&util.getComputedStyle(c,'display')!='none'){elementId+="_clone";c=util.getObject(elementId)}if(c){c=c.cloneNode(false);c.id=elementId;document.body.appendChild(c)};this.elementId=elementId;this.url=null;this.postParams=null;this.putParams=null;this.modal=null;this.obj=null;this.created=null;this.drag=null;this.dragSource=null;this.x=-1;this.y=-1;this.caller=null;this.center=null;this.leftTop=null;this.onClose=null;this.onReload=null;this.onAfterReload=null;this.onSuccessPost=null;this.timeout=0;this.timer=null;this.right=false;this.blocker=null;this.onContentReady=null;this.onCloseAlert=null}PopupWindow.prototype={remove:function(){if(this.url){this.hide();util.detachElement(document.getElementById(this.obj))}},show:function(){var r=null;if(this.url){if(this.postParams){r=util.makePostRequest(this.url,this.postParams,this.onCloseAlert)}else if(this.putParams){r=util.makePutRequest(this.url,this.putParams,this.onCloseAlert)}else{r=util.makeGetRequest(this.url,this.onCloseAlert)}if(r.error){s3.alertHTML(s3.formatError(r.text),this.onCloseAlert);return false}}this.obj=document.getElementById(this.elementId);if(!this.obj){this.obj=document.createElement("DIV");this.obj.id=this.elementId;this.obj.style.position='absolute';this.obj.style.display='none';document.body.appendChild(this.obj);this.created=true}else{this.obj.style.position='absolute';this.obj.style.display='none'}if(r){this.obj.innerHTML=r.text}if(this.elemDiv){var html=$(this.elemDiv).detach();$(this.obj).html(html);$(this.obj).find('.shop2-search-full-wrapper, .shop2-reference-edit-list-wrapper').addClass('popup')}var el_id=this.elementId;if(this.drag&&!dragController.sources.el_id){var a=new dragSource(this.elementId);a.triggerElementClassName='draggable_title';this.dragSource=a;dragController.addSource(this.elementId,a)}if(this.center){this.obj.style.left=-2000+'px'}else if(this.x!=-1||this.y!=-1){this.obj.style.top=this.y+'px';this.obj.style.left=this.x+'px'}if(this.url){this.setContent(r.text,r.url)}if($.browser.msie&&$.browser.version<9.0){this.blocker=document.createElement("iframe");this.blocker.setAttribute('id',this.elementId+"_blocker");this.blocker.style.cssText='display: none; position: absolute; left: 0; top: 0';this.blocker.src='javascript:false;';this.blocker.frameBorder='0';this.blocker.scrolling='no';document.body.appendChild(this.blocker)}this.setTimeout();return true},adjustBlocker:function(){if(this.blocker){this.blocker.style.left=parseInt(this.obj.style.left)+'px';this.blocker.style.top=parseInt(this.obj.style.top)+'px';this.blocker.style.width=parseInt(this.obj.offsetWidth)+'px';this.blocker.style.height=parseInt(this.obj.offsetHeight)+'px';this.blocker.style.zIndex=parseInt(this.obj.style.zIndex)-1;this.blocker.style.display='block'}},setTimeout:function(){if(this.timeout>0){if(this.timer){window.clearTimeout(this.timer);this.timer=null}var d=this.elementId;this.timer=window.setTimeout(function(){popupController.closeSpecifiedLastPopup(d)},this.timeout);this.obj.onmouseover=function(){popupController.resetPopupTimeout(d)}}},close:function(){if(window._last_popup_blocked){return false}if(tinyMCE){tinymceController.removeControls(this.obj)}else if(CKEDITOR){ckeditorController.removeControls(this.obj)}util.hideElement(this.obj);colorPicker.hide(this.obj);if(this.created){util.detachElement(this.obj);if(this.drag){dragController.removeSource(this.elementId)}}if(this.onClose&&typeof(this.onClose)=='function')this.onClose();if(this.timer)window.clearTimeout(this.timer);this.timer=null;if(this.blocker)util.detachElement(this.blocker);return true},reload:function(){if(window._last_popup_blocked){return false}if(this.url){var r;if(this.onReload&&typeof this.onReload=='function'){this.onReload()}if(this.postParams){r=util.makePostRequest(this.url,this.postParams)}else if(this.putParams){r=util.makePutRequest(this.url,this.putParams)}else{r=util.makeGetRequest(this.url)}if(r.error){return false}this.setContent(r.text,r.url);this.reloadedText=r.text;if(this.onAfterReload&&typeof this.onAfterReload=='function'){this.onAfterReload()}}return true},setContent:function(c,url){if(this.obj){if(tinyMCE){tinymceController.removeControls(this.obj)}else if(CKEDITOR){ckeditorController.removeControls(this.obj)}this.obj.innerHTML=c;var _t=this;if(this.obj.style.display=='block'){window.setTimeout(function(){util.focusFirstVisibleControl(_t.obj)},0);this.adjustBlocker()}var a=this.obj;$(a).find('.bluepopup-wrapper').S3ChangeControls();var tree=$(a).find('.bluepopup-wrapper td.content .s3-tree');if(tree.length){tree.each(function(){treeController.init($(this))})}$('[name=seo_h1], [name=seo_title], [name=seo_description], [name=seo_keywords], [name=smt_title], [name=smt_description], .image-edit-wrap [name=keywords]').wordCounter();s3.clearTooltips();if(url)this.url=url;if(tinyMCE){tinymceController.addControls(a)}else if(CKEDITOR){ckeditorController.addControls(a)}if(this.onContentReady&&$.isFunction(this.onContentReady)){this.onContentReady()}}ACLController.init()},successPost:function(r){if(this.onSuccessPost)this.onSuccessPost(r)}};var popupController={popups:[],zIndexStep:2,modal:null,modalLayer:null,init:function(){},mouseDown:function(e){if(this.popups.length>0&&tinyMCE){var src=util.getEventTarget(e);if(src&&src.nodeName=='INPUT'||src.nodeName=='TEXTAREA'||src.nodeName=='SELECT'){return true}for(var i=this.popups.length-1;i>=0;i--){if(util.isParent(src,this.popups[i].obj)){return true}else{if(this.popups[i].modal){return false}this.closeLastPopup()}}}return true},mouseDownInterface:function(e){return popupController.mouseDown(e)},showModalDiv:function(ind){if(!this.modalLayer){this.modalLayer=document.getElementById('modal_layer')}if(this.modalLayer){this.modalLayer.style.zIndex=ind;if(this.modalLayer.style.display!='block')this.modalLayer.style.display='block'}},hideModalDiv:function(){util.hideElement(this.modalLayer)},loaded_scripts:{},postProcessControls:function(a){var self=this;var t=util.getElementByIdAndTagName(a.obj,'div','tabs');if(t){var tabHandler=function(blocks,tabs,obj){for(var i=0;i<blocks.length;i++){if(blocks[i].id==obj.getAttribute('href').replace(/.*#/,'')){blocks[i].style.display='block';$(blocks[i]).find('textarea.autoresize').change();$(blocks[i]).find('.s3-select').each(function(){var select=$(this);setTimeout(function(){if(!select.attr('data-width')&&select.width()>150){select.next('.chzn-container').width(select.width()+30)}},0)})}else{blocks[i].style.display='none'}}for(var i=0;i<tabs.length;i++){tabs[i].className=tabs[i].className.replace(' active','');$(tabs[i]).find('img').attr('src','/my/s3/images/help_icon.png')}obj.className+=' active';$(obj).find('img').attr('src','/my/s3/images/help_icon_white.png');obj.blur();popupController.adjustModalLayerSize();a.adjustBlocker();return false};var tabs=util.getElementsByClassName(t,'a','tab-handle');var blocks=util.getElementsByClassName(t,'div','tabs-container')[0].children;var errors=false;function changeUrl(tab){var last=popupController.getLastPopup();if(!last||!tab){return}var href=tab.getAttribute('href');if(!href||href.indexOf('#tab-')!==0){return}href=href.slice(5);last.url=util.urlParamReplace(last.url,'tab',href)}for(var i=0;i<tabs.length;i++){util.addEvent(tabs[i],'click',(function(q){return function(){changeUrl(tabs[q]);return tabHandler(blocks,tabs,tabs[q])}})(i));if(!errors&&util.getElementsByClassName(blocks[i],'span','form_error').length){errors=true;tabHandler(blocks,tabs,tabs[i]);tabs[i].style.borderColor="#E96C5F";tabs[i].style.color="#E96C5F"}}if(!errors){var activeIndex=0;activeTab=$(tabs).filter('[href="#tab-'+util.getUrlParam(a.url,"tab")+'"]');if(activeTab.length){activeIndex=$(tabs).index(activeTab)}tabHandler(blocks,tabs,tabs[activeIndex])}}try{$(a.obj).find('.json-editor').each(function(e){var opt=jQuery.parseJSON($(this).attr('data'));$(this).jsonEditor(opt)});$(a.obj).find('.combobox').each(function(e,o){$(o).combobox()});$(a.obj).find("script").each(function(){try{if(name=$(this).attr("name")){if(!self.loaded_scripts[name]){self.loaded_scripts[name]=true;eval($(this).html())}}else{eval($(this).html())}}catch(e){}});$(a.obj).find('.autocomplete').each(function(e){function split(val){return val.split(/,\s*/)}function extractLast(term){return split(term).pop()}var multi=$(this).hasClass('multiple');var data=$(this).attr('data');try{data=eval('('+data+')')}catch(e){}var options={minLength:2,focus:function(){return false}};if(multi){var max_cnt=10;options.select=function(event,ui){var terms=split(this.value);terms.pop();terms.push(ui.item.value);this.value=terms.join(", ");if(terms.length<max_cnt){this.value+=", "}return false};options.search=function(){if(extractLast(this.value).length<options.minLength||split(this.value).length>max_cnt){return false}}}if(typeof data=="string"){var cache={};options.source=function(request,response){var term=extractLast(request.term);if(term in cache){response(cache[term])}else{$.getJSON(data,{term:term},function(data){if(data.result){response(cache[term]=data.result)}else{response(cache[term]=data)}})}}}else{if(multi){options.source=function(request,response){response($.ui.autocomplete.filter(data,extractLast(request.term)))}}else{options.source=data}}$(this).bind("keydown",function(event){if(event.keyCode===$.ui.keyCode.ENTER&&!$(this).data("autocomplete").menu.active){$(this).data('autocomplete').close();return false}}).autocomplete(options)})}catch(e){}},showPopup:function(a){var jqueryPopup=S3PopUp.getLastPopup();var tmp_index=jqueryPopup?(jqueryPopup.css('z-index')):(a.zIndex||1000);a.prev_scroll_top=$(window).scrollTop();if(this.popups.length>0){tmp_index=Math.max(parseInt(this.popups[this.popups.length-1].obj.style.zIndex)||0,tmp_index);if(a.zIndex&&tmp_index<a.zIndex){tmp_index=a.zIndex}}if(a.show()){if((!isPartner&&S3_LANG_CODE=='ru'&&!isStaffUser)||(isStaffUser&&!util.readCookie('hide_help'))){ContextHelp._init({url:a.url,popup:true})}a.obj.style.zIndex=tmp_index+this.zIndexStep;this.popups.push(a);window?.popups?.push('s3');if(a.modal){this.showModalDiv(tmp_index+this.zIndexStep-1);this.modal=true}util.showElement(a.obj);if(a.caller){a.obj.style.top='0px';var size=util.clientSize();var height=(Math.max(document.body.clientHeight,size.h,document.body.scrollHeight));var coords=util.findPos(a.caller);var x=coords[0];var y=coords[1];var objHeight=$(a.obj).height();if((y+objHeight)>=height&&objHeight<=y){a.obj.style.top=(y-objHeight)+'px'}else{a.obj.style.top=(y+a.y)+'px'}a.obj.style.left=(x+a.x)+'px'}else window.setTimeout(function(){popupController.postProcessControls(a);popupController.adjustModalLayerSize();a.adjustBlocker();var elements=util.getElementsByClassName(a.obj,'*','drag-drop-source');if(elements&&elements.length){for(i in elements){var id=elements[i].id;if(!id)continue;var tag=elements[i].tagName;if(tag=='UL')dragElementTagName='LI';else if(tag=='DIV')dragElementTagName='DIV';else continue;var ds=new dragDropSource(id,dragElementTagName,false);ds.triggerElementClassName='draggable';ds.triggerElementTagName='TD';dragController.addSource(id,ds,true)}}if(a.center){util.centerElement(a.obj)}},3);window.setTimeout(function(){util.focusFirstVisibleControl(a.obj)},5);return a.obj}return null},reloadPreviousPopup:function(url){if(this.popups.length>1){var p=this.popups[this.popups.length-2];if(url){p.url=url}p.reload();window.setTimeout(function(){popupController.postProcessControls(p);popupController.adjustModalLayerSize();$('.focused').focus()},1)}return true},reloadLastPopup:function(url,center){if(window._last_popup_blocked){return false}if(this.popups.length>0){let i=1;while(i<=this.popups.length){if(this.popups[this.popups.length-i].elementId==='alert'){i++;continue}p=this.popups[this.popups.length-i];break}if(url){p.url=url}if(p.obj){$(p.obj).S3DestroyControls()}p.reload();window.setTimeout(function(){if(center)util.centerElement(p.obj);popupController.postProcessControls(p);popupController.adjustModalLayerSize();p.adjustBlocker()},1)}return true},touchLastPopup:function(){if(window._last_popup_blocked){return false}if(this.popups.length>0){p=this.popups[this.popups.length-1];window.setTimeout(function(){util.centerElement(p.obj);popupController.adjustModalLayerSize();p.adjustBlocker()},1)}return true},getLastPopup:function(){if(this.popups.length>0)return this.popups[this.popups.length-1];return null},getPreviousPopup:function(){if(this.popups.length>1)return this.popups[this.popups.length-2];return null},getLastModalPopup:function(){var offset=arguments[0]?arguments[0]:0;if(this.popups.length>0)for(var i=this.popups.length-1;i>=0;i--)if(this.popups[i].modal){if(offset)offset--;else return this.popups[i]}return null},successPostLastPopup:function(r){if(this.popups.length>0)this.getLastPopup().successPost(r)},updatePostLastPopup:function(r){if(this.popups.length>0){var p=this.getLastPopup();if(p&&p.onUpdate){p.onUpdate(r)}util.msg(s3.loc('JS_SAVED'),'green')}},setLastPopupContent:function(text,url){if(this.popups.length>0){this.popups[this.popups.length-1].setContent(text,url);var obj=this.popups[this.popups.length-1];window.setTimeout(function(){popupController.postProcessControls(obj);popupController.adjustModalLayerSize();$('.focused').focus()},1)}},setPreviousPopupContent:function(text,url){if(this.popups.length>1){this.popups[this.popups.length-2].setContent(text,url);window.setTimeout(function(){popupController.adjustModalLayerSize();$('.focused').focus()},1)}},closeLastPopup:function(){try{$('.s3-tooltip').tooltip('close')}catch(e){};var last_popup=popupController.getLastPopup();if(!JsonCodeController.jsonCodeWarning()&&last_popup.elementId!='alert')return;if(last_popup){if(!last_popup.prev_scroll_top){last_popup.prev_scroll_top=0}$(window).scrollTop(last_popup.prev_scroll_top)}var p=this.popups.pop();window?.popups?.pop();if(!p)return;if(p.obj){$(p.obj).S3DestroyControls()}if(p.close()===false){this.popups.push(p);return}if(p.modal){this.modal=null;for(var i=this.popups.length-1;i>=0;i--){if(this.popups[i].modal){this.modal=true;this.showModalDiv(parseInt(this.popups[i].obj.style.zIndex)-1);break}}if(!this.modal)this.hideModalDiv()}p=this.getLastPopup();if(p)p.adjustBlocker()},toggleLastPopup:function(obj,urlIcoExpand,urlIcoRestore){var p=this.getLastPopup();var table;try{if(p){if(!p.expanded){var cSize=util.clientSize();p._left=p.obj.style.left;p._top=$(document).scrollTop()+'px';p.obj.style.width="100%";p.obj.style.height=cSize.h+'px';p.obj.style.left=0;p.obj.style.top=p._top;table=p.obj.getElementsByTagName("TABLE")[0];if(table){table.style.width="100%";var delta=cSize.h;table.style.height=(delta>=0?delta+'px':0);$(table).addClass('bluepopup-table-expdanded').trigger('expanded')}p.expanded=true;obj.src=urlIcoRestore}else{p.obj.style.width="";p.obj.style.height="";p.obj.style.left=parseInt(p._left)+'px';p.obj.style.top=parseInt(p._top)+'px';table=p.obj.getElementsByTagName("TABLE")[0];if(table){table.style.width=table.style.height="";$(table).removeClass('bluepopup-table-expdanded')}util.centerElement(p.obj);p.expanded=false;obj.src=urlIcoExpand}this.adjustSpecifiedPopupBlocker(p.obj.id)}}catch(e){}},centerLastPopup:function(){var p=this.getLastPopup();util.centerElement(p.obj)},adjustSpecifiedPopupBlocker:function(id){if(typeof browserController!='undefined'&&browserController.isMSIE&&this.popups.length>0){for(var i=this.popups.length-1;i>=0;i--){if(this.popups[i].obj.id==id){this.popups[i].adjustBlocker();break}}}},closeSpecifiedLastPopup:function(elementId){if(this.popups.length>0&&this.popups[this.popups.length-1].obj&&this.popups[this.popups.length-1].obj.id)this.closeLastPopup()},resetPopupTimeout:function(elementId){for(var i=this.popups.length-1;i>=0;i--){if(this.popups[i].obj.id==elementId){this.popups[i].setTimeout();break}}},adjustModalLayerSize:function(){if(this.modal&&this.modalLayer&&this.modalLayer.style.display=='block'){var size=util.clientSize();if(parseInt(this.modalLayer.style.height)!=Math.max(document.body.clientHeight,size.h,document.body.scrollHeight))this.modalLayer.style.height=(Math.max(document.body.clientHeight,size.h,document.body.scrollHeight))+'px'}},childsPopupsHasChanged:function(){if(this.popups.length>0){this.popups[0].childsHasChanged=true}},adjustPopup:function(popup){window.setTimeout(function(){util.centerElement(popup.obj);popup.adjustBlocker();popupController.adjustModalLayerSize()},1)}};var treeStorage={containerId:false,elementTag:false,elementPrefix:false,url:false,updated:false,lang_no_changes:JS_NOTHING_IS_CHANGED,lang_saved:JS_CHANGES_SAVED,lang_saved_error:JS_ERROR_WHILE_SAVING_CHANGES,lang_unload_confirm:JS_UNLOAD_SAVE_CHANGES_CONFIRM,lang_on_update:JS_SAVING_PAGE_STRUCTURE_INSTRUCTION,onUpdate:function(){if(!treeStorage.updated){s3.alert(treeStorage.lang_on_update)}treeStorage.updated=true;document.getElementById('savePagesOrder').style.display=''},onUnload:function(){if(this.updated){if(confirm(this.lang_unload_confirm))this.save()}},save:function(){if(!this.updated){s3.alert(this.lang_no_changes);return false}var main=document.getElementById(this.containerId);var elements=main.getElementsByTagName(this.elementTag);var s='';var level=0;var parent;var id=0;for(i=0;i<elements.length;i++){if(elements[i].id.substring(0,this.elementPrefix.length)==this.elementPrefix){id=elements[i].id.substring(this.elementPrefix.length)}else{continue}parent=elements[i].parentNode;level=0;while(parent&&parent!=main){parent=parent.parentNode;level++}s+="\n"+id+"="+level}var res=util.makePostRequest(this.url,"lines="+s);if(res.error){s3.alert(this.lang_saved_error)}else{s3.alert(this.lang_saved);this.updated=false;document.getElementById('savePagesOrder').style.display='none'}},cancel:function(){document.getElementById('savePagesOrder').style.display='none';var newLocation=document.location.toString();document.location=util.urlParamReplace(newLocation,"r",new Date().getTime());this.updated=false}};var folderController={divContextMenu:"foldersContextMenu",divProperties:"foldersProperties",divBrowser:'divFolderBrowser',divScroll:'folder_scroll_div',divRoot:'folder-draggable-root',classBranchExpanded:'folderBranch-expanded',classBranchCollapsed:'folderBranch-collapsed',classFolderHidden:'folderHidden',classFolderLinked:'folderLinked',classChanged:'folderChanged',classFolderEye:'folderEye',classFolderLink:'folderLink',cookieSelectorState:'FOLDER_SELECTOR_STATE_',srcEye:'/my/s3/images/eye10.png',srcEyeClosed:'/my/s3/images/square10.gif',srcLink:'/my/s3/images/flink2.png',srcLinkClosed:'/my/s3/images/flink1.png',onClick:false,timer:null,folder_id:0,parent_id:0,type_id:0,hidden:0,folders_length:0,nodeIdPostfix:'',selected:false,selectedClassName:"",mode:"",selectorLoaded:"",copyWithBranch:0,lang_none:"none",lang_all:'JS_FOLDERS_ALL',lang_not_in_a_folder:'JS_ITEMS_NOT_IN_A_FOLDER',overrideSettings:null,controllers:[],allSelected:false,hasLockedChild:function(folder_id){if(isStaffUser)return false;if(!folder_id){folder_id=this.controllers[this.last_id].folder_id}if(!folder_id)return false;if($('#folder'+folder_id).parent().find('.folderName.pageLocked').length){s3.alert(s3.loc('JS_FOLDER_HAS_LOCKED_CHILD'));return true}return false},isLocked:function(){if(isStaffUser)return false;var folder_id=this.controllers[this.last_id].folder_id;if(!folder_id)return false;if($('#folder'+folder_id).hasClass('pageLocked')){s3.alert(s3.loc('JS_FOLDER_LOCKED'));return true}return this.hasLockedChild(folder_id)},treeHasLockedItem:function(){if(isStaffUser)return false;if($('#'+this.divRoot).find('.folderName.pageLocked').length){s3.alert(s3.loc('JS_FOLDER_TREE_HAS_LOCKED_ITEM'));return true}return false},contextMenu:function(obj,new_folder_id,e){if(folderStorage.updated){s3.alert(s3.loc('JS_SAVE_OR_CANCEL_FOLDER_ORDER_CHANGES_FIRST'));return}if(this.controllers[this.last_id].selected)this.selected.className=this.selectedClassName;this.controllers[this.last_id].selected=obj;this.controllers[this.last_id].selectedClassName=obj.className;this.controllers[this.last_id].folder_id=new_folder_id;this.controllers[this.last_id].hidden=util.hasClass(obj,'folderHidden')?1:(util.hasClass(obj,'folderLinked')?2:0);$(obj).addClass("folderContextMenu");var popup=new PopupWindow(this.divContextMenu);var a=[coordinatesController.lastX,coordinatesController.lastY];popup.x=a[0]-5;popup.y=a[1]+5;popup.timeout=5000;popup.onClose=this.contextMenuHideInterface;popupController.showPopup(popup)},click:function(folder_id,obj){const hasLastController=this.controllers.length&&this.last_id;if(hasLastController){const countOfSelectedItems=this.controllers[this.last_id].container.find('>li').length;const limit=this.controllers[this.last_id].limit;if(limit&&countOfSelectedItems>=limit){s3.alert(s3.loc(this.controllers[this.last_id].limit_msg),function(){popupController.closeLastPopup()});return}}var node=$(obj).parents('.dynatree-node:first'),label=node.find('label:first');if((node.hasClass('filter')&&!treeController.exportFolders)||node.hasClass('link'))return false;if(label.hasClass('active')){node.removeClass('active');label.removeClass('active');label.find('input').removeAttr('checked')}else{node.addClass('active');label.addClass('active');label.find('input').attr('checked','checked')}if(node.hasClass('search_tree')){var $form=$(obj).parents('.s3-tree-wr').find('.s3-tree-folders-context'),script_url=$form.find('.search-form input[name=script_url]').val().replace("search","index");filter_text=$form.find('.search-form input[name="s[text]"]').val(),is_popup=$form.find('.search-form input[name=popup]').val(),is_global=$form.find('.search-form input[name=global]').val(),type_id=$form.find('.search-form input[name=type_id]').val(),tab='';if(parseInt(is_global)){tab='global'}else{tab='loaded'}if(!parseInt(is_popup)){var url_hash=(window.location.hash.substr(1)).replace('&63;','?').split('?');script_url=url_hash[0]}setTimeout(function(){var tree_id=$form.find('.search-form input[name=tree_id]').val();search_text=$('.tree-wrapper .folders-search input.search-text').val(),object_id=$('.tree-wrapper .folders-search .search-form input[name=object_id]').val(),url=script_url+'?folder_id='+folder_id+'&object_id='+object_id+'&tab_id='+tab+'&folders_search=1&filter_text='+search_text+'&'+S3_ACCESS;if(type_id==68||type_id==39||type_id==8){url+='&act=view'}else{url+='&mode=search_tree&s[text]='+search_text}if(!$(obj).filter('input').length){$('.search_tree .folder-name').removeClass('active');node.find('.folder-name').addClass('active');localStorage.setItem('folder_search_data_'+tree_id,$form.parent().find('.search-results').html())}if(parseInt(is_popup)){if(!$(obj).filter('input').length){s3.loadPopupContent(url+'&popup=1')}}else{s3.loadContent(url)}},300)}obj=$(obj).find('input:first');if(this.controllers[this.last_id]&&this.controllers[this.last_id].onClick){this.controllers[this.last_id].onClick(folder_id,obj)}},load:function(mode,type_id,object_id,obj,onClick,nodeIdPostfix,overrideSettings,reload,disabled_ids){this.controllers.unshift({onClick:onClick,nodeIdPostfix:nodeIdPostfix||'',mode:mode,objectId:object_id,type_id:type_id,parent_id:0,overrideSettings:overrideSettings||null});var self=this;this.last_id=0;var cacheID=mode+type_id+object_id;if(popupController.getLastPopup()){var a=popupController.getLastPopup().obj;var inp=util.getElementByIdAndTagName(a,'INPUT','folder_ids'+nodeIdPostfix)}else{var inp=util.getObject('folder_ids'+nodeIdPostfix)}var popup=new PopupWindow(this.divBrowser);var selected=(mode=='select'||mode=='radio')?inp.value:util.readCookie('last_folder_for_type_'+nodeIdPostfix);var coords=util.findPos(obj);var cs=util.clientSize();popup.modal=true;popup.center=true;popup.onClose=function(){folderStorage.updated=false;self.controllers.shift();if(reload){this.reloadPopupWithSavingDataFormWhenManipulatingFolders(nodeIdPostfix)}};popup.url="/-/cms/v1/folder/?"+access+"&type_id="+type_id+"&object_id="+object_id+"&mode="+mode+(overrideSettings&&overrideSettings.allowOnlyFilled?"&allow_only_filled=1":"")+"&selected="+selected+(disabled_ids?"&disabled="+disabled_ids:"");popupController.showPopup(popup);popup.obj.className='drsElement';popup.obj.style.height='700px';popup.obj.style.width='500px';if(mode=='select'){var c_popup=popupController.getLastPopup().obj,div_root=$(c_popup).find('#'+folderController.divRoot);folderController.folders_length=div_root.find('input[type=checkbox]').not(':disabled').length-1;var checked_items=div_root.find('input:checked').length,disabled_checked=div_root.find('input:disabled:checked').length;folderController.folders_length+=disabled_checked;if(folderController.folders_length==checked_items){div_root.find('#checkAll').attr('checked',true)}}},getFoldersFromBrowser:function(){var d=$(popupController.getLastPopup().obj).is(".s3-tree")?popupController.getLastPopup().obj:$(popupController.getLastPopup().obj).find('.s3-tree').get(0);var elements=util.getElementsByClassName(d,'SPAN','folder-name');var inputs=util.getElementsByClassName(d,'INPUT','folder-input');var res=new Object;for(var i=0;i<elements.length;i++){var folder_id=new Number(elements[i].id.replace('folder',''));if(folder_id==0)continue;s=(inputs&&inputs[i]&&$(inputs[i]).parent('label:first').hasClass('active'))?true:false;res[folder_id]={name:elements[i].innerHTML,checked:s}}return res},cancel:function(){popupController.closeLastPopup()},edit:function(mode,obj){var prevPopup=popupController.getLastPopup();var url;if(prevPopup.obj.id==this.divContextMenu){popupController.closeLastPopup()}if(mode=='add'){this.controllers[this.last_id].parent_id=this.controllers[this.last_id].folder_id?this.controllers[this.last_id].folder_id:this.folder_id;this.controllers[this.last_id].folder_id=0}else{this.controllers[this.last_id].parent_id=0}if(mode=='copy'||mode=='copyfull'){var p=document.getElementById('folder-draggable-'+this.controllers[this.last_id].folder_id).parentNode;var matches=p.id.match(/folder-draggable-(\d+)/);if(matches&&typeof matches[1]!='undefined'){this.controllers[this.last_id].parent_id=matches[1]}if(mode=='copyfull'){this.copyWithBranch=true}var folder_id=this.controllers[this.last_id].folder_id;url='/-/cms/v1/folder/?act=copy&'+access+'&folder_parent='+this.controllers[this.last_id].parent_id+'&folder_id='+this.controllers[this.last_id].folder_id+'&mode='+this.controllers[this.last_id].mode+'&copymode='+mode+'&object_id='+(this.controllers[this.last_id].objectId?this.controllers[this.last_id].objectId:0)+'&type_id='+(this.controllers[this.last_id].type_id?this.controllers[this.last_id].type_id:0);var r=util.makeGetRequest(url);if(!r.error){if(r.code==1){var popup=new PopupWindow('ajaxPopupWindow_'+popupController.popups.length);popup.drag=true;popup.modal=true;popup.center=true;popup.created=true;obj=document.createElement("DIV");obj.id=popup.elementId;obj.style.position='absolute';obj.style.display='none';obj.innerHTML=r.text;document.body.appendChild(obj);popupController.showPopup(popup)}else{this.controllers[this.last_id].folder_id=0;folderController.save(r,true);var folder_name=$('#folder'+folder_id).text();var alert_message,message_prefix;if(this.controllers[this.last_id].type_id==39||this.controllers[this.last_id].type_id==32){alert_message=(mode=='copyfull'?s3.loc('JS_FOLDER_BRANCH_COPY_DONE'):s3.loc('JS_FOLDER_COPY_DONE')),message_prefix=(mode=='copyfull'?s3.loc('JS_FOLDER_BRANCH_COPY_DONE'):s3.loc('JS_FOLDER_COPY_DONE'))+this.controllers[this.last_id].type_id}else{alert_message=(mode=='copyfull'?s3.loc('JS_FOLDER_BRANCH_COPY_DONE_NOT_HIDDEN'):s3.loc('JS_FOLDER_COPY_DONE_NOT_HIDDEN')),message_prefix=(mode=='copyfull'?s3.loc('JS_FOLDER_BRANCH_COPY_DONE_NOT_HIDDEN'):s3.loc('JS_FOLDER_COPY_DONE_NOT_HIDDEN'))+this.controllers[this.last_id].type_id}alert_message=alert_message.replace('%FOLDER_NAME%',folder_name);s3.alertHTML(alert_message,false,message_prefix)}}return}else if(mode=='toggle_lock'){this.toggleLock();return}url="/-/cms/v1/folder/?act=edit&"+access+"&folder_parent="+this.controllers[this.last_id].parent_id+"&folder_id="+this.controllers[this.last_id].folder_id+"&mode="+this.controllers[this.last_id].mode+"&hidden="+(this.controllers[this.last_id].hidden?this.controllers[this.last_id].hidden:0)+"&object_id="+(this.controllers[this.last_id].objectId?this.controllers[this.last_id].objectId:0)+"&type_id="+(this.controllers[this.last_id].type_id?this.controllers[this.last_id].type_id:0);if(mode=='add'){if(document.getElementById('folder'+this.controllers[this.last_id].parent_id).parentNode.className=='folderBranch-root')this.controllers[this.last_id].parent_id=0}var onSubmit=function(r){folderController.save(r)};openAjaxForm(url,onSubmit,folderController.pageDeselectInterface)},toggleLock:function(){var folder_id,url,r;folder_id=this.controllers[this.last_id].folder_id;url="/-/cms/v1/folder/?act=toggle_lock&"+access+"&folder_id="+folder_id+"&type_id="+(this.controllers[this.last_id].type_id?this.controllers[this.last_id].type_id:0);r=util.makeGetRequest(url);if(r&&!r.error){$('#folder'+folder_id).toggleClass('pageLocked')}},save:function(r,keepOpen){if(!keepOpen){this.cancel()}var matches=r.text.match(/this,(\d+)/);if(!matches[1]){alert('bad');return false}var new_folder_id=matches[1],all_id='#folder-all';if(this.controllers[this.last_id].folder_id){var d=document.getElementById('folder'+this.controllers[this.last_id].folder_id).parentNode;var pos=d.innerHTML.toLowerCase().indexOf("div");d.innerHTML=r.text+(pos>0?d.innerHTML.substr(pos-1):'')}else{var nd=document.createElement('DIV');nd.innerHTML=r.text;if(!this.copyWithBranch){nd.className='folderBranch-end';nd.id='folder-draggable-'+new_folder_id}var p,imgobj,tmpimg;if(this.controllers[this.last_id].parent_id){p=document.getElementById('folder'+this.controllers[this.last_id].parent_id).parentNode;imgobj=util.getFirstChild(p,'IMG');if(imgobj.className!='folder-expand-collapse'){tmpimg=document.createElement('IMG');tmpimg.setAttribute("src","/my/s3/images/ico-collapse.gif");tmpimg.setAttribute("alt","+");tmpimg.setAttribute("width","9");tmpimg.setAttribute("height","9");tmpimg.setAttribute("onclick","folderController.toggleExpanded(this)");tmpimg.setAttribute("class","folder-expand-collapse");p.insertBefore(tmpimg,imgobj);util.addClass(p,this.classBranchExpanded);imgobj=tmpimg}var isCollapsed=(p.className.indexOf(this.classBranchExpanded)==-1?true:false);if(isCollapsed){util.addClass(p,this.classBranchExpanded);util.removeClass(p,this.classBranchCollapsed);imgobj.src='/my/s3/images/ico-collapse.gif'}}else{p=$(popupController.getLastPopup().obj).find('#'+this.divRoot).get(0)}var lastchild=util.getLastChild(p,'DIV');if(lastchild){folderController.toggleLastChild(lastchild,true)}if(this.copyWithBranch){nd=util.getFirstChild(nd,'DIV');this.copyWithBranch=false}p.appendChild(nd);var $all_wrap=$(nd).find(all_id);if($all_wrap){$all_wrap.detach();$all_wrap.insertAfter($(p).find('.spacer20:first'))}folderController.folders_length=$('#'+folderController.divRoot).find('input[name=folder]').length}if($(all_id).get(0)){var check_id=$('#checkAll');check_id.removeAttr('checked');var res=folderController.getFoldersFromBrowser(),res_html="&mdash;",folder_names=[],folder_ids=[],folder_length=0,checked_length=0;for(i in res){folder_length+=1;if(res[i].checked){folder_names.push(res[i].name);folder_ids.push(i);checked_length+=1}}folderController.folders_length=folder_length;var disabled_length=$('#'+folderController.divRoot).find('input:disabled').length;if(checked_length==(folder_length-disabled_length)){check_id[0].checked=true}if(folder_names.length)res_html=folder_names.join(" / ");$('#objectEditFolderList').html(res_html);if(folder_ids.length)$('#folder_ids').val(folder_ids.join(","))}return false},toggleHidden:function(obj,folderId,isShop){var self=this;if(this.timer){window.clearTimeout(this.timer)}window.setTimeout(function(){var div=util.getParent(obj,'DIV');if(!div)return;var divParent=util.getParent(div,'DIV');var c=util.getFirstChild(divParent,'SPAN');var isParentHidden=util.hasClass(c,self.classFolderHidden)||util.hasClass(c,self.classFolderLinked);var isAlertShown=false;var firstNode=true;c=util.getFirstChild(div,'SPAN');var isHidden=util.hasClass(c,self.classFolderHidden);var eye_img=util.getElementsByClassName(div,'IMG',self.classFolderEye),link_img=util.getElementsByClassName(div,'IMG',self.classFolderLink);if(isHidden){util.removeClass(c,self.classFolderHidden);eye_img[0].src=self.srcEye}else{util.removeClass(c,self.classFolderLinked);util.addClass(c,self.classFolderHidden);eye_img[0].src=self.srcEyeClosed;if(link_img.length){link_img[0].src=self.srcLinkClosed}}if(!isAlertShown){util.makeGetRequest('/-/cms/v1/folder/?act=visibility&folder_id='+folderId+"&hide="+(isHidden?'0':'1')+"&"+access)}},300)},toggleLinked:function(obj,folderId){var self=this;if(this.timer){window.clearTimeout(this.timer)}window.setTimeout(function(){var div=util.getParent(obj,'DIV');if(!div)return;var divParent=util.getParent(div,'DIV');var c=util.getFirstChild(divParent,'SPAN');var isParentHidden=util.hasClass(c,self.classFolderLinked)|util.hasClass(c,self.classFolderHidden);var isAlertShown=false;var firstNode=true;c=util.getFirstChild(div,'SPAN');var isHidden=util.hasClass(c,self.classFolderLinked);var eye_img=util.getElementsByClassName(div,'IMG',self.classFolderEye),link_img=util.getElementsByClassName(div,'IMG',self.classFolderLink);if(isHidden){util.removeClass(c,self.classFolderLinked);link_img[0].src=self.srcLinkClosed}else{util.removeClass(c,self.classFolderHidden);util.addClass(c,self.classFolderLinked);eye_img[0].src=self.srcEye;link_img[0].src=self.srcLink}if(!isAlertShown){util.makeGetRequest('/-/cms/v1/folder/?act=visibility&folder_id='+folderId+"&hide="+(isHidden?'0':'2')+"&"+access)}},300)},contextMenuHide:function(){this.controllers[this.last_id].selected.className=this.controllers[this.last_id].selectedClassName;this.controllers[this.last_id].selected=false},contextMenuHideInterface:function(){folderController.contextMenuHide()},toggleLastChild:function(lastchild,addlastchild){if(util.hasClass(lastchild,'folderBranch-end')&&!addlastchild)return;var tmpclass;if(util.hasClass(lastchild,this.classBranchExpanded))tmpclass=this.classBranchExpanded;if(util.hasClass(lastchild,this.classBranchCollapsed))tmpclass=this.classBranchCollapsed;if(addlastchild){lastchild.className='folderBranch'}else{lastchild.className='folderBranch-end'}if(tmpclass)util.addClass(lastchild,tmpclass)},remove:function(){var self=this,f;var menu_id=$('#folder-draggable-root').parent().data('tree-id');if(self.isLocked()){return}popupController.closeLastPopup();f=function(){d=$('[id=folder'+folderController.controllers[folderController.last_id].folder_id+']').parent();d.each(function(){var p=this.parentNode;p.removeChild(this);var lastchild=util.getLastChild(p,'DIV');if(lastchild){folderController.toggleLastChild(lastchild,false)}else{util.removeClass(p,self.classBranchExpanded);var imgobj=util.getFirstChild(p,'IMG');if(imgobj.className=='folder-expand-collapse'){p.removeChild(imgobj)}}});util.makePostRequest('/-/cms/v1/folder/?act=delete&folder_id='+folderController.controllers[folderController.last_id].folder_id+'&type_id='+(self.controllers[self.last_id].type_id?self.controllers[self.last_id].type_id:self.type_id)+'&folder_parent=0&'+'&tree_id='+menu_id+'&'+access,'');popupController.closeLastPopup();folderController.select();if($('#'+self.divRoot).find(">div").length==0){$("#folder-all").remove()}};var strConfirm;if(this.overrideSettings&&typeof this.overrideSettings.confirmDelete=="string"){strConfirm=this.overrideSettings.confirmDelete}else{strConfirm=s3.loc('JS_CONFIRM_DELETE')};s3.confirm(strConfirm,f)},reloadPopupWithSavingDataFormWhenManipulatingFolders:function(nodeIdPostfix,objectEditFolderList=null){var p=popupController.getLastPopup();if(!p){return}var imagePartSelector="#control-multi-imagemaster_kind_image_id\\[\\]";var form=$(p.obj).find('form').get(0);var formData=formcontents(form).split('&');var imagePart=$(imagePartSelector).html();if(objectEditFolderList){Preloader.show()}p.url=util.urlParamReplace(p.url,'reload',1);p.url=util.urlParamReplace(p.url,'action','');p.url=util.urlParamReplace(p.url,'folder_ids'+nodeIdPostfix,util.getObject('folder_ids'+nodeIdPostfix).value);if(util.getObject('folder_mode')){p.url=util.urlParamReplace(p.url,'folder_mode',util.getObject('folder_mode').value)}popupController.reloadLastPopup(p.url,true);form=$(p.obj).find('form').get(0);for(var i=0,formElement;i<formData.length;++i){var chunk=formData[i].split('=');var[valueName,value]=chunk;if(chunk.length!==2||value===''){continue}formElement=$(form.elements[valueName]);if(!formElement.length){continue}if(formElement.attr('type')==='checkbox'||$(formElement).attr('type')==='radio'){formElement=formElement.filter('[value='+value+']');if(formElement.parent('label').hasClass('switcher')||(!formElement.is(':visible')&&!formElement.attr('checked'))){formElement.click();continue}formElement.attr('checked','checked');formElement.change()}else if(formElement.attr('multiple')){formElement.filter('[value='+value+']').attr('selected','selected')}else{formElement.val(decodeURIComponent(value));if(formElement.get(0).tagName==='SELECT'&&formElement.hasClass('s3-select')){formElement.trigger('liszt:updated')}}}$(imagePartSelector).html(imagePart);if(objectEditFolderList){setTimeout(function(){Preloader.hide();$(objectEditFolderList).find('li:first span.mark').click()},200)}}};folderController.save2query=function(folder_id,query_id){var href=document.getElementById('folder'+folder_id);var name=(href)?href.innerHTML:'';var r=util.touchUrl('/-/cms/v1/page/content/?act=save&'+access+'&query_id='+query_id+'&ids='+folder_id);if(r){var d=document.getElementById('save2queryFolderName_'+query_id);if(d)d.innerHTML=name}popupController.closeLastPopup()};folderController.selectSingleFolderControl=function(folder_id,control_id,reload){var href,name,e;if(reload){popupController.closeLastPopup();var p=popupController.getLastPopup();if(!p)return;p.url=util.urlParamReplace(p.url,'reload',1);p.url=util.urlParamReplace(p.url,'action','');p.url=util.urlParamReplace(p.url,control_id,folder_id);var form=$(p.obj).find('form').get(0);var formData=formcontents(form).split('&');popupController.reloadLastPopup(p.url,true);form=$(p.obj).find('form').get(0);for(var i=0,re=/^folder_id\w?$/;i<formData.length;++i){var chunk=formData[i].split('=');if(chunk.length!=2||re.test(chunk[0]))continue;$(form.elements[chunk[0]]).val(decodeURIComponent(chunk[1]))}return};e=document.getElementById(control_id);if(e){e.value=folder_id}href=document.getElementById('folder'+folder_id);name=(href)?href.innerHTML:'';let control_name=document.getElementById(control_id+"_name");e=control_name.querySelector('.title .name');if(e){e.innerHTML=name}if(control_name){control_name.style.display='block'}popupController.closeLastPopup()};folderController.filter=function(folder_id,type){var cookie_name="last_folder_for_type_"+type;if(folder_id==0||folder_id==-1){util.eraseCookie(cookie_name);cookie_name="last_page_for_type_"+type;util.eraseCookie(cookie_name)}else{util.createCookie(cookie_name,folder_id,7);cookie_name="last_page_for_type_"+type;util.eraseCookie(cookie_name)}var d=popupController.getPreviousPopup();var url=(d)?d.url:s3.lastContentUrl;url=util.urlParamReplace(url,"folder_id",folder_id);url=util.urlParamReplace(url,"p",0);url=util.urlParamReplace(url,"s[_folder_ids]",0);if(d){d.url=url;d.reload()}else{s3.loadContent(url)}var href=document.getElementById('folder'+folder_id);var name=(href)?href.innerHTML:(folder_id==-1?this.lang_not_in_a_folder:this.lang_all);var filter=document.getElementById('filters'+this.nodeIdPostfix);if(filter)filter.innerHTML=name;popupController.closeLastPopup()};folderController.select=function(folder_id,input){var previousPopup=popupController.getPreviousPopup();var folder_ids_span=null;var objectEditFolderList_span=null;if(previousPopup){var a=previousPopup.obj;folder_ids_span=util.getElementByIdAndTagName(a,'INPUT','folder_ids'+this.nodeIdPostfix);objectEditFolderList_span=util.getElementByIdAndTagName(a,'UL','objectEditFolderList'+this.nodeIdPostfix)}if(!folder_ids_span||!objectEditFolderList_span){folder_ids_span=util.getObject('folder_ids'+this.nodeIdPostfix);objectEditFolderList_span=document.getElementById('objectEditFolderList'+this.nodeIdPostfix)}if(folder_ids_span&&objectEditFolderList_span){var ids=folder_ids_span.value.split(','),isset_mark=$(objectEditFolderList_span).hasClass('folders-mark'),res_html='',folder_length=0,folderNames=[];$(objectEditFolderList_span).find('>li').each(function(){var name=$(this).find('span.title span.name').text();folderNames.push(name)});if(input){var selectInput=$(input),selectFolderId=selectInput.parents('.dynatree-node:first').find('span.folder-name:first').attr('id').replace('folder',''),selectFolderName=selectInput.parents('.dynatree-node:first').find('span.folder-name:first').text();if(ids.indexOf(selectFolderId)!=-1){ids.splice(ids.indexOf(selectFolderId),1);folderNames.splice(folderNames.indexOf(selectFolderName),1)}else{ids.push(selectFolderId);folderNames.push(selectFolderName)}}ids=treeController.cleanArray(ids);var lastPopup=popupController.getLastPopup();var disabled_not_checked=$("#"+lastPopup.elementId).find('input:disabled').not(':checked').length;folderController.folders_length=folder_length;if(ids.length==0)folderNames.push("&mdash;");folder_ids_span.value=ids.join(",");treeController.selectedFolders=folder_ids_span.value;if(ids.length==0){res_html=""}else{for(var i=0;i<folderNames.length;i++){if(isset_mark){res_html+='<li class="folder-'+ids[i]+'" data-prefix="'+this.nodeIdPostfix+'"><span class="title"><span class="s3-ico i-folder-grey-svg"></span><span class="name">'+folderNames[i]+'</span></span><span class="remove" onclick="folderController.delete('+ids[i]+', this.parentNode)"><span class="s3-ico i-delete-svg"></span></span><span class="mark" onclick="folderController.markAsMainFolder(this, '+ids[i]+')"><span class="s3-ico i-ol-check"></span></span></li>'}else{res_html+='<li class="folder-'+ids[i]+'" data-prefix="'+this.nodeIdPostfix+'"><span class="title"><span class="s3-ico i-folder-grey-svg"></span><span class="name">'+folderNames[i]+'</span></span><span class="remove" onclick="folderController.delete('+ids[i]+', this.parentNode)"><span class="s3-ico i-delete-svg"></span></span></li>'}}}objectEditFolderList_span.innerHTML=res_html}};folderController.delete=function(folder_id,elem,reload){var lastPopup=popupController.getLastPopup();var folder_ids_span=null;var objectEditFolderList_span=null;var nodeIdPostfix=$(elem).data('prefix');var form=util.getParent(elem,'FORM');var folder_id_input=$(form).find('input#folder_id');if(lastPopup){var a=lastPopup.obj;folder_ids_span=util.getElementByIdAndTagName(a,'INPUT','folder_ids'+nodeIdPostfix);objectEditFolderList_span=util.getElementByIdAndTagName(a,'UL','objectEditFolderList'+nodeIdPostfix)}if(!folder_ids_span||!objectEditFolderList_span){folder_ids_span=util.getObject('folder_ids'+nodeIdPostfix);objectEditFolderList_span=document.getElementById('objectEditFolderList'+nodeIdPostfix)}if(folder_ids_span&&objectEditFolderList_span){var folder_id=folder_id.toString();var ids=folder_ids_span.value.split(',');var index=ids.indexOf(folder_id);if(index!=-1){ids.splice(index,1);folder_ids_span.value=ids.join(",");if($(elem).hasClass('mark')){folder_id_input.val(0)}elem.remove();if(reload){this.reloadPopupWithSavingDataFormWhenManipulatingFolders(nodeIdPostfix,objectEditFolderList_span)}}}};folderController.selectOne=function(folder_id){var previousPopup=popupController.getPreviousPopup();var folder_ids_span=null;var objectEditFolderList_span=null;if(previousPopup){var a=previousPopup.obj;folder_ids_span=util.getElementByIdAndTagName(a,'INPUT','folder_ids'+this.nodeIdPostfix);objectEditFolderList_span=util.getElementByIdAndTagName(a,'SPAN','objectEditFolderList'+this.nodeIdPostfix)}if(!folder_ids_span||!objectEditFolderList_span){folder_ids_span=util.getObject('folder_ids'+this.nodeIdPostfix);objectEditFolderList_span=document.getElementById('objectEditFolderList'+this.nodeIdPostfix)}if(folder_ids_span&&objectEditFolderList_span){var ids=folder_ids_span.value.split(',');var res=folderController.getFoldersFromBrowser();var res_html='';var folder_ids=[];var folder_names=[];var folder_length=0;for(var i in res){folder_length+=1;if(res[i].checked){folder_ids.push(i);folder_names.push(res[i].name)}}var lastPopup=popupController.getLastPopup();var disabled_not_checked=$("#"+lastPopup.elementId).find('input:disabled').not(':checked').length;folderController.folders_length=folder_length;if(folder_ids.length==0)folder_names.push("&mdash;");folder_ids_span.value=folder_ids.join(",");if(folder_ids.length==0){res_html=""}else{for(i=0;i<folder_names.length;i++){res_html+='<li><span class="title"><span class="s3-ico i-folder-grey-svg"></span><span class="name">'+folder_names[i]+'</span></span><span class="remove" onclick="folderController.delete('+folder_ids[i]+')"><span class="s3-ico i-delete-svg"></span></span></li>'}}if(folder_ids.length==(folderController.folders_length-disabled_not_checked)){if(document.getElementById('checkAll')){if(!disabled_not_checked)res_html='<li><span class="title"><span class="s3-ico i-folder-grey-svg"></span><span class="name">'+JS_ALL+'</span></span><span class="remove"><span class="s3-ico i-delete-svg"></span></span></li>';document.getElementById('checkAll').checked=true}else{res_html=""}}else{if(document.getElementById('checkAll')){document.getElementById('checkAll').checked=false}}objectEditFolderList_span.innerHTML=res_html}};folderController.correctDimensions=function(){var browser=document.getElementById(folderController.divBrowser);if(browser){var scrollDiv=document.getElementById(folderController.divScroll);if(scrollDiv){var h1=parseFloat(util.getComputedStyle(browser,'height'));var h2=parseFloat(util.getComputedStyle(scrollDiv,'height'));var delta=h1-h2-20;scrollDiv.style.height=(h2+delta)+'px'}}};folderController.toggleExpanded=function(obj){var parent=util.getParent(obj,'DIV');if(!parent)return;var isExpanded=(parent.className.indexOf(this.classBranchExpanded)!=-1?true:false);if(isExpanded){util.removeClass(parent,this.classBranchExpanded);util.addClass(parent,this.classBranchCollapsed);obj.src='/my/s3/images/ico-expand.gif'}else{util.addClass(parent,this.classBranchExpanded);util.removeClass(parent,this.classBranchCollapsed);obj.src='/my/s3/images/ico-collapse.gif'}};folderController.expandAll=function(obj){this.toggleExpandedAll(obj,true);util.createCookie(this.cookieSelectorState+this.controllers[this.last_id].type_id,'expanded',0.5)};folderController.collapseAll=function(obj){this.toggleExpandedAll(obj,false);util.createCookie(this.cookieSelectorState+this.controllers[this.last_id].type_id,'collapsed',0.5)};folderController.toggleExpandedAll=function(obj,expand){obj=$(popupController.getLastPopup().obj).find('#'+obj).get(0);if(!obj)obj=util.getObject(obj);if(!obj)return;var classFrom,classTo,src;if(expand){classFrom=this.classBranchCollapsed;classTo=this.classBranchExpanded;src='/my/s3/images/ico-collapse.gif'}else{classFrom=this.classBranchExpanded;classTo=this.classBranchCollapsed;src='/my/s3/images/ico-expand.gif'}var a=util.getElementsByClassName(obj,'IMG','folder-expand-collapse');var div;for(var i=0;i<a.length;i++){div=util.getParent(a[i],'DIV');util.removeClass(div,classFrom);util.addClass(div,classTo);a[i].src=src}};folderController.removeAll=function(treeId){var self=this;if(self.treeHasLockedItem()){return}var p=$(popupController.getLastPopup().obj).find('#'+self.divRoot).get(0);var f=function(){if(!p){return};var folderId,e;var c=util.getFirstChild(p,"DIV");while(c){if(c.id.indexOf('folder')==0){e=util.getNextSibling(c,"DIV");util.detachElement(c);c=e;continue};c=util.getNextSibling(c,"DIV")}$('#objectEditFolderList').html("&mdash;");$('#folder-all').remove();util.makePostRequest('/-/cms/v1/folder/?act=delete_all'+'&type_id='+self.controllers[self.last_id].type_id+'&tree_id='+treeId+'&'+access,'');popupController.closeLastPopup()};s3.confirm(s3.loc('JS_CONFIRM_DELETE_ALL_CATEGORIES'),f)};folderController.selectAllFolders=function(node){var self=this,tree_id=parseInt(node.data.tree_id),type_id=parseInt(node.data.type_id),object_id=parseInt(node.data.object_id),url="/-/cms/v1/folder/?act=select_all&"+S3_ACCESS+"&tree_id="+tree_id+"&type_id="+type_id+"&object_id="+object_id;var previousPopup=popupController.getPreviousPopup(),lastPopup=popupController.getLastPopup();treeController.nodeIdPostfix=$(lastPopup.obj).find('.s3-tree').data('nodeidpostfix');if(previousPopup){var a=previousPopup.obj;var folder_ids_span=util.getElementByIdAndTagName(a,'INPUT','folder_ids'+self.nodeIdPostfix);var objectEditFolderList_span=util.getElementByIdAndTagName(a,'UL','objectEditFolderList'+self.nodeIdPostfix)}if(!folder_ids_span||!objectEditFolderList_span){folder_ids_span=util.getObject('folder_ids'+self.nodeIdPostfix);objectEditFolderList_span=document.getElementById('objectEditFolderList'+self.nodeIdPostfix)}if(folder_ids_span&&objectEditFolderList_span){if(self.allSelected){folder_ids_span.value='';objectEditFolderList_span.innerHTML='';$(node.span).removeClass('active');self.allSelected=false;self.selectAllInputs();treeController.selectedFolders=folder_ids_span.value}else{var response=util.makeGetRequest(url);if(response&&!response.error){folder_ids_span.value=response.text;var html='<li data-prefix="'+treeController.nodeIdPostfix+'"><span class="title"><span class="s3-ico i-folder-dark"></span><span class="name">'+JS_ALL+'</span></span></li>';objectEditFolderList_span.innerHTML=html;$(node.span).addClass('active');self.allSelected=true;self.selectAllInputs(true);treeController.selectedFolders=folder_ids_span.value}}}};folderController.selectAllInputs=function(flag){var self=this,tree=$(treeController.tree);if(flag){tree.find('.dynatree-node').each(function(ind,el){$(this).addClass('active');$(this).find('label.s3-cb').addClass('active');$(this).find('label.s3-cb input').attr('checked','checked')})}else{tree.find('.dynatree-node').each(function(ind,el){$(this).removeClass('active');$(this).find('label.s3-cb').removeClass('active');$(this).find('label.s3-cb input').removeAttr('checked')})}};folderController.selectExportFolders=function(folder_id,input){var self=this;var previousPopup=popupController.getPreviousPopup();var folder_ids_span=null;var objectEditFolderList_span=null;folderController.allSelected=false;$(treeController.tree).find('.dynatree-node.root').removeClass('active');$(treeController.tree).find('.dynatree-node.root').find('label.s3-cb').removeClass('active');$(treeController.tree).find('.dynatree-node.root').find('label.s3-cb input').removeAttr('checked');if(previousPopup){var a=previousPopup.obj;folder_ids_span=util.getElementByIdAndTagName(a,'INPUT','folder_ids'+this.nodeIdPostfix);objectEditFolderList_span=util.getElementByIdAndTagName(a,'UL','objectEditFolderList'+this.nodeIdPostfix)}if(!folder_ids_span||!objectEditFolderList_span){folder_ids_span=util.getObject('folder_ids'+this.nodeIdPostfix);objectEditFolderList_span=document.getElementById('objectEditFolderList'+this.nodeIdPostfix)}if(folder_ids_span&&objectEditFolderList_span){var ids=(folder_ids_span.value!='')?folder_ids_span.value.split(','):[],res_html='',folder_length=0,folderNames=[];ids=treeController.cleanArray(ids);if(input){var selectInput=$(input),selectFolderId=selectInput.parents('.dynatree-node:first').find('span.folder-name:first').attr('id').replace('folder','');if(ids.indexOf(selectFolderId)!=-1){ids.splice(ids.indexOf(selectFolderId),1)}else{ids.push(selectFolderId)}}var lastPopup=popupController.getLastPopup();var disabled_not_checked=$("#"+lastPopup.elementId).find('input:disabled').not(':checked').length;folderController.folders_length=folder_length;if(ids.length==0)folderNames.push("&mdash;");folder_ids_span.value=ids.join(",");treeController.selectedFolders=folder_ids_span.value;if(treeController.folderCount==ids.length){$(treeController.tree).find('.dynatree-node.root').addClass('active');$(treeController.tree).find('.dynatree-node.root').find('label.s3-cb').addClass('active');$(treeController.tree).find('.dynatree-node.root').find('label.s3-cb input').attr('checked','checked');folderController.allSelected=true}if(ids.length==0){res_html=""}else if(treeController.folderCount==ids.length){res_html+='<li><span class="title"><span class="s3-ico i-folder-dark"></span><span class="name">'+JS_ALL+'</span></span></li>'}else{res_html+='<li><span class="title"><span class="s3-ico i-folder-multi"></span><span class="name">'+JS_SELECTED+'&nbsp</span><span class="s3-badge">'+ids.length+'</span></span></li>'}objectEditFolderList_span.innerHTML=res_html}};folderController.addImageToGallery=function(folder_id,input){var previousPopup=popupController.getPreviousPopup(),folder_ids_span=null,objectEditFolderList_span=null;if(previousPopup){var a=previousPopup.obj;folder_ids_span=util.getElementByIdAndTagName(a,'INPUT','folder_ids'+this.nodeIdPostfix);objectEditFolderList_span=util.getElementByIdAndTagName(a,'UL','objectEditFolderList'+this.nodeIdPostfix)}if(!folder_ids_span||!objectEditFolderList_span){folder_ids_span=util.getObject('folder_ids'+this.nodeIdPostfix);objectEditFolderList_span=document.getElementById('objectEditFolderList'+this.nodeIdPostfix)}if(folder_ids_span&&objectEditFolderList_span){var ids=(folder_ids_span.value!='')?folder_ids_span.value.split(','):[],res_html='',folder_length=0,folderNames=[];ids=treeController.cleanArray(ids);$(objectEditFolderList_span).find('>li').each(function(){var name=$(this).find('span.title span.name').text();folderNames.push(name)});if(input){var selectInput=$(input),selectFolderId=selectInput.parents('.dynatree-node:first').find('span.folder-name:first').attr('id').replace('folder',''),selectFolderName=selectInput.parents('.dynatree-node:first').find('span.folder-name:first').text();if(ids.indexOf(selectFolderId)!=-1){ids.splice(ids.indexOf(selectFolderId),1);folderNames.splice(folderNames.indexOf(selectFolderName),1)}else{ids.push(selectFolderId);folderNames.push(selectFolderName)}}folder_ids_span.value=ids.join(",");if(ids.length==0){res_html="";$(objectEditFolderList_span).hide()}else{for(var i=0;i<folderNames.length;i++){res_html+='<li class="folder-'+ids[i]+'" data-prefix="'+this.nodeIdPostfix+'"><span class="title"><span class="s3-ico i-folder-dark"></span><span class="name">'+folderNames[i]+'</span></span><span class="remove" onclick="folderController.delete('+ids[i]+', this.parentNode)"><span class="s3-ico i-delete-svg"></span></span></li>'}$(objectEditFolderList_span).show()}objectEditFolderList_span.innerHTML=res_html}};folderController.markAsMainFolder=function(obj,folder_id){var form=util.getParent(obj,'FORM'),folder_id_input=$(form).find('input#folder_id'),liParent=obj.parentNode;if($(liParent).hasClass('mark')){return false}else{$(liParent).siblings().removeClass('mark');$(liParent).addClass('mark');folder_id_input.val(folder_id)}};folderController.initMainFolder=function(){var popup=popupController.getLastPopup();if(popup.obj){var p=popup.obj,folder_id_input=util.getElementByIdAndTagName(p,'INPUT','folder_id'),objectEditFolderList=util.getElementByIdAndTagName(p,'UL','objectEditFolderList');var folder_id;if(folder_id_input&&folder_id_input.value){folder_id=folder_id_input.value}var li=$(objectEditFolderList).find('li.folder-'+folder_id);if(li.get(0)){li.addClass('mark')}else{var l=$(objectEditFolderList).find('>li:first');l.find('span.mark').click()}}};folderController.selectBranch=function(obj,folder_id){var selectBranch=$('#folder-branch-'+folder_id).data('selected');pageController.selectDynatreeBranch(true,selectBranch,folder_id,folder_id)};(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):(global=global||self,global.Shepherd=factory())}(this,function(){'use strict';function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;subClass.__proto__=superClass}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}var validTypes={object:true,symbol:true};var isImplemented=function(){var symbol;if(typeof Symbol!=='function')return false;symbol=Symbol('test symbol');try{String(symbol)}catch(e){return false}if(!validTypes[typeof Symbol.iterator])return false;if(!validTypes[typeof Symbol.toPrimitive])return false;if(!validTypes[typeof Symbol.toStringTag])return false;return true};var global$1=(function(){if(this)return this;Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:true});try{return __global__}finally{delete Object.prototype.__global__}})();var commonjsGlobal=typeof globalThis!=='undefined'?globalThis:typeof window!=='undefined'?window:typeof global!=='undefined'?global:typeof self!=='undefined'?self:{};function unwrapExports(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,'default')?x['default']:x}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}var _undefined=void 0;var is=function(value){return value!==_undefined&&value!==null};var possibleTypes={"object":true,"function":true,"undefined":true};var is$1=function(value){if(!is(value))return false;return hasOwnProperty.call(possibleTypes,typeof value)};var is$2=function(value){if(!is$1(value))return false;try{if(!value.constructor)return false;return value.constructor.prototype===value}catch(error){return false}};var is$3=function(value){if(typeof value!=="function")return false;if(!hasOwnProperty.call(value,"length"))return false;try{if(typeof value.length!=="number")return false;if(typeof value.call!=="function")return false;if(typeof value.apply!=="function")return false}catch(error){return false}return!is$2(value)};var classRe=/^\s*class[\s{/}]/,functionToString=Function.prototype.toString;var is$4=function(value){if(!is$3(value))return false;if(classRe.test(functionToString.call(value)))return false;return true};var isImplemented$1=function(){var assign=Object.assign,obj;if(typeof assign!=="function")return false;obj={foo:"raz"};assign(obj,{bar:"dwa"},{trzy:"trzy"});return(obj.foo+obj.bar+obj.trzy)==="razdwatrzy"};var isImplemented$2=function(){try{Object.keys("primitive");return true}catch(e){return false}};var noop=function(){};var _undefined$1=noop();var isValue=function(val){return(val!==_undefined$1)&&(val!==null)};var keys=Object.keys;var shim=function(object){return keys(isValue(object)?Object(object):object)};var keys$1=isImplemented$2()?Object.keys:shim;var validValue=function(value){if(!isValue(value))throw new TypeError("Cannot use null or undefined");return value};var max=Math.max;var shim$1=function(dest,src){var error,i,length=max(arguments.length,2),assign;dest=Object(validValue(dest));assign=function(key){try{dest[key]=src[key]}catch(e){if(!error)error=e}};for(i=1;i<length;++i){src=arguments[i];keys$1(src).forEach(assign)}if(error!==undefined)throw error;return dest};var assign=isImplemented$1()?Object.assign:shim$1;var forEach=Array.prototype.forEach,create=Object.create;var process=function(src,obj){var key;for(key in src)obj[key]=src[key]};var normalizeOptions=function(opts1){var result=create(null);forEach.call(arguments,function(options){if(!isValue(options))return;process(Object(options),result)});return result};var str="razdwatrzy";var isImplemented$3=function(){if(typeof str.contains!=="function")return false;return(str.contains("dwa")===true)&&(str.contains("foo")===false)};var indexOf=String.prototype.indexOf;var shim$2=function(searchString){return indexOf.call(this,searchString,arguments[1])>-1};var contains=isImplemented$3()?String.prototype.contains:shim$2;var d_1=createCommonjsModule(function(module){var d=(module.exports=function(dscr,value){var c,e,w,options,desc;if(arguments.length<2||typeof dscr!=="string"){options=value;value=dscr;dscr=null}else{options=arguments[2]}if(is(dscr)){c=contains.call(dscr,"c");e=contains.call(dscr,"e");w=contains.call(dscr,"w")}else{c=w=true;e=false}desc={value:value,configurable:c,enumerable:e,writable:w};return!options?desc:assign(normalizeOptions(options),desc)});d.gs=function(dscr,get,set){var c,e,options,desc;if(typeof dscr!=="string"){options=set;set=get;get=dscr;dscr=null}else{options=arguments[3]}if(!is(get)){get=undefined}else if(!is$4(get)){options=get;get=set=undefined}else if(!is(set)){set=undefined}else if(!is$4(set)){options=set;set=undefined}if(is(dscr)){c=contains.call(dscr,"c");e=contains.call(dscr,"e")}else{c=true;e=false}desc={get:get,set:set,configurable:c,enumerable:e};return!options?desc:assign(normalizeOptions(options),desc)}});var isSymbol=function(x){if(!x)return false;if(typeof x==='symbol')return true;if(!x.constructor)return false;if(x.constructor.name!=='Symbol')return false;return(x[x.constructor.toStringTag]==='Symbol')};var validateSymbol=function(value){if(!isSymbol(value))throw new TypeError(value+" is not a symbol");return value};var create$1=Object.create,defineProperties=Object.defineProperties,defineProperty=Object.defineProperty,objPrototype=Object.prototype,NativeSymbol,SymbolPolyfill,HiddenSymbol,globalSymbols=create$1(null),isNativeSafe;if(typeof Symbol==='function'){NativeSymbol=Symbol;try{String(NativeSymbol());isNativeSafe=true}catch(ignore){}}var generateName=(function(){var created=create$1(null);return function(desc){var postfix=0,name,ie11BugWorkaround;while(created[desc+(postfix||'')])++postfix;desc+=(postfix||'');created[desc]=true;name='@@'+desc;defineProperty(objPrototype,name,d_1.gs(null,function(value){if(ie11BugWorkaround)return;ie11BugWorkaround=true;defineProperty(this,name,d_1(value));ie11BugWorkaround=false}));return name}}());HiddenSymbol=function Symbol(description){if(this instanceof HiddenSymbol)throw new TypeError('Symbol is not a constructor');return SymbolPolyfill(description)};var polyfill=SymbolPolyfill=function Symbol(description){var symbol;if(this instanceof Symbol)throw new TypeError('Symbol is not a constructor');if(isNativeSafe)return NativeSymbol(description);symbol=create$1(HiddenSymbol.prototype);description=(description===undefined?'':String(description));return defineProperties(symbol,{__description__:d_1('',description),__name__:d_1('',generateName(description))})};defineProperties(SymbolPolyfill,{for:d_1(function(key){if(globalSymbols[key])return globalSymbols[key];return(globalSymbols[key]=SymbolPolyfill(String(key)))}),keyFor:d_1(function(s){var key;validateSymbol(s);for(key in globalSymbols)if(globalSymbols[key]===s)return key}),hasInstance:d_1('',(NativeSymbol&&NativeSymbol.hasInstance)||SymbolPolyfill('hasInstance')),isConcatSpreadable:d_1('',(NativeSymbol&&NativeSymbol.isConcatSpreadable)||SymbolPolyfill('isConcatSpreadable')),iterator:d_1('',(NativeSymbol&&NativeSymbol.iterator)||SymbolPolyfill('iterator')),match:d_1('',(NativeSymbol&&NativeSymbol.match)||SymbolPolyfill('match')),replace:d_1('',(NativeSymbol&&NativeSymbol.replace)||SymbolPolyfill('replace')),search:d_1('',(NativeSymbol&&NativeSymbol.search)||SymbolPolyfill('search')),species:d_1('',(NativeSymbol&&NativeSymbol.species)||SymbolPolyfill('species')),split:d_1('',(NativeSymbol&&NativeSymbol.split)||SymbolPolyfill('split')),toPrimitive:d_1('',(NativeSymbol&&NativeSymbol.toPrimitive)||SymbolPolyfill('toPrimitive')),toStringTag:d_1('',(NativeSymbol&&NativeSymbol.toStringTag)||SymbolPolyfill('toStringTag')),unscopables:d_1('',(NativeSymbol&&NativeSymbol.unscopables)||SymbolPolyfill('unscopables'))});defineProperties(HiddenSymbol.prototype,{constructor:d_1(SymbolPolyfill),toString:d_1('',function(){return this.__name__})});defineProperties(SymbolPolyfill.prototype,{toString:d_1(function(){return'Symbol ('+validateSymbol(this).__description__+')'}),valueOf:d_1(function(){return validateSymbol(this)})});defineProperty(SymbolPolyfill.prototype,SymbolPolyfill.toPrimitive,d_1('',function(){var symbol=validateSymbol(this);if(typeof symbol==='symbol')return symbol;return symbol.toString()}));defineProperty(SymbolPolyfill.prototype,SymbolPolyfill.toStringTag,d_1('c','Symbol'));defineProperty(HiddenSymbol.prototype,SymbolPolyfill.toStringTag,d_1('c',SymbolPolyfill.prototype[SymbolPolyfill.toStringTag]));defineProperty(HiddenSymbol.prototype,SymbolPolyfill.toPrimitive,d_1('c',SymbolPolyfill.prototype[SymbolPolyfill.toPrimitive]));if(!isImplemented()){Object.defineProperty(global$1,'Symbol',{value:polyfill,configurable:true,enumerable:false,writable:true})}var isobject=function isObject(val){return val!=null&&typeof val==='object'&&Array.isArray(val)===false};var getValue=function(target,path,options){if(!isobject(options)){options={default:options}}if(!isValidObject(target)){return typeof options.default!=='undefined'?options.default:target}if(typeof path==='number'){path=String(path)}const isArray=Array.isArray(path);const isString=typeof path==='string';const splitChar=options.separator||'.';const joinChar=options.joinChar||(typeof splitChar==='string'?splitChar:'.');if(!isString&&!isArray){return target}if(isString&&path in target){return isValid(path,target,options)?target[path]:options.default}let segs=isArray?path:split(path,splitChar,options);let len=segs.length;let idx=0;do{let prop=segs[idx];if(typeof prop==='number'){prop=String(prop)}while(prop&&prop.slice(-1)==='\\'){prop=join([prop.slice(0,-1),segs[++idx]||''],joinChar,options)}if(prop in target){if(!isValid(prop,target,options)){return options.default}target=target[prop]}else{let hasProp=false;let n=idx+1;while(n<len){prop=join([prop,segs[n++]],joinChar,options);if((hasProp=prop in target)){if(!isValid(prop,target,options)){return options.default}target=target[prop];idx=n-1;break}}if(!hasProp){return options.default}}}while(++idx<len&&isValidObject(target));if(idx===len){return target}return options.default};function join(segs,joinChar,options){if(typeof options.join==='function'){return options.join(segs)}return segs[0]+joinChar+segs[1]}function split(path,splitChar,options){if(typeof options.split==='function'){return options.split(path)}return path.split(splitChar)}function isValid(key,target,options){if(typeof options.isValid==='function'){return options.isValid(key,target)}return true}function isValidObject(val){return isobject(val)||Array.isArray(val)||typeof val==='function'}var VNode=function VNode(){};var options={};var stack=[];var EMPTY_CHILDREN=[];function h(nodeName,attributes){var children=EMPTY_CHILDREN,lastSimple,child,simple,i;for(i=arguments.length;i-->2;){stack.push(arguments[i])}if(attributes&&attributes.children!=null){if(!stack.length)stack.push(attributes.children);delete attributes.children}while(stack.length){if((child=stack.pop())&&child.pop!==undefined){for(i=child.length;i--;){stack.push(child[i])}}else{if(typeof child==='boolean')child=null;if(simple=typeof nodeName!=='function'){if(child==null)child='';else if(typeof child==='number')child=String(child);else if(typeof child!=='string')simple=false}if(simple&&lastSimple){children[children.length-1]+=child}else if(children===EMPTY_CHILDREN){children=[child]}else{children.push(child)}lastSimple=simple}}var p=new VNode();p.nodeName=nodeName;p.children=children;p.attributes=attributes==null?undefined:attributes;p.key=attributes==null?undefined:attributes.key;return p}function extend(obj,props){for(var i in props){obj[i]=props[i]}return obj}function applyRef(ref,value){if(ref){if(typeof ref=='function')ref(value);else ref.current=value}}var defer=typeof Promise=='function'?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function cloneElement(vnode,props){return h(vnode.nodeName,extend(extend({},vnode.attributes),props),arguments.length>2?[].slice.call(arguments,2):vnode.children)}var IS_NON_DIMENSIONAL=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i;var items=[];function enqueueRender(component){if(!component._dirty&&(component._dirty=true)&&items.push(component)==1){(defer)(rerender)}}function rerender(){var p;while(p=items.pop()){if(p._dirty)renderComponent(p)}}function isSameNodeType(node,vnode,hydrating){if(typeof vnode==='string'||typeof vnode==='number'){return node.splitText!==undefined}if(typeof vnode.nodeName==='string'){return!node._componentConstructor&&isNamedNode(node,vnode.nodeName)}return hydrating||node._componentConstructor===vnode.nodeName}function isNamedNode(node,nodeName){return node.normalizedNodeName===nodeName||node.nodeName.toLowerCase()===nodeName.toLowerCase()}function getNodeProps(vnode){var props=extend({},vnode.attributes);props.children=vnode.children;var defaultProps=vnode.nodeName.defaultProps;if(defaultProps!==undefined){for(var i in defaultProps){if(props[i]===undefined){props[i]=defaultProps[i]}}}return props}function createNode(nodeName,isSvg){var node=isSvg?document.createElementNS('http://www.w3.org/2000/svg',nodeName):document.createElement(nodeName);node.normalizedNodeName=nodeName;return node}function removeNode(node){var parentNode=node.parentNode;if(parentNode)parentNode.removeChild(node)}function setAccessor(node,name,old,value,isSvg){if(name==='className')name='class';if(name==='key');else if(name==='ref'){applyRef(old,null);applyRef(value,node)}else if(name==='class'&&!isSvg){node.className=value||''}else if(name==='style'){if(!value||typeof value==='string'||typeof old==='string'){node.style.cssText=value||''}if(value&&typeof value==='object'){if(typeof old!=='string'){for(var i in old){if(!(i in value))node.style[i]=''}}for(var i in value){node.style[i]=typeof value[i]==='number'&&IS_NON_DIMENSIONAL.test(i)===false?value[i]+'px':value[i]}}}else if(name==='dangerouslySetInnerHTML'){if(value)node.innerHTML=value.__html||''}else if(name[0]=='o'&&name[1]=='n'){var useCapture=name!==(name=name.replace(/Capture$/,''));name=name.toLowerCase().substring(2);if(value){if(!old)node.addEventListener(name,eventProxy,useCapture)}else{node.removeEventListener(name,eventProxy,useCapture)}(node._listeners||(node._listeners={}))[name]=value}else if(name!=='list'&&name!=='type'&&!isSvg&&name in node){try{node[name]=value==null?'':value}catch(e){}if((value==null||value===false)&&name!='spellcheck')node.removeAttribute(name)}else{var ns=isSvg&&name!==(name=name.replace(/^xlink:?/,''));if(value==null||value===false){if(ns)node.removeAttributeNS('http://www.w3.org/1999/xlink',name.toLowerCase());else node.removeAttribute(name)}else if(typeof value!=='function'){if(ns)node.setAttributeNS('http://www.w3.org/1999/xlink',name.toLowerCase(),value);else node.setAttribute(name,value)}}}function eventProxy(e){return this._listeners[e.type](e)}var mounts=[];var diffLevel=0;var isSvgMode=false;var hydrating=false;function flushMounts(){var c;while(c=mounts.shift()){if(c.componentDidMount)c.componentDidMount()}}function diff(dom,vnode,context,mountAll,parent,componentRoot){if(!diffLevel++){isSvgMode=parent!=null&&parent.ownerSVGElement!==undefined;hydrating=dom!=null&&!('__preactattr_'in dom)}var ret=idiff(dom,vnode,context,mountAll,componentRoot);if(parent&&ret.parentNode!==parent)parent.appendChild(ret);if(!--diffLevel){hydrating=false;if(!componentRoot)flushMounts()}return ret}function idiff(dom,vnode,context,mountAll,componentRoot){var out=dom,prevSvgMode=isSvgMode;if(vnode==null||typeof vnode==='boolean')vnode='';if(typeof vnode==='string'||typeof vnode==='number'){if(dom&&dom.splitText!==undefined&&dom.parentNode&&(!dom._component||componentRoot)){if(dom.nodeValue!=vnode){dom.nodeValue=vnode}}else{out=document.createTextNode(vnode);if(dom){if(dom.parentNode)dom.parentNode.replaceChild(out,dom);recollectNodeTree(dom,true)}}out['__preactattr_']=true;return out}var vnodeName=vnode.nodeName;if(typeof vnodeName==='function'){return buildComponentFromVNode(dom,vnode,context,mountAll)}isSvgMode=vnodeName==='svg'?true:vnodeName==='foreignObject'?false:isSvgMode;vnodeName=String(vnodeName);if(!dom||!isNamedNode(dom,vnodeName)){out=createNode(vnodeName,isSvgMode);if(dom){while(dom.firstChild){out.appendChild(dom.firstChild)}if(dom.parentNode)dom.parentNode.replaceChild(out,dom);recollectNodeTree(dom,true)}}var fc=out.firstChild,props=out['__preactattr_'],vchildren=vnode.children;if(props==null){props=out['__preactattr_']={};for(var a=out.attributes,i=a.length;i--;){props[a[i].name]=a[i].value}}if(!hydrating&&vchildren&&vchildren.length===1&&typeof vchildren[0]==='string'&&fc!=null&&fc.splitText!==undefined&&fc.nextSibling==null){if(fc.nodeValue!=vchildren[0]){fc.nodeValue=vchildren[0]}}else if(vchildren&&vchildren.length||fc!=null){innerDiffNode(out,vchildren,context,mountAll,hydrating||props.dangerouslySetInnerHTML!=null)}diffAttributes(out,vnode.attributes,props);isSvgMode=prevSvgMode;return out}function innerDiffNode(dom,vchildren,context,mountAll,isHydrating){var originalChildren=dom.childNodes,children=[],keyed={},keyedLen=0,min=0,len=originalChildren.length,childrenLen=0,vlen=vchildren?vchildren.length:0,j,c,f,vchild,child;if(len!==0){for(var i=0;i<len;i++){var _child=originalChildren[i],props=_child['__preactattr_'],key=vlen&&props?_child._component?_child._component.__key:props.key:null;if(key!=null){keyedLen++;keyed[key]=_child}else if(props||(_child.splitText!==undefined?isHydrating?_child.nodeValue.trim():true:isHydrating)){children[childrenLen++]=_child}}}if(vlen!==0){for(var i=0;i<vlen;i++){vchild=vchildren[i];child=null;var key=vchild.key;if(key!=null){if(keyedLen&&keyed[key]!==undefined){child=keyed[key];keyed[key]=undefined;keyedLen--}}else if(min<childrenLen){for(j=min;j<childrenLen;j++){if(children[j]!==undefined&&isSameNodeType(c=children[j],vchild,isHydrating)){child=c;children[j]=undefined;if(j===childrenLen-1)childrenLen--;if(j===min)min++;break}}}child=idiff(child,vchild,context,mountAll);f=originalChildren[i];if(child&&child!==dom&&child!==f){if(f==null){dom.appendChild(child)}else if(child===f.nextSibling){removeNode(f)}else{dom.insertBefore(child,f)}}}}if(keyedLen){for(var i in keyed){if(keyed[i]!==undefined)recollectNodeTree(keyed[i],false)}}while(min<=childrenLen){if((child=children[childrenLen--])!==undefined)recollectNodeTree(child,false)}}function recollectNodeTree(node,unmountOnly){var component=node._component;if(component){unmountComponent(component)}else{if(node['__preactattr_']!=null)applyRef(node['__preactattr_'].ref,null);if(unmountOnly===false||node['__preactattr_']==null){removeNode(node)}removeChildren(node)}}function removeChildren(node){node=node.lastChild;while(node){var next=node.previousSibling;recollectNodeTree(node,true);node=next}}function diffAttributes(dom,attrs,old){var name;for(name in old){if(!(attrs&&attrs[name]!=null)&&old[name]!=null){setAccessor(dom,name,old[name],old[name]=undefined,isSvgMode)}}for(name in attrs){if(name!=='children'&&name!=='innerHTML'&&(!(name in old)||attrs[name]!==(name==='value'||name==='checked'?dom[name]:old[name]))){setAccessor(dom,name,old[name],old[name]=attrs[name],isSvgMode)}}}var recyclerComponents=[];function createComponent(Ctor,props,context){var inst,i=recyclerComponents.length;if(Ctor.prototype&&Ctor.prototype.render){inst=new Ctor(props,context);Component.call(inst,props,context)}else{inst=new Component(props,context);inst.constructor=Ctor;inst.render=doRender}while(i--){if(recyclerComponents[i].constructor===Ctor){inst.nextBase=recyclerComponents[i].nextBase;recyclerComponents.splice(i,1);return inst}}return inst}function doRender(props,state,context){return this.constructor(props,context)}function setComponentProps(component,props,renderMode,context,mountAll){if(component._disable)return;component._disable=true;component.__ref=props.ref;component.__key=props.key;delete props.ref;delete props.key;if(typeof component.constructor.getDerivedStateFromProps==='undefined'){if(!component.base||mountAll){if(component.componentWillMount)component.componentWillMount()}else if(component.componentWillReceiveProps){component.componentWillReceiveProps(props,context)}}if(context&&context!==component.context){if(!component.prevContext)component.prevContext=component.context;component.context=context}if(!component.prevProps)component.prevProps=component.props;component.props=props;component._disable=false;if(renderMode!==0){if(renderMode===1||options.syncComponentUpdates!==false||!component.base){renderComponent(component,1,mountAll)}else{enqueueRender(component)}}applyRef(component.__ref,component)}function renderComponent(component,renderMode,mountAll,isChild){if(component._disable)return;var props=component.props,state=component.state,context=component.context,previousProps=component.prevProps||props,previousState=component.prevState||state,previousContext=component.prevContext||context,isUpdate=component.base,nextBase=component.nextBase,initialBase=isUpdate||nextBase,initialChildComponent=component._component,skip=false,snapshot=previousContext,rendered,inst,cbase;if(component.constructor.getDerivedStateFromProps){state=extend(extend({},state),component.constructor.getDerivedStateFromProps(props,state));component.state=state}if(isUpdate){component.props=previousProps;component.state=previousState;component.context=previousContext;if(renderMode!==2&&component.shouldComponentUpdate&&component.shouldComponentUpdate(props,state,context)===false){skip=true}else if(component.componentWillUpdate){component.componentWillUpdate(props,state,context)}component.props=props;component.state=state;component.context=context}component.prevProps=component.prevState=component.prevContext=component.nextBase=null;component._dirty=false;if(!skip){rendered=component.render(props,state,context);if(component.getChildContext){context=extend(extend({},context),component.getChildContext())}if(isUpdate&&component.getSnapshotBeforeUpdate){snapshot=component.getSnapshotBeforeUpdate(previousProps,previousState)}var childComponent=rendered&&rendered.nodeName,toUnmount,base;if(typeof childComponent==='function'){var childProps=getNodeProps(rendered);inst=initialChildComponent;if(inst&&inst.constructor===childComponent&&childProps.key==inst.__key){setComponentProps(inst,childProps,1,context,false)}else{toUnmount=inst;component._component=inst=createComponent(childComponent,childProps,context);inst.nextBase=inst.nextBase||nextBase;inst._parentComponent=component;setComponentProps(inst,childProps,0,context,false);renderComponent(inst,1,mountAll,true)}base=inst.base}else{cbase=initialBase;toUnmount=initialChildComponent;if(toUnmount){cbase=component._component=null}if(initialBase||renderMode===1){if(cbase)cbase._component=null;base=diff(cbase,rendered,context,mountAll||!isUpdate,initialBase&&initialBase.parentNode,true)}}if(initialBase&&base!==initialBase&&inst!==initialChildComponent){var baseParent=initialBase.parentNode;if(baseParent&&base!==baseParent){baseParent.replaceChild(base,initialBase);if(!toUnmount){initialBase._component=null;recollectNodeTree(initialBase,false)}}}if(toUnmount){unmountComponent(toUnmount)}component.base=base;if(base&&!isChild){var componentRef=component,t=component;while(t=t._parentComponent){(componentRef=t).base=base}base._component=componentRef;base._componentConstructor=componentRef.constructor}}if(!isUpdate||mountAll){mounts.push(component)}else if(!skip){if(component.componentDidUpdate){component.componentDidUpdate(previousProps,previousState,snapshot)}}while(component._renderCallbacks.length){component._renderCallbacks.pop().call(component)}if(!diffLevel&&!isChild)flushMounts()}function buildComponentFromVNode(dom,vnode,context,mountAll){var c=dom&&dom._component,originalComponent=c,oldDom=dom,isDirectOwner=c&&dom._componentConstructor===vnode.nodeName,isOwner=isDirectOwner,props=getNodeProps(vnode);while(c&&!isOwner&&(c=c._parentComponent)){isOwner=c.constructor===vnode.nodeName}if(c&&isOwner&&(!mountAll||c._component)){setComponentProps(c,props,3,context,mountAll);dom=c.base}else{if(originalComponent&&!isDirectOwner){unmountComponent(originalComponent);dom=oldDom=null}c=createComponent(vnode.nodeName,props,context);if(dom&&!c.nextBase){c.nextBase=dom;oldDom=null}setComponentProps(c,props,1,context,mountAll);dom=c.base;if(oldDom&&dom!==oldDom){oldDom._component=null;recollectNodeTree(oldDom,false)}}return dom}function unmountComponent(component){var base=component.base;component._disable=true;if(component.componentWillUnmount)component.componentWillUnmount();component.base=null;var inner=component._component;if(inner){unmountComponent(inner)}else if(base){if(base['__preactattr_']!=null)applyRef(base['__preactattr_'].ref,null);component.nextBase=base;removeNode(base);recyclerComponents.push(component);removeChildren(base)}applyRef(component.__ref,null)}function Component(props,context){this._dirty=true;this.context=context;this.props=props;this.state=this.state||{};this._renderCallbacks=[]}extend(Component.prototype,{setState:function setState(state,callback){if(!this.prevState)this.prevState=this.state;this.state=extend(extend({},this.state),typeof state==='function'?state(this.state,this.props):state);if(callback)this._renderCallbacks.push(callback);enqueueRender(this)},forceUpdate:function forceUpdate(callback){if(callback)this._renderCallbacks.push(callback);renderComponent(this,2)},render:function render(){}});function render(vnode,parent,merge){return diff(merge,vnode,{},false,parent,false)}function createRef(){return{}}var preact={h:h,createElement:h,cloneElement:cloneElement,createRef:createRef,Component:Component,render:render,rerender:rerender,options:options};function isElement(value){return value instanceof HTMLElement}function isFunction(value){return typeof value==='function'}function isString(value){return typeof value==='string'}function isUndefined(value){return value===undefined}var Evented=function(){function Evented(){}var _proto=Evented.prototype;_proto.on=function on(event,handler,ctx){var once=arguments.length<=3||arguments[3]===undefined?false:arguments[3];if(isUndefined(this.bindings)){this.bindings={}}if(isUndefined(this.bindings[event])){this.bindings[event]=[]}this.bindings[event].push({handler:handler,ctx:ctx,once:once})};_proto.once=function once(event,handler,ctx){this.on(event,handler,ctx,true)};_proto.off=function off(event,handler){var _this=this;if(isUndefined(this.bindings)||isUndefined(this.bindings[event])){return false}if(isUndefined(handler)){delete this.bindings[event]}else{this.bindings[event].forEach(function(binding,index){if(binding.handler===handler){_this.bindings[event].splice(index,1)}})}};_proto.trigger=function trigger(event){var _this2=this;if(!isUndefined(this.bindings)&&this.bindings[event]){var args=Array.prototype.slice.call(arguments,1);this.bindings[event].forEach(function(binding,index){var ctx=binding.ctx,handler=binding.handler,once=binding.once;var context=ctx||_this2;handler.apply(context,args);if(once){_this2.bindings[event].splice(index,1)}})}};return Evented}();function autoBind(self){var keys=Object.getOwnPropertyNames(self.constructor.prototype);for(var i=0;i<keys.length;i++){var key=keys[i];var val=self[key];if(key!=='constructor'&&typeof val==='function'){self[key]=val.bind(self)}}return self}function _setupAdvanceOnHandler(selector,step){return function(event){if(step.isOpen()){var targetIsEl=step.el&&event.currentTarget===step.el;var targetIsSelector=!isUndefined(selector)&&event.currentTarget.matches(selector);if(targetIsSelector||targetIsEl){step.tour.next()}}}}function bindAdvance(step){var _ref=step.options.advanceOn||{},event=_ref.event,selector=_ref.selector;if(event){var handler=_setupAdvanceOnHandler(selector,step);var el;try{el=document.querySelector(selector)}catch(e){}if(!isUndefined(selector)&&!el){return console.error("No element was found for the selector supplied to advanceOn: "+selector)}else if(el){el.addEventListener(event,handler);step.on('destroy',function(){return el.removeEventListener(event,handler)})}else{document.body.addEventListener(event,handler,true);step.on('destroy',function(){return document.body.removeEventListener(event,handler,true)})}}else{return console.error('advanceOn was defined, but no event name was passed.')}}var addHasTitleClass=function addHasTitleClass(step){return{addHasTitleClass:_createClassModifier(step.classPrefix+"shepherd-has-title")}};function _createClassModifier(className){return{enabled:true,fn:function fn(data){data.instance.popper.classList.add(className);return data}}}function _getCenteredStylePopperModifier(styles){return{computeStyle:{enabled:true,fn:function fn(data){data.styles=_extends({},data.styles,{left:'50%',top:'50%',transform:'translate(-50%, -50%)'});return data}},addShepherdClass:_createClassModifier(styles.shepherd.trim())}}function _getDefaultPopperOptions(styles){return{positionFixed:true,modifiers:{addShepherdClass:_createClassModifier(styles.shepherd.trim())}}}function makeAttachedTippyOptions(attachToOptions,step){var _makeCommonTippyOptio=_makeCommonTippyOptions(step),popperOptions=_makeCommonTippyOptio.popperOptions,tippyOptions=_makeCommonTippyOptio.tippyOptions;tippyOptions.flipOnUpdate=true;tippyOptions.placement=attachToOptions.on||'right';var stepPopperOptions=getValue(step,'options.tippyOptions.popperOptions');if(stepPopperOptions){popperOptions=_extends({},popperOptions,{},stepPopperOptions,{modifiers:_extends({},popperOptions.modifiers,{},stepPopperOptions.modifiers)})}tippyOptions.popperOptions=popperOptions;tippyOptions.id=step.id;return tippyOptions}function makeCenteredTippy(step){var centeredStylePopperModifier=_getCenteredStylePopperModifier(step.styles);var _makeCommonTippyOptio2=_makeCommonTippyOptions(step),popperOptions=_makeCommonTippyOptio2.popperOptions,tippyOptions=_makeCommonTippyOptio2.tippyOptions;tippyOptions.placement='top';tippyOptions.arrow=false;tippyOptions.popperOptions=tippyOptions.popperOptions||{};popperOptions=_extends({},popperOptions,{},tippyOptions.popperOptions,{modifiers:_extends({},popperOptions.modifiers,{},centeredStylePopperModifier,{},tippyOptions.popperOptions.modifiers)});tippyOptions.popperOptions=popperOptions;tippyOptions.id=step.id;return tippyOptions}function _makeCommonTippyOptions(step){var popperOptions=_getDefaultPopperOptions(step.styles);var tippyOptions=_extends({content:step.el},step.options.tippyOptions);var shepherdElementZIndex=getValue(step,'tour.options.styleVariables.shepherdElementZIndex');if(shepherdElementZIndex){tippyOptions.zIndex=shepherdElementZIndex}if(step.options.title){popperOptions.modifiers=_extends({},popperOptions.modifiers,{},addHasTitleClass(step))}return{popperOptions:popperOptions,tippyOptions:tippyOptions}}function _extends$1(){_extends$1=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends$1.apply(this,arguments)}var isBrowser=typeof window!=='undefined'&&typeof document!=='undefined';var ua=isBrowser?navigator.userAgent:'';var isIE=/MSIE |Trident\//.test(ua);var isUCBrowser=/UCBrowser\//.test(ua);var isIOS=isBrowser&&/iPhone|iPad|iPod/.test(navigator.platform);var defaultProps={allowHTML:true,animateFill:false,animation:'fade',appendTo:function appendTo(){return document.body},aria:'describedby',arrow:true,boundary:'scrollParent',content:'',delay:0,distance:10,duration:[325,275],flip:true,flipBehavior:'flip',flipOnUpdate:false,followCursor:false,hideOnClick:true,ignoreAttributes:false,inertia:false,interactive:false,interactiveBorder:2,interactiveDebounce:0,lazy:true,maxWidth:350,multiple:false,offset:0,onCreate:function onCreate(){},onHidden:function onHidden(){},onHide:function onHide(){},onMount:function onMount(){},onShow:function onShow(){},onShown:function onShown(){},onTrigger:function onTrigger(){},onUntrigger:function onUntrigger(){},placement:'top',popperOptions:{},role:'tooltip',showOnCreate:false,sticky:false,theme:'',touch:true,trigger:'mouseenter focus',triggerTarget:null,updateDuration:0,zIndex:9999};var POPPER_INSTANCE_DEPENDENCIES=['arrow','boundary','distance','flip','flipBehavior','flipOnUpdate','offset','placement','popperOptions'];var PASSIVE={passive:true};var PREVENT_OVERFLOW_PADDING=5;var ROUND_ARROW_INNER_HTML='<svg viewBox="0 0 18 7" xmlns="http://www.w3.org/2000/svg"><path d="M0 7s2.021-.015 5.253-4.218C6.584 1.051 7.797.007 9 0c1.203-.007 2.416 1.035 3.761 2.782C16.012 7.005 18 7 18 7H0z"/></svg>';var IOS_CLASS="tippy-iOS";var POPPER_CLASS="tippy-popper";var TOOLTIP_CLASS="tippy-tooltip";var CONTENT_CLASS="tippy-content";var BACKDROP_CLASS="tippy-backdrop";var ARROW_CLASS="tippy-arrow";var SVG_ARROW_CLASS="tippy-svg-arrow";var POPPER_SELECTOR="."+POPPER_CLASS;var TOOLTIP_SELECTOR="."+TOOLTIP_CLASS;var CONTENT_SELECTOR="."+CONTENT_CLASS;var BACKDROP_SELECTOR="."+BACKDROP_CLASS;var ARROW_SELECTOR="."+ARROW_CLASS;var SVG_ARROW_SELECTOR="."+SVG_ARROW_CLASS;var currentInput={isTouch:false};var lastMouseMoveTime=0;function onDocumentTouchStart(){if(currentInput.isTouch){return}currentInput.isTouch=true;if(isIOS){document.body.classList.add(IOS_CLASS)}if(window.performance){document.addEventListener('mousemove',onDocumentMouseMove)}}function onDocumentMouseMove(){var now=performance.now();if(now-lastMouseMoveTime<20){currentInput.isTouch=false;document.removeEventListener('mousemove',onDocumentMouseMove);if(!isIOS){document.body.classList.remove(IOS_CLASS)}}lastMouseMoveTime=now}function onWindowBlur(){var _document=document,activeElement=_document.activeElement;var instance=activeElement._tippy;if(activeElement&&activeElement.blur&&instance&&!instance.state.isVisible){activeElement.blur()}}function bindGlobalEventListeners(){document.addEventListener('touchstart',onDocumentTouchStart,_extends$1({},PASSIVE,{capture:true}));window.addEventListener('blur',onWindowBlur)}var keys$2=Object.keys(defaultProps);function getDataAttributeProps(reference){var props=keys$2.reduce(function(acc,key){var valueAsString=(reference.getAttribute("data-tippy-"+key)||'').trim();if(!valueAsString){return acc}if(key==='content'){acc[key]=valueAsString}else{try{acc[key]=JSON.parse(valueAsString)}catch(e){acc[key]=valueAsString}}return acc},{});return props}function isReferenceElement(value){return!!(value&&value._tippy&&!value.classList.contains(POPPER_CLASS))}function hasOwnProperty$1(obj,key){return{}.hasOwnProperty.call(obj,key)}function getArrayOfElements(value){if(isRealElement(value)){return[value]}if(value instanceof NodeList){return arrayFrom(value)}if(Array.isArray(value)){return value}return arrayFrom(document.querySelectorAll(value))}function getValueAtIndexOrReturn(value,index,defaultValue){if(Array.isArray(value)){var v=value[index];return v==null?Array.isArray(defaultValue)?defaultValue[index]:defaultValue:v}return value}function getModifier(obj,key){return obj&&obj.modifiers&&obj.modifiers[key]}function isRealElement(value){return value instanceof Element}function innerHTML(){return'innerHTML'}function invokeWithArgsOrReturn(value,args){return typeof value==='function'?value.apply(null,args):value}function setFlipModifierEnabled(modifiers,value){modifiers.filter(function(m){return m.name==='flip'})[0].enabled=value}function div(){return document.createElement('div')}function setTransitionDuration(els,value){els.forEach(function(el){if(el){el.style.transitionDuration=value+"ms"}})}function setVisibilityState(els,state){els.forEach(function(el){if(el){el.setAttribute('data-state',state)}})}function evaluateProps(reference,props){var out=_extends$1({},props,{content:invokeWithArgsOrReturn(props.content,[reference])},props.ignoreAttributes?{}:getDataAttributeProps(reference));if(out.animateFill){out.arrow=false}if(out.arrow||isUCBrowser){out.animateFill=false}return out}function debounce(fn,ms){if(ms===0){return fn}var timeout;return function(arg){clearTimeout(timeout);timeout=setTimeout(function(){fn(arg)},ms)}}function preserveInvocation(originalFn,currentFn,args){if(originalFn&&originalFn!==currentFn){originalFn.apply(null,args)}}function arrayFrom(value){return[].slice.call(value)}function closestCallback(element,callback){while(element){if(callback(element)){return element}element=element.parentElement}return null}function includes(a,b){return a.indexOf(b)>-1}function setInnerHTML(element,html){element[innerHTML()]=isRealElement(html)?html[innerHTML()]:html}function setContent(contentEl,props){if(isRealElement(props.content)){setInnerHTML(contentEl,'');contentEl.appendChild(props.content)}else if(typeof props.content!=='function'){var key=props.allowHTML?'innerHTML':'textContent';contentEl[key]=props.content}}function getChildren(popper){return{tooltip:popper.querySelector(TOOLTIP_SELECTOR),backdrop:popper.querySelector(BACKDROP_SELECTOR),content:popper.querySelector(CONTENT_SELECTOR),arrow:popper.querySelector(ARROW_SELECTOR)||popper.querySelector(SVG_ARROW_SELECTOR)}}function addInertia(tooltip){tooltip.setAttribute('data-inertia','')}function removeInertia(tooltip){tooltip.removeAttribute('data-inertia')}function createArrowElement(arrow){var arrowElement=div();if(arrow===true){arrowElement.className=ARROW_CLASS}else{arrowElement.className=SVG_ARROW_CLASS;if(isRealElement(arrow)){arrowElement.appendChild(arrow)}else{setInnerHTML(arrowElement,arrow==='round'?ROUND_ARROW_INNER_HTML:arrow)}}return arrowElement}function createBackdropElement(isVisible){var backdrop=div();backdrop.className=BACKDROP_CLASS;backdrop.setAttribute('data-state',isVisible?'visible':'hidden');return backdrop}function addInteractive(tooltip){tooltip.setAttribute('data-interactive','')}function removeInteractive(tooltip){tooltip.removeAttribute('data-interactive')}function updateTransitionEndListener(tooltip,action,listener){var eventName=isUCBrowser&&document.body.style.webkitTransition!==undefined?'webkitTransitionEnd':'transitionend';tooltip[action+'EventListener'](eventName,listener)}function getBasePlacement(placement){return placement.split('-')[0]}function reflow(popper){void popper.offsetHeight}function updateTheme(tooltip,action,theme){theme.split(' ').forEach(function(name){if(name){tooltip.classList[action](name+"-theme")}})}function createPopperElement(id,props){var popper=div();popper.className=POPPER_CLASS;popper.style.position='absolute';popper.style.top='0';popper.style.left='0';var tooltip=div();tooltip.className=TOOLTIP_CLASS;tooltip.id="tippy-"+id;tooltip.setAttribute('data-state','hidden');tooltip.setAttribute('tabindex','-1');updateTheme(tooltip,'add',props.theme);var content=div();content.className=CONTENT_CLASS;content.setAttribute('data-state','hidden');if(props.interactive){addInteractive(tooltip)}if(props.arrow){tooltip.setAttribute('data-arrow','');tooltip.appendChild(createArrowElement(props.arrow))}if(props.animateFill){tooltip.appendChild(createBackdropElement(false));tooltip.setAttribute('data-animatefill','')}if(props.inertia){addInertia(tooltip)}setContent(content,props);tooltip.appendChild(content);popper.appendChild(tooltip);updatePopperElement(popper,props,props,false);return popper}function updatePopperElement(popper,prevProps,nextProps,isVisible){var _getChildren=getChildren(popper),tooltip=_getChildren.tooltip,content=_getChildren.content,backdrop=_getChildren.backdrop,arrow=_getChildren.arrow;popper.style.zIndex=''+nextProps.zIndex;tooltip.setAttribute('data-animation',nextProps.animation);tooltip.style.maxWidth=nextProps.maxWidth+(typeof nextProps.maxWidth==='number'?'px':'');if(nextProps.role){tooltip.setAttribute('role',nextProps.role)}else{tooltip.removeAttribute('role')}if(prevProps.content!==nextProps.content){setContent(content,nextProps)}if(!prevProps.animateFill&&nextProps.animateFill){tooltip.appendChild(createBackdropElement(isVisible));tooltip.setAttribute('data-animatefill','')}else if(prevProps.animateFill&&!nextProps.animateFill){tooltip.removeChild(backdrop);tooltip.removeAttribute('data-animatefill')}if(!prevProps.arrow&&nextProps.arrow){tooltip.appendChild(createArrowElement(nextProps.arrow));tooltip.setAttribute('data-arrow','')}else if(prevProps.arrow&&!nextProps.arrow){tooltip.removeChild(arrow);tooltip.removeAttribute('data-arrow')}else if(prevProps.arrow!==nextProps.arrow){tooltip.removeChild(arrow);tooltip.appendChild(createArrowElement(nextProps.arrow))}if(!prevProps.interactive&&nextProps.interactive){addInteractive(tooltip)}else if(prevProps.interactive&&!nextProps.interactive){removeInteractive(tooltip)}if(!prevProps.inertia&&nextProps.inertia){addInertia(tooltip)}else if(prevProps.inertia&&!nextProps.inertia){removeInertia(tooltip)}if(prevProps.theme!==nextProps.theme){updateTheme(tooltip,'remove',prevProps.theme);updateTheme(tooltip,'add',nextProps.theme)}}function isCursorOutsideInteractiveBorder(popperPlacement,popperRect,event,props){if(!popperPlacement){return true}var x=event.clientX,y=event.clientY;var interactiveBorder=props.interactiveBorder,distance=props.distance;var exceedsTop=popperRect.top-y>(popperPlacement==='top'?interactiveBorder+distance:interactiveBorder);var exceedsBottom=y-popperRect.bottom>(popperPlacement==='bottom'?interactiveBorder+distance:interactiveBorder);var exceedsLeft=popperRect.left-x>(popperPlacement==='left'?interactiveBorder+distance:interactiveBorder);var exceedsRight=x-popperRect.right>(popperPlacement==='right'?interactiveBorder+distance:interactiveBorder);return exceedsTop||exceedsBottom||exceedsLeft||exceedsRight}var isBrowser$1=typeof window!=='undefined'&&typeof document!=='undefined';var longerTimeoutBrowsers=['Edge','Trident','Firefox'];var timeoutDuration=0;for(var i=0;i<longerTimeoutBrowsers.length;i+=1){if(isBrowser$1&&navigator.userAgent.indexOf(longerTimeoutBrowsers[i])>=0){timeoutDuration=1;break}}function microtaskDebounce(fn){var called=false;return function(){if(called){return}called=true;window.Promise.resolve().then(function(){called=false;fn()})}}function taskDebounce(fn){var scheduled=false;return function(){if(!scheduled){scheduled=true;setTimeout(function(){scheduled=false;fn()},timeoutDuration)}}}var supportsMicroTasks=isBrowser$1&&window.Promise;var debounce$1=supportsMicroTasks?microtaskDebounce:taskDebounce;function isFunction$1(functionToCheck){var getType={};return functionToCheck&&getType.toString.call(functionToCheck)==='[object Function]'}function getStyleComputedProperty(element,property){if(element.nodeType!==1){return[]}var window=element.ownerDocument.defaultView;var css=window.getComputedStyle(element,null);return property?css[property]:css}function getParentNode(element){if(element.nodeName==='HTML'){return element}return element.parentNode||element.host}function getScrollParent(element){if(!element){return document.body}switch(element.nodeName){case'HTML':case'BODY':return element.ownerDocument.body;case'#document':return element.body}var _getStyleComputedProp=getStyleComputedProperty(element),overflow=_getStyleComputedProp.overflow,overflowX=_getStyleComputedProp.overflowX,overflowY=_getStyleComputedProp.overflowY;if(/(auto|scroll|overlay)/.test(overflow+overflowY+overflowX)){return element}return getScrollParent(getParentNode(element))}var isIE11=isBrowser$1&&!!(window.MSInputMethodContext&&document.documentMode);var isIE10=isBrowser$1&&/MSIE 10/.test(navigator.userAgent);function isIE$1(version){if(version===11){return isIE11}if(version===10){return isIE10}return isIE11||isIE10}function getOffsetParent(element){if(!element){return document.documentElement}var noOffsetParent=isIE$1(10)?document.body:null;var offsetParent=element.offsetParent||null;while(offsetParent===noOffsetParent&&element.nextElementSibling){offsetParent=(element=element.nextElementSibling).offsetParent}var nodeName=offsetParent&&offsetParent.nodeName;if(!nodeName||nodeName==='BODY'||nodeName==='HTML'){return element?element.ownerDocument.documentElement:document.documentElement}if(['TH','TD','TABLE'].indexOf(offsetParent.nodeName)!==-1&&getStyleComputedProperty(offsetParent,'position')==='static'){return getOffsetParent(offsetParent)}return offsetParent}function isOffsetContainer(element){var nodeName=element.nodeName;if(nodeName==='BODY'){return false}return nodeName==='HTML'||getOffsetParent(element.firstElementChild)===element}function getRoot(node){if(node.parentNode!==null){return getRoot(node.parentNode)}return node}function findCommonOffsetParent(element1,element2){if(!element1||!element1.nodeType||!element2||!element2.nodeType){return document.documentElement}var order=element1.compareDocumentPosition(element2)&Node.DOCUMENT_POSITION_FOLLOWING;var start=order?element1:element2;var end=order?element2:element1;var range=document.createRange();range.setStart(start,0);range.setEnd(end,0);var commonAncestorContainer=range.commonAncestorContainer;if(element1!==commonAncestorContainer&&element2!==commonAncestorContainer||start.contains(end)){if(isOffsetContainer(commonAncestorContainer)){return commonAncestorContainer}return getOffsetParent(commonAncestorContainer)}var element1root=getRoot(element1);if(element1root.host){return findCommonOffsetParent(element1root.host,element2)}else{return findCommonOffsetParent(element1,getRoot(element2).host)}}function getScroll(element){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'top';var upperSide=side==='top'?'scrollTop':'scrollLeft';var nodeName=element.nodeName;if(nodeName==='BODY'||nodeName==='HTML'){var html=element.ownerDocument.documentElement;var scrollingElement=element.ownerDocument.scrollingElement||html;return scrollingElement[upperSide]}return element[upperSide]}function includeScroll(rect,element){var subtract=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var scrollTop=getScroll(element,'top');var scrollLeft=getScroll(element,'left');var modifier=subtract?-1:1;rect.top+=scrollTop*modifier;rect.bottom+=scrollTop*modifier;rect.left+=scrollLeft*modifier;rect.right+=scrollLeft*modifier;return rect}function getBordersSize(styles,axis){var sideA=axis==='x'?'Left':'Top';var sideB=sideA==='Left'?'Right':'Bottom';return parseFloat(styles['border'+sideA+'Width'],10)+parseFloat(styles['border'+sideB+'Width'],10)}function getSize(axis,body,html,computedStyle){return Math.max(body['offset'+axis],body['scroll'+axis],html['client'+axis],html['offset'+axis],html['scroll'+axis],isIE$1(10)?parseInt(html['offset'+axis])+parseInt(computedStyle['margin'+(axis==='Height'?'Top':'Left')])+parseInt(computedStyle['margin'+(axis==='Height'?'Bottom':'Right')]):0)}function getWindowSizes(document){var body=document.body;var html=document.documentElement;var computedStyle=isIE$1(10)&&getComputedStyle(html);return{height:getSize('Height',body,html,computedStyle),width:getSize('Width',body,html,computedStyle)}}var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};var createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var defineProperty$1=function(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj};var _extends$2=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};function getClientRect(offsets){return _extends$2({},offsets,{right:offsets.left+offsets.width,bottom:offsets.top+offsets.height})}function getBoundingClientRect(element){var rect={};try{if(isIE$1(10)){rect=element.getBoundingClientRect();var scrollTop=getScroll(element,'top');var scrollLeft=getScroll(element,'left');rect.top+=scrollTop;rect.left+=scrollLeft;rect.bottom+=scrollTop;rect.right+=scrollLeft}else{rect=element.getBoundingClientRect()}}catch(e){}var result={left:rect.left,top:rect.top,width:rect.right-rect.left,height:rect.bottom-rect.top};var sizes=element.nodeName==='HTML'?getWindowSizes(element.ownerDocument):{};var width=sizes.width||element.clientWidth||result.right-result.left;var height=sizes.height||element.clientHeight||result.bottom-result.top;var horizScrollbar=element.offsetWidth-width;var vertScrollbar=element.offsetHeight-height;if(horizScrollbar||vertScrollbar){var styles=getStyleComputedProperty(element);horizScrollbar-=getBordersSize(styles,'x');vertScrollbar-=getBordersSize(styles,'y');result.width-=horizScrollbar;result.height-=vertScrollbar}return getClientRect(result)}function getOffsetRectRelativeToArbitraryNode(children,parent){var fixedPosition=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var isIE10=isIE$1(10);var isHTML=parent.nodeName==='HTML';var childrenRect=getBoundingClientRect(children);var parentRect=getBoundingClientRect(parent);var scrollParent=getScrollParent(children);var styles=getStyleComputedProperty(parent);var borderTopWidth=parseFloat(styles.borderTopWidth,10);var borderLeftWidth=parseFloat(styles.borderLeftWidth,10);if(fixedPosition&&isHTML){parentRect.top=Math.max(parentRect.top,0);parentRect.left=Math.max(parentRect.left,0)}var offsets=getClientRect({top:childrenRect.top-parentRect.top-borderTopWidth,left:childrenRect.left-parentRect.left-borderLeftWidth,width:childrenRect.width,height:childrenRect.height});offsets.marginTop=0;offsets.marginLeft=0;if(!isIE10&&isHTML){var marginTop=parseFloat(styles.marginTop,10);var marginLeft=parseFloat(styles.marginLeft,10);offsets.top-=borderTopWidth-marginTop;offsets.bottom-=borderTopWidth-marginTop;offsets.left-=borderLeftWidth-marginLeft;offsets.right-=borderLeftWidth-marginLeft;offsets.marginTop=marginTop;offsets.marginLeft=marginLeft}if(isIE10&&!fixedPosition?parent.contains(scrollParent):parent===scrollParent&&scrollParent.nodeName!=='BODY'){offsets=includeScroll(offsets,parent)}return offsets}function getViewportOffsetRectRelativeToArtbitraryNode(element){var excludeScroll=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var html=element.ownerDocument.documentElement;var relativeOffset=getOffsetRectRelativeToArbitraryNode(element,html);var width=Math.max(html.clientWidth,window.innerWidth||0);var height=Math.max(html.clientHeight,window.innerHeight||0);var scrollTop=!excludeScroll?getScroll(html):0;var scrollLeft=!excludeScroll?getScroll(html,'left'):0;var offset={top:scrollTop-relativeOffset.top+relativeOffset.marginTop,left:scrollLeft-relativeOffset.left+relativeOffset.marginLeft,width:width,height:height};return getClientRect(offset)}function isFixed(element){var nodeName=element.nodeName;if(nodeName==='BODY'||nodeName==='HTML'){return false}if(getStyleComputedProperty(element,'position')==='fixed'){return true}var parentNode=getParentNode(element);if(!parentNode){return false}return isFixed(parentNode)}function getFixedPositionOffsetParent(element){if(!element||!element.parentElement||isIE$1()){return document.documentElement}var el=element.parentElement;while(el&&getStyleComputedProperty(el,'transform')==='none'){el=el.parentElement}return el||document.documentElement}function getBoundaries(popper,reference,padding,boundariesElement){var fixedPosition=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var boundaries={top:0,left:0};var offsetParent=fixedPosition?getFixedPositionOffsetParent(popper):findCommonOffsetParent(popper,reference);if(boundariesElement==='viewport'){boundaries=getViewportOffsetRectRelativeToArtbitraryNode(offsetParent,fixedPosition)}else{var boundariesNode=void 0;if(boundariesElement==='scrollParent'){boundariesNode=getScrollParent(getParentNode(reference));if(boundariesNode.nodeName==='BODY'){boundariesNode=popper.ownerDocument.documentElement}}else if(boundariesElement==='window'){boundariesNode=popper.ownerDocument.documentElement}else{boundariesNode=boundariesElement}var offsets=getOffsetRectRelativeToArbitraryNode(boundariesNode,offsetParent,fixedPosition);if(boundariesNode.nodeName==='HTML'&&!isFixed(offsetParent)){var _getWindowSizes=getWindowSizes(popper.ownerDocument),height=_getWindowSizes.height,width=_getWindowSizes.width;boundaries.top+=offsets.top-offsets.marginTop;boundaries.bottom=height+offsets.top;boundaries.left+=offsets.left-offsets.marginLeft;boundaries.right=width+offsets.left}else{boundaries=offsets}}padding=padding||0;var isPaddingNumber=typeof padding==='number';boundaries.left+=isPaddingNumber?padding:padding.left||0;boundaries.top+=isPaddingNumber?padding:padding.top||0;boundaries.right-=isPaddingNumber?padding:padding.right||0;boundaries.bottom-=isPaddingNumber?padding:padding.bottom||0;return boundaries}function getArea(_ref){var width=_ref.width,height=_ref.height;return width*height}function computeAutoPlacement(placement,refRect,popper,reference,boundariesElement){var padding=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;if(placement.indexOf('auto')===-1){return placement}var boundaries=getBoundaries(popper,reference,padding,boundariesElement);var rects={top:{width:boundaries.width,height:refRect.top-boundaries.top},right:{width:boundaries.right-refRect.right,height:boundaries.height},bottom:{width:boundaries.width,height:boundaries.bottom-refRect.bottom},left:{width:refRect.left-boundaries.left,height:boundaries.height}};var sortedAreas=Object.keys(rects).map(function(key){return _extends$2({key:key},rects[key],{area:getArea(rects[key])})}).sort(function(a,b){return b.area-a.area});var filteredAreas=sortedAreas.filter(function(_ref2){var width=_ref2.width,height=_ref2.height;return width>=popper.clientWidth&&height>=popper.clientHeight});var computedPlacement=filteredAreas.length>0?filteredAreas[0].key:sortedAreas[0].key;var variation=placement.split('-')[1];return computedPlacement+(variation?'-'+variation:'')}function getReferenceOffsets(state,popper,reference){var fixedPosition=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var commonOffsetParent=fixedPosition?getFixedPositionOffsetParent(popper):findCommonOffsetParent(popper,reference);return getOffsetRectRelativeToArbitraryNode(reference,commonOffsetParent,fixedPosition)}function getOuterSizes(element){var window=element.ownerDocument.defaultView;var styles=window.getComputedStyle(element);var x=parseFloat(styles.marginTop||0)+parseFloat(styles.marginBottom||0);var y=parseFloat(styles.marginLeft||0)+parseFloat(styles.marginRight||0);var result={width:element.offsetWidth+y,height:element.offsetHeight+x};return result}function getOppositePlacement(placement){var hash={left:'right',right:'left',bottom:'top',top:'bottom'};return placement.replace(/left|right|bottom|top/g,function(matched){return hash[matched]})}function getPopperOffsets(popper,referenceOffsets,placement){placement=placement.split('-')[0];var popperRect=getOuterSizes(popper);var popperOffsets={width:popperRect.width,height:popperRect.height};var isHoriz=['right','left'].indexOf(placement)!==-1;var mainSide=isHoriz?'top':'left';var secondarySide=isHoriz?'left':'top';var measurement=isHoriz?'height':'width';var secondaryMeasurement=!isHoriz?'height':'width';if(mainSide==="left"){popperOffsets[mainSide]=referenceOffsets[mainSide]}else{popperOffsets[mainSide]=referenceOffsets[mainSide]+referenceOffsets[measurement]/ 2 - popperRect[measurement] /2}if(placement===secondarySide){popperOffsets[secondarySide]=referenceOffsets[secondarySide]-popperRect[secondaryMeasurement]}else{popperOffsets[secondarySide]=referenceOffsets[getOppositePlacement(secondarySide)]}return popperOffsets}function find(arr,check){if(Array.prototype.find){return arr.find(check)}return arr.filter(check)[0]}function findIndex(arr,prop,value){if(Array.prototype.findIndex){return arr.findIndex(function(cur){return cur[prop]===value})}var match=find(arr,function(obj){return obj[prop]===value});return arr.indexOf(match)}function runModifiers(modifiers,data,ends){var modifiersToRun=ends===undefined?modifiers:modifiers.slice(0,findIndex(modifiers,'name',ends));modifiersToRun.forEach(function(modifier){if(modifier['function']){console.warn('`modifier.function` is deprecated, use `modifier.fn`!')}var fn=modifier['function']||modifier.fn;if(modifier.enabled&&isFunction$1(fn)){data.offsets.popper=getClientRect(data.offsets.popper);data.offsets.reference=getClientRect(data.offsets.reference);data=fn(data,modifier)}});return data}function update(){if(this.state.isDestroyed){return}var data={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:false,offsets:{}};data.offsets.reference=getReferenceOffsets(this.state,this.popper,this.reference,this.options.positionFixed);data.placement=computeAutoPlacement(this.options.placement,data.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding);data.originalPlacement=data.placement;data.positionFixed=this.options.positionFixed;data.offsets.popper=getPopperOffsets(this.popper,data.offsets.reference,data.placement);data.offsets.popper.position=this.options.positionFixed?'fixed':'absolute';data=runModifiers(this.modifiers,data);if(!this.state.isCreated){this.state.isCreated=true;this.options.onCreate(data)}else{this.options.onUpdate(data)}}function isModifierEnabled(modifiers,modifierName){return modifiers.some(function(_ref){var name=_ref.name,enabled=_ref.enabled;return enabled&&name===modifierName})}function getSupportedPropertyName(property){var prefixes=[false,'ms','Webkit','Moz','O'];var upperProp=property.charAt(0).toUpperCase()+property.slice(1);for(var i=0;i<prefixes.length;i++){var prefix=prefixes[i];var toCheck=prefix?''+prefix+upperProp:property;if(typeof document.body.style[toCheck]!=='undefined'){return toCheck}}return null}function destroy(){this.state.isDestroyed=true;if(isModifierEnabled(this.modifiers,'applyStyle')){this.popper.removeAttribute('x-placement');this.popper.style.position='';this.popper.style.top='';this.popper.style.left='';this.popper.style.right='';this.popper.style.bottom='';this.popper.style.willChange='';this.popper.style[getSupportedPropertyName('transform')]=''}this.disableEventListeners();if(this.options.removeOnDestroy){this.popper.parentNode.removeChild(this.popper)}return this}function getWindow(element){var ownerDocument=element.ownerDocument;return ownerDocument?ownerDocument.defaultView:window}function attachToScrollParents(scrollParent,event,callback,scrollParents){var isBody=scrollParent.nodeName==='BODY';var target=isBody?scrollParent.ownerDocument.defaultView:scrollParent;target.addEventListener(event,callback,{passive:true});if(!isBody){attachToScrollParents(getScrollParent(target.parentNode),event,callback,scrollParents)}scrollParents.push(target)}function setupEventListeners(reference,options,state,updateBound){state.updateBound=updateBound;getWindow(reference).addEventListener('resize',state.updateBound,{passive:true});var scrollElement=getScrollParent(reference);attachToScrollParents(scrollElement,'scroll',state.updateBound,state.scrollParents);state.scrollElement=scrollElement;state.eventsEnabled=true;return state}function enableEventListeners(){if(!this.state.eventsEnabled){this.state=setupEventListeners(this.reference,this.options,this.state,this.scheduleUpdate)}}function removeEventListeners(reference,state){getWindow(reference).removeEventListener('resize',state.updateBound);state.scrollParents.forEach(function(target){target.removeEventListener('scroll',state.updateBound)});state.updateBound=null;state.scrollParents=[];state.scrollElement=null;state.eventsEnabled=false;return state}function disableEventListeners(){if(this.state.eventsEnabled){cancelAnimationFrame(this.scheduleUpdate);this.state=removeEventListeners(this.reference,this.state)}}function isNumeric(n){return n!==''&&!isNaN(parseFloat(n))&&isFinite(n)}function setStyles(element,styles){Object.keys(styles).forEach(function(prop){var unit='';if(['width','height','top','right','bottom','left'].indexOf(prop)!==-1&&isNumeric(styles[prop])){unit='px'}element.style[prop]=styles[prop]+unit})}function setAttributes(element,attributes){Object.keys(attributes).forEach(function(prop){var value=attributes[prop];if(value!==false){element.setAttribute(prop,attributes[prop])}else{element.removeAttribute(prop)}})}function applyStyle(data){setStyles(data.instance.popper,data.styles);setAttributes(data.instance.popper,data.attributes);if(data.arrowElement&&Object.keys(data.arrowStyles).length){setStyles(data.arrowElement,data.arrowStyles)}return data}function applyStyleOnLoad(reference,popper,options,modifierOptions,state){var referenceOffsets=getReferenceOffsets(state,popper,reference,options.positionFixed);var placement=computeAutoPlacement(options.placement,referenceOffsets,popper,reference,options.modifiers.flip.boundariesElement,options.modifiers.flip.padding);popper.setAttribute('x-placement',placement);setStyles(popper,{position:options.positionFixed?'fixed':'absolute'});return options}function getRoundedOffsets(data,shouldRound){var _data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference;var round=Math.round,floor=Math.floor;var noRound=function noRound(v){return v};var referenceWidth=round(reference.width);var popperWidth=round(popper.width);var isVertical=['left','right'].indexOf(data.placement)!==-1;var isVariation=data.placement.indexOf('-')!==-1;var sameWidthParity=referenceWidth%2===popperWidth%2;var bothOddWidth=referenceWidth%2===1&&popperWidth%2===1;var horizontalToInteger=!shouldRound?noRound:isVertical||isVariation||sameWidthParity?round:floor;var verticalToInteger=!shouldRound?noRound:round;return{left:horizontalToInteger(bothOddWidth&&!isVariation&&shouldRound?popper.left-1:popper.left),top:verticalToInteger(popper.top),bottom:verticalToInteger(popper.bottom),right:horizontalToInteger(popper.right)}}var isFirefox=isBrowser$1&&/Firefox/i.test(navigator.userAgent);function computeStyle(data,options){var x=options.x,y=options.y;var popper=data.offsets.popper;var legacyGpuAccelerationOption=find(data.instance.modifiers,function(modifier){return modifier.name==='applyStyle'}).gpuAcceleration;if(legacyGpuAccelerationOption!==undefined){console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!')}var gpuAcceleration=legacyGpuAccelerationOption!==undefined?legacyGpuAccelerationOption:options.gpuAcceleration;var offsetParent=getOffsetParent(data.instance.popper);var offsetParentRect=getBoundingClientRect(offsetParent);var styles={position:popper.position};var offsets=getRoundedOffsets(data,window.devicePixelRatio<2||!isFirefox);var sideA=x==='bottom'?'top':'bottom';var sideB=y==='right'?'left':'right';var prefixedProperty=getSupportedPropertyName('transform');var left=void 0,top=void 0;if(sideA==='bottom'){if(offsetParent.nodeName==='HTML'){top=-offsetParent.clientHeight+offsets.bottom}else{top=-offsetParentRect.height+offsets.bottom}}else{top=offsets.top}if(sideB==='right'){if(offsetParent.nodeName==='HTML'){left=-offsetParent.clientWidth+offsets.right}else{left=-offsetParentRect.width+offsets.right}}else{left=offsets.left}if(gpuAcceleration&&prefixedProperty){styles[prefixedProperty]='translate3d('+left+'px, '+top+'px, 0)';styles[sideA]=0;styles[sideB]=0;styles.willChange='transform'}else{var invertTop=sideA==='bottom'?-1:1;var invertLeft=sideB==='right'?-1:1;styles[sideA]=top*invertTop;styles[sideB]=left*invertLeft;styles.willChange=sideA+', '+sideB}var attributes={'x-placement':data.placement};data.attributes=_extends$2({},attributes,data.attributes);data.styles=_extends$2({},styles,data.styles);data.arrowStyles=_extends$2({},data.offsets.arrow,data.arrowStyles);return data}function isModifierRequired(modifiers,requestingName,requestedName){var requesting=find(modifiers,function(_ref){var name=_ref.name;return name===requestingName});var isRequired=!!requesting&&modifiers.some(function(modifier){return modifier.name===requestedName&&modifier.enabled&&modifier.order<requesting.order});if(!isRequired){var _requesting='`'+requestingName+'`';var requested='`'+requestedName+'`';console.warn(requested+' modifier is required by '+_requesting+' modifier in order to work, be sure to include it before '+_requesting+'!')}return isRequired}function arrow(data,options){var _data$offsets$arrow;if(!isModifierRequired(data.instance.modifiers,'arrow','keepTogether')){return data}var arrowElement=options.element;if(typeof arrowElement==='string'){arrowElement=data.instance.popper.querySelector(arrowElement);if(!arrowElement){return data}}else{if(!data.instance.popper.contains(arrowElement)){console.warn('WARNING: `arrow.element` must be child of its popper element!');return data}}var placement=data.placement.split('-')[0];var _data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference;var isVertical=['left','right'].indexOf(placement)!==-1;var len=isVertical?'height':'width';var sideCapitalized=isVertical?'Top':'Left';var side=sideCapitalized.toLowerCase();var altSide=isVertical?'left':'top';var opSide=isVertical?'bottom':'right';var arrowElementSize=getOuterSizes(arrowElement)[len];if(reference[opSide]-arrowElementSize<popper[side]){data.offsets.popper[side]-=popper[side]-(reference[opSide]-arrowElementSize)}if(reference[side]+arrowElementSize>popper[opSide]){data.offsets.popper[side]+=reference[side]+arrowElementSize-popper[opSide]}data.offsets.popper=getClientRect(data.offsets.popper);var center=reference[side]+reference[len]/ 2 - arrowElementSize /2;var css=getStyleComputedProperty(data.instance.popper);var popperMarginSide=parseFloat(css['margin'+sideCapitalized],10);var popperBorderSide=parseFloat(css['border'+sideCapitalized+'Width'],10);var sideValue=center-data.offsets.popper[side]-popperMarginSide-popperBorderSide;sideValue=Math.max(Math.min(popper[len]-arrowElementSize,sideValue),0);data.arrowElement=arrowElement;data.offsets.arrow=(_data$offsets$arrow={},defineProperty$1(_data$offsets$arrow,side,Math.round(sideValue)),defineProperty$1(_data$offsets$arrow,altSide,''),_data$offsets$arrow);return data}function getOppositeVariation(variation){if(variation==='end'){return'start'}else if(variation==='start'){return'end'}return variation}var placements=['auto-start','auto','auto-end','top-start','top','top-end','right-start','right','right-end','bottom-end','bottom','bottom-start','left-end','left','left-start'];var validPlacements=placements.slice(3);function clockwise(placement){var counter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var index=validPlacements.indexOf(placement);var arr=validPlacements.slice(index+1).concat(validPlacements.slice(0,index));return counter?arr.reverse():arr}var BEHAVIORS={FLIP:'flip',CLOCKWISE:'clockwise',COUNTERCLOCKWISE:'counterclockwise'};function flip(data,options){if(isModifierEnabled(data.instance.modifiers,'inner')){return data}if(data.flipped&&data.placement===data.originalPlacement){return data}var boundaries=getBoundaries(data.instance.popper,data.instance.reference,options.padding,options.boundariesElement,data.positionFixed);var placement=data.placement.split('-')[0];var placementOpposite=getOppositePlacement(placement);var variation=data.placement.split('-')[1]||'';var flipOrder=[];switch(options.behavior){case BEHAVIORS.FLIP:flipOrder=[placement,placementOpposite];break;case BEHAVIORS.CLOCKWISE:flipOrder=clockwise(placement);break;case BEHAVIORS.COUNTERCLOCKWISE:flipOrder=clockwise(placement,true);break;default:flipOrder=options.behavior}flipOrder.forEach(function(step,index){if(placement!==step||flipOrder.length===index+1){return data}placement=data.placement.split('-')[0];placementOpposite=getOppositePlacement(placement);var popperOffsets=data.offsets.popper;var refOffsets=data.offsets.reference;var floor=Math.floor;var overlapsRef=placement==='left'&&floor(popperOffsets.right)>floor(refOffsets.left)||placement==='right'&&floor(popperOffsets.left)<floor(refOffsets.right)||placement==='top'&&floor(popperOffsets.bottom)>floor(refOffsets.top)||placement==='bottom'&&floor(popperOffsets.top)<floor(refOffsets.bottom);var overflowsLeft=floor(popperOffsets.left)<floor(boundaries.left);var overflowsRight=floor(popperOffsets.right)>floor(boundaries.right);var overflowsTop=floor(popperOffsets.top)<floor(boundaries.top);var overflowsBottom=floor(popperOffsets.bottom)>floor(boundaries.bottom);var overflowsBoundaries=placement==='left'&&overflowsLeft||placement==='right'&&overflowsRight||placement==='top'&&overflowsTop||placement==='bottom'&&overflowsBottom;var isVertical=['top','bottom'].indexOf(placement)!==-1;var flippedVariationByRef=!!options.flipVariations&&(isVertical&&variation==='start'&&overflowsLeft||isVertical&&variation==='end'&&overflowsRight||!isVertical&&variation==='start'&&overflowsTop||!isVertical&&variation==='end'&&overflowsBottom);var flippedVariationByContent=!!options.flipVariationsByContent&&(isVertical&&variation==='start'&&overflowsRight||isVertical&&variation==='end'&&overflowsLeft||!isVertical&&variation==='start'&&overflowsBottom||!isVertical&&variation==='end'&&overflowsTop);var flippedVariation=flippedVariationByRef||flippedVariationByContent;if(overlapsRef||overflowsBoundaries||flippedVariation){data.flipped=true;if(overlapsRef||overflowsBoundaries){placement=flipOrder[index+1]}if(flippedVariation){variation=getOppositeVariation(variation)}data.placement=placement+(variation?'-'+variation:'');data.offsets.popper=_extends$2({},data.offsets.popper,getPopperOffsets(data.instance.popper,data.offsets.reference,data.placement));data=runModifiers(data.instance.modifiers,data,'flip')}});return data}function keepTogether(data){var _data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference;var placement=data.placement.split('-')[0];var floor=Math.floor;var isVertical=['top','bottom'].indexOf(placement)!==-1;var side=isVertical?'right':'bottom';var opSide=isVertical?'left':'top';var measurement=isVertical?'width':'height';if(popper[side]<floor(reference[opSide])){data.offsets.popper[opSide]=floor(reference[opSide])-popper[measurement]}if(popper[opSide]>floor(reference[side])){data.offsets.popper[opSide]=floor(reference[side])}return data}function toValue(str,measurement,popperOffsets,referenceOffsets){var split=str.match(/((?:\-|\+)?\d*\.?\d*)(.*)/);var value=+split[1];var unit=split[2];if(!value){return str}if(unit.indexOf('%')===0){var element=void 0;switch(unit){case'%p':element=popperOffsets;break;case'%':case'%r':default:element=referenceOffsets}var rect=getClientRect(element);return rect[measurement]/100*value}else if(unit==='vh'||unit==='vw'){var size=void 0;if(unit==='vh'){size=Math.max(document.documentElement.clientHeight,window.innerHeight||0)}else{size=Math.max(document.documentElement.clientWidth,window.innerWidth||0)}return size/100*value}else{return value}}function parseOffset(offset,popperOffsets,referenceOffsets,basePlacement){var offsets=[0,0];var useHeight=['right','left'].indexOf(basePlacement)!==-1;var fragments=offset.split(/(\+|\-)/).map(function(frag){return frag.trim()});var divider=fragments.indexOf(find(fragments,function(frag){return frag.search(/,|\s/)!==-1}));if(fragments[divider]&&fragments[divider].indexOf(',')===-1){console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.')}var splitRegex=/\s*,\s*|\s+/;var ops=divider!==-1?[fragments.slice(0,divider).concat([fragments[divider].split(splitRegex)[0]]),[fragments[divider].split(splitRegex)[1]].concat(fragments.slice(divider+1))]:[fragments];ops=ops.map(function(op,index){var measurement=(index===1?!useHeight:useHeight)?'height':'width';var mergeWithPrevious=false;return op.reduce(function(a,b){if(a[a.length-1]===''&&['+','-'].indexOf(b)!==-1){a[a.length-1]=b;mergeWithPrevious=true;return a}else if(mergeWithPrevious){a[a.length-1]+=b;mergeWithPrevious=false;return a}else{return a.concat(b)}},[]).map(function(str){return toValue(str,measurement,popperOffsets,referenceOffsets)})});ops.forEach(function(op,index){op.forEach(function(frag,index2){if(isNumeric(frag)){offsets[index]+=frag*(op[index2-1]==='-'?-1:1)}})});return offsets}function offset(data,_ref){var offset=_ref.offset;var placement=data.placement,_data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference;var basePlacement=placement.split('-')[0];var offsets=void 0;if(isNumeric(+offset)){offsets=[+offset,0]}else{offsets=parseOffset(offset,popper,reference,basePlacement)}if(basePlacement==='left'){popper.top+=offsets[0];popper.left-=offsets[1]}else if(basePlacement==='right'){popper.top+=offsets[0];popper.left+=offsets[1]}else if(basePlacement==='top'){popper.left+=offsets[0];popper.top-=offsets[1]}else if(basePlacement==='bottom'){popper.left+=offsets[0];popper.top+=offsets[1]}data.popper=popper;return data}function preventOverflow(data,options){var boundariesElement=options.boundariesElement||getOffsetParent(data.instance.popper);if(data.instance.reference===boundariesElement){boundariesElement=getOffsetParent(boundariesElement)}var transformProp=getSupportedPropertyName('transform');var popperStyles=data.instance.popper.style;var top=popperStyles.top,left=popperStyles.left,transform=popperStyles[transformProp];popperStyles.top='';popperStyles.left='';popperStyles[transformProp]='';var boundaries=getBoundaries(data.instance.popper,data.instance.reference,options.padding,boundariesElement,data.positionFixed);popperStyles.top=top;popperStyles.left=left;popperStyles[transformProp]=transform;options.boundaries=boundaries;var order=options.priority;var popper=data.offsets.popper;var check={primary:function primary(placement){var value=popper[placement];if(popper[placement]<boundaries[placement]&&!options.escapeWithReference){value=Math.max(popper[placement],boundaries[placement])}return defineProperty$1({},placement,value)},secondary:function secondary(placement){var mainSide=placement==='right'?'left':'top';var value=popper[mainSide];if(popper[placement]>boundaries[placement]&&!options.escapeWithReference){value=Math.min(popper[mainSide],boundaries[placement]-(placement==='right'?popper.width:popper.height))}return defineProperty$1({},mainSide,value)}};order.forEach(function(placement){var side=['left','top'].indexOf(placement)!==-1?'primary':'secondary';popper=_extends$2({},popper,check[side](placement))});data.offsets.popper=popper;return data}function shift(data){var placement=data.placement;var basePlacement=placement.split('-')[0];var shiftvariation=placement.split('-')[1];if(shiftvariation){var _data$offsets=data.offsets,reference=_data$offsets.reference,popper=_data$offsets.popper;var isVertical=['bottom','top'].indexOf(basePlacement)!==-1;var side=isVertical?'left':'top';var measurement=isVertical?'width':'height';var shiftOffsets={start:defineProperty$1({},side,reference[side]),end:defineProperty$1({},side,reference[side]+reference[measurement]-popper[measurement])};data.offsets.popper=_extends$2({},popper,shiftOffsets[shiftvariation])}return data}function hide(data){if(!isModifierRequired(data.instance.modifiers,'hide','preventOverflow')){return data}var refRect=data.offsets.reference;var bound=find(data.instance.modifiers,function(modifier){return modifier.name==='preventOverflow'}).boundaries;if(refRect.bottom<bound.top||refRect.left>bound.right||refRect.top>bound.bottom||refRect.right<bound.left){if(data.hide===true){return data}data.hide=true;data.attributes['x-out-of-boundaries']=''}else{if(data.hide===false){return data}data.hide=false;data.attributes['x-out-of-boundaries']=false}return data}function inner(data){var placement=data.placement;var basePlacement=placement.split('-')[0];var _data$offsets=data.offsets,popper=_data$offsets.popper,reference=_data$offsets.reference;var isHoriz=['left','right'].indexOf(basePlacement)!==-1;var subtractLength=['top','left'].indexOf(basePlacement)===-1;popper[isHoriz?'left':'top']=reference[basePlacement]-(subtractLength?popper[isHoriz?'width':'height']:0);data.placement=getOppositePlacement(placement);data.offsets.popper=getClientRect(popper);return data}var modifiers={shift:{order:100,enabled:true,fn:shift},offset:{order:200,enabled:true,fn:offset,offset:0},preventOverflow:{order:300,enabled:true,fn:preventOverflow,priority:['left','right','top','bottom'],padding:5,boundariesElement:'scrollParent'},keepTogether:{order:400,enabled:true,fn:keepTogether},arrow:{order:500,enabled:true,fn:arrow,element:'[x-arrow]'},flip:{order:600,enabled:true,fn:flip,behavior:'flip',padding:5,boundariesElement:'viewport',flipVariations:false,flipVariationsByContent:false},inner:{order:700,enabled:false,fn:inner},hide:{order:800,enabled:true,fn:hide},computeStyle:{order:850,enabled:true,fn:computeStyle,gpuAcceleration:true,x:'bottom',y:'right'},applyStyle:{order:900,enabled:true,fn:applyStyle,onLoad:applyStyleOnLoad,gpuAcceleration:undefined}};var Defaults={placement:'bottom',positionFixed:false,eventsEnabled:true,removeOnDestroy:false,onCreate:function onCreate(){},onUpdate:function onUpdate(){},modifiers:modifiers};var Popper=function(){function Popper(reference,popper){var _this=this;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};classCallCheck(this,Popper);this.scheduleUpdate=function(){return requestAnimationFrame(_this.update)};this.update=debounce$1(this.update.bind(this));this.options=_extends$2({},Popper.Defaults,options);this.state={isDestroyed:false,isCreated:false,scrollParents:[]};this.reference=reference&&reference.jquery?reference[0]:reference;this.popper=popper&&popper.jquery?popper[0]:popper;this.options.modifiers={};Object.keys(_extends$2({},Popper.Defaults.modifiers,options.modifiers)).forEach(function(name){_this.options.modifiers[name]=_extends$2({},Popper.Defaults.modifiers[name]||{},options.modifiers?options.modifiers[name]:{})});this.modifiers=Object.keys(this.options.modifiers).map(function(name){return _extends$2({name:name},_this.options.modifiers[name])}).sort(function(a,b){return a.order-b.order});this.modifiers.forEach(function(modifierOptions){if(modifierOptions.enabled&&isFunction$1(modifierOptions.onLoad)){modifierOptions.onLoad(_this.reference,_this.popper,_this.options,modifierOptions,_this.state)}});this.update();var eventsEnabled=this.options.eventsEnabled;if(eventsEnabled){this.enableEventListeners()}this.state.eventsEnabled=eventsEnabled}createClass(Popper,[{key:'update',value:function update$$1(){return update.call(this)}},{key:'destroy',value:function destroy$$1(){return destroy.call(this)}},{key:'enableEventListeners',value:function enableEventListeners$$1(){return enableEventListeners.call(this)}},{key:'disableEventListeners',value:function disableEventListeners$$1(){return disableEventListeners.call(this)}}]);return Popper}();Popper.Utils=(typeof window!=='undefined'?window:global).PopperUtils;Popper.placements=placements;Popper.Defaults=Defaults;var version="5.0.0-beta.1";var idCounter=1;var mouseMoveListeners=[];function createTippy(reference,collectionProps){var props=evaluateProps(reference,collectionProps);if(!props.multiple&&reference._tippy){return null}var lastTriggerEventType;var showTimeout;var hideTimeout;var scheduleHideAnimationFrame;var isBeingDestroyed=false;var hasMountCallbackRun=false;var didHideDueToDocumentMouseDown=false;var currentMountCallback;var currentTransitionEndListener;var listeners=[];var debouncedOnMouseMove=debounce(onMouseMove,props.interactiveDebounce);var id=collectionProps.hasOwnProperty('id')?collectionProps.id:idCounter++;var popper=createPopperElement(id,props);var popperChildren=getChildren(popper);var popperInstance=null;var tooltip=popperChildren.tooltip,content=popperChildren.content;var state={currentPlacement:props.placement,isScheduledToShow:false,isEnabled:true,isVisible:false,isDestroyed:false,isMounted:false,isShown:false};var instance={id:id,reference:reference,popper:popper,popperChildren:popperChildren,popperInstance:popperInstance,props:props,state:state,clearDelayTimeouts:clearDelayTimeouts,setProps:setProps,setContent:setContent,show:show,hide:hide,enable:enable,disable:disable,destroy:destroy};reference._tippy=instance;popper._tippy=instance;addTriggersToEventListenersTarget();if(!props.lazy){createPopperInstance()}if(props.showOnCreate){scheduleShow()}popper.addEventListener('mouseenter',function(){if(instance.props.interactive&&instance.state.isVisible&&lastTriggerEventType==='mouseenter'){instance.clearDelayTimeouts()}});popper.addEventListener('mouseleave',function(){if(instance.props.interactive&&lastTriggerEventType==='mouseenter'){document.addEventListener('mousemove',debouncedOnMouseMove)}});props.onCreate(instance);return instance;function getNormalizedTouchSettings(){var touch=instance.props.touch;return Array.isArray(touch)?touch:[touch,0]}function getIsCustomTouchBehavior(){return getNormalizedTouchSettings()[0]==='hold'}function getTransitionableElements(){return[tooltip,content,instance.popperChildren.backdrop]}function getEventListenersTarget(){return instance.props.triggerTarget||reference}function cleanupInteractiveMouseListeners(){document.body.removeEventListener('mouseleave',scheduleHide);document.removeEventListener('mousemove',debouncedOnMouseMove);mouseMoveListeners=mouseMoveListeners.filter(function(listener){return listener!==debouncedOnMouseMove})}function onDocumentMouseDown(event){if(instance.props.interactive&&popper.contains(event.target)){return}if(getEventListenersTarget().contains(event.target)){if(currentInput.isTouch){return}if(instance.state.isVisible&&includes(instance.props.trigger,'click')){return}}if(instance.props.hideOnClick===true){instance.clearDelayTimeouts();instance.hide();didHideDueToDocumentMouseDown=true;setTimeout(function(){didHideDueToDocumentMouseDown=false});if(!instance.state.isMounted){removeDocumentMouseDownListener()}}}function addDocumentMouseDownListener(){document.addEventListener('mousedown',onDocumentMouseDown,true)}function removeDocumentMouseDownListener(){document.removeEventListener('mousedown',onDocumentMouseDown,true)}function makeSticky(){setTransitionDuration([popper],isIE?0:instance.props.updateDuration);var prevRefRect=reference.getBoundingClientRect();function updatePosition(){var currentRefRect=reference.getBoundingClientRect();if(prevRefRect.top!==currentRefRect.top||prevRefRect.right!==currentRefRect.right||prevRefRect.bottom!==currentRefRect.bottom||prevRefRect.left!==currentRefRect.left){instance.popperInstance.scheduleUpdate()}prevRefRect=currentRefRect;if(instance.state.isMounted){requestAnimationFrame(updatePosition)}}updatePosition()}function onTransitionedOut(duration,callback){onTransitionEnd(duration,function(){if(!instance.state.isVisible&&popper.parentNode&&popper.parentNode.contains(popper)){callback()}})}function onTransitionedIn(duration,callback){onTransitionEnd(duration,callback)}function onTransitionEnd(duration,callback){function listener(event){if(event.target===tooltip){updateTransitionEndListener(tooltip,'remove',listener);callback()}}if(duration===0){return callback()}updateTransitionEndListener(tooltip,'remove',currentTransitionEndListener);updateTransitionEndListener(tooltip,'add',listener);currentTransitionEndListener=listener}function on(eventType,handler,options){if(options===void 0){options=false}getEventListenersTarget().addEventListener(eventType,handler,options);listeners.push({eventType:eventType,handler:handler,options:options})}function addTriggersToEventListenersTarget(){if(getIsCustomTouchBehavior()){on('touchstart',onTrigger,PASSIVE);on('touchend',onMouseLeave,PASSIVE)}if(!includes(instance.props.trigger,'click')){on('click',function(){if(!currentInput.isTouch&&instance.props.hideOnClick===true){instance.hide()}})}instance.props.trigger.trim().split(' ').forEach(function(eventType){if(eventType==='manual'){return}on(eventType,onTrigger);switch(eventType){case'mouseenter':on('mouseleave',onMouseLeave);break;case'focus':on(isIE?'focusout':'blur',onBlur);break}})}function removeTriggersFromEventListenersTarget(){listeners.forEach(function(_ref){var eventType=_ref.eventType,handler=_ref.handler,options=_ref.options;getEventListenersTarget().removeEventListener(eventType,handler,options)});listeners=[]}function onTrigger(event){if(didHideDueToDocumentMouseDown||!instance.state.isEnabled||isEventListenerStopped(event)){return}if(!instance.state.isVisible){lastTriggerEventType=event.type;if(event instanceof MouseEvent){mouseMoveListeners.forEach(function(listener){return listener(event)})}}if(event.type==='click'&&instance.props.hideOnClick!==false&&instance.state.isVisible){scheduleHide(event)}else{var _getNormalizedTouchSe=getNormalizedTouchSettings(),value=_getNormalizedTouchSe[0],duration=_getNormalizedTouchSe[1];if(currentInput.isTouch&&value==='hold'&&duration){showTimeout=setTimeout(function(){scheduleShow(event)},duration)}else{scheduleShow(event)}}}function onMouseMove(event){var isCursorOverReferenceOrPopper=closestCallback(event.target,function(el){return el===reference||el===popper});if(isCursorOverReferenceOrPopper){return}if(isCursorOutsideInteractiveBorder(getBasePlacement(instance.state.currentPlacement),popper.getBoundingClientRect(),event,instance.props)){cleanupInteractiveMouseListeners();scheduleHide(event)}}function onMouseLeave(event){if(isEventListenerStopped(event)){return}if(instance.props.interactive){document.body.addEventListener('mouseleave',scheduleHide);document.addEventListener('mousemove',debouncedOnMouseMove);mouseMoveListeners.push(debouncedOnMouseMove);return}scheduleHide(event)}function onBlur(event){if(event.target!==getEventListenersTarget()){return}if(instance.props.interactive&&event.relatedTarget&&popper.contains(event.relatedTarget)){return}scheduleHide(event)}function isEventListenerStopped(event){var supportsTouch='ontouchstart'in window;var isTouchEvent=includes(event.type,'touch');var isCustomTouch=getIsCustomTouchBehavior();return supportsTouch&&currentInput.isTouch&&isCustomTouch&&!isTouchEvent||currentInput.isTouch&&!isCustomTouch&&isTouchEvent}function createPopperInstance(){var popperOptions=instance.props.popperOptions;var arrow=instance.popperChildren.arrow;var preventOverflowModifier=getModifier(popperOptions,'preventOverflow');function applyMutations(data){instance.state.currentPlacement=data.placement;if(instance.props.flip&&!instance.props.flipOnUpdate){if(data.flipped){instance.popperInstance.options.placement=data.placement}setFlipModifierEnabled(instance.popperInstance.modifiers,false)}tooltip.setAttribute('data-placement',data.placement);if(data.attributes['x-out-of-boundaries']!==false){tooltip.setAttribute('data-out-of-boundaries','')}else{tooltip.removeAttribute('data-out-of-boundaries')}var basePlacement=getBasePlacement(data.placement);var isVerticalPlacement=includes(['top','bottom'],basePlacement);var isSecondaryPlacement=includes(['bottom','right'],basePlacement);var tooltipStyles=tooltip.style;tooltipStyles.top='0';tooltipStyles.left='0';tooltipStyles[isVerticalPlacement?'top':'left']=(isSecondaryPlacement?1:-1)*instance.props.distance+"px"}var config=_extends$1({eventsEnabled:false,placement:instance.props.placement},popperOptions,{modifiers:_extends$1({},popperOptions&&popperOptions.modifiers,{preventOverflow:_extends$1({boundariesElement:instance.props.boundary,padding:PREVENT_OVERFLOW_PADDING},preventOverflowModifier),tippySetPreventOverflowPadding:{enabled:true,order:299,fn:function fn(data){var basePlacement=getBasePlacement(data.placement);var padding=preventOverflowModifier&&preventOverflowModifier.padding!==undefined?preventOverflowModifier.padding:PREVENT_OVERFLOW_PADDING;var isPaddingNumber=typeof padding==='number';var paddingObject={top:0,bottom:0,left:0,right:0};var computedPadding=Object.keys(paddingObject).reduce(function(obj,key){obj[key]=isPaddingNumber?padding:padding[key];if(basePlacement===key){obj[key]=isPaddingNumber?padding+instance.props.distance:(padding[basePlacement]||0)+instance.props.distance}return obj},paddingObject);instance.popperInstance.modifiers.filter(function(m){return m.name==='preventOverflow'})[0].padding=computedPadding;return data}},arrow:_extends$1({element:arrow,enabled:!!arrow},getModifier(popperOptions,'arrow')),flip:_extends$1({enabled:instance.props.flip,padding:instance.props.distance+PREVENT_OVERFLOW_PADDING,behavior:instance.props.flipBehavior},getModifier(popperOptions,'flip')),offset:_extends$1({offset:instance.props.offset},getModifier(popperOptions,'offset'))}),onCreate:function onCreate(data){applyMutations(data);preserveInvocation(popperOptions&&popperOptions.onCreate,config.onCreate,[data]);runMountCallback()},onUpdate:function onUpdate(data){applyMutations(data);preserveInvocation(popperOptions&&popperOptions.onUpdate,config.onUpdate,[data]);runMountCallback()}});instance.popperInstance=new Popper(reference,popper,config)}function runMountCallback(){if(!hasMountCallbackRun&&currentMountCallback){hasMountCallbackRun=true;reflow(popper);currentMountCallback()}}function mount(){hasMountCallbackRun=false;var appendTo=instance.props.appendTo;var parentNode=appendTo==='parent'?reference.parentNode:invokeWithArgsOrReturn(appendTo,[reference]);if(!parentNode.contains(popper)){parentNode.appendChild(popper)}if(instance.popperInstance){setFlipModifierEnabled(instance.popperInstance.modifiers,instance.props.flip);instance.popperInstance.enableEventListeners();instance.popperInstance.scheduleUpdate()}else{createPopperInstance();instance.popperInstance.enableEventListeners()}}function scheduleShow(event){instance.clearDelayTimeouts();instance.state.isScheduledToShow=true;if(!instance.popperInstance){createPopperInstance()}if(event){instance.props.onTrigger(instance,event)}addDocumentMouseDownListener();var delay=getValueAtIndexOrReturn(instance.props.delay,0,defaultProps.delay);if(delay){showTimeout=setTimeout(function(){instance.show()},delay)}else{instance.show()}}function scheduleHide(event){instance.clearDelayTimeouts();instance.props.onUntrigger(instance,event);if(!instance.state.isVisible){removeDocumentMouseDownListener();return}instance.state.isScheduledToShow=false;var delay=getValueAtIndexOrReturn(instance.props.delay,1,defaultProps.delay);if(delay){hideTimeout=setTimeout(function(){if(instance.state.isVisible){instance.hide()}},delay)}else{scheduleHideAnimationFrame=requestAnimationFrame(function(){instance.hide()})}}function enable(){instance.state.isEnabled=true}function disable(){instance.hide();instance.state.isEnabled=false}function clearDelayTimeouts(){clearTimeout(showTimeout);clearTimeout(hideTimeout);cancelAnimationFrame(scheduleHideAnimationFrame)}function setProps(_ref2){var partialProps=_extends$1({},_ref2);if(instance.state.isDestroyed){return}removeTriggersFromEventListenersTarget();var prevProps=instance.props;var nextProps=evaluateProps(reference,_extends$1({},instance.props,{},partialProps,{ignoreAttributes:true}));nextProps.ignoreAttributes=hasOwnProperty$1(partialProps,'ignoreAttributes')?partialProps.ignoreAttributes||false:prevProps.ignoreAttributes;instance.props=nextProps;addTriggersToEventListenersTarget();cleanupInteractiveMouseListeners();debouncedOnMouseMove=debounce(onMouseMove,nextProps.interactiveDebounce);updatePopperElement(popper,prevProps,nextProps,instance.state.isVisible);instance.popperChildren=getChildren(popper);if(instance.popperInstance){if(POPPER_INSTANCE_DEPENDENCIES.some(function(prop){return hasOwnProperty$1(partialProps,prop)&&partialProps[prop]!==prevProps[prop]})){instance.popperInstance.destroy();createPopperInstance();if(instance.state.isVisible){instance.popperInstance.enableEventListeners()}}else{instance.popperInstance.update()}}}function setContent(content){instance.setProps({content:content})}function show(duration,shouldPreventPopperTransition){if(duration===void 0){duration=getValueAtIndexOrReturn(instance.props.duration,0,defaultProps.duration)}if(shouldPreventPopperTransition===void 0){shouldPreventPopperTransition=true}var isAlreadyVisible=instance.state.isVisible;var isDestroyed=instance.state.isDestroyed;var isDisabled=!instance.state.isEnabled;var isTouchAndTouchDisabled=currentInput.isTouch&&!instance.props.touch;if(isAlreadyVisible||isDestroyed||isDisabled||isTouchAndTouchDisabled){return}if(getEventListenersTarget().hasAttribute('disabled')){return}if(instance.props.onShow(instance)===false){return}addDocumentMouseDownListener();popper.style.visibility='visible';instance.state.isVisible=true;var transitionableElements=getTransitionableElements();setTransitionDuration(shouldPreventPopperTransition?transitionableElements.concat(popper):transitionableElements,0);currentMountCallback=function currentMountCallback(){if(!instance.state.isVisible){return}instance.popperInstance.update();instance.props.onMount(instance);instance.state.isMounted=true;content.style.transitionDelay=instance.popperChildren.backdrop?Math.round(duration/12)+"ms":'';if(instance.props.sticky){makeSticky()}setTransitionDuration([popper],instance.props.updateDuration);setTransitionDuration(transitionableElements,duration);setVisibilityState(transitionableElements,'visible');onTransitionedIn(duration,function(){if(instance.props.aria){var node=getEventListenersTarget();var attrName="aria-"+instance.props.aria;var currentAttrValue=node.getAttribute(attrName);var nextAttrValue=currentAttrValue?currentAttrValue+" "+tooltip.id:tooltip.id;node.setAttribute(attrName,nextAttrValue)}instance.props.onShown(instance);instance.state.isShown=true})};mount()}function hide(duration){if(duration===void 0){duration=getValueAtIndexOrReturn(instance.props.duration,1,defaultProps.duration)}var isAlreadyHidden=!instance.state.isVisible&&!isBeingDestroyed;var isDestroyed=instance.state.isDestroyed;var isDisabled=!instance.state.isEnabled&&!isBeingDestroyed;if(isAlreadyHidden||isDestroyed||isDisabled){return}if(instance.props.onHide(instance)===false&&!isBeingDestroyed){return}removeDocumentMouseDownListener();popper.style.transition='none';popper.querySelector(TOOLTIP_SELECTOR).style.transition='none';popper.querySelector(CONTENT_SELECTOR).style.transition='none';popper.style.visibility='hidden';instance.state.isVisible=false;instance.state.isShown=false;var transitionableElements=getTransitionableElements();setTransitionDuration(transitionableElements,duration);setVisibilityState(transitionableElements,'hidden');onTransitionedOut(duration,function(){if(instance.props.aria){var node=getEventListenersTarget();var attrName="aria-"+instance.props.aria;var currentAttrValue=node.getAttribute(attrName);var nextAttrValue=currentAttrValue?currentAttrValue.replace(tooltip.id,'').trim():null;if(nextAttrValue){node.setAttribute(attrName,nextAttrValue)}else{node.removeAttribute(attrName)}}instance.popperInstance.disableEventListeners();instance.popperInstance.options.placement=instance.props.placement;popper.parentNode.removeChild(popper);instance.props.onHidden(instance);instance.state.isMounted=false})}function destroy(){if(instance.state.isDestroyed){return}isBeingDestroyed=true;instance.hide(0);removeTriggersFromEventListenersTarget();delete reference._tippy;if(instance.popperInstance){instance.popperInstance.destroy()}isBeingDestroyed=false;instance.state.isDestroyed=true}}function tippy(targets,optionalProps){bindGlobalEventListeners();var props=_extends$1({},defaultProps,{},optionalProps);var elements=getArrayOfElements(targets);var instances=elements.reduce(function(acc,reference){var instance=reference&&createTippy(reference,props);if(instance){acc.push(instance)}return acc},[]);return isRealElement(targets)?instances[0]:instances}tippy.version=version;tippy.defaultProps=defaultProps;tippy.currentInput=currentInput;tippy.setDefaultProps=function(partialProps){Object.keys(partialProps).forEach(function(key){defaultProps[key]=partialProps[key]})};tippy.hideAll=function(_temp){var _ref=_temp===void 0?{}:_temp,excludedReferenceOrInstance=_ref.exclude,duration=_ref.duration;arrayFrom(document.querySelectorAll(POPPER_SELECTOR)).forEach(function(popper){var instance=popper._tippy;if(instance){var isExcluded=false;if(excludedReferenceOrInstance){isExcluded=isReferenceElement(excludedReferenceOrInstance)?instance.reference===excludedReferenceOrInstance:popper===excludedReferenceOrInstance.popper}if(!isExcluded){instance.hide(duration)}}})};function autoInit(){arrayFrom(document.querySelectorAll('[data-tippy]')).forEach(function(el){var content=el.getAttribute('data-tippy');if(content){tippy(el,{content:content})}})}if(isBrowser){setTimeout(autoInit)}var css=".tippy-tooltip[data-animation=fade][data-state=hidden]{opacity:0}.tippy-iOS{cursor:pointer!important;-webkit-tap-highlight-color:transparent}.tippy-popper{pointer-events:none;max-width:calc(100% - 10px);transition-timing-function:cubic-bezier(.165,.84,.44,1)}.tippy-tooltip{position:relative;color:#fff;border-radius:.25rem;font-size:.875rem;line-height:1.4;background-color:#333;overflow:hidden;transition-property:visibility,opacity,transform;outline:0}.tippy-tooltip[data-placement^=top] .tippy-arrow{border-width:8px 8px 0;border-top-color:#333;margin:0 3px;transform-origin:50% 0;bottom:-7px}.tippy-tooltip[data-placement^=bottom] .tippy-arrow{border-width:0 8px 8px;border-bottom-color:#333;margin:0 3px;transform-origin:50% 7px;top:-7px}.tippy-tooltip[data-placement^=left] .tippy-arrow{border-width:8px 0 8px 8px;border-left-color:#333;margin:3px 0;transform-origin:0 50%;right:-7px}.tippy-tooltip[data-placement^=right] .tippy-arrow{border-width:8px 8px 8px 0;border-right-color:#333;margin:3px 0;transform-origin:7px 50%;left:-7px}.tippy-tooltip[data-arrow]{overflow:visible}.tippy-tooltip[data-animatefill]{background-color:transparent!important}.tippy-tooltip[data-interactive]{pointer-events:auto}.tippy-tooltip[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(.54,1.5,.38,1.11)}.tippy-tooltip[data-inertia][data-state=hidden]{transition-timing-function:ease}.tippy-arrow{border-color:transparent;border-style:solid;position:absolute}.tippy-arrow[data-state=hidden]{opacity:0}.tippy-content{padding:.3125rem .5625rem}";function injectCSS(css){var style=document.createElement('style');style.textContent='';style.setAttribute('data-tippy-stylesheet','');var head=document.head;var firstStyleOrLinkTag=head.querySelector('style,link');if(firstStyleOrLinkTag){head.insertBefore(style,firstStyleOrLinkTag)}else{head.appendChild(style)}}if(isBrowser){injectCSS(css)}function normalizePrefix(prefix){if(!isString(prefix)||prefix===''){return''}return prefix.charAt(prefix.length-1)!=='-'?prefix+"-":prefix}function parseAttachTo(step){var options=step.options.attachTo||{};var returnOpts=_extends({},options);if(isString(options.element)){try{returnOpts.element=document.querySelector(options.element)}catch(e){}if(!returnOpts.element){console.error("The element for this Shepherd step was not found "+options.element)}}return returnOpts}function setupTooltip(step){if(isUndefined(tippy)){throw new Error('Using the attachment feature of Shepherd requires the Tippy.js library')}if(step.tooltip){step.tooltip.destroy()}var attachToOpts=parseAttachTo(step);step.tooltip=_makeTippyInstance(attachToOpts,step);step.target=attachToOpts.element}function _makeTippyInstance(attachToOptions,step){var tippyOptions={};var element=document.body;if(!attachToOptions.element||!attachToOptions.on){tippyOptions=makeCenteredTippy(step)}else{tippyOptions=makeAttachedTippyOptions(attachToOptions,step);element=attachToOptions.element}return tippy(element,tippyOptions)}function toggleShepherdModalClass(currentElement,classPrefix){var shepherdModalTarget=document.querySelector("."+classPrefix+"shepherd-modal-target");if(shepherdModalTarget){shepherdModalTarget.classList.remove(classPrefix+"shepherd-modal-target")}currentElement.classList.add(classPrefix+"shepherd-modal-target")}var Component$1=preact.Component;var ShepherdButton=function(_Component){_inheritsLoose(ShepherdButton,_Component);function ShepherdButton(){return _Component.apply(this,arguments)||this}var _proto=ShepherdButton.prototype;_proto.render=function render(props){var classPrefix=props.classPrefix,config=props.config,step=props.step,styles=props.styles;var action=config.action,classes=config.classes,secondary=config.secondary,text=config.text;return preact.h("button",{className:(classes||'')+styles.button+(secondary?" "+classPrefix+"shepherd-button-secondary":''),onClick:action?action.bind(step.tour):null,tabindex:"0",dangerouslySetInnerHTML:{__html:!isElement(text)?text:null},},text)};return ShepherdButton}(Component$1);var Component$2=preact.Component;var ShepherdFooter=function(_Component){_inheritsLoose(ShepherdFooter,_Component);function ShepherdFooter(){return _Component.apply(this,arguments)||this}var _proto=ShepherdFooter.prototype;_proto.render=function render(props){var classPrefix=props.classPrefix,step=props.step,styles=props.styles;var buttons=step.options.buttons;return preact.h("footer",{className:styles.footer.trim()},this._addButtons(buttons,classPrefix,step,styles))};_proto._addButtons=function _addButtons(buttons,classPrefix,step,styles){if(buttons){return buttons.map(function(config){return preact.h(ShepherdButton,{classPrefix:classPrefix,config:config,key:config.toString(),step:step,styles:styles})})}return null};return ShepherdFooter}(Component$2);var Component$3=preact.Component;var ShepherdHeader=function(_Component){_inheritsLoose(ShepherdHeader,_Component);function ShepherdHeader(props){var _this;_this=_Component.call(this,props)||this;_this.step=props.step;_this.handleCancelClick=_this.handleCancelClick.bind(_assertThisInitialized(_this));return _this}var _proto=ShepherdHeader.prototype;_proto.render=function render(props){var labelId=props.labelId,step=props.step,styles=props.styles;var _step$options=step.options,cancelIcon=_step$options.cancelIcon,title=_step$options.title;return preact.h("header",{className:styles.header.trim()},this.constructor._addTitle(labelId,styles,title),this._addCancelLink(cancelIcon,styles))};_proto.handleCancelClick=function handleCancelClick(e){e.preventDefault();this.step.cancel()};ShepherdHeader._addTitle=function _addTitle(labelId,styles,title){if(title){return preact.h("h3",{id:labelId,className:styles.title.trim()},title)}return null};_proto._addCancelLink=function _addCancelLink(cancelIcon,styles){if(cancelIcon&&cancelIcon.enabled){return preact.h("button",{"aria-label":cancelIcon.label?cancelIcon.label:'Close Tour',className:styles['cancel-icon'].trim(),onClick:this.handleCancelClick,type:"button"},preact.h("span",{"aria-hidden":"true"},"\xD7"))}return null};return ShepherdHeader}(Component$3);var Component$4=preact.Component;var ShepherdText=function(_Component){_inheritsLoose(ShepherdText,_Component);function ShepherdText(){return _Component.apply(this,arguments)||this}var _proto=ShepherdText.prototype;_proto.shouldComponentUpdate=function shouldComponentUpdate(){return false};_proto.componentDidMount=function componentDidMount(){var step=this.props.step;var text=step.options.text;if(isFunction(text)){text=text.call(step)}if(isElement(text)){this.base.appendChild(text)}};_proto.render=function render(props){var descriptionId=props.descriptionId,step=props.step,styles=props.styles;var text=step.options.text;if(isFunction(text)){text=text.call(step)}return preact.h("div",{className:styles.text.trim(),dangerouslySetInnerHTML:{__html:!isElement(text)?text:null},id:descriptionId})};return ShepherdText}(Component$4);var Component$5=preact.Component;var ShepherdContent=function(_Component){_inheritsLoose(ShepherdContent,_Component);function ShepherdContent(){return _Component.apply(this,arguments)||this}var _proto=ShepherdContent.prototype;_proto.render=function render(props){var classPrefix=props.classPrefix,descriptionId=props.descriptionId,labelId=props.labelId,step=props.step,styles=props.styles;return preact.h("div",{className:styles.content.trim()},preact.h(ShepherdHeader,{labelId:labelId,step:step,styles:styles}),ShepherdContent._addShepherdText(descriptionId,step,styles),ShepherdContent._addShepherdFooter(classPrefix,step,styles))};ShepherdContent._addShepherdText=function _addShepherdText(descriptionId,step,styles){if(!isUndefined(step.options.text)){return preact.h(ShepherdText,{descriptionId:descriptionId,step:step,styles:styles})}return null};ShepherdContent._addShepherdFooter=function _addShepherdFooter(classPrefix,step,styles){if(Array.isArray(step.options.buttons)&&step.options.buttons.length){return preact.h(ShepherdFooter,{classPrefix:classPrefix,step:step,styles:styles})}return null};return ShepherdContent}(Component$5);var Component$6=preact.Component;var KEY_TAB=9;var KEY_ESC=27;var LEFT_ARROW=37;var RIGHT_ARROW=39;var ShepherdElement=function(_Component){_inheritsLoose(ShepherdElement,_Component);function ShepherdElement(props){var _this;_this=_Component.call(this,props)||this;_this.step=props.step;_this.handleKeyDown=_this.handleKeyDown.bind(_assertThisInitialized(_this));return _this}var _proto=ShepherdElement.prototype;_proto.componentDidMount=function componentDidMount(){var focusableElements=this.element.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]');var firstFocusableElement=focusableElements[0];var lastFocusableElement=focusableElements[focusableElements.length-1];this.focusableElements=focusableElements;this.firstFocusableElement=firstFocusableElement;this.lastFocusableElement=lastFocusableElement};_proto.render=function render(props){var _dataStepId,_this2=this;var classes=props.classes,classPrefix=props.classPrefix,descriptionId=props.descriptionId,labelId=props.labelId,step=props.step,styles=props.styles;var dataStepId=(_dataStepId={},_dataStepId["data-"+classPrefix+"shepherd-step-id"]=step.id,_dataStepId);return preact.h("div",_extends({"aria-describedby":!isUndefined(step.options.text)?descriptionId:null,"aria-labeledby":step.options.title?labelId:null,className:classes+styles.element},dataStepId,{onKeyDown:this.handleKeyDown,ref:function ref(c){return _this2.element=c},role:"dialog",tabindex:"0"}),preact.h(ShepherdContent,{classPrefix:classPrefix,descriptionId:descriptionId,labelId:labelId,step:step,styles:styles}))};_proto.handleKeyDown=function handleKeyDown(e){var tour=this.step.tour;switch(e.keyCode){case KEY_TAB:if(this.focusableElements.length===1){e.preventDefault();break}if(e.shiftKey){if(document.activeElement===this.firstFocusableElement){e.preventDefault();this.lastFocusableElement.focus()}}else{if(document.activeElement===this.lastFocusableElement){e.preventDefault();this.firstFocusableElement.focus()}}break;case KEY_ESC:if(tour.options.exitOnEsc){this.step.cancel()}break;case LEFT_ARROW:if(tour.options.keyboardNavigation){tour.back()}break;case RIGHT_ARROW:if(tour.options.keyboardNavigation){tour.next()}break;default:break}};return ShepherdElement}(Component$6);if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector}var smoothscroll=createCommonjsModule(function(module,exports){(function(){function polyfill(){var w=window;var d=document;if('scrollBehavior'in d.documentElement.style&&w.__forceSmoothScrollPolyfill__!==true){return}var Element=w.HTMLElement||w.Element;var SCROLL_TIME=468;var original={scroll:w.scroll||w.scrollTo,scrollBy:w.scrollBy,elementScroll:Element.prototype.scroll||scrollElement,scrollIntoView:Element.prototype.scrollIntoView};var now=w.performance&&w.performance.now?w.performance.now.bind(w.performance):Date.now;function isMicrosoftBrowser(userAgent){var userAgentPatterns=['MSIE ','Trident/','Edge/'];return new RegExp(userAgentPatterns.join('|')).test(userAgent)}var ROUNDING_TOLERANCE=isMicrosoftBrowser(w.navigator.userAgent)?1:0;function scrollElement(x,y){this.scrollLeft=x;this.scrollTop=y}function ease(k){return 0.5*(1-Math.cos(Math.PI*k))}function shouldBailOut(firstArg){if(firstArg===null||typeof firstArg!=='object'||firstArg.behavior===undefined||firstArg.behavior==='auto'||firstArg.behavior==='instant'){return true}if(typeof firstArg==='object'&&firstArg.behavior==='smooth'){return false}throw new TypeError('behavior member of ScrollOptions '+firstArg.behavior+' is not a valid value for enumeration ScrollBehavior.')}function hasScrollableSpace(el,axis){if(axis==='Y'){return el.clientHeight+ROUNDING_TOLERANCE<el.scrollHeight}if(axis==='X'){return el.clientWidth+ROUNDING_TOLERANCE<el.scrollWidth}}function canOverflow(el,axis){var overflowValue=w.getComputedStyle(el,null)['overflow'+axis];return overflowValue==='auto'||overflowValue==='scroll'}function isScrollable(el){var isScrollableY=hasScrollableSpace(el,'Y')&&canOverflow(el,'Y');var isScrollableX=hasScrollableSpace(el,'X')&&canOverflow(el,'X');return isScrollableY||isScrollableX}function findScrollableParent(el){while(el!==d.body&&isScrollable(el)===false){el=el.parentNode||el.host}return el}function step(context){var time=now();var value;var currentX;var currentY;var elapsed=(time-context.startTime)/SCROLL_TIME;elapsed=elapsed>1?1:elapsed;value=ease(elapsed);currentX=context.startX+(context.x-context.startX)*value;currentY=context.startY+(context.y-context.startY)*value;context.method.call(context.scrollable,currentX,currentY);if(currentX!==context.x||currentY!==context.y){w.requestAnimationFrame(step.bind(w,context))}}function smoothScroll(el,x,y){var scrollable;var startX;var startY;var method;var startTime=now();if(el===d.body){scrollable=w;startX=w.scrollX||w.pageXOffset;startY=w.scrollY||w.pageYOffset;method=original.scroll}else{scrollable=el;startX=el.scrollLeft;startY=el.scrollTop;method=scrollElement}step({scrollable:scrollable,method:method,startTime:startTime,startX:startX,startY:startY,x:x,y:y})}w.scroll=w.scrollTo=function(){if(arguments[0]===undefined){return}if(shouldBailOut(arguments[0])===true){original.scroll.call(w,arguments[0].left!==undefined?arguments[0].left:typeof arguments[0]!=='object'?arguments[0]:w.scrollX||w.pageXOffset,arguments[0].top!==undefined?arguments[0].top:arguments[1]!==undefined?arguments[1]:w.scrollY||w.pageYOffset);return}smoothScroll.call(w,d.body,arguments[0].left!==undefined?~~arguments[0].left:w.scrollX||w.pageXOffset,arguments[0].top!==undefined?~~arguments[0].top:w.scrollY||w.pageYOffset)};w.scrollBy=function(){if(arguments[0]===undefined){return}if(shouldBailOut(arguments[0])){original.scrollBy.call(w,arguments[0].left!==undefined?arguments[0].left:typeof arguments[0]!=='object'?arguments[0]:0,arguments[0].top!==undefined?arguments[0].top:arguments[1]!==undefined?arguments[1]:0);return}smoothScroll.call(w,d.body,~~arguments[0].left+(w.scrollX||w.pageXOffset),~~arguments[0].top+(w.scrollY||w.pageYOffset))};Element.prototype.scroll=Element.prototype.scrollTo=function(){if(arguments[0]===undefined){return}if(shouldBailOut(arguments[0])===true){if(typeof arguments[0]==='number'&&arguments[1]===undefined){throw new SyntaxError('Value could not be converted')}original.elementScroll.call(this,arguments[0].left!==undefined?~~arguments[0].left:typeof arguments[0]!=='object'?~~arguments[0]:this.scrollLeft,arguments[0].top!==undefined?~~arguments[0].top:arguments[1]!==undefined?~~arguments[1]:this.scrollTop);return}var left=arguments[0].left;var top=arguments[0].top;smoothScroll.call(this,this,typeof left==='undefined'?this.scrollLeft:~~left,typeof top==='undefined'?this.scrollTop:~~top)};Element.prototype.scrollBy=function(){if(arguments[0]===undefined){return}if(shouldBailOut(arguments[0])===true){original.elementScroll.call(this,arguments[0].left!==undefined?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,arguments[0].top!==undefined?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop);return}this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior})};Element.prototype.scrollIntoView=function(){if(shouldBailOut(arguments[0])===true){original.scrollIntoView.call(this,arguments[0]===undefined?true:arguments[0]);return}var scrollableParent=findScrollableParent(this);var parentRects=scrollableParent.getBoundingClientRect();var clientRects=this.getBoundingClientRect();if(scrollableParent!==d.body){smoothScroll.call(this,scrollableParent,scrollableParent.scrollLeft+clientRects.left-parentRects.left,scrollableParent.scrollTop+clientRects.top-parentRects.top);if(w.getComputedStyle(scrollableParent).position!=='fixed'){w.scrollBy({left:parentRects.left,top:parentRects.top,behavior:'smooth'})}}else{w.scrollBy({left:clientRects.left,top:clientRects.top,behavior:'smooth'})}}}{module.exports={polyfill:polyfill}}}())});var smoothscroll_1=smoothscroll.polyfill;smoothscroll.polyfill();var render$1=preact.render;var uniqueId=function(){var id=0;return function(){return++id}}();var Step=function(_Evented){_inheritsLoose(Step,_Evented);function Step(tour,options){var _this;if(options===void 0){options={}}_this=_Evented.call(this,tour,options)||this;_this.tour=tour;_this.classPrefix=_this.tour.options?normalizePrefix(_this.tour.options.classPrefix):'';_this.styles=tour.styles;autoBind(_assertThisInitialized(_this));_this._setOptions(options);return _assertThisInitialized(_this)||_assertThisInitialized(_this)}var _proto=Step.prototype;_proto.cancel=function cancel(){this.tour.cancel();this.trigger('cancel')};_proto.complete=function complete(){this.tour.complete();this.trigger('complete')};_proto.destroy=function destroy(){if(this.tooltip){this.tooltip.destroy();this.tooltip=null}if(isElement(this.el)&&this.el.parentNode){this.el.parentNode.removeChild(this.el);this.el=null}if(this.target){this._updateStepTargetOnHide()}this.trigger('destroy')};_proto.getTour=function getTour(){return this.tour};_proto.hide=function hide(){this.tour.modal.hide();this.trigger('before-hide');document.body.removeAttribute("data-"+this.classPrefix+"shepherd-step");if(this.target){this._updateStepTargetOnHide()}if(this.tooltip){this.tooltip.hide()}this.trigger('hide')};_proto.isOpen=function isOpen(){return Boolean(this.tooltip&&this.tooltip.state&&this.tooltip.state.isVisible)};_proto.show=function show(){var _this2=this;if(isFunction(this.options.beforeShowPromise)){var beforeShowPromise=this.options.beforeShowPromise();if(!isUndefined(beforeShowPromise)){return beforeShowPromise.then(function(){return _this2._show()})}}this._show()};_proto._createTooltipContent=function _createTooltipContent(){var cancelIconEnabled=getValue(this,'options.cancelIcon.enabled');var classes=this.options.classes||'';var descriptionId=this.id+"-description";var labelId=this.id+"-label";if(cancelIconEnabled){classes+=" "+this.classPrefix+"shepherd-has-cancel-icon"}return render$1(preact.h(ShepherdElement,{classPrefix:this.classPrefix,classes:classes,descriptionId:descriptionId,labelId:labelId,step:this,styles:this.styles}),null)};_proto._scrollTo=function _scrollTo(scrollToOptions){var _parseAttachTo=parseAttachTo(this),element=_parseAttachTo.element;if(isFunction(this.options.scrollToHandler)){this.options.scrollToHandler(element)}else if(isElement(element)){element.scrollIntoView(scrollToOptions)}};_proto._setOptions=function _setOptions(options){var _this3=this;if(options===void 0){options={}}this.options=options;var when=this.options.when;this.destroy();this.id=this.options.id||"step-"+uniqueId();if(when){Object.keys(when).forEach(function(event){_this3.on(event,when[event],_this3)})}};_proto._setupElements=function _setupElements(){if(!isUndefined(this.el)){this.destroy()}this.el=this._createTooltipContent();if(this.options.advanceOn){bindAdvance(this)}setupTooltip(this)};_proto._show=function _show(){var _this4=this;this.trigger('before-show');if(!this.el){this._setupElements()}this.tour.modal.setupForStep(this);this._styleTargetElementForStep(this);var target=this.target||document.body;target.classList.add(this.classPrefix+"shepherd-enabled",this.classPrefix+"shepherd-target");document.body.setAttribute("data-"+this.classPrefix+"shepherd-step",this.id);if(this.options.scrollTo){setTimeout(function(){_this4._scrollTo(_this4.options.scrollTo)})}this.tooltip.show();this.trigger('show');this.el.focus()};_proto._styleTargetElementForStep=function _styleTargetElementForStep(step){var targetElement=step.target;if(!targetElement){return}toggleShepherdModalClass(targetElement,step.classPrefix);if(step.options.highlightClass){targetElement.classList.add(step.options.highlightClass)}if(step.options.canClickTarget===false){targetElement.style.pointerEvents='none'}};_proto._updateStepTargetOnHide=function _updateStepTargetOnHide(){if(this.options.highlightClass){this.target.classList.remove(this.options.highlightClass)}this.target.classList.remove(this.classPrefix+"shepherd-enabled",this.classPrefix+"shepherd-target")};return Step}(Evented);var bodyScrollLock_min=createCommonjsModule(function(module,exports){!function(e,t){t(exports)}(commonjsGlobal,function(exports){function r(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}Object.defineProperty(exports,"__esModule",{value:!0});var l=!1;if("undefined"!=typeof window){var e={get passive(){l=!0}};window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}var d="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&/iP(ad|hone|od)/.test(window.navigator.platform),c=[],u=!1,a=-1,s=void 0,v=void 0,f=function(t){return c.some(function(e){return!(!e.options.allowTouchMove||!e.options.allowTouchMove(t))})},m=function(e){var t=e||window.event;return!!f(t.target)||(1<t.touches.length||(t.preventDefault&&t.preventDefault(),!1))},o=function(){setTimeout(function(){void 0!==v&&(document.body.style.paddingRight=v,v=void 0),void 0!==s&&(document.body.style.overflow=s,s=void 0)})};exports.disableBodyScroll=function(i,e){if(d){if(!i)return void console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");if(i&&!c.some(function(e){return e.targetElement===i})){var t={targetElement:i,options:e||{}};c=[].concat(r(c),[t]),i.ontouchstart=function(e){1===e.targetTouches.length&&(a=e.targetTouches[0].clientY)},i.ontouchmove=function(e){var t,o,n,r;1===e.targetTouches.length&&(o=i,r=(t=e).targetTouches[0].clientY-a,!f(t.target)&&(o&&0===o.scrollTop&&0<r?m(t):(n=o)&&n.scrollHeight-n.scrollTop<=n.clientHeight&&r<0?m(t):t.stopPropagation()))},u||(document.addEventListener("touchmove",m,l?{passive:!1}:void 0),u=!0)}}else{n=e,setTimeout(function(){if(void 0===v){var e=!!n&&!0===n.reserveScrollBarGap,t=window.innerWidth-document.documentElement.clientWidth;e&&0<t&&(v=document.body.style.paddingRight,document.body.style.paddingRight=t+"px")}void 0===s&&(s=document.body.style.overflow,document.body.style.overflow="hidden")});var o={targetElement:i,options:e||{}};c=[].concat(r(c),[o])}var n},exports.clearAllBodyScrollLocks=function(){d?(c.forEach(function(e){e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),u&&(document.removeEventListener("touchmove",m,l?{passive:!1}:void 0),u=!1),c=[],a=-1):(o(),c=[])},exports.enableBodyScroll=function(t){if(d){if(!t)return void console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");t.ontouchstart=null,t.ontouchmove=null,c=c.filter(function(e){return e.targetElement!==t}),u&&0===c.length&&(document.removeEventListener("touchmove",m,l?{passive:!1}:void 0),u=!1)}else(c=c.filter(function(e){return e.targetElement!==t})).length||o()}})});var bodyScrollLock=unwrapExports(bodyScrollLock_min);var defaults={trigger:'manual',arrow:true,animation:'fade',duration:420,flip:true,animateFill:false,interactive:true,hideOnClick:'toggle',multiple:true};function cleanupSteps(tour){if(tour){var steps=tour.steps;steps.forEach(function(step){if(step.options&&step.options.canClickTarget===false&&step.options.attachTo){var stepElement=step.target;if(stepElement instanceof HTMLElement){stepElement.style.pointerEvents='auto'}}})}}function _extends$3(){_extends$3=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends$3.apply(this,arguments)}function _assertThisInitialized$1(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _inheritsLoose$1(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;subClass.__proto__=superClass}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}function isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function _construct(Parent,args,Class){if(isNativeReflectConstruct()){_construct=Reflect.construct}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map():undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class)};return _wrapNativeSuper(Class)}var PolishedError=function(_Error){_inheritsLoose$1(PolishedError,_Error);function PolishedError(code){var _this;{_this=_Error.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/master/src/internalHelpers/errors.md#"+code+" for more information.")||this}return _assertThisInitialized$1(_this)}return PolishedError}(_wrapNativeSuper(Error));function colorToInt(color){return Math.round(color*255)}function convertToInt(red,green,blue){return colorToInt(red)+","+colorToInt(green)+","+colorToInt(blue)}function hslToRgb(hue,saturation,lightness,convert){if(convert===void 0){convert=convertToInt}if(saturation===0){return convert(lightness,lightness,lightness)}var huePrime=(hue%360+360)%360/60;var chroma=(1-Math.abs(2*lightness-1))*saturation;var secondComponent=chroma*(1-Math.abs(huePrime%2-1));var red=0;var green=0;var blue=0;if(huePrime>=0&&huePrime<1){red=chroma;green=secondComponent}else if(huePrime>=1&&huePrime<2){red=secondComponent;green=chroma}else if(huePrime>=2&&huePrime<3){green=chroma;blue=secondComponent}else if(huePrime>=3&&huePrime<4){green=secondComponent;blue=chroma}else if(huePrime>=4&&huePrime<5){red=secondComponent;blue=chroma}else if(huePrime>=5&&huePrime<6){red=chroma;blue=secondComponent}var lightnessModification=lightness-chroma/2;var finalRed=red+lightnessModification;var finalGreen=green+lightnessModification;var finalBlue=blue+lightnessModification;return convert(finalRed,finalGreen,finalBlue)}var namedColorMap={aliceblue:'f0f8ff',antiquewhite:'faebd7',aqua:'00ffff',aquamarine:'7fffd4',azure:'f0ffff',beige:'f5f5dc',bisque:'ffe4c4',black:'000',blanchedalmond:'ffebcd',blue:'0000ff',blueviolet:'8a2be2',brown:'a52a2a',burlywood:'deb887',cadetblue:'5f9ea0',chartreuse:'7fff00',chocolate:'d2691e',coral:'ff7f50',cornflowerblue:'6495ed',cornsilk:'fff8dc',crimson:'dc143c',cyan:'00ffff',darkblue:'00008b',darkcyan:'008b8b',darkgoldenrod:'b8860b',darkgray:'a9a9a9',darkgreen:'006400',darkgrey:'a9a9a9',darkkhaki:'bdb76b',darkmagenta:'8b008b',darkolivegreen:'556b2f',darkorange:'ff8c00',darkorchid:'9932cc',darkred:'8b0000',darksalmon:'e9967a',darkseagreen:'8fbc8f',darkslateblue:'483d8b',darkslategray:'2f4f4f',darkslategrey:'2f4f4f',darkturquoise:'00ced1',darkviolet:'9400d3',deeppink:'ff1493',deepskyblue:'00bfff',dimgray:'696969',dimgrey:'696969',dodgerblue:'1e90ff',firebrick:'b22222',floralwhite:'fffaf0',forestgreen:'228b22',fuchsia:'ff00ff',gainsboro:'dcdcdc',ghostwhite:'f8f8ff',gold:'ffd700',goldenrod:'daa520',gray:'808080',green:'008000',greenyellow:'adff2f',grey:'808080',honeydew:'f0fff0',hotpink:'ff69b4',indianred:'cd5c5c',indigo:'4b0082',ivory:'fffff0',khaki:'f0e68c',lavender:'e6e6fa',lavenderblush:'fff0f5',lawngreen:'7cfc00',lemonchiffon:'fffacd',lightblue:'add8e6',lightcoral:'f08080',lightcyan:'e0ffff',lightgoldenrodyellow:'fafad2',lightgray:'d3d3d3',lightgreen:'90ee90',lightgrey:'d3d3d3',lightpink:'ffb6c1',lightsalmon:'ffa07a',lightseagreen:'20b2aa',lightskyblue:'87cefa',lightslategray:'789',lightslategrey:'789',lightsteelblue:'b0c4de',lightyellow:'ffffe0',lime:'0f0',limegreen:'32cd32',linen:'faf0e6',magenta:'f0f',maroon:'800000',mediumaquamarine:'66cdaa',mediumblue:'0000cd',mediumorchid:'ba55d3',mediumpurple:'9370db',mediumseagreen:'3cb371',mediumslateblue:'7b68ee',mediumspringgreen:'00fa9a',mediumturquoise:'48d1cc',mediumvioletred:'c71585',midnightblue:'191970',mintcream:'f5fffa',mistyrose:'ffe4e1',moccasin:'ffe4b5',navajowhite:'ffdead',navy:'000080',oldlace:'fdf5e6',olive:'808000',olivedrab:'6b8e23',orange:'ffa500',orangered:'ff4500',orchid:'da70d6',palegoldenrod:'eee8aa',palegreen:'98fb98',paleturquoise:'afeeee',palevioletred:'db7093',papayawhip:'ffefd5',peachpuff:'ffdab9',peru:'cd853f',pink:'ffc0cb',plum:'dda0dd',powderblue:'b0e0e6',purple:'800080',rebeccapurple:'639',red:'f00',rosybrown:'bc8f8f',royalblue:'4169e1',saddlebrown:'8b4513',salmon:'fa8072',sandybrown:'f4a460',seagreen:'2e8b57',seashell:'fff5ee',sienna:'a0522d',silver:'c0c0c0',skyblue:'87ceeb',slateblue:'6a5acd',slategray:'708090',slategrey:'708090',snow:'fffafa',springgreen:'00ff7f',steelblue:'4682b4',tan:'d2b48c',teal:'008080',thistle:'d8bfd8',tomato:'ff6347',turquoise:'40e0d0',violet:'ee82ee',wheat:'f5deb3',white:'fff',whitesmoke:'f5f5f5',yellow:'ff0',yellowgreen:'9acd32'};function nameToHex(color){if(typeof color!=='string')return color;var normalizedColorName=color.toLowerCase();return namedColorMap[normalizedColorName]?"#"+namedColorMap[normalizedColorName]:color}var hexRegex=/^#[a-fA-F0-9]{6}$/;var hexRgbaRegex=/^#[a-fA-F0-9]{8}$/;var reducedHexRegex=/^#[a-fA-F0-9]{3}$/;var reducedRgbaHexRegex=/^#[a-fA-F0-9]{4}$/;var rgbRegex=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i;var rgbaRegex=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([-+]?[0-9]*[.]?[0-9]+)\s*\)$/i;var hslRegex=/^hsl\(\s*(\d{0,3}[.]?[0-9]+)\s*,\s*(\d{1,3})%\s*,\s*(\d{1,3})%\s*\)$/i;var hslaRegex=/^hsla\(\s*(\d{0,3}[.]?[0-9]+)\s*,\s*(\d{1,3})%\s*,\s*(\d{1,3})%\s*,\s*([-+]?[0-9]*[.]?[0-9]+)\s*\)$/i;function parseToRgb(color){if(typeof color!=='string'){throw new PolishedError(3)}var normalizedColor=nameToHex(color);if(normalizedColor.match(hexRegex)){return{red:parseInt(""+normalizedColor[1]+normalizedColor[2],16),green:parseInt(""+normalizedColor[3]+normalizedColor[4],16),blue:parseInt(""+normalizedColor[5]+normalizedColor[6],16)}}if(normalizedColor.match(hexRgbaRegex)){var alpha=parseFloat((parseInt(""+normalizedColor[7]+normalizedColor[8],16)/255).toFixed(2));return{red:parseInt(""+normalizedColor[1]+normalizedColor[2],16),green:parseInt(""+normalizedColor[3]+normalizedColor[4],16),blue:parseInt(""+normalizedColor[5]+normalizedColor[6],16),alpha:alpha}}if(normalizedColor.match(reducedHexRegex)){return{red:parseInt(""+normalizedColor[1]+normalizedColor[1],16),green:parseInt(""+normalizedColor[2]+normalizedColor[2],16),blue:parseInt(""+normalizedColor[3]+normalizedColor[3],16)}}if(normalizedColor.match(reducedRgbaHexRegex)){var _alpha=parseFloat((parseInt(""+normalizedColor[4]+normalizedColor[4],16)/255).toFixed(2));return{red:parseInt(""+normalizedColor[1]+normalizedColor[1],16),green:parseInt(""+normalizedColor[2]+normalizedColor[2],16),blue:parseInt(""+normalizedColor[3]+normalizedColor[3],16),alpha:_alpha}}var rgbMatched=rgbRegex.exec(normalizedColor);if(rgbMatched){return{red:parseInt(""+rgbMatched[1],10),green:parseInt(""+rgbMatched[2],10),blue:parseInt(""+rgbMatched[3],10)}}var rgbaMatched=rgbaRegex.exec(normalizedColor);if(rgbaMatched){return{red:parseInt(""+rgbaMatched[1],10),green:parseInt(""+rgbaMatched[2],10),blue:parseInt(""+rgbaMatched[3],10),alpha:parseFloat(""+rgbaMatched[4])}}var hslMatched=hslRegex.exec(normalizedColor);if(hslMatched){var hue=parseInt(""+hslMatched[1],10);var saturation=parseInt(""+hslMatched[2],10)/100;var lightness=parseInt(""+hslMatched[3],10)/100;var rgbColorString="rgb("+hslToRgb(hue,saturation,lightness)+")";var hslRgbMatched=rgbRegex.exec(rgbColorString);if(!hslRgbMatched){throw new PolishedError(4,normalizedColor,rgbColorString)}return{red:parseInt(""+hslRgbMatched[1],10),green:parseInt(""+hslRgbMatched[2],10),blue:parseInt(""+hslRgbMatched[3],10)}}var hslaMatched=hslaRegex.exec(normalizedColor);if(hslaMatched){var _hue=parseInt(""+hslaMatched[1],10);var _saturation=parseInt(""+hslaMatched[2],10)/100;var _lightness=parseInt(""+hslaMatched[3],10)/100;var _rgbColorString="rgb("+hslToRgb(_hue,_saturation,_lightness)+")";var _hslRgbMatched=rgbRegex.exec(_rgbColorString);if(!_hslRgbMatched){throw new PolishedError(4,normalizedColor,_rgbColorString)}return{red:parseInt(""+_hslRgbMatched[1],10),green:parseInt(""+_hslRgbMatched[2],10),blue:parseInt(""+_hslRgbMatched[3],10),alpha:parseFloat(""+hslaMatched[4])}}throw new PolishedError(5)}function rgbToHsl(color){var red=color.red/255;var green=color.green/255;var blue=color.blue/255;var max=Math.max(red,green,blue);var min=Math.min(red,green,blue);var lightness=(max+min)/2;if(max===min){if(color.alpha!==undefined){return{hue:0,saturation:0,lightness:lightness,alpha:color.alpha}}else{return{hue:0,saturation:0,lightness:lightness}}}var hue;var delta=max-min;var saturation=lightness>0.5?delta/(2-max-min):delta/(max+min);switch(max){case red:hue=(green-blue)/delta+(green<blue?6:0);break;case green:hue=(blue-red)/delta+2;break;default:hue=(red-green)/delta+4;break}hue*=60;if(color.alpha!==undefined){return{hue:hue,saturation:saturation,lightness:lightness,alpha:color.alpha}}return{hue:hue,saturation:saturation,lightness:lightness}}function parseToHsl(color){return rgbToHsl(parseToRgb(color))}var reduceHexValue=function reduceHexValue(value){if(value.length===7&&value[1]===value[2]&&value[3]===value[4]&&value[5]===value[6]){return"#"+value[1]+value[3]+value[5]}return value};function numberToHex(value){var hex=value.toString(16);return hex.length===1?"0"+hex:hex}function colorToHex(color){return numberToHex(Math.round(color*255))}function convertToHex(red,green,blue){return reduceHexValue("#"+colorToHex(red)+colorToHex(green)+colorToHex(blue))}function hslToHex(hue,saturation,lightness){return hslToRgb(hue,saturation,lightness,convertToHex)}function hsl(value,saturation,lightness){if(typeof value==='number'&&typeof saturation==='number'&&typeof lightness==='number'){return hslToHex(value,saturation,lightness)}else if(typeof value==='object'&&saturation===undefined&&lightness===undefined){return hslToHex(value.hue,value.saturation,value.lightness)}throw new PolishedError(1)}function hsla(value,saturation,lightness,alpha){if(typeof value==='number'&&typeof saturation==='number'&&typeof lightness==='number'&&typeof alpha==='number'){return alpha>=1?hslToHex(value,saturation,lightness):"rgba("+hslToRgb(value,saturation,lightness)+","+alpha+")"}else if(typeof value==='object'&&saturation===undefined&&lightness===undefined&&alpha===undefined){return value.alpha>=1?hslToHex(value.hue,value.saturation,value.lightness):"rgba("+hslToRgb(value.hue,value.saturation,value.lightness)+","+value.alpha+")"}throw new PolishedError(2)}function rgb(value,green,blue){if(typeof value==='number'&&typeof green==='number'&&typeof blue==='number'){return reduceHexValue("#"+numberToHex(value)+numberToHex(green)+numberToHex(blue))}else if(typeof value==='object'&&green===undefined&&blue===undefined){return reduceHexValue("#"+numberToHex(value.red)+numberToHex(value.green)+numberToHex(value.blue))}throw new PolishedError(6)}function rgba(firstValue,secondValue,thirdValue,fourthValue){if(typeof firstValue==='string'&&typeof secondValue==='number'){var rgbValue=parseToRgb(firstValue);return"rgba("+rgbValue.red+","+rgbValue.green+","+rgbValue.blue+","+secondValue+")"}else if(typeof firstValue==='number'&&typeof secondValue==='number'&&typeof thirdValue==='number'&&typeof fourthValue==='number'){return fourthValue>=1?rgb(firstValue,secondValue,thirdValue):"rgba("+firstValue+","+secondValue+","+thirdValue+","+fourthValue+")"}else if(typeof firstValue==='object'&&secondValue===undefined&&thirdValue===undefined&&fourthValue===undefined){return firstValue.alpha>=1?rgb(firstValue.red,firstValue.green,firstValue.blue):"rgba("+firstValue.red+","+firstValue.green+","+firstValue.blue+","+firstValue.alpha+")"}throw new PolishedError(7)}var isRgb=function isRgb(color){return typeof color.red==='number'&&typeof color.green==='number'&&typeof color.blue==='number'&&(typeof color.alpha!=='number'||typeof color.alpha==='undefined')};var isRgba=function isRgba(color){return typeof color.red==='number'&&typeof color.green==='number'&&typeof color.blue==='number'&&typeof color.alpha==='number'};var isHsl=function isHsl(color){return typeof color.hue==='number'&&typeof color.saturation==='number'&&typeof color.lightness==='number'&&(typeof color.alpha!=='number'||typeof color.alpha==='undefined')};var isHsla=function isHsla(color){return typeof color.hue==='number'&&typeof color.saturation==='number'&&typeof color.lightness==='number'&&typeof color.alpha==='number'};function toColorString(color){if(typeof color!=='object')throw new PolishedError(8);if(isRgba(color))return rgba(color);if(isRgb(color))return rgb(color);if(isHsla(color))return hsla(color);if(isHsl(color))return hsl(color);throw new PolishedError(8)}function curried(f,length,acc){return function fn(){var combined=acc.concat(Array.prototype.slice.call(arguments));return combined.length>=length?f.apply(this,combined):curried(f,length,combined)}}function curry(f){return curried(f,f.length,[])}function guard(lowerBoundary,upperBoundary,value){return Math.max(lowerBoundary,Math.min(upperBoundary,value))}function darken(amount,color){if(color==='transparent')return color;var hslColor=parseToHsl(color);return toColorString(_extends$3({},hslColor,{lightness:guard(0,1,hslColor.lightness-parseFloat(amount))}))}var curriedDarken=curry(darken);function desaturate(amount,color){if(color==='transparent')return color;var hslColor=parseToHsl(color);return toColorString(_extends$3({},hslColor,{saturation:guard(0,1,hslColor.saturation-parseFloat(amount))}))}var curriedDesaturate=curry(desaturate);function getLuminance(color){if(color==='transparent')return 0;var rgbColor=parseToRgb(color);var _Object$keys$map=Object.keys(rgbColor).map(function(key){var channel=rgbColor[key]/255;return channel<=0.03928?channel/12.92:Math.pow((channel+0.055)/1.055,2.4)}),r=_Object$keys$map[0],g=_Object$keys$map[1],b=_Object$keys$map[2];return parseFloat((0.2126*r+0.7152*g+0.0722*b).toFixed(3))}function lighten(amount,color){if(color==='transparent')return color;var hslColor=parseToHsl(color);return toColorString(_extends$3({},hslColor,{lightness:guard(0,1,hslColor.lightness+parseFloat(amount))}))}var curriedLighten=curry(lighten);function readableColor(color,lightReturnColor,darkReturnColor){if(lightReturnColor===void 0){lightReturnColor='#000'}if(darkReturnColor===void 0){darkReturnColor='#fff'}return getLuminance(color)>0.179?lightReturnColor:darkReturnColor}function transparentize(amount,color){if(color==='transparent')return color;var parsedColor=parseToRgb(color);var alpha=typeof parsedColor.alpha==='number'?parsedColor.alpha:1;var colorWithAlpha=_extends$3({},parsedColor,{alpha:guard(0,1,(alpha*100-parseFloat(amount)*100)/100)});return rgba(colorWithAlpha)}var curriedTransparentize=curry(transparentize);var styles={arrowSize:2.1,overlayOpacity:0.5,shepherdButtonBorderRadius:'3px',shepherdElementBorderRadius:'5px',shepherdElementMaxHeight:'100%',shepherdElementMaxWidth:'100%',shepherdElementZIndex:9999,shepherdTextBackground:'#ffffff',shepherdTextLineHeight:'1.3em',shepherdTextFontSize:'1rem',shepherdThemePrimary:'#3288e6'};function getVariables(options){if(options.styleVariables){_extends(styles,options.styleVariables)}if(!styles.shepherdHeaderBackground){styles.shepherdHeaderBackground=curriedDarken(0.1,styles.shepherdTextBackground)}if(!styles.shepherdThemeSecondary){styles.shepherdThemeSecondary=curriedDesaturate(0.7,curriedLighten(0.4,styles.shepherdThemePrimary))}_setTextColors();return styles}function _setTextColors(){if(!styles.shepherdThemeTextPrimary){styles.shepherdThemeTextPrimary=curriedTransparentize(0.25,readableColor(styles.shepherdThemePrimary))}if(!styles.shepherdThemeTextSecondary){styles.shepherdThemeTextSecondary=curriedTransparentize(0.25,readableColor(styles.shepherdThemeSecondary))}if(!styles.shepherdThemeTextHeader){styles.shepherdThemeTextHeader=curriedTransparentize(0.25,readableColor(styles.shepherdHeaderBackground))}if(!styles.shepherdThemeTextColor){styles.shepherdThemeTextColor=curriedTransparentize(0.25,readableColor(styles.shepherdTextBackground))}}function assign$1(target,firstSource){if(target===undefined||target===null){throw new TypeError('Cannot convert first argument to object')}var to=Object(target);for(var i=1;i<arguments.length;i++){var nextSource=arguments[i];if(nextSource===undefined||nextSource===null){continue}var keysArray=Object.keys(Object(nextSource));for(var nextIndex=0,len=keysArray.length;nextIndex<len;nextIndex++){var nextKey=keysArray[nextIndex];var desc=Object.getOwnPropertyDescriptor(nextSource,nextKey);if(desc!==undefined&&desc.enumerable){to[nextKey]=nextSource[nextKey]}}}return to}function polyfill$1(){if(!Object.assign){Object.defineProperty(Object,'assign',{enumerable:false,configurable:true,writable:true,value:assign$1})}}var es6ObjectAssign={assign:assign$1,polyfill:polyfill$1};var es6ObjectAssign_1=es6ObjectAssign.assign;var KEBAB_REGEX=/[A-Z]/g;var _hash=function hash(str){var hash=5381,i=str.length;while(i){hash=hash*33^str.charCodeAt(--i)}return'_'+(hash>>>0).toString(36)};var create$2=function create(config){config=config||{};var assign=config.assign||Object.assign;var client=typeof window==='object';var renderer=assign({raw:'',pfx:'_',client:client,assign:assign,stringify:JSON.stringify,kebab:function kebab(prop){return prop.replace(KEBAB_REGEX,'-$&').toLowerCase()},decl:function decl(key,value){key=renderer.kebab(key);return key+':'+value+';'},hash:function hash(obj){return _hash(renderer.stringify(obj))},selector:function selector(parent,_selector){return parent+(_selector[0]===':'?'':' ')+_selector},putRaw:function putRaw(rawCssRule){renderer.raw+=rawCssRule}},config);if(renderer.client){if(!renderer.sh)document.head.appendChild(renderer.sh=document.createElement('style'));renderer.putRaw=function(rawCssRule){{var sheet=renderer.sh.sheet;try{sheet.insertRule(rawCssRule,sheet.cssRules.length)}catch(error){}}}}renderer.put=function(selector,decls,atrule){var str='';var prop,value;var postponed=[];for(prop in decls){value=decls[prop];if(value instanceof Object&&!(value instanceof Array)){postponed.push(prop)}else{{str+=renderer.decl(prop,value,selector,atrule)}}}if(str){{str=selector+'{'+str+'}'}renderer.putRaw(atrule?atrule+'{'+str+'}':str)}for(var i=0;i<postponed.length;i++){prop=postponed[i];if(prop[0]==="@"&&prop!=="@font-face"){renderer.putAt(selector,decls[prop],prop)}else{renderer.put(renderer.selector(selector,prop),decls[prop],atrule)}}};renderer.putAt=renderer.put;return renderer};var addon=function addon(renderer){var cache={};renderer.cache=function(css){if(!css)return'';var key=renderer.hash(css);if(!cache[key]){cache[key]=renderer.rule(css,key)}return cache[key]}};var addon$1=function addon(renderer){renderer.selector=function(parentSelectors,selector){var parents=parentSelectors.split(',');var result=[];var selectors=selector.split(',');var len1=parents.length;var len2=selectors.length;var i,j,sel,pos,parent,replacedSelector;for(i=0;i<len2;i++){sel=selectors[i];pos=sel.indexOf('&');if(pos>-1){for(j=0;j<len1;j++){parent=parents[j];replacedSelector=sel.replace(/&/g,parent);result.push(replacedSelector)}}else{for(j=0;j<len1;j++){parent=parents[j];if(parent){result.push(parent+' '+sel)}else{result.push(sel)}}}}return result.join(',')}};var addon$2=function addon(renderer){renderer.rule=function(css,block){block=block||renderer.hash(css);block=renderer.pfx+block;renderer.put('.'+block,css);return' '+block}};var addon$3=function addon(renderer){renderer.sheet=function(map,block){var result={};if(!block){block=renderer.hash(map)}var onElementModifier=function onElementModifier(elementModifier){var styles=map[elementModifier];{Object.defineProperty(result,elementModifier,{configurable:true,enumerable:true,get:function get(){var classNames=renderer.rule(styles,block+'-'+elementModifier);Object.defineProperty(result,elementModifier,{value:classNames,enumerable:true});return classNames}})}};for(var elementModifier in map){onElementModifier(elementModifier)}return result}};var nano=create$2({assign:es6ObjectAssign_1,h:h,pfx:''});addon(nano);addon$1(nano);addon$2(nano);addon$3(nano);var rule=nano.rule,sheet=nano.sheet;function buttonStyles(classPrefix,variables,includeStyles){if(includeStyles){var _button;return{button:(_button={background:variables.shepherdThemePrimary,borderRadius:variables.shepherdButtonBorderRadius,border:0,color:variables.shepherdThemeTextPrimary,cursor:'pointer',display:'inline-block',fontFamily:'inherit',fontSize:'0.8em',letterSpacing:'0.1em',lineHeight:'1em',marginRight:'0.5em',padding:'0.75em 2em',textTransform:'uppercase',transition:'all 0.5s ease',verticalAlign:'middle','&:hover':{background:curriedDarken(0.1,variables.shepherdThemePrimary)}},_button["&."+classPrefix+"shepherd-button-secondary"]={background:variables.shepherdThemeSecondary,color:variables.shepherdThemeTextSecondary,'&:hover':{background:curriedDarken(0.1,variables.shepherdThemeSecondary),color:curriedDarken(0.1,variables.shepherdThemeTextSecondary)}},_button)}}return{button:{}}}function contentStyles(variables,includeStyles){if(includeStyles){return{content:{background:variables.shepherdTextBackground,borderRadius:variables.shepherdElementBorderRadius,fontSize:'inherit',outline:'none',padding:0}}}return{content:{}}}function elementStyles(){return{element:{'outline':'none','&, *':{'&, &:after, &:before':{boxSizing:'border-box'}}}}}function footerStyles(classPrefix,variables,includeStyles){if(includeStyles){var _footer;return{footer:(_footer={borderBottomLeftRadius:variables.shepherdElementBorderRadius,borderBottomRightRadius:variables.shepherdElementBorderRadius,display:'flex',justifyContent:'flex-end',padding:'0 0.75em 0.75em'},_footer["."+classPrefix+"shepherd-button"]={'&:last-child':{marginRight:0}},_footer)}}return{footer:{}}}function getLighterOrDarker(color){var l=getLuminance(color);if(l>0.6){return curriedDarken(l/2,color)}return curriedLighten((1-l)/2,color)}function headerStyles(classPrefix,variables,includeStyles){var _header,_cancelIcon;var header=(_header={alignItems:'center',borderTopLeftRadius:variables.shepherdElementBorderRadius,borderTopRightRadius:variables.shepherdElementBorderRadius,display:'flex',justifyContent:'flex-end',lineHeight:'2em',padding:'0.75em 0.75em 0'},_header["."+classPrefix+"shepherd-has-title ."+classPrefix+"shepherd-content &"]={background:variables.shepherdHeaderBackground,padding:'1em'},_header);var title={color:variables.shepherdThemeTextHeader,display:'flex',flex:'1 0 auto',fontSize:'1.1em',fontWeight:'normal',margin:0,padding:0,position:'relative',verticalAlign:'middle'};var styles={'cancel-icon':(_cancelIcon={background:'transparent',border:'none',color:getLighterOrDarker(variables.shepherdThemeTextColor),fontSize:'2em',fontWeight:'normal',margin:0,padding:0,position:'relative',textDecoration:'none',transition:'color 0.5s ease',verticalAlign:'middle','&:hover':{color:variables.shepherdThemeTextColor,cursor:'pointer'}},_cancelIcon["."+classPrefix+"shepherd-has-title ."+classPrefix+"shepherd-content &"]={color:getLighterOrDarker(variables.shepherdThemeTextHeader),'&:hover':{color:variables.shepherdThemeTextHeader}},_cancelIcon)};if(includeStyles){styles=_extends({},styles,{header:header,title:title})}else{styles=_extends({},styles,{header:{},title:{}})}return styles}function modalStyles(classPrefix,variables){var _modalOverlayContai;return{'modal-overlay-container':(_modalOverlayContai={'-ms-filter':'progid:dximagetransform.microsoft.gradient.alpha(Opacity=50)',filter:'alpha(opacity=50)',height:0,left:0,opacity:0,overflow:'hidden',position:'fixed',top:0,transition:'all 0.3s ease-out, height 0ms 0.3s, opacity 0.3s 0ms',width:'100vw',zIndex:variables.shepherdElementZIndex-2},_modalOverlayContai["."+classPrefix+"shepherd-modal-is-visible &"]={height:'100vh',opacity:variables.overlayOpacity,transition:'all 0.3s ease-out, height 0s 0s, opacity 0.3s 0s'},_modalOverlayContai),'modal-mask-rect':{height:'100vh',width:'100vw'}}}function textStyles(variables,includeStyles){if(includeStyles){return{text:{color:variables.shepherdThemeTextColor,fontSize:variables.shepherdTextFontSize,lineHeight:variables.shepherdTextLineHeight,padding:'0.75em',p:{marginTop:0,'&:last-child':{marginBottom:0}}}}}return{text:{}}}function generateStyles(options){var _ref,_active,_xPlacementTop,_ref2,_xPlacementBott,_xPlacementLeft,_xPlacementRigh,_ref3,_extends2,_rule;var variables=getVariables(options);var classPrefix=normalizePrefix(options.classPrefix);var tippyPrefix=normalizePrefix(options.tippyClassPrefix);var includeStyles=options.includeStyles;var styles=_extends({active:(_active={},_active["&."+classPrefix+"shepherd-modal-is-visible"]=(_ref={},_ref[":not(."+classPrefix+"shepherd-target)"]={pointerEvents:'none'},_ref["."+classPrefix+"shepherd-button, ."+classPrefix+"shepherd-cancel-icon, ."+classPrefix+"shepherd-element, ."+classPrefix+"shepherd-target"]={pointerEvents:'auto','*':{pointerEvents:'auto'}},_ref),_active)},buttonStyles(classPrefix,variables,includeStyles),{},contentStyles(variables,includeStyles),{},elementStyles(),{},footerStyles(classPrefix,variables,includeStyles),{},headerStyles(classPrefix,variables,includeStyles),{},modalStyles(classPrefix,variables),{},textStyles(variables,includeStyles));if(variables.useDropShadow){styles.element.filter='drop-shadow(0 1px 4px rgba(0, 0, 0, 0.2))'}var classes=sheet(styles,classPrefix+"shepherd");var arrowMargin="calc(("+variables.arrowSize+" / 2.1) * 16px)";var popperThemeArrows={'&[x-placement^="top"]':(_xPlacementTop={marginBottom:arrowMargin},_xPlacementTop["."+tippyPrefix+"tippy-arrow"]={borderTopColor:variables.shepherdTextBackground},_xPlacementTop),'&[x-placement^="bottom"]':(_xPlacementBott={marginTop:arrowMargin},_xPlacementBott["."+tippyPrefix+"tippy-arrow"]={borderBottomColor:variables.shepherdTextBackground},_xPlacementBott["&."+classPrefix+"shepherd-has-title"]=(_ref2={},_ref2["."+tippyPrefix+"tippy-arrow"]={borderBottomColor:variables.shepherdHeaderBackground},_ref2),_xPlacementBott),'&[x-placement^="left"]':(_xPlacementLeft={marginRight:arrowMargin},_xPlacementLeft["."+tippyPrefix+"tippy-arrow"]={borderLeftColor:variables.shepherdTextBackground},_xPlacementLeft),'&[x-placement^="right"]':(_xPlacementRigh={marginLeft:arrowMargin},_xPlacementRigh["."+tippyPrefix+"tippy-arrow"]={borderRightColor:variables.shepherdTextBackground},_xPlacementRigh)};classes.shepherd=rule((_rule={},_rule["&."+tippyPrefix+"tippy-popper"]=_extends({},popperThemeArrows,(_extends2={zIndex:variables.shepherdElementZIndex},_extends2["."+tippyPrefix+"tippy-tooltip"]=(_ref3={backgroundColor:variables.shepherdTextBackground},_ref3["."+tippyPrefix+"tippy-arrow"]={transform:"scale("+variables.arrowSize+")",zIndex:variables.shepherdElementZIndex+1},_ref3["."+tippyPrefix+"tippy-content"]={maxHeight:variables.shepherdElementMaxHeight,maxWidth:variables.shepherdElementMaxWidth,padding:0,textAlign:'center'},_ref3),_extends2)),_rule),classPrefix+"shepherd");return classes}var Component$7=preact.Component;var ShepherdModal=function(_Component){_inheritsLoose(ShepherdModal,_Component);function ShepherdModal(props){var _this;_this=_Component.call(this,props)||this;_this._onScreenChange=null;_this.classPrefix=props.classPrefix;autoBind(_assertThisInitialized(_this));_this.closeModalOpening();return _this}var _proto=ShepherdModal.prototype;_proto.render=function render(props,state){var classPrefix=props.classPrefix,styles=props.styles;return preact.h("svg",{className:styles['modal-overlay-container'],onTouchMove:ShepherdModal.handlePreventModalOverlayTouch},preact.h("defs",null,preact.h("mask",{className:classPrefix+"shepherd-modal-mask",height:"100%",id:classPrefix+"shepherd-modal-mask",width:"100%",x:"0",y:"0"},preact.h("rect",{className:styles['modal-mask-rect'],fill:"#FFFFFF",height:"100%",width:"100%",x:"0",y:"0"}),preact.h("rect",{className:classPrefix+"shepherd-modal-mask-opening",fill:"#000000",height:state.openingProperties.height,x:state.openingProperties.x,y:state.openingProperties.y,rx:6,ry:6,width:state.openingProperties.width}))),preact.h("rect",{height:"100%",width:"100%",x:"0",y:"0",mask:"url(#"+classPrefix+"shepherd-modal-mask)"}))};_proto.closeModalOpening=function closeModalOpening(){this.setState({openingProperties:{height:0,x:0,y:0,width:0}})};_proto.hide=function hide(){document.body.classList.remove(this.classPrefix+"shepherd-modal-is-visible");this._cleanupStepEventListeners()};_proto.positionModalOpening=function positionModalOpening(targetElement,modalOverlayOpeningPadding){if(modalOverlayOpeningPadding===void 0){modalOverlayOpeningPadding=0}if(targetElement.getBoundingClientRect){var _targetElement$getBou=targetElement.getBoundingClientRect(),x=_targetElement$getBou.x,y=_targetElement$getBou.y,width=_targetElement$getBou.width,height=_targetElement$getBou.height,left=_targetElement$getBou.left,top=_targetElement$getBou.top;this.setState({openingProperties:{x:(x||left)-modalOverlayOpeningPadding,y:(y||top)-modalOverlayOpeningPadding,width:width+modalOverlayOpeningPadding*2,height:height+modalOverlayOpeningPadding*2}})}};_proto.setupForStep=function setupForStep(step){this._cleanupStepEventListeners();if(step.tour.options.useModalOverlay){this._styleForStep(step);this.show()}else{this.hide()}};_proto.show=function show(){document.body.classList.add(this.classPrefix+"shepherd-modal-is-visible")};_proto._addStepEventListeners=function _addStepEventListeners(){window.addEventListener('touchmove',ShepherdModal._preventModalBodyTouch,{passive:false})};_proto._cleanupStepEventListeners=function _cleanupStepEventListeners(){if(this.rafId){cancelAnimationFrame(this.rafId);this.rafId=undefined}window.removeEventListener('touchmove',ShepherdModal._preventModalBodyTouch,{passive:false})};_proto._styleForStep=function _styleForStep(step){var _this2=this;var modalOverlayOpeningPadding=step.options.modalOverlayOpeningPadding;if(step.target){var rafLoop=function rafLoop(){_this2.rafId=undefined;_this2.positionModalOpening(step.target,modalOverlayOpeningPadding);_this2.rafId=requestAnimationFrame(rafLoop)};rafLoop();this._addStepEventListeners()}else{this.closeModalOpening()}};ShepherdModal._preventModalBodyTouch=function _preventModalBodyTouch(e){e.preventDefault()};ShepherdModal.handlePreventModalOverlayTouch=function handlePreventModalOverlayTouch(e){e.stopPropagation()};return ShepherdModal}(Component$7);var render$2=preact.render;var uniqueId$1=function(){var id=0;return function(){return++id}}();var Shepherd=new Evented();var Tour=function(_Evented){_inheritsLoose(Tour,_Evented);function Tour(options){var _this;if(options===void 0){options={}}_this=_Evented.call(this,options)||this;autoBind(_assertThisInitialized(_this));var defaultTourOptions={exitOnEsc:true,includeStyles:true,keyboardNavigation:true};_this.options=_extends({},defaultTourOptions,options);_this.classPrefix=_this.options?normalizePrefix(_this.options.classPrefix):'';_this.styles=generateStyles(_this.options);_this.steps=[];_this.addSteps(_this.options.steps);var events=['active','cancel','complete','inactive','show','start'];events.map(function(event){(function(e){_this.on(e,function(opts){opts=opts||{};opts.tour=_assertThisInitialized(_this);Shepherd.trigger(e,opts)})})(event)});var existingModal=document.querySelector("."+_this.classPrefix+"shepherd-modal-overlay-container");render$2(preact.h(ShepherdModal,{classPrefix:_this.classPrefix,ref:function ref(c){return _this.modal=c},styles:_this.styles}),options.modalContainer||document.body,existingModal);_this._setTooltipDefaults();_this._setTourID();return _assertThisInitialized(_this)||_assertThisInitialized(_this)}var _proto=Tour.prototype;_proto.addStep=function addStep(options){var step=options;if(!(step instanceof Step)){step=this._setupStep(step)}else{step.tour=this}this.steps.push(step);return step};_proto.addSteps=function addSteps(steps){var _this2=this;if(Array.isArray(steps)){steps.forEach(function(step){_this2.addStep(step)})}return this};_proto.back=function back(){var index=this.steps.indexOf(this.currentStep);this.show(index-1,false)};_proto.cancel=function cancel(){if(this.options.onClose&&typeof this.options.onClose==='function'){this.options.onClose()}if(this.options.confirmCancel){var cancelMessage=this.options.confirmCancelMessage||'Are you sure you want to stop the tour?';var stopTour=window.confirm(cancelMessage);if(stopTour){this._done('cancel')}}else{this._done('cancel')}};_proto.complete=function complete(){this._done('complete')};_proto.getById=function getById(id){return this.steps.find(function(step){return step.id===id})};_proto.getCurrentStep=function getCurrentStep(){return this.currentStep};_proto.hide=function hide(){var currentStep=this.getCurrentStep();if(currentStep){return currentStep.hide()}};_proto.isActive=function isActive(){return Shepherd.activeTour===this};_proto.next=function next(){var index=this.steps.indexOf(this.currentStep);if(index===this.steps.length-1){this.complete()}else{this.show(index+1,true)}};_proto.removeStep=function removeStep(name){var _this3=this;var current=this.getCurrentStep();this.steps.some(function(step,i){if(step.id===name){if(step.isOpen()){step.hide()}step.destroy();_this3.steps.splice(i,1);return true}});if(current&&current.id===name){this.currentStep=undefined;this.steps.length?this.show(0):this.cancel()}};_proto.show=function show(key,forward){if(key===void 0){key=0}if(forward===void 0){forward=true}var step=isString(key)?this.getById(key):this.steps[key];if(step){this._updateStateBeforeShow();var shouldSkipStep=isFunction(step.options.showOn)&&!step.options.showOn();if(shouldSkipStep){this._skipStep(step,forward)}else{this.trigger('show',{step:step,previous:this.currentStep});this.currentStep=step;step.show()}}};_proto.start=function start(){this.trigger('start');if(this.options.disableScroll){bodyScrollLock.disableBodyScroll()}this.focusedElBeforeOpen=document.activeElement;this.currentStep=null;this._setupActiveTour();this.next()};_proto._done=function _done(event){var index=this.steps.indexOf(this.currentStep);if(Array.isArray(this.steps)){this.steps.forEach(function(step){return step.destroy()})}cleanupSteps(this);this.trigger(event,{index:index});Shepherd.activeTour=null;this._removeBodyAttrs();this.trigger('inactive',{tour:this});if(this.options.disableScroll){bodyScrollLock.clearAllBodyScrollLocks()}this.modal.hide();if(isElement(this.focusedElBeforeOpen)){this.focusedElBeforeOpen.focus()}};_proto._setupActiveTour=function _setupActiveTour(){this._addBodyAttrs();this.trigger('active',{tour:this});Shepherd.activeTour=this};_proto._setupStep=function _setupStep(stepOptions){stepOptions=_extends({},this.options.defaultStepOptions,stepOptions);return new Step(this,stepOptions)};_proto._skipStep=function _skipStep(step,forward){var index=this.steps.indexOf(step);var nextIndex=forward?index+1:index-1;this.show(nextIndex,forward)};_proto._setTooltipDefaults=function _setTooltipDefaults(){tippy.setDefaultProps(defaults)};_proto._updateStateBeforeShow=function _updateStateBeforeShow(){if(this.currentStep){this.currentStep.hide()}if(!this.isActive()){this._setupActiveTour()}};_proto._setTourID=function _setTourID(){var tourName=this.options.tourName||'tour';var uuid=uniqueId$1();this.id=tourName+"--"+uuid};_proto._addBodyAttrs=function _addBodyAttrs(){document.body.setAttribute("data-"+this.classPrefix+"shepherd-active-tour",this.id);document.body.classList.add(this.styles.active.trim())};_proto._removeBodyAttrs=function _removeBodyAttrs(){document.body.removeAttribute("data-"+this.classPrefix+"shepherd-active-tour");document.body.classList.remove(this.styles.active.trim())};return Tour}(Evented);_extends(Shepherd,{Tour:Tour,Step:Step});return Shepherd}));function Onboarding(params){let self=this;self.params=params;self.tour=new Shepherd.Tour({defaultStepOptions:{cancelIcon:{enabled:true},},scrollTo:{behavior:'auto',block:'center'},useModalOverlay:true,onClose:params.onClose});params.steps.forEach(function(step,i){let buttons_params=[{action(){return this.back()},classes:'prev-step'},{action(){return false},classes:'step-count',text:`<span>${i}</span>/${params.steps.length-1}`},{action(){return this.next()},classes:i===params.steps.length-1?'last-step':'next-step',text:i===params.steps.length-1?s3.loc('DONE'):''}];if(i===0){buttons_params=[{action(){return this.next()},classes:'next-step welcome-next-step',text:s3.loc('LP_WELCOME_BTN_TEXT')}]}self.tour.addStep({title:step.title,text:i===0?step.text.replace('%s',params.steps.length-1):step.text,beforeShowPromise:step.beforeShowPromise,attachTo:step.attachTo,arrow:false,buttons:buttons_params,id:`step_${i+1}`})});self.start=function(timeout,force,days){let self=this;let t=timeout?timeout:800;if(!self.params.hasOwnProperty('cookie_name')){console.error('Required cookie_name parameter not found');return}let cookie_name=self.params.cookie_name;let old_cookie_name=self.params.cookie_name+"_"+VER_ID;if(util.readCookie(old_cookie_name)&&!util.readCookie(cookie_name)){self.createCookie(cookie_name,1,days)}if((!isStaffUser&&!util.readCookie(cookie_name))||force){setTimeout(function(){self.tour&&self.tour.show()},t);self.createCookie(cookie_name,1,days)}};self.createCookie=function(cookie_name,value,days){if(days){util.createCookie(cookie_name,value,days)}else{util.createCookie(cookie_name,value)}}}var s3={contentDiv:null,lastContentUrl:null,loaded_scripts:[],keyFilter:function(selector,def,callback){var self=this;$(selector).each(function(){var obj=$(this);obj.keypress(function(e){if(e.which==0||e.which==46||e.keyCode==13)return true;var isDigit=e.which>=48&&e.which<=57;var isBack=e.which==8;if(!isDigit&&!isBack)return false}).keyup(function(e){if(callback)callback(obj)}).blur(function(){if(obj.val()==''||self.getVal(obj)==0){obj.val(def);if(callback)callback(obj)}}).keydown(function(e){if(e.keyCode==13){}})})},getVal:function(obj){var v=$(obj).val();v=parseFloat(v);if(v)return v;return 0},getInt:function(num,def){if(!def)def=0;return(parseInt(num,10)?parseInt(num,10):def)},getStr:function(str,def){if(!def)def='';return(str?str:def)},loc:function(key,data){var value;if(window[key]&&typeof window[key]=="string"){value=window[key]}else if(window['JS_'+key]&&typeof window['JS_'+key]=="string"){value=window['JS_'+key]}else{value=key}if(!data){return value}$.each(data,function(k,v){var re=new RegExp('\\$\\{'+k+'\\}','g');value=value.replace(re,v)});return value},showInnerHtml:function(){var p=this.getContentDiv().innerHTML;var popup=new PopupWindow('a');popup.x=200;popup.y=50;popupController.showPopup(popup);popupController.setLastPopupContent("<textarea style='width:700px;height:400px;padding:10px;border: 1px solid black'>"+p+"</textarea>")},getContentDiv:function(){if(!this.mainContentDiv){this.contentDiv=document.getElementById('divContent')}return this.contentDiv},dublicateObject:function(obj,tagName,containerID,url,before,func){var e=util.getElement(obj,tagName);if(selector.taken(e,obj))return false;var container;if(containerID=='UL'||containerID=='DIV'||containerID=='TABLE'){container=util.getParent(e,containerID)}else{container=util.getObject(containerID)}if(!container)return false;var tmpObject=util.makePostRequest(url,'');s3.drawReturnedElement(container,tagName,util.getElementFromText(tmpObject.text,tagName),obj,before);if(typeof func=="function")func()},drawReturnedElement:function(container_obj,obj_tagname,dst_obj,src_obj,before,onDomAfterChanged,onDomBeforeChanged){var result=src_obj,beforeResult=false,position=Number(before);if(isNaN(position)){position=0}if(typeof onDomBeforeChanged=="function"){beforeResult=onDomBeforeChanged(src_obj.parentNode)}if(container_obj&&dst_obj){if(!src_obj){if(position==1){var tmp=util.getFirstChild(container_obj,obj_tagname);result=tmp?container_obj.insertBefore(dst_obj,tmp):container_obj.appendChild(dst_obj)}else{result=container_obj.appendChild(dst_obj)}}else{src_obj=util.getElement(src_obj,obj_tagname);if(position==-1){result=src_obj.parentNode.insertBefore(dst_obj,src_obj.nextSibling)}else{result=src_obj.parentNode.insertBefore(dst_obj,src_obj);if(position==0&&result!=src_obj){util.detachElement(src_obj)}}}fadeController.init(dst_obj);if(typeof onDomAfterChanged=="function"){onDomAfterChanged(dst_obj,beforeResult)}}$(result).S3ChangeControls();return result},getObjectId:function(obj){var matches=obj.id.match(/[a-z_]+(\d+)/);if(matches[1]){return matches[1]}return false},bulkSize:function(id){if(id==undefined){id=""}var l=$(".pLength"+id).val(),w=$(".pWidth"+id).val(),h=$(".pHeight"+id).val();var bulk=l*w*h/1000/ 1000 /1000;if(!bulk){bulk=0}else if(bulk<0.000001){bulk=bulk.toFixed(9).replace(/0+$/,'')}$(".pBulk"+id).val(bulk)},editObject:function(obj,tagName,containerID,url,onDomAfterChanged,before,onDomBeforeChanged,callback,params,onUpdate){var e=util.getElement(obj,tagName);if(selector.taken(e,obj))return false;var container;if(containerID=='UL'||containerID=='DIV'||containerID=='TABLE'||containerID=='TBODY'){container=util.getParent(e,containerID)}else{container=util.getObject(containerID)}if(!container)return false;var objTagName=(obj?obj.tagName:null);var self=this;openAjaxForm(url,function(r){s3.drawReturnedElement(container,tagName,util.getElementFromText(r.text,tagName),obj,before,onDomAfterChanged,onDomBeforeChanged);popupController.closeLastPopup();$(document).find("script").not('.no-reload').each(function(){try{var name;if(name=$(this).attr("name")){if(!self.loaded_scripts[name]){self.loaded_scripts[name]=true;eval($(this).html())}}else{if($(this).attr('id')==undefined){eval($(this).html())}}}catch(e){console.error(e,this)}})},function(){if(typeof callback=='function'){callback()}},function(r){var p=popupController.getLastPopup();if(!p.updateArgs){p.updateArgs=[container,tagName,util.getElementFromText(r.text,tagName),obj,before,onDomAfterChanged]}if(obj){p.updateArgs[2]=util.getElementFromText(r.text,p.updateArgs[1]);if(!p.updateArgs[3]){p.updateArgs[3]=$(obj).find('.objectEdit').get(0)}obj=s3.drawReturnedElement.apply(s3,p.updateArgs);p.updateArgs[3]=util.getFirstChild(obj,objTagName)}if(typeof onUpdate=='function'){onUpdate()}},params);return false},updateObject:function(obj,tagName,containerID,url,func){var container,before=arguments[5],e=util.getElement(obj,tagName);if(containerID=='UL'||containerID=='DIV'||containerID=='TABLE'){container=util.getParent(e,containerID)}else{container=util.getObject(containerID)}if(!container)return false;var r=util.makeGetRequest(url);if(r.error){s3.alertHTML(r.text);return false}s3.drawReturnedElement(container,tagName,util.getElementFromText(r.text,tagName),obj,before,func);return false},updateObjectPost:function(obj,tagName,containerID,url,func,parameters){var container,before=arguments[5],e=util.getElement(obj,tagName);if(containerID=='UL'||containerID=='DIV'||containerID=='TABLE'){container=util.getParent(e,containerID)}else{container=util.getObject(containerID)}if(!container)return false;var r=util.makePostRequest(url,parameters);if(r.error){s3.alertHTML(r.text);return false}s3.drawReturnedElement(container,tagName,util.getElementFromText(r.text,tagName),obj,before,func);return false},viewObject:function(obj,tagName,containerID,url,urlUpdate){var self=this;var e=util.getElement(obj,tagName);var container;if(containerID=='UL'||containerID=='DIV'||containerID=='TABLE'){container=util.getParent(e,containerID)}else{container=util.getObject(containerID)}if(!container)return;var onClose;if(urlUpdate){onClose=function(){self.updateObject(obj,tagName,containerID,urlUpdate,null)}}else{onClose=false}openAjaxForm(url,false,onClose,false)},customizableConfirm:function(msg,func,obj,settings={}){let confirm=document.querySelector('#customizable_confirm');let confirmBody=confirm.querySelector('.body');let btnSubmit=confirm.querySelector('.submit');let btnClose=confirm.querySelector('.close');let isAlert=settings.isAlert?settings.isAlert:false;btnSubmit.id='';settings.btnName=settings.btnName?settings.btnName:s3.loc('YES');if(!confirm||!confirmBody){return false}confirmBody.innerHTML=msg;const confirmTitleWrapper=confirm.querySelector('.title-wrapper');if(confirmTitleWrapper){const confirmTitle=confirmTitleWrapper.querySelector('.title');if(confirmTitle&&settings.title){confirmTitle.innerHTML=settings.title}else if(confirmTitle&&isAlert){confirmTitle.innerHTML=s3.loc('JS_NOTE')}else{confirmTitleWrapper.remove()}}else if(confirmTitleWrapper){confirmTitleWrapper.remove()}if(btnSubmit&&!isAlert){btnSubmit.onclick=func;btnSubmit.id=settings.btnClass?settings.btnClass:'success';if(settings.btnName){btnSubmit.innerHTML=settings.btnName}}else if(isAlert){btnSubmit.remove()}if(btnClose&&isAlert){btnClose.innerHTML=s3.loc('JS_CLOSE')}let popup=new PopupWindow('customizable_confirm');popup.center=true;popup.modal=true;popup.caller=obj;popupController.showPopup(popup);if(popup.obj){util.centerElement(popup.obj)}},confirm:function(msg,func,obj,onClose){var confirm_message=document.getElementById('confirm_message');if(!confirm_message)return false;var cf=document.getElementById('confirm');if(cf.style.display=="block"){return false}confirm_message.innerHTML=msg;var confirm_submit=document.getElementById('confirm_submit');if(!confirm_submit)return false;confirm_submit.onclick=func;var popup=new PopupWindow('confirm');popup.center=true;popup.modal=true;popup.caller=obj;popupController.showPopup(popup);if(popup.obj)util.centerElement(popup.obj);if(onClose!==undefined){popup.onClose=onClose}confirm_submit.focus()},cropperConfirm:function(msg,func,obj){var confirm_message=document.getElementById('cropper_confirm_message');if(!confirm_message)return false;confirm_message.innerHTML=msg;var confirm_submit=document.getElementById('cropper_confirm_submit');if(!confirm_submit)return false;confirm_submit.onclick=func;var popup=new PopupWindow('cropper_confirm');popup.center=true;popup.modal=true;popup.caller=obj;popupController.showPopup(popup);if(popup.obj)util.centerElement(popup.obj);confirm_submit.focus()},prompt:function(title,filename,func,obj){var prompt_title=document.getElementById('prompt-title');if(!prompt_title)return false;prompt_title.innerHTML=title;var prompt_input=document.getElementById('prompt-input');if(!prompt_input)return false;$(prompt_input).val(filename);var prompt_submit=document.getElementById('prompt-submit');if(!prompt_submit)return false;prompt_submit.onclick=func;var popup=new PopupWindow('prompt');popup.center=true;popup.modal=true;popup.caller=obj;popupController.showPopup(popup);if(popup.obj)util.centerElement(popup.obj);prompt_submit.focus()},confirmGreen:function(msg,func,obj,style='green'){var confirm_message=document.getElementById('confirm_green_message');if(!confirm_message)return false;confirm_message.innerHTML=msg;var confirm_submit=document.getElementById('confirm_green_submit');if(!confirm_submit)return false;confirm_submit.classList.add(style);confirm_submit.onclick=func;var popup=new PopupWindow('confirm_green');popup.center=true;popup.modal=true;popup.caller=obj;popupController.showPopup(popup);if(popup.obj)util.centerElement(popup.obj);confirm_submit.focus()},lpConfirm:function(msg,func,obj,onClose){var confirm_message=document.getElementById('lp_confirm_message');if(!confirm_message)return false;confirm_message.innerHTML=msg;var confirm_submit=document.getElementById('lp_confirm_submit');if(!confirm_submit)return false;confirm_submit.onclick=func;var popup=new PopupWindow('lp_confirm');popup.center=true;popup.modal=true;popup.caller=obj;popupController.showPopup(popup);if(popup.obj)util.centerElement(popup.obj);if(onClose!==undefined){popup.onClose=onClose}confirm_submit.focus()},alert:function(msg,func,id){var a=util.getObject('alert'),alert_cookie_name='s3_alert_skip_';if(util.getComputedStyle(a,'display')!='none'){return true}var alert_skip="",alert_message=document.getElementById('alert_message');if(id!==undefined){alert_skip="<br/><span style='font-weight: normal;'><label><input type='checkbox' class='skipAlert' data-id='"+id+"' /> "+s3.loc('JS_DONT_SHOW_THIS_MESSAGE_AGAIN')+"</label></span>";var alert_skip_enabled=util.readCookie(alert_cookie_name+id);if(alert_skip_enabled){return true}}if(!alert_message)return false;alert_message.innerHTML=msg+alert_skip+' ';var skip_alert=document.querySelector(".skipAlert");if(skip_alert){skip_alert.addEventListener('click',function(e){var id=e.target.dataset.id;util.createCookie(alert_cookie_name+id,1,30)})}var popup=new PopupWindow('alert');popup.center=true;popup.modal=true;if(func)popup.onClose=func;popupController.showPopup(popup);window.setTimeout(function(){try{var f=popup.obj.getElementsByClassName('s3-btn');if(f.length){f[0].focus()}}catch(e){}},10);return true},getStringHash:function(msg){var hash=0,i,chr,len;if(msg.length==0)return hash;for(i=0,len=msg.length;i<len;i++){chr=msg.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash|=0}return hash},formatError:function(text,details){if(details){text+="<hr/><div class='xhr-error-details'>"+details+"</div>"}return text},alertHTML:function(msg,func,id){return s3.alert((msg?msg.replace(/[\n]/g,"<br/>\n"):s3.loc('JS_ERROR_UNKNOWN')),func,id)},applyActionWithCondition:function(func,condition,msg,interrupt){if(!condition){if(interrupt)return false;func();return true}s3.alertHTML(msg,func);return true},applySelectedAction:function(selectNode,funcSetIds){try{if(typeof funcSetIds=="function")funcSetIds();if(selectNode&&selectNode.tagName=='SELECT'&&selectNode.selectedIndex>0){var v=selectNode.options[selectNode.selectedIndex].value;if(v){eval(v)}}}catch(err){alert(err.name+"\n"+err.fileName+": Line "+err.lineNumber+":"+err.message)}},getBatchOpInfo:function(src_obj,objTagName,objIdPrefix,url,func,targetTagName,props){if(!src_obj)return false;var ids=[],reId=new RegExp(objIdPrefix+"(\\d+)"),dstObjs=[];var objs=src_obj.getElementsByTagName(objTagName);if($(src_obj).attr('data-ids')!=undefined){dstObjs=objs;ids=$(src_obj).attr('data-ids');return{url:url,dstObjs:dstObjs,ids:ids}}var i;if(props&&targetTagName){targetTagName=targetTagName.toUpperCase();var target,hasProp=true;for(i=0;i<objs.length;++i,hasProp=true){try{target=objs[i].getElementsByTagName(targetTagName)[0];if(target){for(var a in props){if(target[a]!=props[a]){hasProp=false;break}}if(hasProp){dstObjs.push(objs[i])}}}catch(err){alert(err.name+"\n"+err.fileName+": Line "+err.lineNumber+":"+err.message)}}}else{dstObjs=objs}for(i=0;i<dstObjs.length;++i){var id;if(dstObjs[i].id&&(id=dstObjs[i].id.replace(reId,'$1'))){ids.push(id)}}ids=ids.join(',');return{url:url,dstObjs:dstObjs,ids:ids}},updateObjects:function(src_obj,objTagName,objIdPrefix,url,func,targetTagName,props,folder_id){if(!src_obj)return false;var result=false;var batchOpInfo=s3.getBatchOpInfo(src_obj,objTagName,objIdPrefix,url,func,targetTagName,props),params;if(batchOpInfo.dstObjs.length>0&&batchOpInfo.ids&&batchOpInfo.ids.length>0){if(typeof folder_id=='number'){params='from_folder_id='+folder_id}else{params='ids='+batchOpInfo.ids}var r=util.makePostRequest(url,params);if(!r.error){if(func)func();if(popupController.getLastPopup())popupController.reloadLastPopup();else s3.reloadVisibleContent();result=true}}if(!batchOpInfo.ids.length){s3.alert(s3.loc('JS_NO_OBJECTS_CHOSEN_ERROR'));return}if(result==false){popupController.closeLastPopup();s3.alert(s3.loc('JS_GROUP_OPERATIONS_ERROR_MESSAGE'))}return result},cronJobs:function(src_obj,objTagName,objIdPrefix,url,func,targetTagName,props,withConfirm,folder_id,form_param){if(typeof src_obj=='string')src_obj=util.getObject(src_obj);if(!src_obj)return false;var f=function(){var result=false;var batchOpInfo=s3.getBatchOpInfo(src_obj,objTagName,objIdPrefix,url,func,targetTagName,props),params=null;if($(src_obj).attr('data-form')!=undefined){var searchForm=$(src_obj).attr('data-form');params=formcontents(document.forms[searchForm])}else if(typeof folder_id=='number'){params='folder_id='+folder_id}else if(batchOpInfo.dstObjs.length&&batchOpInfo.ids&&batchOpInfo.ids.length>0){params='ids='+batchOpInfo.ids}if(form_param){params+='&form_param='+form_param}if(params){if(withConfirm){popupController.closeLastPopup()}var r=util.makePostRequest(url,params);if(func)func();var d;if(r.code==2){util.msg(s3.loc('JS_COMPLETE'),'green');d=popupController.getLastPopup();if(d)popupController.reloadLastPopup(null);else s3.reloadContent()}else{if(!r.error){var popup=new PopupWindow('ajaxPopupWindow_'+popupController.popups.length);popup.drag=true;popup.modal=true;popup.center=true;popup.created=true;var obj=document.createElement('DIV');obj.id=popup.elementId;obj.style.position='absolute';obj.style.display='none';obj.innerHTML=r.text;document.body.appendChild(obj);popupController.showPopup(popup);popup.url=url;popup.postParams=params;popup.onAfterReload=function(){d=popupController.getPreviousPopup();if(d)popupController.reloadPreviousPopup(null);else s3.reloadContent();if(popup.reloadedText=='OK')popupController.closeLastPopup()};d=popupController.getPreviousPopup();if(d)popupController.reloadPreviousPopup(null);else s3.reloadContent()}}result=true}if(!batchOpInfo.ids.length&&!folder_id){if(withConfirm){popupController.closeLastPopup()}s3.alert(s3.loc('JS_NO_OBJECTS_CHOSEN_ERROR'),function(){if(popupController.getLastPopup())popupController.reloadLastPopup();else s3.reloadVisibleContent()},);return}if(result===false){if(withConfirm){popupController.closeLastPopup()}s3.alert(s3.loc('JS_GROUP_OPERATIONS_ERROR_MESSAGE'),function(){if(popupController.getLastPopup())popupController.reloadLastPopup();else s3.reloadVisibleContent()},)}};if(withConfirm){s3.confirm(s3.loc('JS_CONFIRM_DELETE'),f)}else{f()}},deleteObjectsOrders:function(src_obj,objTagName,objIdPrefix,url,func,targetTagName,props,msg){if(!src_obj)return false;var f=function(){var result=false;var batchOpInfo={};if(OrderController.folder_id===0){dstObjs=src_obj.getElementsByTagName(objTagName);batchOpInfo={url:url,dstObjs:dstObjs,ids:-1}}else{batchOpInfo=s3.getBatchOpInfo(src_obj,objTagName,objIdPrefix,url,func,targetTagName,props)}if(batchOpInfo.dstObjs.length&&batchOpInfo.ids&&(batchOpInfo.ids.length>0||batchOpInfo.ids==-1)){popupController.closeLastPopup();util.makePostRequest(url,'ids='+batchOpInfo.ids);for(var i=0;i<batchOpInfo.dstObjs.length;++i){window.setTimeout(util.detachElement,10,batchOpInfo.dstObjs[i])}if(func)func();s3.reloadVisibleContent(false);result=true}if(batchOpInfo.ids.length==0&&batchOpInfo.ids!=-1){popupController.closeLastPopup();s3.alert(s3.loc('JS_NO_OBJECTS_CHOSEN_ERROR'));return}if(result==false){popupController.closeLastPopup();s3.alert(s3.loc('JS_GROUP_OPERATIONS_ERROR_MESSAGE'))}};s3.confirm((msg?msg:s3.loc('JS_CONFIRM_DELETE')),f)},deleteObjects:function(src_obj,objTagName,objIdPrefix,url,func,targetTagName,props,msg){if(!src_obj)return false;var f=function(){var result=false;var batchOpInfo=s3.getBatchOpInfo(src_obj,objTagName,objIdPrefix,url,func,targetTagName,props);if(batchOpInfo.dstObjs.length&&batchOpInfo.ids&&(batchOpInfo.ids.length>0||batchOpInfo.ids==-1)){util.makePostRequest(url,'ids='+batchOpInfo.ids+'&context='+batchOpInfo.context);for(var i=0;i<batchOpInfo.dstObjs.length;++i){window.setTimeout(util.detachElement,10,batchOpInfo.dstObjs[i])}popupController.closeLastPopup();if(func)func();s3.reloadVisibleContent(false);result=true}if(batchOpInfo.ids.length==0&&batchOpInfo.ids!=-1){popupController.closeLastPopup();s3.alert(s3.loc('JS_NO_OBJECTS_CHOSEN_ERROR'));return}if(result==false){popupController.closeLastPopup();s3.alert(s3.loc('JS_GROUP_OPERATIONS_ERROR_MESSAGE'))}};s3.confirm((msg?msg:s3.loc('JS_CONFIRM_DELETE')),f)},deleteObject:function(obj,objTagName,url,func,msg,msgError,settings={}){obj=util.getElement(obj,objTagName);if(!obj)return false;if(selector.focused()){util.detachElement(obj);return}var f=function(){if(util.touchUrl(url)){util.detachElement(obj);popupController.closeLastPopup();popupController.childsPopupsHasChanged();if(func)func()}else{popupController.closeLastPopup();s3.alertHTML((msgError?msgError:s3.loc('JS_ERROR')))}};if(Object.keys(settings).length!==0){s3.customizableConfirm((msg?msg:s3.loc('JS_CONFIRM_DELETE')),f,false,settings)}else{s3.confirm((msg?msg:s3.loc('JS_CONFIRM_DELETE')),f)}},touchAndReload:function(url,msg,withoutConfirm,smallMsg,settings={}){if(withoutConfirm){util.touchUrl(url);s3.reloadVisibleContent()}else{func=()=>{util.touchUrl(url);popupController.closeLastPopup();s3.reloadVisibleContent()};if(Object.keys(settings).length!==0){s3.customizableConfirm((msg?msg:s3.loc('JS_CONFIRM_DELETE')),func,false,settings)}else{s3.confirm((msg?msg:s3.loc('JS_CONFIRM_DELETE')),func)}}if(smallMsg){util.msg(smallMsg)}},editProperties:function(url,popup,noSetContent,reloadLastPopup,outfunc,reloadOnClose){var func,onClose;if(!outfunc){if(popup){func=function(r){if(r.text&&!noSetContent){popupController.setPreviousPopupContent(r.text,r.url)}popupController.closeLastPopup();if(reloadLastPopup){popupController.reloadLastPopup()}}}else{func=function(r){s3.setContent(r.text,r.url);popupController.closeLastPopup()}}}else{func=outfunc}if(reloadOnClose){onClose=function(){popupController.reloadLastPopup();var PreviousPopup=popupController.getPreviousPopup();if(PreviousPopup){PreviousPopup.reload()}else{s3.reloadContent()}}};openAjaxForm(url,func,onClose)},editPropertiesReloadContent:function(url){var func;func=function(r){popupController.closeLastPopup();s3.reloadVisibleContent()};openAjaxForm(url,func)},editQueryParams:function(url){var func=function(){popupController.closeLastPopup();popupController.closeLastPopup();popupController.reloadLastPopup()};openAjaxForm(url,func,false)},viewPlugin:function(obj,tagName,url,callback){if(!popupController.getLastModalPopup()){this.loadContent(url,callback)}else{var e=util.getElement(obj,tagName);if(selector.taken(e,obj)){return false}var func=function(){popupController.reloadLastPopup()};openAjaxForm(util.urlParamReplace(url,"popup",1),false,func)}},changePage:function(p,max,type,tab){if(p<1){p=0}else{if(max<p){p=max}}if(type!=undefined){var cookie_name="last_page_for_type_"+type;if(p==0){util.eraseCookie(cookie_name)}else{util.createCookie(cookie_name,p,7)}}var pName="p";if(tab){pName+="["+tab+"]"}var url;if(!popupController.getLastModalPopup()){url=util.urlParamReplace(this.lastContentUrl,pName,p);if(tab){url=util.urlParamReplace(url,"tab",tab)}this.loadContent(url)}else{url=util.urlParamReplace(popupController.getLastPopup().url,pName,p);if(tab){url=util.urlParamReplace(url,"tab",tab)}popupController.reloadLastPopup(url)}},reloadVisibleContent:function(url){if(!popupController.getLastModalPopup()){if(!url)url=this.lastContentUrl;s3.loadContent(url)}else{popupController.reloadLastPopup(url?util.urlParamReplace(url,"popup",1):false)}},addPlugin:function(url){var func_post=function(r){s3.setContent(r.text,r.url);popupController.closeLastPopup()};var func_close=null;if(popupController.getLastModalPopup()){func_post=function(r){popupController.setLastPopupContent(r.text,r.url)};func_close=function(){popupController.reloadLastPopup()}}openAjaxForm(url,func_post,func_close)},loadContent:function(url,callback){if(!url){return}var self=this,main_page_url='/-/cms/v1/main/?'+access;this.offEvents();historyController.loadInProgress=true;if(!treeStorage.updated){self.getContentDiv();if(self.contentDiv&&url){url=util.urlParamReplace(url,'rnd',Math.round(Math.random()*10000));if(url.includes('/-/cms/v2/')){ReactWidgetsController.route.loadContent(url);historyController.loadInProgress=false;self.lastContentUrl=url}else{Preloader.show({mini:true});var contentLoadDef=$.get(url);contentLoadDef.then(function(data,textStatus,jqXHR){var request=util.parseRequestResult(jqXHR);if(!request.error){self.setContent(request.text,url);if(self.callBacks&&self.callBacks.length){self.callBacks.map(function(el){if(url.indexOf(el.url)>-1&&el.onLoad&&el.onLoad instanceof Function){el.onLoad()}})}if(callback instanceof Function){callback()}}else{s3.alert(s3.loc('JS_LOAD_CONTENT_ERROR_MESSAGE')+url)}if(util.readCookie('s3_upgrades')){$('header.s3-header-new .navbar').find('.s3-btn-blink').removeClass('s3-btn-blink').find('span.s3-ico:first').removeClass('filled')}Preloader.hide();if((!isPartner&&S3_LANG_CODE=='ru'&&!isStaffUser)||(isStaffUser&&!util.readCookie('hide_help'))){ContextHelp._init({url:url,popup:false})}historyController.loadInProgress=false}).fail(function(req){var error_text=JS_LOAD_CONTENT_ERROR_MESSAGE+url;var deny=req.getResponseHeader('X-Reason');if(req.status==503){var l,msg="Сайт на техническом обслуживании.\nПовторите действие через несколько минут.";if(l=document.cookie.match(/lang_id=\d+/g)){if(l[0].split('=')[1]>1){msg="Service Temporarily Unavailable.\nRetry after a few minutes."}}error_text=msg}else if(req.status==500){error_text=s3.loc('JS_ERROR_UNKNOWN')}else if(req.status==403){if(deny=='acl-deny'){error_text=req.text=ACLController.getToolTipContent(req.getResponseHeader('X-Acl').split(';')[0])}else{error_text="Нет доступа.\nВозможно, изменился IP-адрес. Повторите вход в СУ.\nПоследний IP: "+util.readCookie('CMS_IP_'+ver_id)}}else if(req.status==404){error_text="Страница не найдена"}s3.alert(error_text);Preloader.hide();historyController.loadInProgress=false})}if(!historyController.loadByHistory){historyController.setAnchor(url)}}}else{pageController.saveStructureFirstAlert()}},loadPopupContent:function(url,callback){var self=this;historyController.loadInProgress=true;if(!treeStorage.updated){if(url){var popup=popupController.getLastPopup();if(popup){Preloader.show({hideClass:'s3-preloader-hide',to:$(popup.obj),local:true,mini:true})}url=util.urlParamReplace(url,'rnd',Math.round(Math.random()*10000));var contentLoadDef=$.get(url);contentLoadDef.then(function(data,textStatus,jqXHR){var request=util.parseRequestResult(jqXHR);if(!request.error){if(this.onReload&&typeof this.onReload=='function'){this.onReload()}popup.setContent(request.text,request.url);popup.reloadedText=request.text;if(this.onAfterReload&&typeof this.onAfterReload=='function'){this.onAfterReload()}}else{s3.alert(s3.loc('JS_LOAD_CONTENT_ERROR_MESSAGE')+url)}Preloader.hide()}).fail(function(){s3.alert(JS_LOAD_CONTENT_ERROR_MESSAGE+url);Preloader.hide()})}}else{pageController.saveStructureFirstAlert()}historyController.loadInProgress=false},searchCode:function(){var code=document.getElementsByName("eval-code");if(code){for(var i=0;i<code.length;i++){if(code[i]){var evalit=true;for(var obj=code[i].parentNode;obj&&obj!=this.contentDiv;obj=obj.parentNode){if(obj.nodeName=="TEXTAREA"){evalit=false;break}}if(evalit){eval(code[i].value);util.detachElement(code[i])}}}}},addHelpLink:function(url,content){if(!url)return;if(help_on){help_key=url.replace(/\?.*$/,'');var help_html='<span id="help_container"><span id="'+help_key+'">';if(help_urls[help_key]){help_html+=' <a class="ins" target="_blank" href="'+help_urls[help_key]+'"><span class="s3-ico i-help-svg"></span>'+s3.loc('JS_INSTRUCTION')+'</a>'}if(isStaffUser&&server_id=='1'){help_html+=' <img onclick="s3.editObject(this, \'SPAN\', \'help_container\', \'/-/cms/v1/help/?act=edit&'+S3_ACCESS+'&url='+help_key+'\', function(){document.location=document.location;})" style="cursor: pointer;" title="Редактировать ссылку на help.megagroup.ru" src="/my/s3/images/svg_icons/ic_ol-edit.svg" />'}var t=$('.module-title',content);t.html(t.html()+help_html+'</span></span>')}},setContent:function(text,url){var self=this;tinymceController.removeControls(this.contentDiv);$(this.contentDiv).S3DestroyControls();this.contentDiv.innerHTML=text;ACLController.init();$(this.contentDiv).S3ChangeControls();treeController.init($(this.contentDiv).find('.s3-tree'));s3.clearTooltips();this.searchCode(this.contentDiv);if(url)this.lastContentUrl=url;if(tinyMCE){tinymceController.addControls(this.contentDiv)}else{ckeditorController.addControls(this.contentDiv)}if(!(typeof url=='string'&&/\/my\/s3\/seo/.test(url))&&!(typeof url=='string'&&/\/my\/s3\/site_settings/.test(url))&&!(typeof url=='string'&&/\/my\/s3\/data\/menu/.test(url))&&!(typeof url=='string'&&/\/my\/s3\/data\/lp/.test(url))&&!popupController.getLastPopup()){util.focusFirstVisibleControl(this.contentDiv)}$(document).find("script").each(function(){try{if(name=$(this).attr("name")){if(!self.loaded_scripts[name]){self.loaded_scripts[name]=true;eval($(this).html())}}else{if($(this).attr('id')==undefined){eval($(this).html())}}}catch(e){console.error(e,this)}})},reloadContent:function(url,params){if(!url){url=s3.lastContentUrl}if(params){for(key in params){url=util.urlParamReplace(url,key,params[key])}}s3.loadContent(url)},sendMessageToWindow:function(eventName,dataObject,windowObject){if(!eventName||!dataObject)return false;if(!windowObject)windowObject=window;const targetOrigin=window.location.origin;const data={event:eventName,params:dataObject,};windowObject.postMessage(JSON.stringify(data),targetOrigin)},initEmitterPostMessage:function(windowObject){const targetOrigin=window.location.origin;if(!windowObject)windowObject=window;windowObject.addEventListener('message',function(event){if(event.origin!==targetOrigin||!event.data){return}try{const eventData=JSON.parse(event.data);const eventName=eventData.event;const eventParams=eventData.params;const newEvent=new CustomEvent(eventName,{detail:eventParams,});windowObject.dispatchEvent(newEvent)}catch(e){}})},openModalPopup:function(url,reloadPreviousOnClose,postParams){var popup=new PopupWindow('ajaxPopupWindow_'+popupController.popups.length);popup.url=url;popup.postParams=postParams;popup.drag=true;popup.modal=true;popup.center=true;var is_cron_task=url.indexOf('is_cron_task');if(reloadPreviousOnClose)popup.onClose=function(){popupController.reloadLastPopup(false);if(is_cron_task!=-1){setTimeout(function(){S3ContextMenuController.openContextMenu('.cron-tasks-list')},10)}};popupController.showPopup(popup);return popup},getElementsOrder:function(container,elementTagName,elementPrefix){container=util.getObject(container);var result={ids:[],levels:[]};var elements=container.getElementsByTagName(elementTagName);var parent;var level;for(var i=0;i<elements.length;i++){if(elements[i].id.substring(0,elementPrefix.length)==elementPrefix){result.ids.push(elements[i].id.substring(elementPrefix.length));parent=elements[i].parentNode;level=0;while(parent&&parent!=container){parent=parent.parentNode;level++}result.levels.push(level)}}return result},saveElementsOrder:function(containerId,saveMessageContainer,tagName,prefix,url){var result=this.getElementsOrder(containerId,tagName,prefix);if(result.ids.length>0){var data="ids="+encodeURIComponent(result.ids.join())+"&levels="+encodeURIComponent(result.levels.join());var r=util.makePostRequest(url,data);if(r.error){util.msg("Error");return false}}$('[id='+saveMessageContainer+']:last').hide();util.msg(s3.loc('JS_SAVED'));return true},getFolderSelector:function(type_id,type_code,plugin_id,query_id,obj){if(plugin_id>0){selector.open(type_code,0,0,obj,function(e){popupController.closeLastPopup();treeController.load('select2',type_id,e,obj,function r(i){folderController.save2query(i,query_id)})})}else{treeController.load('select2',type_id,0,obj,function r(i){folderController.save2query(i,query_id)})}},submitTemplate:function(f){var r=util.makePostRequest("/-/cms/v1/template/?act=editing",getFormData(f));if(!r.error)s3.alert(s3.loc('JS_TEMPLATE_SUCCESSFULY_SAVED'));return false},postContentForm:function(url,f){var r=util.makePostRequest(url,formcontents(f));if(r.error==true){s3.alertHTML(s3.formatError(r.text))}else{s3.setContent(r.text)}return false},savePost:function(url,f){var r=util.makePostRequest(url,formcontents(f));if(r.error==true){s3.alert('Error '+r.text+" "+url)}else{util.msg(s3.loc('JS_SAVED'))}return false},changeEditor:function(url,f,isStaffUser){var isTinyMCE=formcontents(f).indexOf('=tinymce')!==-1?true:false,isCkEditor=formcontents(f).indexOf('=ckeditor')!==-1?true:false;if(isTinyMCE&&isStaffUser){s3.savePostOnConfirmWithReload(url,f,s3.loc('JS_CHANGE_EDITOR_TO_TINYMCE'))}else if(isCkEditor&&(!isStaffUser||isStaffUser)){s3.savePostOnConfirmWithReload(url,f,s3.loc('JS_CHANGE_EDITOR_TO_CKEDITOR'))}else{s3.savePostWithReload(url,f)}return false},savePostOnConfirmWithReload:function(url,f,msg){s3.confirm((msg?msg:JS_SAVE),function(){var r=util.makePostRequest(url,formcontents(f));if(r.error==true){s3.alert('Error '+r.text+" "+url)}else{util.msg(s3.loc('JS_SAVED'));location.reload()}});return false},savePostWithReload:function(url,f){var r=util.makePostRequest(url,formcontents(f));if(r.error==true){s3.alert('Error '+r.text+" "+url)}else{util.msg(JS_SAVED);document.content.reload()}return false},savePostOnConfirm:function(url,f,msg){s3.confirm((msg?msg:JS_SAVE),function(){var r=util.makePostRequest(url,formcontents(f));if(r.error==true){s3.alert('Error '+r.text+" "+url)}else{util.msg(s3.loc('JS_SAVED'))}popupController.closeLastPopup()});return false},reloadPage:function(url){if(!treeStorage.updated){document.location=util.urlParamReplace(url,"r",new Date().getTime())}else{pageController.saveStructureFirstAlert()}},requestJsonApi:function(url){var r=util.makeGetRequest(url);var json=r.text?eval('('+r.text+')'):false;if(!json||json.errno){s3.alertHTML(json.errstr||r.text);return false}return json},openWindow:function(request){var url=false;if(request){request=request+'&'+access;url=util.loadString(request)}window.open(url,"_blank");return false},openQueueSettingsPopup:function(o){var url=o.hasOwnProperty("url")?o.url:null;var formSel=o.hasOwnProperty("formSel")?o.formClass:"form:first";var onQueue=o.hasOwnProperty("onQueue")?o.onQueue:null;if(!url){return}var p=s3.openModalPopup(url);$(p.obj).find(formSel).submit(function(){queueFormData(this,url,onQueue);return false})},alignElementsHeight:function(){var items=arguments,maxHeight=0,itemHeight;setTimeout(function(){for(i=0;i<items.length;++i){itemHeight=$(items[i]).outerHeight(true);if(itemHeight>maxHeight){maxHeight=itemHeight}}for(i=0;i<items.length;++i){$(items[i]).css({'min-height':maxHeight,'opacity':1})}},50)},callBacks:[{url:'/data/image/',onLoad:imagePageOnLoad},{url:'/data/shop2/view.php',onLoad:shop2PageOnLoad}],maps:{Google:function(callback,key){if(s3.maps.Google.prototype._singletonInstance){if(typeof callback=="function"){callback(s3.maps.Google.prototype._singletonInstance)}return s3.maps.Google.prototype._singletonInstance}this.callback=callback;var map_key=key?'&key='+key:'',url='https://maps.googleapis.com/maps/api/js?v=3.exp'+map_key+'&callback=s3.maps.Google.prototype._singletonInstance.init';s3.maps.Google.prototype._singletonInstance=this;$(document.body).append('<script src="'+url+'" type="text/javascript">');this.init=function(){this.gmaps=google.maps;if(typeof this.callback=="function"){this.callback(this)}};this.draw=function(id,center,zoom){this.map=new this.gmaps.Map(document.getElementById(id),{center:new this.gmaps.LatLng(center[0],center[1]),zoom:zoom});var marker=new this.gmaps.Marker({position:new this.gmaps.LatLng(center[0],center[1]),map:this.map,draggable:true});this.marker=marker;this.gmaps.event.addListener(this.map,'click',function(e){marker.setPosition(e.latLng)})};this.getZoom=function(){return this.map.getZoom()};this.getCoordinates=function(){return[this.marker.getPosition().lat(),this.marker.getPosition().lng()]}},Yandex:function(callback,key){if(s3.maps.Yandex.prototype._singletonInstance){if(typeof callback=="function"){callback(s3.maps.Yandex.prototype._singletonInstance)}return s3.maps.Yandex.prototype._singletonInstance}this.callback=callback;var map_key=key?'&apikey='+key:'',url='https://api-maps.yandex.ru/2.1/?lang=ru_RU'+map_key+'&onload=s3.maps.Yandex.prototype._singletonInstance.init';s3.maps.Yandex.prototype._singletonInstance=this;$(document.body).append('<script src="'+url+'" type="text/javascript">');this.init=function(ymaps){this.ymaps=ymaps;if(typeof this.callback=="function"){this.callback(this)}};this.draw=function(id,center,zoom){this.map=new this.ymaps.Map(id,{center:center,zoom:zoom,controls:['smallMapDefaultSet']});var marker=new this.ymaps.Placemark([center[0],center[1]],{content:'text'},{draggable:"true",preset:'islands#redDotIcon'});this.marker=marker;this.map.geoObjects.add(this.marker);this.map.events.add('click',function(e){marker.geometry.setCoordinates(e.get('coords'))});var searchControl=this.map.controls.get('searchControl');if(searchControl){searchControl.options.set('noPlacemark',true);searchControl.events.add('resultselect',function(){searchControl.getResult(searchControl.getSelectedIndex()).then(function(res){marker.geometry.setCoordinates(res.geometry.getCoordinates())})})}};this.getZoom=function(){return this.map.geoObjects.getMap().getZoom()};this.getCoordinates=function(){return this.marker.geometry.getCoordinates()}},showMapWithPoint:function(type,x,y,z,key){this.draw=function(map){map.draw("coordinates",[x,y],z)};if(type=='yandex'){new s3.maps.Yandex(this.draw,key)}else{new s3.maps.Google(this.draw,key)}},editCoordinates:function(type,container,coords){var maps;if(coords){var z=coords.z,xy=coords.xy}else{if(type=='yandex'){maps=new s3.maps.Yandex()}else{maps=new s3.maps.Google()}if(!maps.map||!maps.marker){return false}var z=maps.getZoom(),xy=maps.getCoordinates();if(!xy||!z){return false}}var title=$('#coordinates_title').val();$('.val',container).text(title).append('<br \>'+xy[0]+'<br \>'+xy[1]);$('.x',container).val(xy[0]);$('.y',container).val(xy[1]);$('.z',container).val(z);$('.common',container).val($('#coordinates_common').attr('checked')?1:0);$('.title',container).val(title);$('.text',container).val($('#coordinates_text').val());return true},showYandexMapInFrame:function(x,y,z,site_domain,container){var self=this,p=popupController.getLastPopup();if(p.obj){var iframe=$(p.obj).find('#yandexFrame'),iframeContent=$(p.obj).find('#yandexFrame').get(0).contentWindow,editCoordsBtn=$(p.obj).find('.editCoords');iframe.load(function(){iframeContent.postMessage(JSON.stringify({init:true,origin:document.location.origin,x:x,y:y,z:z}),site_domain);editCoordsBtn.on('click',function(){iframeContent.postMessage(JSON.stringify({getCoords:true,origin:document.location.origin,}),'*')})});if(window.addEventListener){var f=function(event){if($.trim(event.origin)===document.location.origin){var data=JSON.parse(event.data);if(data.setCoords&&data.coords&&event.source){self.editCoordinates('yandex',container,data.coords);popupController.closeLastPopup();window.removeEventListener("message",f,false)}}};window.addEventListener('message',f,false)}}}},clipboard:function(selector,onsuccess){if(selector){var clipboard=new Clipboard(selector);if(typeof onsuccess=="function"){clipboard.on('success',function(){onsuccess()})}}},setPerPage:function(type,per_page,prevPopupReload){if(type&&per_page){let url='/-/cms/v2/main/per-page?'+window.access,response=fetch(url,{method:'POST',headers:{'Content-type':'application/json',},body:JSON.stringify({'type':type,'per_page':per_page})}).then(function(response){return response.json()});response.then(function(response){if(response.error){console.warn(response.error)}else{if(popupController.getLastModalPopup()){var popup=popupController.getLastModalPopup(),url=util.urlParamReplace(popup.url,'p',0);url=util.urlParamReplace(url,'limit','');s3.reloadVisibleContent(url);if(prevPopupReload&&popupController.getPreviousPopup()){popupController.reloadPreviousPopup()}}else{var url=util.urlParamReplace(s3.lastContentUrl,'p',0);url=util.urlParamReplace(url,'limit','');s3.reloadVisibleContent(url)}}})}},setPerPageCustomController:function(func,per_page){if(typeof func=='function'){func(per_page)}},setPerPageEnter:function(e){var keyCode=e.keyCode||e.which;if(keyCode=='13'){$(e.target).next('[onclick]').click()}},initHelp:function(){var self=this;let steps=[{title:s3.loc('WELCOME'),text:s3.loc('DASHBOARD_WELCOME_TEXT'),attachTo:{on:'center'}},{title:s3.loc('DASHBOARD_HELP_STEP1_TITLE'),text:s3.loc('DASHBOARD_HELP_STEP1_BODY'),attachTo:{element:'.onboarding-step1-element',on:'bottom'},},{title:s3.loc('DASHBOARD_HELP_STEP2_TITLE'),text:s3.loc('DASHBOARD_HELP_STEP2_BODY'),attachTo:{element:'.onboarding-step2-element',on:'bottom'}},{title:s3.loc('DASHBOARD_HELP_STEP3_TITLE'),text:s3.loc('DASHBOARD_HELP_STEP3_BODY'),attachTo:{element:'.onboarding-step3-element',on:'bottom'}}];if(!isPartner){const newStep={title:s3.loc('DASHBOARD_HELP_STEP4_TITLE'),text:s3.loc('DASHBOARD_HELP_STEP4_BODY'),attachTo:{element:'.onboarding-step4-element',on:'bottom_corner'}};steps=[...steps,newStep]}self.onboarding=new Onboarding({cookie_name:'dashboard_training_completed',steps:steps});if(window.innerWidth>767){self.showHelp(null,null,3650)}},showHelp:function(timeout,force,days){var self=this;if(self.onboarding){self.onboarding.start(timeout,force,days)}},};function selectFormImage(obj,imageId,callback){var func=function(r){if(obj){var a=util.getFirstChild(obj,"IMG");if(a){a.src=uploader.thumbnail}a=util.getFirstChild(obj,"INPUT");if(a)a.value=r}popupController.closeLastPopup();if(typeof callback=='function'){callback()}};var extra_get=imageId?'image_id='+imageId:'';extra_get+='&folder_id='+treeController.current_folder_id;selector.open('image',0,0,obj,func,extra_get)}function selectWatermarkPreviewImage(obj,imageId){var formWrapper=false;if(obj){formWrapper=$(obj).parents('form:first').get(0)}else if($(popupController.getLastPopup().obj).find('form [name=watermark_on]').size()){formWrapper=$(popupController.getLastPopup().obj).find('form').get(0)}else if($(popupController.getPreviousPopup().obj).find('form [name=watermark_on]').size()){formWrapper=$(popupController.getPreviousPopup().obj).find('form').get(0)}if(formWrapper&&formWrapper.watermark_on&&formWrapper.watermark_on.value>0){var func=function(r){popupController.closeLastPopup();if(formWrapper){if(popupController.getLastPopup().url.indexOf('watermark-preview')>-1){popupController.getLastPopup().url=popupController.getLastPopup().url.replace(/image_id=\d+/,'image_id='+r);popupController.reloadLastPopup();popupController.centerLastPopup()}else{s3.openModalPopup('/-/cms/v1/image/?act=watermark_preview&'+access+'&image_id='+r+'&'+getFormData(formWrapper))}}};var extra_get=imageId?'image_id='+imageId:'';extra_get+='&folder_id='+treeController.current_folder_id;selector.open('image',0,0,obj,func,extra_get)}else{s3.alert(s3.loc('JS_IMAGES_WATERMARK_OFF'))}}function selectFormImage2(obj,get_svg_body,cropper,callback){var func=function(r,selected_obj){if(obj){var image_box=util.getParent(obj,"DIV");var image_ver_id=parseInt($(selected_obj).attr('data-ver-id'));var global=(image_ver_id==1?1:0);var image_info={};var filename="";var a=util.getFirstChild(obj,"IMG");var rnd=new Date().getTime();var ext=$(selected_obj).data('ext');var name=$(obj).attr('data-name');if(a){image_info=$.parseJSON(util.makeGetRequest('/-/cms/v1/image/?act=control&'+access+'&rnd='+rnd+'&object_id='+r+'&control_id=2&global='+global).text);a.src=uploader.thumbnail;filename=image_info.filename}a=util.getFirstChild(obj,"INPUT");if(a.value==""){a.value="{}"}var old_image_data=$.parseJSON(a.value);var new_image_data={};if(get_svg_body){new_image_data={image_id:r,filename:filename,ver_id:image_ver_id,svg_body:image_info.svg_body,image_width:image_info.width,image_height:image_info.height,ext:image_info.ext}}else{new_image_data={image_id:r,filename:filename,ver_id:image_ver_id,image_width:image_info.width,image_height:image_info.height,ext:image_info.ext}}if(cropper&&cropper.width&&cropper.height){new_image_data.cropper_width=cropper.width;new_image_data.cropper_height=cropper.height}if(a)a.value=JSON.stringify(new_image_data);$(obj).attr('data-image-id',r);$(obj).attr('data-name',name);$(obj).attr('id','image_control_'+name+'_'+r);$(obj).attr('data-ver-id',image_ver_id);var image_replace_btn=$(util.getElementsByClassName(image_box,"SPAN","image-replace")),image_crop_btn=$(util.getElementsByClassName(image_box,"SPAN","image-crop")),image_zoom_btn=$(util.getElementsByClassName(image_box,"SPAN","image-zoom")),image_edit_btn=$(util.getElementsByClassName(image_box,"SPAN","image-edit")),image_delete_btn=$(util.getElementsByClassName(image_box,"SPAN","image-remove")),image_replace_link=image_replace_btn.attr('onclick'),image_edit_link=image_edit_btn.attr('onclick'),image_crop_link=image_edit_btn.attr('onclick'),replace_regex_replacer=(old_image_data?'object_id='+old_image_data.image_id:"object_id=");if(image_replace_btn.get(0)){if(!old_image_data){var ghost_image_id=image_replace_link.match(/object_id=(.\d+)\&/);if(ghost_image_id&&ghost_image_id[1]){replace_regex_replacer+=ghost_image_id[1]}}var extra_get='';if(cropper&&cropper.width&&cropper.height){extra_get='&cropper_width='+cropper.width+'&cropper_height='+cropper.height}var global_get_param=(image_ver_id==1?"&global=1":""),edit_btn_new_link="s3.openModalPopup('/-/cms/v1/image/?act=edit&object_id="+r+"&"+access+global_get_param+"', false, null);",crop_btn_new_link="s3.openModalPopup('/-/cms/v1/image/?act=maker&"+access+"&popup="+r+extra_get+global_get_param+"');",zoom_btn_new_link="s3.openModalPopup('/-/cms/v1/image/?act=preview&"+access+"&hide_edit=1&image_id="+r+"');";image_replace_btn.attr('onclick',"selectFormImage2($(\"span[id^='image_control']span[id*='"+r+"']\").get(0), 0)").removeClass('hidden');if(cropper&&cropper.width&&cropper.height){image_replace_btn.attr('onclick',"selectFormImage2($(\"span[id^='image_control']span[id*='"+r+"']\").get(0), 0, {'width':"+cropper.width+",'height':"+cropper.height+"})").removeClass('hidden')}image_zoom_btn.attr('onclick',zoom_btn_new_link).removeClass('hidden');image_edit_btn.attr('onclick',edit_btn_new_link).removeClass('hidden');image_delete_btn.removeClass('no-image');image_crop_btn.attr('onclick',crop_btn_new_link);if(cropper&&cropper.width&&cropper.height){$(image_box).addClass('crop')}if(global||ext=='svg'){$(image_box).removeClass('crop')}}}popupController.closeLastPopup();if(cropper&&cropper.width&&cropper.height&&!global&&ext!='svg'){var imageWidth=parseInt($(selected_obj).data('image-width'));var imageHeight=parseInt($(selected_obj).data('image-height'));var cropperWidth=parseInt(cropper.width);var cropperHeight=parseInt(cropper.height);var msg=s3.loc('JS_IMAGE_CROPPER_DIALOG',{imageWidth:imageWidth,imageHeight:imageHeight,cropperWidth:cropperWidth,cropperHeight:cropperHeight});var extra_get='&cropper_width='+cropper.width+'&cropper_height='+cropper.height;if(cropperWidth<=imageWidth&&cropperHeight<=imageHeight){if(cropperWidth==imageWidth&&cropperHeight==imageHeight)return;s3.cropperConfirm(msg,function(){var w=popupController.getLastPopup();var confirm=$(w.obj).attr('id')=='cropper_confirm';if(confirm){popupController.closeLastPopup()}openAjaxForm('/-/cms/v1/image/?act=maker&'+S3_ACCESS+'&popup='+r+extra_get)})}else{$(image_box).removeClass('crop')}}if(callback&&typeof callback==='function'){callback(obj,image_info)}};var image_id=parseInt($(obj).attr('data-image-id')),extra_get=image_id?'image_id='+image_id:'',extra_get_prefix=extra_get==''?'':'&';if(cropper&&cropper.width&&cropper.height){extra_get+=extra_get_prefix+'cropper_width='+cropper.width+'&cropper_height='+cropper.height}selector.open('image',0,0,obj,func,extra_get)}function selectFormMedia(obj){var func=function(r){if(obj){var a=util.getFirstChild(obj,"BUTTON");if(a){a.innerHTML=util.makeGetRequest('/-/cms/v1/media/?act=control&'+access+'&object_id='+r).text}a=util.getFirstChild(obj,"INPUT");if(a)a.value=r}popupController.closeLastPopup()};selector.open('media',0,0,obj,func)}function selectFormMedia2(obj){var func=function(r){if(obj){var filename="";var a=util.getFirstChild(obj,"BUTTON");if(a){filename=util.makeGetRequest('/-/cms/v1/media/?act=control&'+access+'&object_id='+r+'&control_id=2').text;a.innerHTML=filename}a=util.getFirstChild(obj,"INPUT");if(a)a.value=JSON.stringify({media_id:r,filename:filename})}popupController.closeLastPopup()};selector.open('media',0,0,obj,func)}function selectFormGallery(obj){var func=function(r){if(obj){var a=util.getFirstChild(obj,"BUTTON");if(a){a.innerHTML=util.makeGetRequest('/-/cms/v1/gallery/?act=control&'+access+'&object_id='+r).text}a=util.getFirstChild(obj,"INPUT");if(a)a.value=r}popupController.closeLastPopup()};selector.open('gallery',0,0,obj,func)}function selectFormFile(obj,jsonControl){var func=function(r){if(obj){var filename="";var a=util.getFirstChild(obj,"BUTTON");if(a){filename=util.makeGetRequest('/-/cms/v1/file/?act=control&'+access+'&object_id='+r+'&control_id='+(jsonControl?2:1)).text;a.innerHTML=filename}a=util.getFirstChild(obj,"INPUT");if(a){if(jsonControl){a.value=JSON.stringify({file_id:r,filename:filename})}else{a.value=r}}}popupController.closeLastPopup()};selector.open('file',0,0,obj,func)}function selectFormMultiFile(obj,name){var func=function(r){if(obj){var a=document.getElementById('control-multi-file'+name);if(a){var li=document.createElement('LI');li.className='box_draggable';li.innerHTML=util.makeGetRequest('/-/cms/v1/file/?act=multi_control&'+access+'&object_id='+r).text;var inp=util.getFirstChild(li,"INPUT");inp.name=name;a.appendChild(li);util.msg(s3.loc('JS_ADDED_TO_LIST'))}}popupController.closeLastPopup()};selector.open('file',0,0,obj,func)}function selectFormMultiMedia(obj,name){var func=function(r){if(obj){var a=document.getElementById('control-multi-media'+name);if(a){var li=document.createElement('LI');li.className='box_draggable';li.innerHTML=util.makeGetRequest('/-/cms/v1/media/?act=multi_control&'+access+'&object_id='+r).text;var inp=util.getFirstChild(li,"INPUT");inp.name=name;a.appendChild(li);util.msg(s3.loc('JS_ADDED_TO_LIST'))}}popupController.closeLastPopup()};selector.open('media',0,0,obj,func)}function selectFormMultiGalleryImage(obj,name){ImageController.image_selector_name=name;ImageController.image_selector_gallery_type_extra_get='&gallery=1';var extra_get='multiselect=1&gallery=1';var func=function(object_id,obj){if(obj){var a=document.getElementById(name);var image_ver_id=parseInt($(obj).attr('data-ver-id'));var gallery_id=$(a).data('gallery-id');if(a){var new_field_form={'image_id':object_id,'gallery_id':gallery_id,'add_image_dubl':0,};$.ajax({type:"POST",url:'/-/cms/v1/gallery/?act=add_image&'+S3_ACCESS,data:new_field_form,dataType:'html',async:false,success:function(field_data){if(field_data){var li=util.getElementFromText(field_data,'LI');if(li){a.appendChild(li);$(li).S3ChangeControls();util.msg(s3.loc('JS_ADDED_TO_LIST'))}else{s3.confirm(s3.loc('JS_ADDED_DOUBLE_PICTURE'),function(){popupController.closeLastPopup();new_field_form["add_image_dubl"]=1;$.ajax({type:"POST",url:'/-/cms/v1/gallery/?act=add_image&'+S3_ACCESS,data:new_field_form,dataType:'html',async:false,success:function(field_data){if(field_data){var li=util.getElementFromText(field_data,'LI');if(li){a.appendChild(li);$(li).S3ChangeControls();util.msg(s3.loc('JS_ADDED_TO_LIST'))}else{s3.alert(field_data)}}},error:function(){s3.alert(JS_ERROR)}})})}}},error:function(){s3.alert(JS_ERROR)}})}}};selector.open('image',0,0,obj,func,extra_get)}function selectFormMultiGallery2Image(obj,name,regallery){ImageController.image_selector_name=name;ImageController.image_selector_gallery_type_extra_get='&gallery=2';var extra_get='multiselect=1&gallery=2';var url='/-/cms/v1/gallery2/?act=add_image&'+S3_ACCESS+'&popup=1';var func=function(object_id,obj){if(obj){var a=document.getElementById(name);var gallery_id=$(a).data('gallery-id');var album_id=(regallery)?$(a).data('folder-id'):$(a).data('album-id');if(a){var new_field_form={'image_id':object_id,'gallery_id':gallery_id,'album_id':album_id,'add_image_dubl':0,};$.ajax({type:"POST",url:url,data:new_field_form,dataType:'html',async:false,success:function(field_data){if(field_data){var li=util.getElementFromText(field_data,'LI');if(li){a.appendChild(li);$(li).S3ChangeControls();util.msg(s3.loc('JS_ADDED_TO_LIST'));var album=$('li#gallery_album_'+album_id);$(album).find('span.s3-badge').text(parseInt($(album).find('span.s3-badge').text())+1)}else{s3.confirm(s3.loc('JS_ADDED_DOUBLE_PICTURE'),function(){popupController.closeLastPopup();new_field_form["add_image_dubl"]=1;$.ajax({type:"POST",url:url,data:new_field_form,dataType:'html',async:false,success:function(field_data){if(field_data){var li=util.getElementFromText(field_data,'LI');if(li){a.appendChild(li);$(li).S3ChangeControls();util.msg(s3.loc('JS_ADDED_TO_LIST'));var album=$('li#gallery_album_'+album_id);$(album).find('span.s3-badge').text(parseInt($(album).find('span.s3-badge').text())+1)}else{s3.alert(field_data)}}},error:function(){s3.alert(JS_ERROR)}})})}if(S3_REGISTRY_PATCH.migrate_gallery_albums_to_folders){let popup=popupController.getLastPopup();popup.onClose=function(){treeController.reloadTree()}}}},error:function(){s3.alert(JS_ERROR)}})}}};selector.open('image',0,0,obj,func,extra_get)}function selectFormMultiImage(obj,name){ImageController.image_selector_name=name;ImageController.image_selector_gallery_type_extra_get='';ImageController.image_selector_control_id=0;var extra_get='multiselect=1';var func=function(object_id,obj){if(obj){var a=document.getElementById('control-multi-image'+name);var image_ver_id=parseInt($(obj).attr('data-ver-id'));var global=(image_ver_id==1?1:0);if(a){var li=document.createElement('LI');li.className='image';li.innerHTML=util.makeGetRequest('/-/cms/v1/image/?act=multi_control&'+access+'&object_id='+object_id+'&global='+global).text;var inp=util.getFirstChild(li,"INPUT");inp.name=name;a.appendChild(li);util.msg(s3.loc('JS_ADDED_TO_LIST'))}}popupController.closeLastPopup()};selector.open('image',0,0,obj,func,extra_get)}function selectFormMultiImage2(obj,name,get_svg_body,cropper){ImageController.image_selector_name=name;ImageController.image_selector_gallery_type_extra_get='';ImageController.image_selector_control_id=2;var extra_get='multiselect=1';var func=function(object_id,obj){if(obj){var a=document.getElementById('control-multi-image'+name);var image_ver_id=parseInt($(obj).attr('data-ver-id'));var global=(image_ver_id==1?1:0);var rnd=new Date().getTime();if(a){var li=document.createElement('LI');li.className='image';li.innerHTML=util.makeGetRequest('/-/cms/v1/image/?act=multi_control&'+access+'&rnd='+rnd+'&object_id='+object_id+'&control_id=2&global='+global+'&get_svg_body='+get_svg_body).text;var inp=util.getFirstChild(li,"INPUT");inp.name=name;a.appendChild(li);util.msg(s3.loc('JS_ADDED_TO_LIST'))}}popupController.closeLastPopup()};if(cropper&&cropper.width&&cropper.height){extra_get+='&cropper_width='+cropper.width+'&cropper_height='+cropper.height}selector.open('image',0,0,obj,func,extra_get)}function selectFileForImport(obj,extraGet){var func=function(r){if(obj){var pp=popupController.getPreviousPopup();var _u=pp.url;_u=util.urlParamReplace(_u,'mode','check_format');_u=util.urlParamReplace(_u,'file_id',r);if(obj.software&&obj.software.options)_u=util.urlParamReplace(_u,'software',obj.software.options[obj.software.selectedIndex].value);if(obj.delim&&obj.delim.options)_u=util.urlParamReplace(_u,'delim',obj.delim.options[obj.delim.selectedIndex].value);if(extraGet&&typeof extraGet=="string"){extraGet=extraGet.split("&");for(var i=0,kv;i<extraGet.length;++i){kv=extraGet[i].split("=");if(kv&&kv.length==2){_u=util.urlParamReplace(_u,kv[0],kv[1])}}}popupController.reloadPreviousPopup(_u)}popupController.closeLastPopup();window.setTimeout("util.centerElement(popupController.getLastPopup().obj)",1)};selector.open('file',0,false,obj,func)}function doFolderImport(obj,extraGet){var func=function(r){if(obj){var pp=popupController.getPreviousPopup();var _u=pp.url;_u=util.urlParamReplace(_u,'mode','import_folders');_u=util.urlParamReplace(_u,'file_id',r);if(obj.software&&obj.software.options){_u=util.urlParamReplace(_u,'software',obj.software.options[obj.software.selectedIndex].value)}if(extraGet&&typeof extraGet=="string"){extraGet=extraGet.split("&");for(var i=0,kv;i<extraGet.length;++i){kv=extraGet[i].split("=");if(kv&&kv.length==2){_u=util.urlParamReplace(_u,kv[0],kv[1])}}}popupController.reloadPreviousPopup(_u)}popupController.closeLastPopup();window.setTimeout("util.centerElement(popupController.getLastPopup().obj)",1)};selector.open('file',0,false,obj,func)}function shopImport(obj,cellsCount){if(obj&&obj.elements){var key_field=obj.elements['key_field'].value;var keyExists=false;var cells='';for(var i=1;i<=cellsCount;i++){if(key_field==obj.elements['cells_'+i].options[obj.elements['cells_'+i].selectedIndex].value)keyExists=true;cells=cells+";"+obj.elements['cells_'+i].options[obj.elements['cells_'+i].selectedIndex].value}if(keyExists==false){s3.alert(s3.loc('JS_SHOP_IMPORT_ERROR_MESSAGE'))}else{var pp=popupController.getLastPopup();var _u=pp.url;_u=util.urlParamReplace(_u,'mode','import_file');if(_processing_post_ajax_form){return false}_processing_post_ajax_form=1;var r=util.makePostRequest(_u,formcontents(obj));if(r.error==true){s3.alertHTML(s3.formatError(r.text));window.setTimeout("_processing_post_ajax_form=0",0)}else{popupController.setLastPopupContent(r.text);var d=popupController.getPreviousPopup();if(d)popupController.reloadPreviousPopup(null);else s3.reloadContent()}window.setTimeout("_processing_post_ajax_form=0",0)}}}function queueFormData(obj,url,onSuccess){if(!obj)return false;var pp=popupController.getLastPopup();var _u=url||pp.url;_u=util.urlParamReplace(_u,'mode','queue');if(_processing_post_ajax_form){return false}_processing_post_ajax_form=1;var r=util.makePostRequest(_u,formcontents(obj));if(r.error==true){s3.alertHTML(s3.formatError(r.text));window.setTimeout("_processing_post_ajax_form=0",0)}else{if(onSuccess){onSuccess(r.text)}else{popupController.setLastPopupContent(r.text);var d=popupController.getPreviousPopup();if(d)popupController.reloadPreviousPopup(null);else s3.reloadContent()}}window.setTimeout("_processing_post_ajax_form=0",0)}function showImageVerPopup(id){var showVerImage=function(html){var _s=document.getElementById('s3_image_click_format');var _v=_s.options[_s.selectedIndex].value;if(_v!=""){html="<img id='"+showImageVerPopup.imageId+"_src' class=\"highslide\" onClick=\"hs.expand(this,{src:'"+_v+"'});\""+html.substr(5)}popupController.closeLastPopup();var imgId=document.getElementById('image_id');if(imgId){imgId.value=showImageVerPopup.imageId}var img=document.getElementById("image_id_src");if(img){var src=html.match(/src=("|')([^("|')]+)("|')/);if(src)img.src=src[2]}};showImageVerPopup.imageId=id;popupController.closeLastPopup();var popup=new PopupWindow('aaa');popup.url="/-/cms/v1/image/?act=src&"+access+"&object_id="+id;popup.center=true;popup.modal=true;popup.drag=true;popup.onClose=image_insert.unset_old();image_insert.caller=showVerImage;popupController.showPopup(popup)}function removeMe(obj,tagName){obj=util.getElement(obj,tagName);if(!obj)return false;util.detachElement(obj)}function resetSelectFlash(obj,text){obj=util.getPreviousSibling(obj,'SPAN');util.getFirstChild(obj,'INPUT').value='';util.getFirstChild(obj,'BUTTON').innerHTML=text}function resetSelectMedia(obj,text){obj=util.getPreviousSibling(obj,'SPAN');util.getFirstChild(obj,'INPUT').value='';util.getFirstChild(obj,'BUTTON').innerHTML=text}function resetSelectImage(obj,text,callback){$(obj).parent().removeClass('crop');$(obj).addClass('no-image').next('.image-replace').addClass('hidden');$(obj).parent().find('.image-zoom').addClass('hidden');obj=util.getPreviousSibling(obj,'SPAN');$(obj).removeAttr('data-image-id');$(obj).removeAttr('id');util.getFirstChild(obj,'INPUT').value='';util.getFirstChild(obj,'IMG').src=text;if(typeof callback==='function'){callback()}}function markAll(src_obj,mark,type){switch(type){default:var cbxes=util.getElementsByClassName(src_obj,'input','checkbox');for(var i=0;i<cbxes.length;++i){cbxes[i].checked=(mark?true:null)}break}}function sortNews(params){var d=popupController.getLastPopup();var url=d?d.url:s3.lastContentUrl;$.each(params,function(key,value){url=util.urlParamReplace(url,key,value)});if(d){d.url=url;d.reload()}else{s3.loadContent(url)}}function sortArticles(params){var d=popupController.getLastPopup();var url=d?d.url:s3.lastContentUrl;$.each(params,function(key,value){url=util.urlParamReplace(url,key,value)});if(d){d.url=url;d.reload()}else{s3.loadContent(url)}}function sortArticles2(params,path){var d=popupController.getLastPopup();var url;if(d){url=d.url}else{url=path}$.each(params,function(key,value){url=util.urlParamReplace(url,key,value)});if(d){d.url=url;d.reload()}else{s3.loadContent(url)}}function openDialogSelectArticles2(url,container){var selected=[];$('input[name="'+container+'[]"]').each(function(){var $this=$(this);var value=$this.val();selected.push(value)});selected=selected.join(',');url+='&selected='+selected;openAjaxForm(url)}function removeArticleFromBlock(elem){$(elem).parent().remove()}function openDialogSelectArticles(url){var selected=[];$('input[name="articles[]"]').each(function(){var $this=$(this);var value=$this.val();selected.push(value)});selected=selected.join(',');url+='&selected='+selected;openAjaxForm(url)}function paginationArticles(f,url,container,params,cont,popup){var _processing_post_ajax_form=1;var d=popupController.getLastPopup();if(params){for(var k in params){if(!k){continue}if(typeof f.elements[k]!="undefined"){f.elements[k].value=params[k]}else url=util.urlParamReplace(url,k,params[k])}}var selected=[];$('input[name="'+container+'[]"]').each(function(){var $this=$(this);var value=$this.val();selected.push(value)});selected=selected.join(',');url+='&selected='+selected;var fc=formcontents(f);url+=(url.indexOf("?")==-1?'?':'&')+fc;var r=util.makePostRequest(url,fc);if(params&&typeof params['get_all_ids']!="undefined"){_processing_post_ajax_form=0;return r.text}if(r.error==true){s3.alertHTML(s3.formatError(r.text))}else if(d&&!popup){d.setContent(r.text,url);window.setTimeout(function(){util.centerElement(d.obj);d.adjustBlocker();popupController.adjustModalLayerSize()},1)}else{s3.setContent(r.text,url)}window.setTimeout((function(){try{var s;if(typeof f.elements['_search']!="undefined")s=f.elements['_search'].value.trim();else if(typeof f.elements['search_text']!="undefined")s=f.elements['search_text'].value.trim();if(!s)return;if(cont&&typeof cont=='string'){cont=util.getObject(cont)}var c=cont||util.getObject('shop_products_container');var spans=util.getElementsByClassName(c,"SPAN","objectName");if(!spans||spans.length==0){return}for(var i=0;i<spans.length;++i){spans[i].innerHTML=spans[i].innerHTML.replace(new RegExp('('+RegExp.escape(s)+')','gi'),'<span class="search-highlight">$1</span>')}}catch(e){}}),1000);window.setTimeout("_processing_post_ajax_form=0",0);return false}function searchProducts(f,url,params,cont,popup){var _processing_post_ajax_form=1;var lastPopup=popupController.getLastPopup();var lastPreviousPopup=popupController.getPreviousPopup();if(params){for(var k in params){if(!k){continue}if(typeof f.elements[k]!="undefined"){f.elements[k].value=params[k]}else{url=util.urlParamReplace(url,k,params[k])}if(typeof f.elements[k]=="undefined"&&(url.indexOf("&"+k+"=")==-1||url.indexOf("?"+k+"=")==-1)){$(f).append('<input class="temp_for_sort" type="hidden" name="'+k+'" value="'+params[k]+'">')}}}var fc=formcontents(f);url+=(url.indexOf("?")==-1?'?':'')+fc;var r=util.makePostRequest(url,fc);if(params&&typeof params['get_all_ids']!="undefined"){_processing_post_ajax_form=0;return r.text}if(r.error==true){s3.alertHTML(s3.formatError(r.text))}else if(lastPopup&&!popup){lastPopup.setContent(r.text,url);popupController.adjustPopup(lastPopup)}else if(lastPreviousPopup){lastPreviousPopup.setContent(r.text,url);popupController.adjustPopup(lastPreviousPopup)}else{s3.setContent(r.text,url)}window.setTimeout((function(){try{var s;if(typeof f.elements['_search']!="undefined")s=f.elements['_search'].value.trim();else if(typeof f.elements['search_text']!="undefined")s=f.elements['search_text'].value.trim();if(!s)return;if(cont&&typeof cont=='string'){cont=util.getObject(cont)}var c=cont||util.getObject('shop_products_container');var spans=util.getElementsByClassName(c,"SPAN","objectName");if(!spans||spans.length==0){return}for(var i=0;i<spans.length;++i){spans[i].innerHTML=spans[i].innerHTML.replace(new RegExp('('+RegExp.escape(s)+')','gi'),'<span class="search-highlight">$1</span>')}$(f).find('input.temp_for_sort').remove()}catch(e){}}),1000);window.setTimeout("_processing_post_ajax_form=0",0);return false}function search(f,url,params){_processing_post_ajax_form=1;var d=popupController.getLastPopup();if(params){for(var k in params){if(!k){continue}if(typeof f.elements[k]!="undefined"){f.elements[k].value=params[k]}else url=util.urlParamReplace(url,k,params[k])}}var fc=formcontents(f);url+=(url.indexOf("?")==-1?'?':'&')+fc;var r=util.makePostRequest(url,fc);if(r.error==true){s3.alertHTML(s3.formatError(r.text))}else if(d){d.setContent(r.text,url);window.setTimeout(function(){util.centerElement(d.obj);d.adjustBlocker();popupController.adjustModalLayerSize()},1)}else{s3.setContent(r.text,url)}window.setTimeout("_processing_post_ajax_form=0",0);return false}var historyController={stop:false,lasHash:null,loadInProgress:false,loadByHistory:false,init:function(){util.addEvent(window,"load",function(){function cancelHashChange(event){if(!historyController.loadInProgress){return true}event.preventDefault()}$('a[href^="#"]').on('click',cancelHashChange);unFocus.History.addEventListener('historyChange',historyController.listener);historyController.listener(unFocus.History.getCurrent())})},listener:function(historyHash){if(historyHash[0]=='!'){return}if(historyController.loadInProgress)return;if((!s3.lastContentUrl&&!document.location.hash)||s3.lastContentUrl&&s3.lastContentUrl.replace(/&?rnd=[0-9]+/,"")==historyController.unescape(historyHash))return;historyController.loadByHistory=true;historyController.lasHash=historyHash;if(historyHash){s3.loadContent(historyController.unescape(historyHash))}else if(!historyHash&&location.href.indexOf("#")==-1){document.location.reload()}historyController.loadByHistory=false},setAnchor:function(anchor){anchor=historyController.escape(anchor);if(historyController.stop||historyController.lasHash==anchor)return;unFocus.History.addHistory(anchor)},escape:function(anchor){return anchor.replace(/\?/g,'&63;')},unescape:function(anchor){return anchor.replace(/&63;/g,'?')}};historyController.init();function isFastpay(ps_group_id){return ps_group_id==5||ps_group_id==8}function addPaymentToList(ps_group_id,ps_id,single,node){function add(){var obj=util.getElement(node,'LI');var a=$('#payment-list-new').get(0);if(obj&&a){fadeController.init(obj);popupController.closeLastPopup();$(a).append(obj);if(single){$('#payment-list-add').hide()}util.msg(s3.loc('JS_ADDED_TO_LIST'),this.msgColor)}}if(isFastpay(ps_group_id)){add()}else if(util.makePostRequest('/-/cms/v1/payment-systems/?'+access+'&act=add','ps_id='+ps_id+'&ps_group_id='+ps_group_id)){add();popupController.reloadLastPopup()}}function deletePaymentsFromList(ps_group_id,ps_id,single,node){if(isFastpay(ps_group_id)){var obj=util.getElement(node,'LI');if(!obj)return false;if(selector.focused()){util.detachElement(obj);return}s3.confirm((s3.loc('JS_CONFIRM_DELETE')),function(){util.detachElement(obj);popupController.closeLastPopup();popupController.childsPopupsHasChanged();single&&$('#payment-list-add').show()})}else{var url='/-/cms/v1/payment-systems/?'+access+'&act=delete&ps_group_id='+ps_group_id+'&ps_id='+ps_id;s3.deleteObject(node,'LI',url,function(){single&&$('#payment-list-add').show()})}}function deleteFiscalizationFromList(ps_group_id,fiscalization_system_id,account_id,fiscalization_account_id,single,node){var url='/-/cms/v1/fiscalization-systems/?'+access+'&act=delete&ps_group_id='+ps_group_id+'&fiscalization_system_id='+fiscalization_system_id+'&account_id='+account_id+'&fiscalization_account_id='+fiscalization_account_id;s3.deleteObject(node,'LI',url,function(){single&&$('#payment-list-add').show()})}function addJsonMetaToList(object_id,node,extra_params){if(util.makePostRequest('/-/cms/v1/json/?act=edit_in_list&'+access+'&action=add&object_id='+object_id+'&query_id='+this.query_id+(extra_params?'&'+extra_params:''),{})){var obj=util.getElement(node,this.elementTagName);if(obj){if(!this.exists(obj)){popupController.getPreviousPopup().reload()}fadeController.init(obj);util.msg(s3.loc('JS_ADDED_TO_LIST'),this.msgColor)}}}function addJsonMetaToJson(object_id,node,extra_params){if(extra_params){extra_params=extra_params.split('&');for(var i=0;i<extra_params.length;i++){var parts=extra_params[i].split('=');extra_params[parts[0]]=parts[1]}}var obj=util.getElement(node,this.elementTagName);var a=$('[id=json-'+extra_params['field_name']+'-'+this.query_id+']:last').get(0);if(obj&&a){fadeController.init(obj);if(!$(a).find('[name='+extra_params['field_name']+'\\[\\]][value='+object_id+']').length){var li=document.createElement('LI');var objectName;li.className='box';li.innerHTML=node.innerHTML;objectName=li.querySelector('.objectName .name');if(objectName){$(objectName).attr('onclick',$(objectName).attr('onclick').replace('popupController.closeLastPopup();',''))}$(li).find('input[type=hidden]').attr('name',extra_params['field_name']+"[]");if(extra_params['single']){popupController.closeLastPopup();$('#json-'+extra_params['field_name']+'-add').hide();$(li).find('.objectRemove, .remove').attr('onclick',"util.detachElement(util.getElement(this, 'LI'));$('#json-"+extra_params['field_name']+"-add').show();")}else{$(li).find('.objectRemove, .remove').attr('onclick',"util.detachElement(util.getElement(this, 'LI'));")}a.appendChild(li);util.msg(s3.loc('JS_ADDED_TO_LIST'),this.msgColor)}}}function deleteJsonMetaFromList(object_id,query_id,node){var url='/-/cms/v1/json/?act=edit_in_list&'+access+'&action=delete&object_id='+object_id+'&query_id='+query_id;s3.deleteObject(node,'LI',url,false);util.makePostRequest(url,{})}function imagePageOnLoad(){var div=document.createElement('div');if('ondragstart'in div&&'ondrop'in div&&window.File&&window.FileReader&&window.FileList&&window.FormData&&window.Blob&&(window.DataTransferItemList||window.DataTransfer)&&(!$.browser.opera||($.browser.opera&&$.browser.versionNumber>=17))){$('.s3-image').addClass('drop-upload-support')}}function shop2PageOnLoad(){$('.shop2-product-search-form-row select[multiple]').change(function(e,o){if(!o)return;if(!(o.deselected===""||o.deselected)){if($(this).val()&&$(this).val().length>1&&o.selected===""){$(this).siblings('.chzn-container').find('ul li.search-choice:lt('+($(this).val().length-1)+') a').click()}else if($(this).val()&&$(this).val().length>1&&$(this).val()[0]===""){$(this).siblings('.chzn-container').find('ul li.search-choice:eq(0) a').click()}}})}function shop2OrderChooseUser(){var p=s3.openModalPopup("/-/cms/v1/user/?select=1&popup=true&"+access);util.createCookie('users_select',1);p.onClose=function(){util.eraseCookie('users_select')}}function shop2OrderUpdateUser(user_id){var order_id=$("#current_order_id").val();s3.confirm(s3.loc('JS_SHOP2_ORDER_PROBABLY_DISCOUNT_RECOUNT_NEEDED'),function(){popupController.closeLastPopup();var res=util.makePostRequest('/-/cms/v1/shop2/order/?act=update_user&'+access,"&user_id="+user_id+"&order_id="+order_id);if(res&&!res.error){popupController.closeLastPopup();popupController.reloadLastPopup();util.eraseCookie('users_select')}})}function shop2OrderDeleteUser(order_id){s3.confirm(s3.loc('JS_SHOP2_ORDER_PROBABLY_DISCOUNT_RECOUNT_NEEDED'),function(){popupController.closeLastPopup();var res=util.makePostRequest('/-/cms/v1/shop2/order/?act=delete_user&'+access,"&order_id="+order_id);if(res&&!res.error){popupController.reloadLastPopup()}})}function shop2OrderGroupRemove(url,msg){s3.deleteObjectsOrders(util.getObject('shop2_orders_container'),'TR','shop2_order_',url,null,'input',{checked:true},msg)}function shop2OrderGroupBasket(url,msg){s3.deleteObjectsOrders(util.getObject('shop2_orders_container'),'TR','shop2_order_',url,null,'input',{checked:true},msg)}function shop2OrderGroupArchive(url,msg){s3.deleteObjectsOrders(util.getObject('shop2_orders_container'),'TR','shop2_order_',url,null,'input',{checked:true},msg)}function shop2OrderGroupFullPaiment(url,msg){s3.confirm(msg,function(){popupController.closeLastPopup();var container=util.getObject('shop2_orders_container');var orders=s3.getBatchOpInfo(container,'TR','shop2_order_','',null,'input',{checked:true});if(!orders.ids.length){return s3.alert(s3.loc('JS_NO_OBJECTS_CHOSEN_ERROR'))}var promise=$.when();$.each(orders.ids?orders.ids.split(','):[],function(i,order_id){promise=promise.then(function(){s3.updateObject($('#shop2_order_'+order_id)[0],'TR','shop2_orders_container',url+order_id)})});promise.then(function(){$('#shop2_order_actions').val('').trigger('liszt:updated')})})}function shop2OrderGroupFullReturn(url,msg){s3.confirm(msg,function(){popupController.closeLastPopup();var container=util.getObject('shop2_orders_container');var orders=s3.getBatchOpInfo(container,'TR','shop2_order_','',null,'input',{checked:true});if(!orders.ids.length){return s3.alert(s3.loc('JS_NO_OBJECTS_CHOSEN_ERROR'))}var promise=$.when();$.each(orders.ids?orders.ids.split(','):[],function(i,order_id){promise=promise.then(function(){s3.updateObject($('#shop2_order_'+order_id)[0],'TR','shop2_orders_container',url+order_id)})});promise.then(function(){$('#shop2_order_actions').val('').trigger('liszt:updated')})})}function saveRefOptions(url,form,update){var data=$(form).serializeArray(),f=$('<form>'),color_refs={},color_refs_num=0,element_new={},element_new_num=0,element_del={},element_del_num=0,element={},element_num=0;var parts;for(var i=0;i<data.length;i++){if(data[i].name.indexOf('color_ref_el')==0){parts=data[i].name.match(/(\w+)\[(\d*)\]\[(\w+)\]/);if(parts.length==4){color_refs_num++;if(parts[2]==""){parts[2]=color_refs_num}else{color_refs_num=parseInt(parts[2])}if(!color_refs[parts[2]])color_refs[parts[2]]={};color_refs[parts[2]][parts[3]]=data[i].value}}else if(data[i].name.indexOf('element_new')==0){element_new[element_new_num]=data[i].value;element_new_num++}else if(data[i].name.indexOf('element_del')==0){parts=data[i].name.match(/(\w+)\[(\d*)\]/);if(parts.length==3){element_del[parts[2]]=data[i].value;element_del_num++}}else if(data[i].name.indexOf('element')==0){parts=data[i].name.match(/(\w+)\[(\d*)\]/);if(parts.length==3){element[parts[2]]=data[i].value;element_num++}}else{var el=$('<input type="text">');el.prop('name',data[i].name);el.val(data[i].value);f.append(el)}}var ref_el;if(color_refs_num){ref_el=$('<input type="text" name="color_ref_el" value="">');ref_el.val(JSON.stringify(color_refs));f.append(ref_el)}if(element_new_num){ref_el=$('<input type="text" name="element_new" value="">');ref_el.val(JSON.stringify(element_new));f.append(ref_el)}if(element_del_num){ref_el=$('<input type="text" name="element_del" value="">');ref_el.val(JSON.stringify(element_del));f.append(ref_el)}if(element_num){ref_el=$('<input type="text" name="element" value="">');ref_el.val(JSON.stringify(element));f.append(ref_el)}return postAjaxForm(url,f.get(0),update,function(r){if($(r.text).find('.form_error').length==0){popupController.reloadLastPopup()}})}function fillMetaChildJson(id){var val=$('#'+id+' [name=json]').val();if(val){popupController.getLastPopup().obj}}function applyBoilerplate(fromPageId,toPageId,access){var params={from_page_id:fromPageId,to_page_id:toPageId};$.post('/-/cms/v1/page/content/?act=boilerplate&'+access,params).done(function(res){alert(res)});return false}function Preloader(params){this.params=$.extend({},this.defaults,params||{});var preloaderContainer=(this.params.to instanceof jQuery)?this.params.to:$(this.params.to);if(!preloaderContainer.is('body')){this.params.local=true}}Preloader.preloaders=[];Preloader.show=function(params){var preloader=new Preloader(params).append();var alredyCreated=false;if(this.preloaders.length){this.preloaders.some(function(item){if(item===preloader){return alredyCreated=true}})}if(!alredyCreated){this.preloaders.push(preloader)}preloader.show();return preloader};Preloader.hide=function(){if(!this.preloaders.length)return false;var preloader=this.preloaders.pop();preloader.hide();return preloader};Preloader.prototype={elem:null,defaults:{hideClass:'s3-preloader-hide',to:'body',local:false,mini:false,new_preloader:false,onShow:function(){},onHide:function(){}},_getPreloaderHtml:function(){return $('<div class="s3-preloader'+(this.params.local?' local':'')+(this.params.mini?' mini':'')+'"><div class="spinner"></div></div>')},append:function(){var preloaderContainer=(this.params.to instanceof jQuery)?this.params.to:$(this.params.to);var childPreloader=preloaderContainer.children('.s3-preloader');if(childPreloader.length){this.elem=childPreloader;if(this.params.new_preloader){this.elem.html('<div class="spinner">Операция выполняется</div>');this.elem.removeClass('mini').addClass('s3-new-preloader')}else{this.elem.html('<div class="spinner"></div>');this.elem.removeClass('s3-new-preloader')}return childPreloader.data('s3-preloader')}this.elem=this._getPreloaderHtml();if(this.params.local&&preloaderContainer.height()>$(window).height()){this.elem.removeClass('local')}this.elem.appendTo(preloaderContainer);this.elem.data('s3-preloader',this);return this},remove:function(){this.elem.remove();return this},hide:function(){this.elem.addClass(this.params.hideClass);this.params.onHide.apply(this,arguments);return this},show:function(){this.elem.removeClass(this.params.hideClass);this.params.onShow.apply(this,arguments);return this}};s3.processResponse=function(res,params){if(!res){return false}try{res=JSON.parse(res)}catch(e){console.error(e);return false}if($.type(res.html)=='string'){if(params.$insert){params.$insert.html(res.html)}else if(params.$replace){params.$replace.replaceWith(res.html)}}if($.type(res.message)=='string'){alert(res.message)}return true};s3.makeURL=function(url,params){if(url.indexOf('?')===-1){url+='?'}else{url+='&'}return url+access+'&'+$.param(params)};s3.offEvents=function(){if(typeof(logotizer)!=="undefined"&&typeof(logotizer.offEvents)==="function"){logotizer.offEvents()}if(typeof(logo)!=="undefined"&&typeof(logo.offEvents)==="function"){logo.offEvents()}};function fastPayOrdersContainerShowIfOrderNotEmpty(){var container=document.querySelector('#fast_pay_orders_container_dashboard_list');if(container){var listContainer=container.querySelector('#fast_pay_orders_container_dashboard');if(listContainer.childElementCount){if(container)container.style.display='block'}}};function setPageIdToLp(input,page_id,url){if($(input).prop("checked")){const $previousPopup=$(popupController.getPreviousPopup().obj);$previousPopup.find('.reset-url').show();$previousPopup.find('#page_id').val(page_id);$previousPopup.find('#link').val(url)}};s3.checkboxToggler=function(state,selector){if(!state){$(selector).addClass('hidden')}else{$(selector).removeClass('hidden')}};s3.editHelpLinks=function(url,obj){openAjaxForm(url,function(r){var object=$(obj).parent();object.empty();object.html(r.text);popupController.closeLastPopup();fadeController.init($(object).get(0))},null,null)};s3.viewVideo=function(url){openAjaxForm(url)};s3.addFav=function(e,a){var name='CMS '+site_domain,url=document.location,UA=navigator.userAgent.toLowerCase(),isFF=UA.indexOf('firefox')!=-1,isMac=UA.indexOf('mac')!=-1,isWebkit=UA.indexOf('webkit')!=-1,isIE=UA.indexOf('.net')!=-1,webkitMsg=(isMac)?s3.loc('JS_ADD_TO_BOOKMARKS_MAC'):s3.loc('JS_ADD_TO_BOOKMARKS');a.setAttribute('title',name);if(isFF&&window.sidebar){window.sidebar.addPanel(name,url,"");return false}if(isIE&&window.external){window.external.AddFavorite(url,name);return false}if(isMac||isWebkit){e.preventDefault();s3.alert(webkitMsg);return false}};s3.upgradesToggle=function(obj){var service=$(obj).parents('div.service-item:first');service.toggleClass('opened')};s3.clearTooltips=function(){var tooltips=$('div[id^="ui-tooltip-"]');if(tooltips.length){tooltips.remove()}};s3.toggleSnowFlakeColor=function(obj){var image_id_input=obj[0],image_color=obj.parents('.snowflakes-settings:first').find('#snowflake_color_wrapper');if(image_id_input.value){image_color.hide()}else{image_color.show()}};s3.initS3DateSelect=function(el){var date_min=$(el).data('date-min')||false,date_max=$(el).data('date-max')||false,applyLabel=$(el).data('apply-label')||JS_CHOOSE,cancelLabel=$(el).data('cancel-label')||JS_CANCEL,customRangeLabel=$(el).data('range-label')||JS_PERIOD,format=$(el).data('format')||"DD.MM.YYYY";var l=$.datepicker.regional[i18n_map[S3_LANG_CODE]];var options={singleDatePicker:true,showDropdowns:false,timePicker:$(el).data('time-picker'),timePickerSeconds:true,timePicker24Hour:true,autoUpdateInput:false,startDate:' ',locale:{"format":format,"applyLabel":applyLabel,"cancelLabel":cancelLabel,"customRangeLabel":customRangeLabel,"daysOfWeek":[l['dayNamesMin'][0],l['dayNamesMin'][1],l['dayNamesMin'][2],l['dayNamesMin'][3],l['dayNamesMin'][4],l['dayNamesMin'][5],l['dayNamesMin'][6]],"monthNames":[l['monthNames'][0],l['monthNames'][1],l['monthNames'][2],l['monthNames'][3],l['monthNames'][4],l['monthNames'][5],l['monthNames'][6],l['monthNames'][7],l['monthNames'][8],l['monthNames'][9],l['monthNames'][10],l['monthNames'][11]],"firstDay":1}};if(date_min){options.minDate=date_min}if(date_max){options.maxDate=date_max}var $dp=$(el).daterangepicker(options,function(start){$dp.val(start.format(format))})};s3.wmCheckCleanStatus=function(url){Preloader.show({mini:true});$.get(url).done(function(status){Preloader.hide();if(status=='success'){s3.reloadVisibleContent()}}).fail(function(){s3.alert('Error')}).always(function(){Preloader.hide()})};s3.changeStatusFormResult=(url,callback,msgKey='JS_MOVE_TO_SPAM')=>{s3.confirm(s3.loc(msgKey),()=>{popupController.closeLastPopup();Preloader.show({mini:true});const res=util.makeGetRequest(url);if(res&&!res.error){util.msg(s3.loc('JS_SAVED'));Preloader.hide();if(callback&&typeof callback==='function'){callback()}}})};s3.checkoutHidden=function(url){Preloader.show({mini:true});$.get(url).done(function(status){Preloader.hide();if(status=='success'){s3.reloadVisibleContent()}}).fail(function(){s3.alert('Error')}).always(function(){Preloader.hide()})};s3.handleSelectDateChange=function($select){const dateInput=$select.parents('.form-row-date').find('.date-select');const selectedValue=$select.val();selectedValue==='1'?dateInput.removeClass('disabled'):dateInput.addClass('disabled')};s3Email={ERR_TOO_MANY_CONFIRMATION_ATTEMPTS:1001,_replaceNode:function(container,html){var newContainer=$(html);$(container).replaceWith(newContainer);newContainer.S3ChangeControls();fadeController.init(newContainer.get(0))},chooseSingle:function(container){var self=this;var control=$(container).find('input:hidden:first');var onOpen=function(popup){var v=control.val();if(!v){return}var email=v.split(',');if(!email){return}email=email[0];popup.find(':radio').each(function(){if(email==this.value){$(this).prop('checked',true)}})};var onClose=function(popup){var address='';popup.find(':radio').each(function(){if(this.checked){address=this.value}});$.ajax({url:'/-/cms/v1/email/?act=controlList&'+window.access,data:{mails:[address],control_name:control.attr('name'),single:1},type:"POST",async:false,contentType:'application/x-www-form-urlencoded; charset=UTF-8',success:function(response){if(response.hasOwnProperty('error')){self.onError(response);return}self._replaceNode(container,response)},})};S3Ajax.openAjaxPopup({type:'dynamic',link:'/-/cms/v1/email/?single=1&'+window.access,onClose:onClose,onOpen:onOpen})},append:function(container){var self=this;var control=$(container).find('input:hidden:first');var onOpen=function(popup){var v=control.val();if(!v){return}var emails=v.split(',').reverse();$.each(emails,function(key,value){popup.find(':checkbox').each(function(){if(value.indexOf(this.value)!=-1){$(this).prop('checked',true);var prep=$(this).closest("tr");popup.find('#email-list').prepend(prep)}})})};var onClose=function(popup){var mails=[];$(popup).find(':checkbox').each(function(){if(this.checked){mails.push(this.value)}});$.ajax({url:'/-/cms/v1/email/?act=controlList&'+window.access,data:{mails:mails,control_name:control.attr('name')},type:"POST",async:false,contentType:'application/x-www-form-urlencoded; charset=UTF-8'}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}self._replaceNode(container,response)})};S3Ajax.openAjaxPopup({type:'dynamic',link:'/-/cms/v1/email/?'+window.access,isReloaded:true,onClose:onClose,onOpen:onOpen})},appendFromShowOnly:function(container){var onOpen=function(popup){};var onClose=function(popup){S3PopUp.reloadLastPopup()};S3Ajax.openAjaxPopup({type:'dynamic',link:'/-/cms/v1/email/?'+window.access,onClose:onClose,onOpen:onOpen})},remove:function(node,hash){jQuery_S3.deleteObject({obj:node,url:'/-/cms/v1/email/?act=remove&hash='+hash+'&'+window.access,parent:'tr',msg:s3.loc('JS_CONFIRM_EMAIL_DELETE')});return false},save:function(node,hash){var self=this,email=document.getElementById('email_'+hash).value.trim(),name=document.getElementById('name_'+hash).value.trim();if(email==''){return false}$.ajax({url:'/-/cms/v1/email/?act=save&'+window.access,type:"POST",async:false,data:{hash:hash,name:name,email:email},success:function(response){if(response.hasOwnProperty('error')){self.onError(response);return}$(node).removeClass("name-changed")},});return false},removeControlItem:function(itemContainer,email,input){var emails=input.value.split(',');var i=emails.indexOf(email);if(i!=-1){emails.splice(i,1).join(',');input.value=emails}$(itemContainer).remove()},_attachConfirmCountdown:function(hash){var self=this;$.ajax({url:'/-/cms/v1/email/?act=confirmResendCountdown&hash='+hash+'&'+window.access,type:"GET",async:false,success:function(response){if(response.hasOwnProperty('error')){self.onError(response);return}var $c=$(response),$countdownValue=parseInt($c.find('s3-integer').text());$('#resend_container').after($c);if($countdownValue<=0){$c.css('display','none')}util.initCountdown($c.find('s3-integer').get(0),1e3,function(){$('#resend_button').prop('disabled',false);$c.remove()})},})},openConfirmPopup:function(node,hash){var self=this;function onSubmitConfirmByUrl(){self.updateListItem(node,hash,function(){S3PopUp.closeLastPopup()});return false}function onOpen(popup){popup.find('form').each(function(i,f){if(f.name=='confirm_by_url'){$(f).submit(onSubmitConfirmByUrl);if($('#resend_button').is(':disabled')){self._attachConfirmCountdown(hash)}}else{$(f).data('callerNode',node)}})}$.ajax({url:'/-/cms/v1/email/?act=checkConfirmation&hash='+hash+'&'+window.access,type:"GET",async:false,success:function(response){if(response.hasOwnProperty('error')){self.onError(response);return}var emailConfirmed=response;if(emailConfirmed){self.updateListItem(node,hash)}else{S3Ajax.openAjaxPopup({type:'dynamic',link:'/-/cms/v1/email/?act=confirmData&hash='+hash+'&'+window.access,onOpen:onOpen})}},})},resend:function(button,hash){var self=this,$form,$button;$button=$(button);$form=$('#resend_form').get(0);$.ajax({url:'/-/cms/v1/email/?act=resend&hash='+hash+'&'+window.access,type:"GET",async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}}).complete(function(){$button.prop('disabled',true);if($form){self._attachConfirmCountdown(hash)}})},updateListItem:function(node,hash,onComplete){var self=this;$.ajax({url:'/-/cms/v1/email/?act=listItem&hash='+hash+'&single='+$(node).data('single')+'&'+window.access,type:"GET",async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}util.msg(JS_DONE);self._replaceNode($(node).closest('TR'),response)}).complete(function(jqXHR,statusText){onComplete(jqXHR,statusText)})},confirm:function(e,form,hash){if(!e){e=window.event}if(form.code==undefined||!form.code.value){e.stopPropagation();return false}var self=this,callerNode;$.ajax({url:'/-/cms/v1/email/?act=confirm&'+window.access,type:"POST",data:{hash:hash,code:form.code.value},async:false}).done(function(response){if(response.hasOwnProperty('error')){S3PopUp.open('alert',JS_ERROR+" #"+response.error.code+": "+response.error.message);e.stopPropagation();if(response.error.code==self.ERR_TOO_MANY_CONFIRMATION_ATTEMPTS){$(form).closest('.confirm_by_code_form_container').hide().parent().find('.confirm_by_code_block_container').show()}}else{if(callerNode=$(form).data('callerNode')){self.updateListItem(callerNode,hash,function(){S3PopUp.closeLastPopup()})}}});return false},chackadd:function(form,container){var email=form.email.value.trim(),label=$(container).find('.email-address label'),send=true;if(email==''){return false}label.each(function(){if($(this).text()==email){send=false;var this_label=this;if(!window.isStaffUser){S3PopUp.open('alert',s3.loc('JS_EMAIL_ADDRESS_IS_ALREADY_LISTED_CL'))}else{S3PopUp.open('confirm',s3.loc('JS_EMAIL_ADDRESS_IS_ALREADY_LISTED'),function(){s3Email.add(form,container);$(this_label).closest('tr').empty().remove()})}}});if(send){s3Email.add(form,container)}return false},add:function(form,container){var self=this,email=form.email.value.trim(),name=form.name.value.trim(),single=form.single.value;if(email==''){return false}$.ajax({url:'/-/cms/v1/email/?act=add&'+window.access,type:"POST",data:{email:email,name:name,single:single},async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}if(!window.isStaffUser){S3PopUp.open('alert',JS_EMAIL_CONFIRMATION_SENT.replace('%EMAIL%',email))}var newTr=$(response);$(container).append(newTr);newTr.S3ChangeControls();fadeController.init(newTr.get(0));form.reset()});return false},checkConfirmation:function(hash){var self=this;$.ajax({url:'/-/cms/v1/email/?act=checkConfirmation&hash='+hash+'&'+window.access,type:"GET",async:false,success:function(response){util.msg(JS_DONE);self._replaceNode($(node).closest('TR'),response)},}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}var emailConfirmed=response;if(emailConfirmed){S3PopUp.closeLastPopup();S3PopUp.reloadLastPopup()}else{S3PopUp.open('alert',JS_EMAIL_NOT_CONFIRMED)}})},onError:function(response){var errorMessage;if(window.isStaffUser){errorMessage='<b>'+JS_ERROR+(response.error.code?' #'+response.error.code:'')+'</b><br/><br/>'+response.error.message}else{errorMessage='<b>'+JS_ERROR+'</b><br/><br/>'+response.error.message}S3PopUp.open('alert',errorMessage)}};s3Phone={ERR_TOO_MANY_CONFIRMATION_ATTEMPTS:1001,remove:function(node,hash){jQuery_S3.deleteObject({obj:node,url:'/-/cms/v1/phone/?act=remove&hash='+hash+'&'+window.access,parent:'tr',msg:s3.loc('JS_CONFIRM_DELETE')});return false},removeControlItem:function(itemContainer,email,input){var emails=input.value.split(',');var i=emails.indexOf(email);if(i!=-1){emails.splice(i,1).join(',');input.value=emails}$(itemContainer).remove()},_attachConfirmCountdown:function(hash){var self=this;$.ajax({url:'/-/cms/v1/phone/?act=confirmResendCountdown&hash='+hash+'&'+window.access,type:"GET",async:false,success:function(response){if(response.hasOwnProperty('error')){self.onError(response);return}var $c=$(response),$countdownValue=parseInt($c.find('s3-integer').text());$('#resend_container').after($c);if($countdownValue<=0){$c.css('display','none')}util.initCountdown($c.find('s3-integer').get(0),1e3,function(){$('#resend_button').prop('disabled',false);$c.remove()})},})},openConfirmPopup:function(node,hash){var self=this;function onSubmitConfirmByUrl(){self.updateListItem(node,hash,function(){S3PopUp.closeLastPopup()});return false}function onOpen(popup){popup.find('form').each(function(i,f){if(f.name=='confirm_by_url'){$(f).submit(onSubmitConfirmByUrl);self._attachConfirmCountdown(hash)}else{$(f).data('callerNode',node)}})}S3Ajax.openAjaxPopup({type:'dynamic',link:'/-/cms/v1/phone/?act=confirmData&hash='+hash+'&'+window.access,isReloaded:true,onOpen:onOpen})},resend:function(button,hash){var self=this,$form,$button;$button=$(button);$form=$('#resend_form').get(0);$.ajax({url:'/-/cms/v1/phone/?act=resend&hash='+hash+'&'+window.access,type:"GET",async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}}).complete(function(){$button.prop('disabled',true);S3PopUp.reloadLastPopup();if($form){self._attachConfirmCountdown(hash)}})},updateListItem:function(node,hash,onComplete){var self=this;$.ajax({url:'/-/cms/v1/phone/?act=listItem&hash='+hash+'&'+window.access,type:"GET",async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}util.msg(JS_DONE);jQuery_S3.replaceNode($(node).closest('TR'),response)}).complete(function(jqXHR,statusText){onComplete(jqXHR,statusText)})},confirm:function(e,form,hash){if(!e){e=window.event}if(form.code==undefined||!form.code.value){e.stopPropagation();return false}var self=this,callerNode;$.ajax({url:'/-/cms/v1/phone/?act=confirm&'+window.access,type:"POST",data:{hash:hash,code:form.code.value},async:false}).done(function(response){if(response.hasOwnProperty('error')){var errorTextTitle=s3.loc(JS_ERROR);e.stopPropagation();if(response.error.code==self.ERR_TOO_MANY_CONFIRMATION_ATTEMPTS){$(form).closest('.confirm_by_code_form_container').hide().parent().find('.confirm_by_code_block_container').show();S3PopUp.reloadLastPopup()}else{S3PopUp.open('alert',response.error.message);S3PopUp.setTitle(errorTextTitle+(response.error.code?' #'+response.error.code:''))}}else{if(callerNode=$(form).data('callerNode')){self.updateListItem(callerNode,hash,function(){S3PopUp.closeLastPopup()})}}});return false},append:function(container){var self=this;var control=$(container).find('input:hidden:first');var onOpen=function(popup){var v=control.val();if(!v){return}var emails=v.split(',');popup.find(':checkbox').each(function(){if(emails.indexOf(this.value)!=-1){$(this).prop('checked',true)}})};var onClose=function(popup){var numbers=[];popup.find(':checkbox').each(function(){if(this.checked){numbers.push(this.value)}});$.ajax({url:'/-/cms/v1/phone/?act=controlList&'+window.access,data:{numbers:numbers,control_name:control.attr('name')},type:"POST",async:false,contentType:'application/x-www-form-urlencoded; charset=UTF-8'}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}jQuery_S3.replaceNode(container,response)})};S3Ajax.openAjaxPopup({type:'dynamic',link:'/-/cms/v1/phone/?'+window.access,isReloaded:true,onClose:onClose,onOpen:onOpen})},appendFromShowOnly:function(container){var onOpen=function(popup){};var onClose=function(popup){S3PopUp.reloadLastPopup()};S3Ajax.openAjaxPopup({type:'dynamic',link:'/-/cms/v1/phone/?'+window.access,isReloaded:true,onClose:onClose,onOpen:onOpen})},add:function(form,container){var self=this,number=form.number.value.trim();if(number==''){return false}$.ajax({url:'/-/cms/v1/phone/?act=add&'+window.access,type:"POST",data:{number:number},async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}var resultText=JS_PHONE_CONFIRMATION_SENT.replace('%PHONE%',number);var textTitle=s3.loc(JS_WARNING_TITLE);S3PopUp.open('alert',resultText);S3PopUp.setTitle(textTitle);var newTr=$(response);$(container).find('.s3-placeholder').remove();$(container).append(newTr);newTr.S3ChangeControls();fadeController.init(newTr.get(0));form.reset()}).fail(function(response){var textError=s3.loc(JS_SMS_GATEWAY_UNAVAILABLE);S3PopUp.open('alert',textError);S3PopUp.setTitle(errorTextTitle)});return false},onError:function(response){var errorMessage;if(window.isStaffUser){errorMessage='<b>'+JS_ERROR+(response.error.code?' #'+response.error.code:'')+'</b><br/><br/>'+response.error.message}else{errorMessage='<b>'+JS_ERROR+'</b><br/><br/>'+response.error.message}S3PopUp.open('alert',errorMessage)}};var image_insert={old:false,caller:false,error:false,click:function(current,path,width,height,alt,opt){$('.image_insert_format_selected').attr('class','image_insert_format');$(current).attr('class','image_insert_format_selected');if(!opt){$('#_custom_image_size').attr("hidden","hidden");$('#s3_image_preview').html('<img src="'+path+'"'+(width?' width="'+width+'"':'')+(height?' height="'+height+'"':'')+(alt?' alt="'+alt+'"':'')+' style="border-width: 0">')}else{$('#_custom_image_size').removeAttr("hidden");image_insert.optionalSize('/-/cms/v1/image/?act=src&',$('#_custom_image_size').get(0),path)}},unset_old:function(){image_insert.old=false},insert:function(){if(!image_insert.error){image_insert.unset_old();if(image_insert.caller){image_insert.caller($('#s3_image_preview').html())}}},optionalSize:function(url,f,alt){var width=f.elements['width'].value;var height=f.elements['height'].value;if(width==0&&height==0){$('#s3_image_preview').html("");image_insert.error=true;return false}width=width==0?'-':width;height=height==0?'-':height;f.elements['width'].value=width;f.elements['height'].value=height;url+=formcontents(f)+"&image_source="+encodeURIComponent(alt);var r=util.makeGetRequest(url);if(r.error){s3.alertHTML(r.text);return false}$('#s3_image_preview').html('<img src="'+r.text+'"'+(alt?' alt="'+alt+'"':'')+' style="border-width: 0">');image_insert.error=false;return false},checkSizeValue:function(input,errorcont,maxval){var num_regex=/(^[1-9]\d{1,3}$)|(^-$)/,valError=false;if(!num_regex.test(input.value)){valError=true}if(input.value>maxval){valError=true}if(valError){image_insert.error=true;input.focus();input.value='-';$(input).fadeOut(500).fadeIn(500)}else{if(image_insert.error){$(errorcont).html("")}image_insert.error=false}}};var folderStorage={containerId:'folder_scroll_div',elementTag:'DIV',elementPrefix:'folder-draggable-',url:'/-/cms/v1/folder/?act=storage&'+access,updated:false,lang_no_changes:JS_NOTHING_IS_CHANGED,lang_saved:JS_CHANGES_SAVED,lang_saved_error:JS_ERROR_WHILE_SAVING_CHANGES,lang_unload_confirm:JS_UNLOAD_SAVE_CHANGES_CONFIRM,lang_on_update:JS_SAVING_FOLDER_STRUCTURE_INSTRUCTION,tree_id:0,menu_modified:'',onUpdate:function(){tree_id=$('#folder-draggable-root').parent().data('tree-id');menu_modified=$('#folder-draggable-root').parent().data('menu-modified');var last_menu_modified=treeController.getTreeModified(tree_id,menu_modified,true);if(!folderStorage.updated&&menu_modified==last_menu_modified){s3.alert(folderStorage.lang_on_update)}folderStorage.updated=true;document.getElementById('saveFolderOrder').style.display=''},onUnload:function(){if(this.updated){if(confirm(this.lang_unload_confirm))this.save()}},save:function(folder_global){if(!this.updated){s3.alert(this.lang_no_changes);return false}var main=document.getElementById(this.containerId);var elements=main.getElementsByTagName(this.elementTag);var s='';var level=0;var parent;var id=0;for(i=0;i<elements.length;i++){if(elements[i].id.substring(0,this.elementPrefix.length)==this.elementPrefix){id=elements[i].id.substring(this.elementPrefix.length)}else{continue}parent=elements[i].parentNode;level=0;while(parent&&parent!=main){parent=parent.parentNode;level++}s+="\n"+id+"="+level}if(tree_id!==0&&menu_modified!==''){var res=util.makePostRequest(this.url,"lines="+s+"&global="+folder_global+"&tree_id="+tree_id+"&menu_modified="+menu_modified)}else{var res=util.makePostRequest(this.url,"lines="+s+"&global="+folder_global)}if(res.error){s3.alert(this.lang_saved_error)}else{s3.alert(this.lang_saved,function(){folderStorage.cancel()});this.updated=false;document.getElementById('saveFolderOrder').style.display='none'}},cancel:function(){popupController.reloadLastPopup();this.updated=false}};var requestController={progressDiv:null,inProgress:false,currentRequest:null,queue:[],mode:'queue',getProgressDiv:function(){if(!this.progressDiv){this.progressDiv=document.getElementById('progressDiv');if(!this.progressDiv&&document&&document.body){this.progressDiv=document.createElement('DIV');this.progressDiv.style.position='absolute';this.progressDiv.style.display='none';this.progressDiv.style.backgroundColor='red';this.progressDiv.style.color='white';this.progressDiv.style.padding='0px';this.progressDiv.style.left='90%';this.progressDiv.style.top='1px';this.progressDiv.style.width='10%';this.progressDiv.style.zIndex=100000;document.body.appendChild(this.progressDiv)}}return this.progressDiv},showProgress:function(message){var d=this.getProgressDiv();d.innerHTML="<div style=\"padding:5px;\">"+message+"</div>";d.style.display=''},hideProgress:function(message){this.progressDiv.style.display='none'},makeGetRequest:function(url,func){var q={};q.url=url;q.func=func;this.queue.push(q);this.next()},buildRequest:function(){var req=null;if(window.XMLHttpRequest){req=new XMLHttpRequest();if(req.overrideMimeType)req.overrideMimeType('text/html')}else if(window.ActiveXObject){req=new ActiveXObject("Msxml2.XMLHTTP")}if(!req){alert("Can't create XMLHTTP request");return false}return req},requestOnChange:function(req,func){if(req.readyState==4){this.showProgress("Готово...");var result=null;if(req.status==200){try{result=eval(req.responseText)}catch(ex){alert("Error "+escape(req.responseText))}}else{alert("Error server return "+req.status)+" status "}this.hideProgress();if(func)func(result);this.inProgress=false;this.next()}},next:function(){if(!this.inProgress){this.inProgress=true;this.showProgress('...');var req=this.buildRequest();if(!req){alert("Your browser don't support XMLHttpRequest");this.hideProgress();this.inProgress=false;return false}var cur=this.queue.shift();if(!cur){this.hideProgress();this.inProgress=false;return false}try{if(cur.func){req.onreadystatechange=function(){requestController.requestOnChange(req,cur.func)}}cur.url=this.urlParamReplace(cur.url,'r',new Date().getTime());req.open('GET',cur.url,true);req.send('');return true}catch(ex){alert(ex);this.inProgress=false;return false}}},urlParamReplace:function(url,param_name,param_value){var url=new String(url);if(url.indexOf("&"+param_name+"=")!=-1||url.indexOf("?"+param_name+"=")!=-1){var pattern=param_name+'\\=[^\\&]*';var replace="";if(param_value!=''){replace=param_name+"="+encodeURIComponent(param_value);url=url.replace(eval(new String('/([&?])'+pattern+'/').toString()),'$1'+replace)}else{replace='';url=url.replace(eval(new String('/[?]'+pattern+'\\&/').toString()),'?'+replace);url=url.replace(eval(new String('/[&?]'+pattern+'/').toString()),replace)}}else if(param_value!=''){if(url.indexOf('?')==-1)url=url+"?";else url=url+"&";url=url+param_name+"="+encodeURIComponent(param_value)}return url}};cache={};sending=false;function reloadChilds(obj,childs){var f=getParent(obj,"FORM");if(f){if(obj.nodeName=="SELECT"){var g=obj.name;if(!g)g=obj.id;var i=0;for(i=0;i<childs.length;i++){var child=f.elements[childs[i]];if(child){if(child.nodeName=="SELECT"){clearSelect(child);addOption(child,"","Загрузка...")}}}var lastOpenPopup=popupController.getLastPopup();if(lastOpenPopup==null){var url=s3.lastContentUrl}else{var url=lastOpenPopup.url}if(!url)url=document.location;url=requestController.urlParamReplace(url,"_mode","reloadChildControls");url=requestController.urlParamReplace(url,"_parent_control",obj.name);url=requestController.urlParamReplace(url,"_parent_control_value",obj.options[obj.selectedIndex].value);var __func=function(r){fillSelects(f,r)};requestController.makeGetRequest(url,__func)}}}function getParent(obj,tagname){obj=obj.parentNode;return this.getElement(obj,tagname)}function fillSelect(sel,arr){if(sel){clearSelect(sel);addOption(sel,"","  ");for(var i in arr){addOption(sel,i,arr[i])}}}function fillSelects(f,data){var i,j;for(i in data){if(f.elements[i]){if(f.elements[i].nodeName=="SELECT"){fillSelect(f.elements[i],data[i]);if($(f.elements[i]).hasClass('s3-select')){$(f.elements[i]).trigger('liszt:updated')}}}else if((f.elements[i+"[]"])){if(f.elements[i+"[]"].nodeName=="SELECT"){fillSelect(f.elements[i+"[]"],data[i])}}}}function addOption(sel,optionValue,optionText){if(sel){var o=new Option(optionText,optionValue);if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1)sel.add(o,sel.options[sel.options.length]);else sel.add(o,sel.options.length)}}function clearSelect(obj){while(obj.options.length>0){obj.remove(0)}}function getElement(obj,tagname){while(obj&&(obj.nodeName!=tagname))obj=obj.parentNode;return obj}function switchSelectAddText(obj,id,isNextElement=false){if(obj.checked==false){if(isNextElement){var d=document.getElementById(id).nextElementSibling}else{var d=document.getElementById(id)}if(d)d.style.display='';d.focus();d=document.getElementById(id+"_add");if(d){d.value="";d.style.display='none'}}else{var d=document.getElementById(id+"_add");if(d){d.style.display='';d.focus()}if(isNextElement){d=document.getElementById(id).nextElementSibling}else{d=document.getElementById(id)}if(d){d.value="";d.style.display='none';d.selectedIndex=0}}}function deleteImage(id,controlName){var a=document.getElementById("image_"+id);if(a)a.parentNode.removeChild(a);delete a;a=document.getElementById(controlName+"_image_select_div");if(a){a.style.display='block'}a=document.getElementById(controlName);if(a){if(a.value.indexOf(",")==-1){a.value=""}else{var b=a.value.split(1);a.value="";for(var i=0;i<a.length;i++){if(b[i]!=id){if(a.value!="")a.value+=",";a.value+=b[i]}}}}}function addImage(obj){var a=obj.parentNode;if(a){var b=a.cloneNode(true);a.parentNode.insertBefore(b,a.nextSibling);obj.style.display='none'}}function dynamicChangeTemplate(obj,id,type_id,typeTpl){var val=document.getElementById(id).value;var res=util.makePostRequest('/my/s3/types/template.change.php?'+access,'type_id='+type_id+'&tpl='+val+'&type_tpl='+typeTpl);if(!res.error){s3.alert('Шаблон успешно сохранен')}else{s3.alert('Ошибка при сохранении')}}function dynamicGenerateTemplate(obj,url){var res=util.makeGetRequest(url);if(!res.error){s3.alert('Шаблон успешно сгенерирован');window.location.reload()}else{s3.alert(res.text)}}(function(){function FieldsMappingControl(){this.control_class_name='js-field-mapping-control';this.control_wrapper_class_name='js-field-mapping-wrap';this.control_result_input_class_name='js-field-mapping-control-input'}FieldsMappingControl.prototype.initControls=function(controls_parent){if(!controls_parent){return}var mapping_control_parents=controls_parent.querySelectorAll(this.getClassName(this.control_wrapper_class_name));var self=this;mapping_control_parents.forEach(function(mapping_control_parent){var result_input=mapping_control_parent.querySelector(self.getClassName(self.control_result_input_class_name));if(!result_input.value){result_input.value='{}'}var mapping_json=result_input.value;if(!mapping_json){return}var mapping_object=JSON.parse(mapping_json);var mapping_controls=mapping_control_parent.querySelectorAll(self.getClassName(self.control_class_name));mapping_controls.forEach(function(mapping_control){var field_name=mapping_control.getAttribute('data-fieldname');mapping_control.value=mapping_object[field_name]||0;var event=document.createEvent('Event');event.initEvent('change',true,true);mapping_control.dispatchEvent(event)})})};FieldsMappingControl.prototype.onControlChange=function(element){var controls_wrapper=element.closest(this.getClassName(this.control_wrapper_class_name));var controls=controls_wrapper.querySelectorAll(this.getClassName(this.control_class_name));var result_input=controls_wrapper.querySelector(this.getClassName(this.control_result_input_class_name));var result={};controls.forEach(function(control){var field_name=control.getAttribute('data-fieldname');result[field_name]=control.value});result_input.value=JSON.stringify(result)};FieldsMappingControl.prototype.getClassName=function(class_name){return'.'+class_name};window.fieldsMappingControl=new FieldsMappingControl()})();window.anketaResultAll={clickCalendarBtn:function(){var $thisValue=$(this).val();if($thisValue!=''){$('.reset_btn').addClass('active')}},clickSpamBtn:function(resultID,anketaID){const url='/-/cms/v1/anketa/result/?act=spam&${S3_ACCESS}&result_id=${resultID}&anketa_id=${anketaID}';s3.deleteObject(this,'TR',url,function(){s3.reloadVisibleContent()},s3.loc(JS_MOVE_TO_SPAM))},clickFormBtn:function(url){var $date_from=$(document.forms.anketa_export.date_from),$date_to=$(document.forms.anketa_export.date_to),$anketa_id=$('#result_list_anketa_id');if(!$date_from||!$date_to||!$anketa_id){return false}s3.reloadVisibleContent('/-/cms/v1/anketa/result/?all=1&date_from='+$date_from.val()+'&date_to='+$date_to.val()+'&anketa_id='+$anketa_id.val()+url)},clickRivertBtn:function(url){var $date_from=$(document.forms.anketa_export.date_from),$date_to=$(document.forms.anketa_export.date_to),$anketa_id=$('#result_list_anketa_id');if(!$date_from||!$date_to||!$anketa_id){return false}$date_from.val('');$date_to.val('');$anketa_id.val(0);s3.reloadVisibleContent('/-/cms/v1/anketa/result/?all=1&date_from='+$date_from.val()+'&date_to='+$date_to.val()+'&anketa_id='+$anketa_id.val()+url)},clickExportBtn:function(url){var $encode=$(document.forms.anketa_export.encoding),$date_from=$(document.forms.anketa_export.date_from),$date_to=$(document.forms.anketa_export.date_to),$anketa_id=$('#result_list_anketa_id');if(!$date_from||!$date_to||!$anketa_id||!$encode){return false}var popup=new PopupWindow('CRON_EXPORT_ANKETA_RESULTS');popup.center=true;popup.modal=true;popup.drag=true;popupController.showPopup(popup);var $anketa_export_from=$(document.forms.anketa_export).clone().append('<input name="all" value="1">').append('<input name="anketa_id" value="'+$anketa_id.val()+'">');queueFormData($anketa_export_from.get(0),url)},};window.anketa2ResultAll={clickFormBtn:function(url){var $date_from=$(document.forms.anketa_export.date_from),$date_to=$(document.forms.anketa_export.date_to),$anketa_id=$('#result_list_anketa_id');if(!$date_from||!$date_to||!$anketa_id){return false}s3.reloadVisibleContent('/-/cms/v1/anketa2/result/?all=1&date_from='+$date_from.val()+'&date_to='+$date_to.val()+'&anketa_id='+$anketa_id.val()+url)},clickRivertBtn:function(url){var $date_from=$(document.forms.anketa_export.date_from),$date_to=$(document.forms.anketa_export.date_to),$anketa_id=$('#result_list_anketa_id');if(!$date_from||!$date_to||!$anketa_id){return false}$date_from.val('');$date_to.val('');$anketa_id.val(0);s3.reloadVisibleContent('/-/cms/v1/anketa2/result/?all=1&date_from='+$date_from.val()+'&date_to='+$date_to.val()+'&anketa_id='+$anketa_id.val()+url)},clickExportBtn:function(url){var $encode=$(document.forms.anketa_export.encoding),$date_from=$(document.forms.anketa_export.date_from),$date_to=$(document.forms.anketa_export.date_to),$anketa_id=$('#result_list_anketa_id');if(!$date_from||!$date_to||!$anketa_id||!$encode){return false}location.href=url+$anketa_id.val()+'&all=1&encoding='+$encode.val()+'&date_from='+$date_from.val()+'&date_to='+$date_to.val()}};var ImageMaker=function(){};ImageMaker.prototype={url:"/-/cms/v1/image/?act=maker",maxWidth:570,maxHeight:440,prefix:browserController.isChrome?'webkitTransform':browserController.isFirefox?'MozTransform':browserController.isOpera?'OTransform':(browserController.isIE||browserController.isMSIE)?'-ms-transform':'transform',init:function(config){var self=this;if(this.isReady){return false}util.apply(this,config);var img=new Image();img.onload=function(){if(self.image){self.update();self.createCanvas();self.restore();self.createCropper();self._setDefaultDDHandler(self);self._setRotateHandler(self);self._setScrollHandler(self);var popup=popupController.getLastModalPopup();popup.onClose=popup.onReload=self.unbind();self.isReady=true;$(self.image).wrapAll("<div class='ov-hidden'></div>")}};img.src=config.image.src},onSuccess:function(){popupController.reloadLastPopup();this.update();this.restore();var image=$('#image'+this.id+' span.image-thumb'),url=image.css('background-image'),new_url=url.replace(/(\?\d*)/g,'?'+Math.random());image.add('.image-preview.image'+this.id).css({"background-image":new_url})},createCanvas:function(){var parent=this.image.parentNode;this.canvas=document.createElement('div');util.addClass(this.canvas,'im-canvas');parent.innerHTML='';this.canvas.appendChild(this.createResizer());parent.appendChild(this.canvas);return this.canvas},createResizer:function(){this.resizer=document.createElement('div');util.addClass(this.resizer,'im-resize');this.resizer.appendChild(this._createDDHandlers('resize'));this.resizer.appendChild(this.image);return this.resizer},createCropper:function(){var crop=document.createElement('div');util.addClass(crop,'im-crop');crop.style.display='none';crop.appendChild(this._createDDHandlers('crop'));this.resizer.appendChild(crop);this.crop={element:crop,top:this.height/4,left:this.width/4,width:this.width/2,height:this.height/2}},setCanvasBgColor:function(color){this.bgcolor=color;this.canvas.style.backgroundColor=color},getCenterX:function(){return this._getX(this.image)-this.offsetLeft+parseInt(this.width/2,10)},getCenterY:function(){return this._getY(this.image)-this.offsetTop+parseInt(this.height/2,10)},setSize:function(width,height){if(width>this.maxWidth)width=this.maxWidth;if(height>this.maxHeight)height=this.maxHeight;this.setWidth(width);this.setHeight(height)},setXY:function(x,y){this.setLeft(x);this.setTop(y)},setAngle:function(deg){var matrix,angle=Math.round(deg%360);if(angle&&angle===this.angle){return false}if(typeof browserController!='undefined'&&browserController.isMSIE){matrix=this._getMatrix(angle);this.image.style.filter='progid:DXImageTransform.Microsoft.Matrix(sizingMethod="auto expand", M11='+matrix.m11+', M12='+matrix.m12+', M21='+matrix.m21+',M22='+matrix.m22+')';this.offsetLeft=parseInt((this.height-this.image.offsetHeight)/2,10)-1;this.offsetTop=parseInt((this.width-this.image.offsetWidth)/2,10)-1;this.image.style.margin=this.offsetTop+'px '+this.offsetLeft+'px'}else{this.image.style[this.prefix]='rotate('+angle+'deg)'}this.angle=angle},setTop:function(top){this.top=parseInt(top,10);this.resizer.style.top=this.top+'px'+5},setLeft:function(left){this.left=parseInt(left,10);this.resizer.style.left=this.left+'px'+5},setWidth:function(width){this.width=parseInt(width,10);this.resizer.style.width=this.width+'px'},setHeight:function(height){this.height=parseInt(height,10);this.resizer.style.height=this.height+'px'},resize:function(dx,dy){this.resizeSE(dx,dy||dx)},resizeN:function(dx,dy){dy=-dy;this.setTop(this.top-dy);this.resizeS(dx,dy)},resizeNE:function(dx,dy){this.resizeN(dx,dy);this.resizeE(dx,dy)},resizeE:function(dx,dy){this.setWidth(this.width+dx)},resizeSE:function(dx,dy){this.resizeE(dx,dy);this.resizeS(dx,dy)},resizeS:function(dx,dy){this.setHeight(this.height+dy)},resizeSW:function(dx,dy){this.resizeW(dx,dy);this.resizeS(dx,dy)},resizeW:function(dx,dy){dx=-dx;this.setLeft(this.left-dx);this.resizeE(dx,dy)},resizeNW:function(dx,dy){this.resizeN(dx,dy);this.resizeW(dx,dy)},setCropHeight:function(height){this.crop.height=parseInt(height,10);this.crop.element.style.height=this.crop.height+'px'},setCropWidth:function(width){this.crop.width=parseInt(width,10);this.crop.element.style.width=this.crop.width+'px'},setCropTop:function(top){this.crop.top=parseInt(top,10);this.crop.element.style.top=this.crop.top+'px'},setCropLeft:function(left){this.crop.left=parseInt(left,10);this.crop.element.style.left=this.crop.left+'px'},move:function(dx,dy){dx+=this.crop.left;dy+=this.crop.top;if(coordinatesController.left){if(dx>=0){this.setCropLeft(dx)}}else{if(this.width>=this.crop.width+dx){this.setCropLeft(dx)}}if(coordinatesController.up){if(dy>=0){this.setCropTop(dy)}}else{if(this.top>=this.crop.top+dy){this.setCropTop(dy)}}},crop:function(dx,dy){this.cropSE(dx,dy||dx)},cropN:function(dx,dy){dy=-dy;if(this.crop.top>dy&&this.crop.height+dy>0){this.setCropTop(this.crop.top-dy);this.cropS(dx,dy)}},cropNE:function(dx,dy){this.cropN(dx,dy);this.cropE(dx,dy)},cropE:function(dx,dy){dx+=this.crop.width;if(dx>0&&Math.min(this.maxWidth,this.width)>this.crop.left+dx){this.setCropWidth(dx)}},cropSE:function(dx,dy){this.cropE(dx,dy);this.cropS(dx,dy)},cropS:function(dx,dy){dy+=this.crop.height;if(dy>0&&Math.min(this.maxHeight,this.height)>this.crop.top+dy){this.setCropHeight(dy)}},cropSW:function(dx,dy){this.cropW(dx,dy);this.cropS(dx,dy)},cropW:function(dx,dy){dx=-dx;if(this.crop.left>dx&&this.crop.width+dx>0){this.setCropLeft(this.crop.left-dx);this.cropE(dx,dy)}},cropNW:function(dx,dy){this.cropN(dx,dy);this.cropW(dx,dy)},rotate:function(ddeg){this.setAngle(this.angle+ddeg)},getQuadrant:function(x,y){return x>0?y>0?1:4:y>0?2:3},getOmega:function(dx,dy){return Math.sqrt(dx*dx+dy*dy)},getFactor:function(x,y){return x?y/x:0},rotateByCoords:function(x,y,dx,dy){var d=this.rotateData,q=this.getQuadrant(x,y),k=this.getFactor(x,y),o=this.getOmega(dx,dy);if(d.k!==k){this.rotate((d.q===q?d.k>k:q===1||q===3?d.q===2:d.q===3)?o:-o);d.q=q;d.k=k}},toggleCropper:function(elem){var style=this.crop.element.style;style.display=style.display==='none'?'block':'none';this.inCrop=!this.inCrop;elem.toggleClass('active')},scroll:function(delta){if(delta){delta=delta>0?5:-5;switch(this.action){case'rotate':this.rotate(-delta);break;default:this.resize(delta)}}},update:function(){this.original={angle:0,action:'',direction:'',inDrag:false,inCrop:false,width:this.image.naturalWidth||this.image.width,height:this.image.naturalHeight||this.image.height,left:5,top:5,offsetTop:0,offsetLeft:0}},save:function(){var response,params=this.getSaveParams();if(params){try{response=eval('('+util.makePostRequest(this.url,params).text+')')}catch(e){util.log("No response from server",e)}if(response.success){util.msg("JS_SAVED");this.onSuccess()}else{util.log("Image was not saved!")}}},unbind:function(){var self=this;return function(){coordinatesController.removeHandler('im-handler-'+self.id);self.isReady=false}},getSaveParams:function(){var url='';if(this.width!==this.original.width||this.height!==this.original.height){url+='&resize[width]='+this.width;url+='&resize[height]='+this.height}if(this.angle){url+='&rotate='+this.angle}if(this.inCrop){url+='&crop[width]='+this.crop.width;url+='&crop[height]='+this.crop.height;url+='&crop[left]='+this.crop.left;url+='&crop[top]='+this.crop.top}if(this.bgcolor){url+='&background='+this.bgcolor}return url?'image_id='+this.id+(this.appendUrl?'&'+this.appendUrl:'')+url:false},restore:function(){util.apply(this,this.original);this.setXY(this.left,this.top);this.setSize(this.width,this.height);this.setAngle(this.angle)},getScrollDelta:function(e){return e.wheelDelta?Math.round((e.wheelDelta/(e.wheelDelta>80?120:80))):e.detail?-e.detail/3:0},_setScrollHandler:function(scope){var wheel=function(e){e=e||window.event;util.cancelEvent(e);scope.scroll.call(scope,scope.getScrollDelta(e))};util.addEvent([this.image,this.resizer,this.cropper],"DOMMouseScroll",wheel);window.onmousewheel=document.onmousewheel=wheel},_setRotateHandler:function(){var self=this;util.addEvent(this.image,'mousedown',function(e){util.cancelEvent(e);var x=coordinatesController.x-self.getCenterX(),y=self.getCenterY()-coordinatesController.y;util.apply(self,{inDrag:true,action:'rotate',direction:'',rotateData:{k:self.getFactor(x,y),q:self.getQuadrant(x,y)}})})},_setMoveHandler:function(el){var self=this;util.addEvent(el.element,'mousedown',function(e){util.cancelEvent(e);util.apply(self,{inDrag:true,action:'move',direction:''})})},_createDDHandlers:function(action){var div,i,fragment=document.createDocumentFragment(),postfixes=['n','e','s','w','ne','se','sw','nw'];for(i=0;i<postfixes.length;i+=1){div=document.createElement('div');util.addClass(div,'im-'+action+'-def im-'+action+'-'+postfixes[i]);util.addEvent(div,'mousedown',this._applyStatus(this,{inDrag:true,action:action,direction:postfixes[i].toUpperCase()}));fragment.appendChild(div)}return fragment},_applyStatus:function(scope,data){return function(e){util.cancelEvent(e);util.apply(scope,data)}},_setDefaultDDHandler:function(scope){util.addEvent(document,'mouseup',this._applyStatus(this,{inDrag:false,action:'',direction:''}));coordinatesController.addHandler(function(){if(this.inDrag){if(this.inCrop){if(this.action==='crop'){this[this.action+this.direction](coordinatesController.deltaX,coordinatesController.deltaY)}}else{if(this.action==='rotate'){this.rotateByCoords(coordinatesController.x-this.getCenterX(),this.getCenterY()-coordinatesController.y,coordinatesController.deltaX,coordinatesController.deltaY)}else{this[this.action+this.direction](coordinatesController.deltaX,coordinatesController.deltaY)}}}},'im-handler-'+this.id,this);if(browserController.isMSIE){util.addEvent(document.body,"selectstart",function(){return!scope.inDrag})}},_getX:function(obj){var x=0;if(obj.offsetParent){while(obj.offsetParent){x+=obj.offsetLeft;obj=obj.offsetParent}}else{if(obj.x){x=obj.x}}return x},_getY:function(obj){var y=0;if(obj.offsetParent){while(obj.offsetParent){y+=obj.offsetTop;obj=obj.offsetParent}}else{if(obj.y){y=obj.y}}return y},_getMatrix:function(deg){var rad=this._degToRad(deg),c=Math.cos(rad),s=Math.sin(rad);return{m11:c,m12:-s,m21:s,m22:c}},_degToRad:function(deg){return(deg-360)*Math.PI/180}};var imageMaker=new ImageMaker();(function(){var undefined,window=this;var xedit=null;window.xedit=xedit={insertTabChar:"\t",doubleRow:true,indentNewLine:true,doubleExplode:true,eol:"\n",isIE:false,isOpera:false,isGecko:false,isChrome:false,regs:[],keeper:false,lineHeight:20,getSelectionPos:function(textarea){if(textarea.selectionStart!==undefined){return{"start":textarea.selectionStart,"end":textarea.selectionEnd,"scrollTop":textarea.scrollTop,"selected":(textarea.selectionStart===textarea.selectionEnd)?false:true}}else if(document.selection){var range=document.selection.createRange();var dpl=range.duplicate();dpl.moveToElementText(textarea);dpl.setEndPoint("EndToEnd",range);if(range.text.length>0){return{"start":dpl.text.length-range.text.length,"end":dpl.text.length,"scrollTop":textarea.scrollTop,"selected":true}}else{return{"start":dpl.text.length-range.text.length,"end":dpl.text.length-range.text.length,"scrollTop":textarea.scrollTop,"selected:":false}}}else{return{"start":0,"end":0}}},setSelectionPos:function(textarea,start,end,scrollTop){if(textarea.setSelectionRange!==undefined){textarea.setSelectionRange(start,end)}else if(textarea.selectionStart!==undefined){textarea.selectionStart=start;textarea.selectionEnd=end}else if(textarea.createTextRange){var selection=textarea.createTextRange();selection.collapse(true);var _fixB=textarea.value.substring(0,start).match(/\r/g);var fixB=_fixB?_fixB.length:0;var _fixI=textarea.value.substring(start,end).match(/\r/g);var fixI=_fixI?_fixI.length:0;selection.moveEnd("character",end-fixB-fixI);selection.moveStart("character",start-fixB);selection.select()}else{}if(scrollTop!==undefined)textarea.scrollTop=scrollTop},getSelectText:function(textarea){textarea.focus();if(textarea.selectionStart!==undefined){return(textarea.value).substring(textarea.selectionStart,textarea.selectionEnd)}else if(document.selection){return document.selection.createRange().text}else return false},replaceSelectText:function(textarea,text,selectSelf){selectSelf=!!selectSelf;var select=xedit.getSelectionPos(textarea);if(document.selection){document.selection.createRange().text=text}else{textarea.value=textarea.value.replace(new RegExp("^((?:.|\\s){"+select.start+"})((?:.|\\s){"+(select.end-select.start)+"})"),"$1"+text);if(!selectSelf){xedit.setSelectionPos(textarea,select.start+text.length,select.start+text.length,select.scrollTop)}}if(selectSelf){xedit.setSelectionPos(textarea,select.start,select.start+text.length,select.scrollTop)}return true},hasSelectText:function(textarea){var select=xedit.getSelectionPos(textarea);return select.selected},completeSelectLines:function(textarea){var select=xedit.getSelectionPos(textarea);var newStart=select.start;var newEnd=select.end;do{if(!textarea.value.charAt(newStart-1))break;var ch=textarea.value.charAt(newStart-1);if(ch==="\n"||ch==="\r")break;newStart--}while(1);do{if(!textarea.value.charAt(newEnd+1))break;var ch=textarea.value.charAt(newEnd);if(ch=="\n"||ch=="\r")break;newEnd++}while(1);xedit.setSelectionPos(textarea,newStart,newEnd);return newStart},trimLeft:function(textarea){var select=xedit.getSelectionPos(textarea);if(textarea.value.charAt(select.start-1)=="\t"){xedit.setSelectionPos(textarea,select.start-1,select.end);xedit.replaceSelectText(textarea,"",false)}},init:function(textarea,e,triggerSave){var key=e.keyCode||e.which;if(e.ctrlKey){if(e.altKey){if(key===38&&xedit.doubleRow)xedit.copyRowUp(textarea,true);if(key===40&&xedit.doubleRow)xedit.copyRowDown(textarea,true);if(key==97)xedit.selectRow(textarea)}if(triggerSave&&((xedit.isIE||xedit.isChrome)?(key===83?1:0):(key===115?1:0))){xedit.cancelEvent(e);triggerSave(textarea)}}else{if(!e.altKey){if(key==9){if(e.shiftKey){if(xedit.hasSelectText(textarea)){xedit.completeSelectLines(textarea);var text=xedit.getSelectText(textarea);text=text.replace(xedit.regs[0],"$1");text=text.replace(/^(\t| {1,4})/,"");xedit.replaceSelectText(textarea,text,true)}else{xedit.trimLeft(textarea)}}else{if(xedit.hasSelectText(textarea)){xedit.completeSelectLines(textarea);var text=xedit.getSelectText(textarea);text=xedit.insertTabChar+text.replace(xedit.regs[1],"$1"+xedit.insertTabChar);xedit.replaceSelectText(textarea,text,true)}else{xedit.replaceSelectText(textarea,xedit.insertTabChar,false)}}xedit.cancelEvent(e);textarea.focus();return false}}}if(key===13&&xedit.indentNewLine){var select=xedit.getSelectionPos(textarea);var start=xedit.completeSelectLines(textarea);var text=xedit.getSelectText(textarea);var textBegin=text.substring(0,select.start-start);var textEnd=text.substring(select.end-start,text.length);var scrollTop=textarea.scrollTop;var indent=textBegin.match(/^\s+/);if(!indent&&!e.ctrlKey){xedit.setSelectionPos(textarea,select.start,select.end);return true}var indent=indent?indent[0]:"";if(e.ctrlKey&&xedit.doubleExplode&&textEnd.length>0)text=textBegin+xedit.eol+indent+xedit.eol+indent+textEnd;else text=textBegin+xedit.eol+indent+textEnd;xedit.replaceSelectText(textarea,text,false);var s=start+textBegin.length+xedit.eol.length+indent.length;xedit.setSelectionPos(textarea,s,s,scrollTop+xedit.lineHeight);xedit.cancelEvent(e);textarea.focus();return false}return true},bind:function(elemnts,saveFunc){if(typeof elemnts!=="object")return;if(elemnts[0]!==undefined){for(var i=0;i<elemnts.length;i++){xedit.bind(elemnts[i],saveFunc)}}else{if(xedit.isIE||xedit.isChrome)xedit.event(elemnts,"keydown",function(event){xedit.init(elemnts,event,saveFunc)});else xedit.event(elemnts,"keypress",function(event){xedit.init(elemnts,event,saveFunc)})}},event:function(object,event,handler,useCapture){if(object.addEventListener){object.addEventListener(event,handler,!!useCapture)}else if(object.attachEvent){object.attachEvent('on'+event,handler)}else{object["on"+event]=handler}},cancelEvent:function(e){if(e.cancelBubble!==undefined)e.cancelBubble=true;if(e.stopPropagation)e.stopPropagation();if(e.preventDefault)e.preventDefault();e.returnValue=false},setSettings:function(settings){for(var key in settings){if(xedit[key]!==undefined&&typeof xedit[key]!=="function"){xedit[key]=settings[key]}}},define:function(){var ua=navigator.userAgent.toLowerCase();xedit.isIE=(ua.indexOf("msie")!=-1&&ua.indexOf("opera")==-1);xedit.isGecko=(ua.indexOf("gecko")!=-1);xedit.isOpera=(ua.indexOf("opera")!=-1);xedit.isChrome=(ua.indexOf("chrome")!=-1);xedit.eol=(ua.indexOf("mac")!=-1)?"\r":(ua.indexOf("windows")!=-1)?"\r\n":"\n";if(xedit.isGecko)xedit.eol="\n";xedit.regs=[new RegExp("("+xedit.eol+")(\t| {1,4})","g"),new RegExp("("+xedit.eol+")","g")];window.onbeforeunload=function(){var quest=null;if(typeof(xedit.keeper)==="function")quest=xedit.keeper();else quest=xedit.keeper;if(quest)return quest};return true},copyRowUp:function(textarea,selectSelf){selectSelf=!!selectSelf;var start=xedit.completeSelectLines(textarea);var text=xedit.getSelectText(textarea);var textLength=text.length;var scrollTop=textarea.scrollTop;text+=xedit.eol+text;xedit.replaceSelectText(textarea,text,false);if(selectSelf)xedit.setSelectionPos(textarea,start,start+textLength,scrollTop-xedit.lineHeight)},copyRowDown:function(textarea,selectSelf){selectSelf=!!selectSelf;var start=xedit.completeSelectLines(textarea);var text=xedit.getSelectText(textarea);var textLength=text.length;var scrollTop=textarea.scrollTop;text+=xedit.eol+text;xedit.replaceSelectText(textarea,text,false);if(selectSelf){xedit.setSelectionPos(textarea,start+textLength+xedit.eol.length,start+textLength*2+xedit.eol.length,scrollTop+xedit.lineHeight)}},selectRow:function(textarea){xedit.completeSelectLines(textarea)},keepPage:function(keeper){if(!keeper)xedit.keeper=false;else xedit.keeper=keeper}}})();xedit.define();var amMap={mapObjId:"ammap",movieLatId:"ammap_movie_lat",movieLngId:"ammap_movie_lng",zoomId:"ammap_zoom",zoomXId:"ammap_zoom_x",zoomYId:"ammap_zoom_y",defSettingsId:"default_map_settings",defDataId:"default_map_data",mapData:new Array(),so:new Array(),clientSide:false,getObj:function(obj){if(typeof(obj)=='string')return document.getElementById(obj);else return null},getMapObj:function(mapId){return this.getObj(this.mapObjId+mapId)},getMovieLat:function(mapId){var val=this.getObj(this.movieLatId+mapId).value;return(val!=""?parseFloat(val):0)},getMovieLng:function(mapId){var val=this.getObj(this.movieLngId+mapId).value;return(val!=""?parseFloat(val):0)},setMovieLat:function(mapId,val){this.getObj(this.movieLatId+mapId).value=val},setMovieLng:function(mapId,val){this.getObj(this.movieLngId+mapId).value=val},setZoomInfo:function(mapId,zoom_x,zoom_y,zoom){this.getObj(this.zoomId+mapId).value=zoom;this.getObj(this.zoomXId+mapId).value=zoom_x;this.getObj(this.zoomYId+mapId).value=zoom_y},getZoom:function(mapId){var val=this.getObj(this.zoomId+mapId).value;return(val!=""?parseFloat(val):0)},getZoomX:function(mapId){var val=this.getObj(this.zoomXId+mapId).value;return(val!=""?parseFloat(val):0)},getZoomY:function(mapId){var val=this.getObj(this.zoomYId+mapId).value;return(val!=""?parseFloat(val):0)},setReturnedMapData:function(mapId,val){this.mapData[mapId]=unescape(val)},getReturnedMapData:function(mapId){return this.mapData[mapId]},getData:function(mapId){this.getObj(this.mapObjId+mapId).getData()},setData:function(mapId,data){this.getObj(this.mapObjId+mapId).setData(data)},isClient:function(){return this.clientSide},getMovieNode:function(mapId){var movie='';movie+='<movie ';movie+=' file="target" xtitle="Label" width="10" height="10" fixed_size="true" ';movie+='lat="'+this.getMovieLat(mapId)+'" long="'+this.getMovieLng(mapId)+'"';movie+='></movie>';return movie},getParsedMovie:function(mapId,mapData){var regCond=/<movies \/>/i;var newNode=this.getMovieNode(mapId);if(mapData.indexOf('<movies />')==-1)regCond=/<movies>.*<\/movies>/i;return mapData.replace(regCond,'<movies>'+newNode+'</movies>')},updateMovieData:function(mapId){var mapData=this.getReturnedMapData(mapId);if(mapData==''||mapData==undefined){this.getData(mapId);mapData=this.getReturnedMapData(mapId)}this.setData(mapId,this.getParsedMovie(mapId,mapData))},getInitMapSettings:function(mapId){var mapSettings=this.unHtmlFilter(this.getObj(this.defSettingsId+mapId).value);return mapSettings},getInitMapData:function(mapId){var mapData=this.unHtmlFilter(this.getObj(this.defDataId+mapId).value);var zoom=this.getZoom(mapId);var zoomX=this.getZoomX(mapId);var zoomY=this.getZoomY(mapId);if(zoom!=''||zoomX!=''||zoomY!=''){var cond=/(<map[^>]*) (zoom|zoom_x|zoom_y)=[^ >]+/im;var newZoom=' '+'zoom="'+zoom+'%" zoom_x="'+zoomX+'%" zoom_y="'+zoomY+'%"';mapData=mapData.replace(cond,"$1").replace(cond,"$1").replace(cond,"$1"+newZoom);mapData=this.getParsedMovie(mapId,mapData)}return mapData},initAmMap:function(mapId,clientSide){if(clientSide===true)this.clientSide=true;var mapSettings=this.getInitMapSettings(mapId);var mapData=this.getInitMapData(mapId);var width=this.getObj("flashcontent"+mapId).style.width;var height=this.getObj("flashcontent"+mapId).style.height;this.so[mapId]=new SWFObject("/shared/s3/ammap/ammap.swf","ammap"+mapId,width,height,"8","#444444");this.so[mapId].addVariable("path","/shared/s3/ammap/");this.so[mapId].addVariable('map_id',mapId);this.so[mapId].addVariable("map_settings",escape(mapSettings));this.so[mapId].addVariable("map_data",escape(mapData));this.so[mapId].write("flashcontent"+mapId)},unHtmlFilter:function(str){str=str.replace(/&lt;/g,'<');str=str.replace(/&gt;/g,'>');str=str.replace(/&quot;/g,'"');str=str.replace(/(^\s+)|(\s+$)/g,"");str=str.replace(/^(<\?[^>]+>)\s+(<)/g,"$1$2");str=str.replace(/\r/g,'');str=str.replace(/\n/g,'');str=str.replace(/<!--[^>]*-->/g,'');return str}};function amRegisterClickAnywhere(mapId,objectId,title,value){if(amMap.isClient())return false;if(mapId==''||mapId==undefined)return false;amMap.getMapObj(mapId).getLongLat();amMap.getMapObj(mapId).getZoomInfo();amMap.updateMovieData(mapId)}function amSetLongLat(mapId,lng,lat){if(amMap.isClient())return false;amMap.setMovieLat(mapId,lat);amMap.setMovieLng(mapId,lng)}function amReturnData(mapId,data){amMap.setReturnedMapData(mapId,data)}function amSetZoomInfo(mapId,zoomX,zoomY,zoom){if(amMap.isClient())return false;var cond=/%/;zoom=zoom.replace(cond,'');zoomX=zoomX.replace(cond,'');zoomY=zoomY.replace(cond,'');amMap.setZoomInfo(mapId,zoomX,zoomY,zoom)}function myInArray(needle,haystack){var key='';for(key in haystack){if(haystack[key]==needle){return key}}return-1}function setMutualValues(id1,id2){var obj1=document.getElementById(id1);var obj2=document.getElementById(id2);if(obj1.value!="")obj2.value=obj1.value;else obj1.value=obj2.value}function getMapPars(prefix,map_id){var map_pars=new Array();var lat=document.getElementById(prefix+"_lat"+map_id).value;var lng=document.getElementById(prefix+"_lng"+map_id).value;var zoom=document.getElementById(prefix+"_zoom"+map_id).value;if(lat=="")lat=0;if(lng=="")lng=0;if(zoom=="")zoom=0;map_pars['lat']=parseFloat(lat);map_pars['lng']=parseFloat(lng);map_pars['zoom']=parseInt(zoom);if(map_id!=""){map_pars['marker_lat']=parseFloat(document.getElementById(prefix+"_marker_lat"+map_id).value);map_pars['marker_lng']=parseFloat(document.getElementById(prefix+"_marker_lng"+map_id).value);if(!map_pars['marker_lat']&&!map_pars['marker_lng']){map_pars['marker_lat']=map_pars['lat'];map_pars['marker_lng']=map_pars['lng']}}return map_pars}function googleMapInitialize(map_id,clientSide){if(typeof(window['GMap2'])=='undefined')return false;if(GBrowserIsCompatible()){var map=new GMap2(document.getElementById("google_map_canvas"+map_id));map_pars=getMapPars('google_map',map_id);var center=new GLatLng(map_pars['lat'],map_pars['lng']);map.setCenter(center,map_pars['zoom']);var zoomControl=new GLargeMapControl();map.addControl(zoomControl);var marker=new GMarker(new GLatLng(map_pars['marker_lat'],map_pars['marker_lng']),{draggable:(clientSide===true?false:true)});if(clientSide!==true){GEvent.addListener(map,"moveend",function(){document.getElementById("google_map_lat"+map_id).value=map.getCenter().lat();document.getElementById("google_map_lng"+map_id).value=map.getCenter().lng()});GEvent.addListener(marker,"dragend",function(){document.getElementById("google_map_marker_lat"+map_id).value=marker.getPoint().lat();document.getElementById("google_map_marker_lng"+map_id).value=marker.getPoint().lng()});GEvent.addListener(map,"zoomend",function(previouszoom,newzoom){document.getElementById("google_map_zoom"+map_id).value=newzoom})}map.addOverlay(marker)}}var googleMapType;function googleMapTypeInitialize(){if(typeof(window['GMap2'])=='undefined')return false;if(GBrowserIsCompatible()){var map=new GMap2(document.getElementById("google_map_type_canvas"));googleMapType=map;map_pars=getMapPars('map_def',"");var center=new GLatLng(map_pars['lat'],map_pars['lng']);map.setCenter(center,map_pars['zoom']);var zoomControl=new GLargeMapControl();map.addControl(zoomControl);GEvent.addListener(map,"moveend",function(){document.getElementById("map_def_lat").value=map.getCenter().lat();document.getElementById("map_def_lng").value=map.getCenter().lng()});GEvent.addListener(map,"zoomend",function(previouszoom,newzoom){document.getElementById("map_def_zoom").value=newzoom})}}function googleMapChangeSize(){var canvas=document.getElementById("google_map_type_canvas");canvas.style.width=document.getElementById("gmap_width").value;canvas.style.height=document.getElementById("gmap_height").value;googleMapType.checkResize()}var yandexMaps=new Array();function yandexMapInitialize(map_id,clientSide){if(typeof(window['YMaps'])=='undefined')return false;var maps_index=myInArray(map_id,yandexMaps);if(maps_index==-1){var map=new YMaps.Map(document.getElementById("yandex_map_canvas"+map_id));yandexMaps[map_id]=map_id;map_pars=getMapPars('yandex_map',map_id);map_zoom=new YMaps.Zoom();map.addControl(map_zoom);map.setCenter(new YMaps.GeoPoint(map_pars['lng'],map_pars['lat']),map_pars['zoom']);var placemark=new YMaps.Placemark(new YMaps.GeoPoint(map_pars['marker_lng'],map_pars['marker_lat']),{draggable:(clientSide===true?false:true)});map.addOverlay(placemark);if(clientSide!==true){YMaps.Events.observe(placemark,placemark.Events.DragEnd,function(){document.getElementById("yandex_map_marker_lat"+map_id).value=placemark.getGeoPoint().getY();document.getElementById("yandex_map_marker_lng"+map_id).value=placemark.getGeoPoint().getX()});var fZoomChange=function(map){var map_zoom=document.getElementById("yandex_map_zoom"+map_id);if(map_zoom!=null){map_zoom.value=map.getZoom();document.getElementById("yandex_map_lat"+map_id).value=map.getCenter().getY();document.getElementById("yandex_map_lng"+map_id).value=map.getCenter().getX()}};YMaps.Events.observe(map,map.Events.SmoothZoomStart,fZoomChange);YMaps.Events.observe(map,map.Events.SmoothZoomEnd,fZoomChange);YMaps.Events.observe(map,map.Events.Update,fZoomChange);YMaps.Events.observe(map,map.Events.Redraw,fZoomChange);YMaps.Events.observe(map,map.Events.MoveEnd,fZoomChange)}}else{yandexMaps.splice(maps_index,1)}}var yandexMapType;function yandexMapTypeInitialize(){if(typeof(window['YMaps'])=='undefined')return false;var map=new YMaps.Map(document.getElementById("yandex_map_type_canvas"));yandexMapType=map;map_pars=getMapPars('map_def',"");map_zoom=new YMaps.Zoom();map.addControl(map_zoom);map.setCenter(new YMaps.GeoPoint(map_pars['lng'],map_pars['lat']),map_pars['zoom']);var fZoomChange=function(map){var map_zoom=document.getElementById("map_def_zoom");if(map_zoom!=null){map_zoom.value=map.getZoom();document.getElementById("map_def_lat").value=map.getCenter().getY();document.getElementById("map_def_lng").value=map.getCenter().getX()}};YMaps.Events.observe(map,map.Events.SmoothZoomStart,fZoomChange);YMaps.Events.observe(map,map.Events.SmoothZoomEnd,fZoomChange);YMaps.Events.observe(map,map.Events.Update,fZoomChange);YMaps.Events.observe(map,map.Events.Redraw,fZoomChange);YMaps.Events.observe(map,map.Events.MoveEnd,fZoomChange)}function yandexMapChangeSize(){var canvas=document.getElementById("yandex_map_type_canvas");canvas.style.width=document.getElementById("ymap_width").value;canvas.style.height=document.getElementById("ymap_height").value;yandexMapType.destructor();yandexMapTypeInitialize()}function saveMapSizeToForm(mapType){document.getElementById("map_width").value=document.getElementById(mapType+"_width").value;document.getElementById("map_height").value=document.getElementById(mapType+"_height").value}var colorPicker={palette:false,getPalette:function(){if(this.palette)return this.palette;var colours=[],row=[],r,g,b,h="0123456789abcdef";for(r=0;r<16;r+=3){for(g=0;g<16;g+=3){for(b=0;b<16;b+=3){row.push("#"+h[r]+h[g]+h[b]);if(row.length%24==0){colours.push(row);row=[]}}}}this.palette=colours;return colours},reset:function(id){setTimeout(function(){$('[id="'+id+'"]').spectrum("set","").val("").attr("value","");$('[id="'+id+'_code"]').html(JS_CANCELLED)},0)},hide:function(parent){$(parent).find('.spectrum').each(function(e){$(this).spectrum("hide")})}};var dynaTreeActivator={dyna_uri:access,dyna_tree:false,dyna_changes:[],form:null,dyna_tree_search:false,group_editing:false,init:function(objects,form,DynaTreeChilds,menu_modified,group_editing){var self=this;self.form=form;self.menu_modified=menu_modified;self.dyna_changes=[];self.group_editing=group_editing;return objects.show().each(function(){$(this).dynatree({debugLevel:0,minExpandLevel:2,idPrefix:"page",generateIds:true,onLazyRead:function(node){node.appendAjax({url:"/-/cms/v1/menu/?act=branch&"+self.dyna_uri,data:{page_id:node.data.key,_left:node.data._left,_right:node.data._right,_level:node.data._level,menu_id:node.data.menu_id},async:false,type:"post"})},children:DynaTreeChilds,onActivate:function(node){},onCustomRender:function(node){var html='',active={};if(node.data.root){}else{if(node.data.title===" "){node.data.title="..."}if(self.group_editing){html+="<label data-parent-selector=\"#pages_container\" data-add-class=\"active\" data-class-target=\"#page"+node.data.key+"\" class=\"s3-cb\"><input name=\"page_id\" data-page-id=\""+node.data.key+"\" type=\"checkbox\" value=\""+node.data.key+"\" parent=\".cb-menu-parent\" /></label>"}html+="<span data-menu-id=\""+node.data.menu_id+"\" onclick=\"pageController.contextMenu(this,"+node.data.key+", event);\" class=\"pageName "+node.data.type+(parseInt(node.data.copy_allowed)?" copyAllowed":"")+"\">"+node.data.title+"</span>";if(node.data.type=='link'){html+="<span><a class=\"pageUrl\" target=\"_blank\" href=\""+node.data.pageUrl+"\">"+node.data.pageUrl+"</a></span><span class=\"s3-ico i-redirect page-ico\"></span>"};if(node.data.type=="home"||node.data.type=="page"||node.data.type=="verification"||(node.data.type=="link"&&node.data.url.indexOf("http")==-1)){if(node.data.type=='link'){html+="<span class=\"linkUrl\">"}if((new RegExp("/\\{\\w+\\}|\\[\\w+\\]/")).test(node.data.url)){html+="<a class=\"pageUrl\" href=\"javascript:void(0)\">"+node.data.url+"</a>"}else{html+="<a target=\"_blank\" class=\"pageUrl\" href=\""+node.data.url_with_prefix+"\">"+node.data.url+"</a>"}if(node.data.type=='link'){html+="</span>"}}else{html+="<a target=\"_blank\" class=\"pageUrl\" href=\""+node.data.url+"\">"+node.data.url+"</a>"}if(node.data.template_name!=undefined&&isStaffUser){if(node.data.template_url!=undefined){html+="<a href=\"#/-/cms/v1/template/?"+S3_ACCESS+"&template_id="+node.data.template_id+"\" class=\"tpl\">"+node.data.template_name+"</a>"}else{html+="<span class=\"tpl no-link\">"+node.data.template_name+"</span>"}}}return html},onRender:function(node,nodeSpan){$(nodeSpan).find('>*').not('span:first-child').wrapAll('<span class="node-wrap"></span>');$(nodeSpan).S3ChangeControls()},onCreate:function(node){if(!self.dyna_tree){self.dyna_tree=node.tree.$tree}},classNames:{nodeIcon:"dynatree-icon"},dnd:{onDragStart:function(node){if(node.data.noedit){return false}else{return true}},onDragStop:function(node){},autoExpandMS:400,preventVoidMoves:true,onDragEnter:function(node,sourceNode){return true},onDragOver:function(node,sourceNode,hitMode){if(node.isDescendantOf(sourceNode)){return false}},onDrop:function(node,sourceNode,hitMode,ui,draggable){pageController.update=true;sourceNode.move(node,hitMode);sourceNode.data.addClass=sourceNode.data.addClass.replace('added','');sourceNode.data.addClass=sourceNode.data.addClass+' added';sourceNode.render();setTimeout(function(){sourceNode.data.addClass=sourceNode.data.addClass.replace('added','');sourceNode.render()},3000);self.dyna_changes.push({source_id:sourceNode.data.key,source_menu_id:sourceNode.data.menu_id,target_id:node.data.key,target_menu_id:node.data.menu_id,mode:hitMode});var last_menu_modified=pageController.getMenuModified(node.data.menu_id,self.menu_modified,node.data.key);if(self.form.is(':hidden')){self.form.show().find('input.menu_modified').val(self.menu_modified);if(last_menu_modified===self.menu_modified){pageController.saveStructureFirstAlert()}}self.form.show().find('input.tree_changes').val(JSON.stringify(self.dyna_changes))},onDragLeave:function(node,sourceNode){}}})})},jsRequest:function(objects,type){var self=this,$this=objects,method=($this.attr('method')?$this.attr('method'):'get'),action=($this.attr('action')?$this.attr('action'):document.location),params=$this.serializeArray(),data={},target,minlength=0,error=false;for(var i=0;i<params.length;i++){minlength=$this.find('*[name="'+params[i]['name']+'"]').attr('minlength');if(params[i]['value'].length>=minlength||minlength==undefined){data[params[i]['name']]=params[i]['value']}else{alert(s3.loc('JS_DYNA_TREE_SEARCH_ERROR_ALERT')+' '+minlength);error=true}};if(!error){$.ajax({url:action,type:method,data:data,success:function(d){self.dyna_changes=[];switch(type){case"only-request":if(d=='1'){s3.alert(JS_CHANGES_SAVED)}else{s3.alert(d)};self.form.hide();break;case"data-load":target=$($this.attr('_target'));target.empty().html(d).show();break;case"search-page":target=$($this.attr('_target'));target.empty().html(d).show();target.find('#search-results-tree').dynatree({debugLevel:0,idPrefix:"page_s",generateIds:true,onActivate:function(node){},onCustomRender:function(node){var html='',active={};if(self.group_editing){html+="<label data-parent-selector=\"#pages_container\" data-add-class=\"active\" data-class-target=\"#page"+node.data.key+"\" class=\"s3-cb\"><input name=\"page_id\" data-page-id=\""+node.data.key+"\" type=\"checkbox\" value=\""+node.data.key+"\" parent=\".cb-menu-parent\" /></label>"}html+="<span data-menu-id=\""+node.data.menu_id+"\" onclick=\"javascript:pageController.contextMenu(this,"+node.data.key+");\" class=\"pageName "+node.data.type+"\">"+node.data.title+"</span>";if(node.data.type=="home"||node.data.type=="page"||node.data.type=="verification"||(node.data.type=="link"&&node.data.url.indexOf("http")==-1)){html+="<a target=\"_blank\" class=\"pageUrl\" href=\""+node.data.url_with_prefix+"\">"+node.data.url+"</a>"}else{html+="<a target=\"_blank\" class=\"pageUrl\" href=\""+node.data.url+"\">"+node.data.url+"</a>"};if(node.data.type=='link'){html+="<span class=\"s3-ico i-redirect page-ico\"></span><span class=\"linkUrl\"><a target=\"_blank\" href=\""+node.data.pageUrl+"\">"+node.data.pageUrl+"</a></span>"};if(node.data.template_name!=undefined){html+="<a href=\""+node.data.template_url+"\" class=\"tpl\">"+node.data.template_name+"</a>"};if(node.data.menu_name!=undefined){html+="<span class=\"menu-name\">"+node.data.menu_name+"</span>"};return html},onRender:function(node,nodeSpan){$(nodeSpan).find('>*').not('span:first-child').wrapAll('<span class="node-wrap"></span>');$(nodeSpan).S3ChangeControls()},onCreate:function(node){if(!self.dyna_tree_search){self.dyna_tree_search=node.tree.$tree}},classNames:{nodeIcon:"dynatree-icon"}});break}}});return true}else{return false}},toggleChecked:function(type){var self=this,menuContainer=$('#menu-tree');if(type){pageController.expandDynatree(true);menuContainer.find('label.s3-cb').addClass('active').find('input[type=checkbox]').prop('checked',true)}else{menuContainer.find('label.s3-cb').removeClass('active').find('input[type=checkbox]').prop('checked',false);pageController.expandDynatree(false)}return false},menuGroupEditing:function(type,menu_id,confirmMessage){var self=this,url='/-/cms/v1/menu/?act=group&'+S3_ACCESS+'&menu_id='+menu_id,menuContainer=$('.dynatree-menu'),pageIds=[];menuContainer.find('input[type=checkbox]').each(function(){if($(this).is(':checked')){pageIds.push($(this).data('page-id'))}});if(!pageIds.length){return s3.alert(s3.loc('JS_NO_OBJECTS_CHOSEN_ERROR'))}pageIds=pageIds.join(',');s3.confirm(confirmMessage,function(){popupController.closeLastPopup();var r=util.makePostRequest(url,'&type='+type+'&page_ids='+pageIds);if(r&&!r.error){util.msg(s3.loc('JS_SAVED'));pageController.reloadMenu()}});return false}};var _canLog=true;function _log(mode,msg){if(!_canLog){return}var args=Array.prototype.slice.apply(arguments,[1]);var dt=new Date();var tag=dt.getHours()+":"+dt.getMinutes()+":"+dt.getSeconds()+"."+dt.getMilliseconds();args[0]=tag+" - "+args[0];try{switch(mode){case"info":window.console.info.apply(window.console,args);break;case"warn":window.console.warn.apply(window.console,args);break;default:window.console.log.apply(window.console,args);break}}catch(e){if(!window.console){_canLog=false}}}function logMsg(msg){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)}var getDynaTreePersistData=null;var DTNodeStatus_Error=-1;var DTNodeStatus_Loading=1;var DTNodeStatus_Ok=0;(function($){var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};function getDtNodeFromElement(el){alert("getDtNodeFromElement is deprecated");return $.ui.dynatree.getNode(el)}function noop(){}var DynaTreeNode=Class.create();DynaTreeNode.prototype={initialize:function(parent,tree,data){this.parent=parent;this.tree=tree;if(typeof data==="string"){data={title:data}}if(data.key===undefined){data.key="_"+tree._nodeCount++}this.data=$.extend({},$.ui.dynatree.nodedatadefaults,data);this.li=null;this.span=null;this.ul=null;this.childList=null;this._isLoading=false;this.hasSubSel=false;this.bExpanded=false;this.bSelected=false},toString:function(){return"DynaTreeNode<"+this.data.key+">: '"+this.data.title+"'"},toDict:function(recursive,callback){var dict=$.extend({},this.data);dict.activate=(this.tree.activeNode===this);dict.focus=(this.tree.focusNode===this);dict.expand=this.bExpanded;dict.select=this.bSelected;if(callback){callback(dict)}if(recursive&&this.childList){dict.children=[];for(var i=0,l=this.childList.length;i<l;i++){dict.children.push(this.childList[i].toDict(true,callback))}}else{delete dict.children}return dict},fromDict:function(dict){var children=dict.children;if(children===undefined){this.data=$.extend(this.data,dict);this.render();return}dict=$.extend({},dict);dict.children=undefined;this.data=$.extend(this.data,dict);this.removeChildren();this.addChild(children)},_getInnerHtml:function(){var tree=this.tree,opts=tree.options,cache=tree.cache,level=this.getLevel(),data=this.data,res="",imageSrc;if(level<opts.minExpandLevel){if(level>1){res+=cache.tagConnector}}else if(this.hasChildren()!==false){res+=cache.tagExpander}else{res+=cache.tagConnector}if(opts.checkbox&&data.hideCheckbox!==true&&!data.isStatusNode){res+=cache.tagCheckbox}if(data.icon){if(data.icon.charAt(0)==="/"){imageSrc=data.icon}else{imageSrc=opts.imagePath+data.icon}res+="<img src='"+imageSrc+"' alt='' />"}else if(data.icon===false){}else{res+=cache.tagNodeIcon}var nodeTitle="";if(opts.onCustomRender){nodeTitle=opts.onCustomRender.call(tree,this)||""}if(!nodeTitle){var tooltip=data.tooltip?' title="'+data.tooltip.replace(/\"/g,'&quot;')+'"':'',href=data.href||"#";if(opts.noLink||data.noLink){nodeTitle='<span style="display:inline-block;" class="'+opts.classNames.title+'"'+tooltip+'>'+data.title+'</span>'}else{nodeTitle='<a href="'+href+'" class="'+opts.classNames.title+'"'+tooltip+'>'+data.title+'</a>'}}res+=nodeTitle;return res},_fixOrder:function(){var cl=this.childList;if(!cl||!this.ul){return}var childLI=this.ul.firstChild;for(var i=0,l=cl.length-1;i<l;i++){var childNode1=cl[i];var childNode2=childLI.dtnode;if(childNode1!==childNode2){this.tree.logDebug("_fixOrder: mismatch at index "+i+": "+childNode1+" != "+childNode2);this.ul.insertBefore(childNode1.li,childNode2.li)}else{childLI=childLI.nextSibling}}},render:function(useEffects,includeInvisible){var tree=this.tree,parent=this.parent,data=this.data,opts=tree.options,cn=opts.classNames,isLastSib=this.isLastSibling(),firstTime=false;if(!parent&&!this.ul){this.li=this.span=null;this.ul=document.createElement("ul");if(opts.minExpandLevel>1){this.ul.className=cn.container+" "+cn.noConnector}else{this.ul.className=cn.container}}else if(parent){if(!this.li){firstTime=true;this.li=document.createElement("li");this.li.dtnode=this;this.span=document.createElement("div");if(data.key&&opts.generateIds){this.span.id=opts.idPrefix+data.key}this.span.className=cn.title;this.li.appendChild(this.span);if(!parent.ul){parent.ul=document.createElement("ul");parent.ul.style.display="none";parent.li.appendChild(parent.ul)}parent.ul.appendChild(this.li)}this.span.innerHTML=this._getInnerHtml();var cnList=[];cnList.push(cn.node);if(data.isFolder){cnList.push(cn.folder)}if(this.bExpanded){cnList.push(cn.expanded)}if(this.hasChildren()!==false){cnList.push(cn.hasChildren)}if(data.isLazy&&this.childList===null){cnList.push(cn.lazy)}if(isLastSib){cnList.push(cn.lastsib)}if(this.bSelected){cnList.push(cn.selected)}if(this.hasSubSel){cnList.push(cn.partsel)}if(tree.activeNode===this){cnList.push(cn.active)}if(data.addClass){cnList.push(data.addClass)}cnList.push(cn.combinedExpanderPrefix+(this.bExpanded?"e":"c")+(data.isLazy&&this.childList===null?"d":"")+(isLastSib?"l":""));cnList.push(cn.combinedIconPrefix+(this.bExpanded?"e":"c")+(data.isFolder?"f":""));this.span.className=cnList.join(" ");this.li.className=isLastSib?cn.lastsib:"";if(firstTime&&opts.onCreate){opts.onCreate.call(tree,this,this.span)}if(opts.onRender){opts.onRender.call(tree,this,this.span)}}if((this.bExpanded||includeInvisible===true)&&this.childList){for(var i=0,l=this.childList.length;i<l;i++){this.childList[i].render(false,includeInvisible)}this._fixOrder()}if(this.ul){var isHidden=(this.ul.style.display==="none");var isExpanded=!!this.bExpanded;if(useEffects&&opts.fx&&(isHidden===isExpanded)){var duration=opts.fx.duration||200;$(this.ul).animate(opts.fx,duration)}else{this.ul.style.display=(this.bExpanded||!parent)?"":"none"}}},getKeyPath:function(excludeSelf){var path=[];this.visitParents(function(node){if(node.parent){path.unshift(node.data.key)}},!excludeSelf);return"/"+path.join(this.tree.options.keyPathSeparator)},getParent:function(){return this.parent},getChildren:function(){if(this.hasChildren()===undefined){return undefined}return this.childList},hasChildren:function(){if(this.data.isLazy){if(this.childList===null||this.childList===undefined){return undefined}else if(this.childList.length===0){return false}else if(this.childList.length===1&&this.childList[0].isStatusNode()){return undefined}return true}return!!this.childList},isFirstSibling:function(){var p=this.parent;return!p||p.childList[0]===this},isLastSibling:function(){var p=this.parent;return!p||p.childList[p.childList.length-1]===this},isLoading:function(){return!!this._isLoading},getPrevSibling:function(){if(!this.parent){return null}var ac=this.parent.childList;for(var i=1,l=ac.length;i<l;i++){if(ac[i]===this){return ac[i-1]}}return null},getNextSibling:function(){if(!this.parent){return null}var ac=this.parent.childList;for(var i=0,l=ac.length-1;i<l;i++){if(ac[i]===this){return ac[i+1]}}return null},isStatusNode:function(){return(this.data.isStatusNode===true)},isChildOf:function(otherNode){return(this.parent&&this.parent===otherNode)},isDescendantOf:function(otherNode){if(!otherNode){return false}var p=this.parent;while(p){if(p===otherNode){return true}p=p.parent}return false},countChildren:function(){var cl=this.childList;if(!cl){return 0}var n=cl.length;for(var i=0,l=n;i<l;i++){var child=cl[i];n+=child.countChildren()}return n},sortChildren:function(cmp,deep){var cl=this.childList;if(!cl){return}cmp=cmp||function(a,b){var x=a.data.title.toLowerCase(),y=b.data.title.toLowerCase();return x===y?0:x>y?1:-1};cl.sort(cmp);if(deep){for(var i=0,l=cl.length;i<l;i++){if(cl[i].childList){cl[i].sortChildren(cmp,"$norender$")}}}if(deep!=="$norender$"){this.render()}},_setStatusNode:function(data){var firstChild=(this.childList?this.childList[0]:null);if(!data){if(firstChild&&firstChild.isStatusNode()){try{if(this.ul){this.ul.removeChild(firstChild.li);firstChild.li=null}}catch(e){}if(this.childList.length===1){this.childList=[]}else{this.childList.shift()}}}else if(firstChild){data.isStatusNode=true;data.key="_statusNode";firstChild.data=data;firstChild.render()}else{data.isStatusNode=true;data.key="_statusNode";firstChild=this.addChild(data)}},setLazyNodeStatus:function(lts,opts){var tooltip=(opts&&opts.tooltip)?opts.tooltip:null,info=(opts&&opts.info)?" ("+opts.info+")":"";switch(lts){case DTNodeStatus_Ok:this._setStatusNode(null);$(this.span).removeClass(this.tree.options.classNames.nodeLoading);this._isLoading=false;if(this.tree.options.autoFocus){if(this===this.tree.tnRoot&&this.childList&&this.childList.length>0){this.childList[0].focus()}else{this.focus()}}break;case DTNodeStatus_Loading:this._isLoading=true;$(this.span).addClass(this.tree.options.classNames.nodeLoading);if(!this.parent){this._setStatusNode({title:this.tree.options.strings.loading+info,tooltip:tooltip,addClass:this.tree.options.classNames.nodeWait})}break;case DTNodeStatus_Error:this._isLoading=false;this._setStatusNode({title:this.tree.options.strings.loadError+info,tooltip:tooltip,addClass:this.tree.options.classNames.nodeError});break;default:throw"Bad LazyNodeStatus: '"+lts+"'."}},_parentList:function(includeRoot,includeSelf){var l=[];var dtn=includeSelf?this:this.parent;while(dtn){if(includeRoot||dtn.parent){l.unshift(dtn)}dtn=dtn.parent}return l},getLevel:function(){var level=0;var dtn=this.parent;while(dtn){level++;dtn=dtn.parent}return level},_getTypeForOuterNodeEvent:function(event){var cns=this.tree.options.classNames;var target=event.target;if(target.className.indexOf(cns.node)<0){return null}var eventX=event.pageX-target.offsetLeft;var eventY=event.pageY-target.offsetTop;for(var i=0,l=target.childNodes.length;i<l;i++){var cn=target.childNodes[i];var x=cn.offsetLeft-target.offsetLeft;var y=cn.offsetTop-target.offsetTop;var nx=cn.clientWidth,ny=cn.clientHeight;if(eventX>=x&&eventX<=(x+nx)&&eventY>=y&&eventY<=(y+ny)){if(cn.className==cns.title){return"title"}else if(cn.className==cns.expander){return"expander"}else if(cn.className==cns.checkbox){return"checkbox"}else if(cn.className==cns.nodeIcon){return"icon"}}}return"prefix"},getEventTargetType:function(event){var tcn=event&&event.target?event.target.className:"",cns=this.tree.options.classNames;if(tcn===cns.title){return"title"}else if(tcn===cns.expander){return"expander"}else if(tcn===cns.checkbox){return"checkbox"}else if(tcn===cns.nodeIcon){return"icon"}else if(tcn===cns.empty||tcn===cns.vline||tcn===cns.connector){return"prefix"}else if(tcn.indexOf(cns.node)>=0){return this._getTypeForOuterNodeEvent(event)}return null},isVisible:function(){var parents=this._parentList(true,false);for(var i=0,l=parents.length;i<l;i++){if(!parents[i].bExpanded){return false}}return true},makeVisible:function(){var parents=this._parentList(true,false);for(var i=0,l=parents.length;i<l;i++){parents[i]._expand(true)}},focus:function(){this.makeVisible();try{$(this.span).find(">a").focus()}catch(e){}},isFocused:function(){return(this.tree.tnFocused===this)},_activate:function(flag,fireEvents){this.tree.logDebug("dtnode._activate(%o, fireEvents=%o) - %o",flag,fireEvents,this);var opts=this.tree.options;if(this.data.isStatusNode){return}if(fireEvents&&opts.onQueryActivate&&opts.onQueryActivate.call(this.tree,flag,this)===false){return}if(flag){if(this.tree.activeNode){if(this.tree.activeNode===this){return}this.tree.activeNode.deactivate()}if(opts.activeVisible){this.makeVisible()}this.tree.activeNode=this;if(opts.persist){util.createCookie(opts.cookieId+"-active",this.data.key)}this.tree.persistence.activeKey=this.data.key;$(this.span).addClass(opts.classNames.active);if(fireEvents&&opts.onActivate){opts.onActivate.call(this.tree,this)}}else{if(this.tree.activeNode===this){if(opts.onQueryActivate&&opts.onQueryActivate.call(this.tree,false,this)===false){return}$(this.span).removeClass(opts.classNames.active);if(opts.persist){util.createCookie(opts.cookieId+"-active","")}this.tree.persistence.activeKey=null;this.tree.activeNode=null;if(fireEvents&&opts.onDeactivate){opts.onDeactivate.call(this.tree,this)}}}},activate:function(){this._activate(true,true)},activateSilently:function(){this._activate(true,false)},deactivate:function(){this._activate(false,true)},isActive:function(){return(this.tree.activeNode===this)},_userActivate:function(){},_setSubSel:function(hasSubSel){if(hasSubSel){this.hasSubSel=true;$(this.span).addClass(this.tree.options.classNames.partsel)}else{this.hasSubSel=false;$(this.span).removeClass(this.tree.options.classNames.partsel)}},_updatePartSelectionState:function(){var sel;if(!this.hasChildren()){sel=(this.bSelected&&!this.data.unselectable&&!this.data.isStatusNode);this._setSubSel(false);return sel}var i,l,cl=this.childList,allSelected=true,allDeselected=true;for(i=0,l=cl.length;i<l;i++){var n=cl[i],s=n._updatePartSelectionState();if(s!==false){allDeselected=false}if(s!==true){allSelected=false}}if(allSelected){sel=true}else if(allDeselected){sel=false}else{sel=undefined}this._setSubSel(sel===undefined);this.bSelected=(sel===true);return sel},_fixSelectionState:function(){var p,i,l;if(this.bSelected){this.visit(function(node){node.parent._setSubSel(true);if(!node.data.unselectable){node._select(true,false,false)}});p=this.parent;while(p){p._setSubSel(true);var allChildsSelected=true;for(i=0,l=p.childList.length;i<l;i++){var n=p.childList[i];if(!n.bSelected&&!n.data.isStatusNode&&!n.data.unselectable){allChildsSelected=false;break}}if(allChildsSelected){p._select(true,false,false)}p=p.parent}}else{this._setSubSel(false);this.visit(function(node){node._setSubSel(false);node._select(false,false,false)});p=this.parent;while(p){p._select(false,false,false);var isPartSel=false;for(i=0,l=p.childList.length;i<l;i++){if(p.childList[i].bSelected||p.childList[i].hasSubSel){isPartSel=true;break}}p._setSubSel(isPartSel);p=p.parent}}},_select:function(sel,fireEvents,deep){var opts=this.tree.options;if(this.data.isStatusNode){return}if(this.bSelected===sel){return}if(fireEvents&&opts.onQuerySelect&&opts.onQuerySelect.call(this.tree,sel,this)===false){return}if(opts.selectMode==1&&sel){this.tree.visit(function(node){if(node.bSelected){node._select(false,false,false);return false}})}this.bSelected=sel;if(sel){if(opts.persist){this.tree.persistence.addSelect(this.data.key)}$(this.span).addClass(opts.classNames.selected);if(deep&&opts.selectMode===3){this._fixSelectionState()}if(fireEvents&&opts.onSelect){opts.onSelect.call(this.tree,true,this)}}else{if(opts.persist){this.tree.persistence.clearSelect(this.data.key)}$(this.span).removeClass(opts.classNames.selected);if(deep&&opts.selectMode===3){this._fixSelectionState()}if(fireEvents&&opts.onSelect){opts.onSelect.call(this.tree,false,this)}}},select:function(sel){if(this.data.unselectable){return this.bSelected}return this._select(sel!==false,true,true)},toggleSelect:function(){return this.select(!this.bSelected)},isSelected:function(){return this.bSelected},isLazy:function(){return!!this.data.isLazy},_loadContent:function(){try{var opts=this.tree.options;this.tree.logDebug("_loadContent: start - %o",this);this.setLazyNodeStatus(DTNodeStatus_Loading);if(true===opts.onLazyRead.call(this.tree,this)){this.setLazyNodeStatus(DTNodeStatus_Ok);this.tree.logDebug("_loadContent: succeeded - %o",this)}}catch(e){this.tree.logWarning("_loadContent: failed - %o",e);this.setLazyNodeStatus(DTNodeStatus_Error,{tooltip:""+e})}},_expand:function(bExpand,forceSync){if(this.bExpanded===bExpand){this.tree.logDebug("dtnode._expand(%o) IGNORED - %o",bExpand,this);return}this.tree.logDebug("dtnode._expand(%o) - %o",bExpand,this);var opts=this.tree.options;if(!bExpand&&this.getLevel()<opts.minExpandLevel){this.tree.logDebug("dtnode._expand(%o) prevented collapse - %o",bExpand,this);return}if(opts.onQueryExpand&&opts.onQueryExpand.call(this.tree,bExpand,this)===false){return}this.bExpanded=bExpand;if(opts.persist){if(bExpand){this.tree.persistence.addExpand(this.data.key)}else{this.tree.persistence.clearExpand(this.data.key)}}var allowEffects=!(this.data.isLazy&&this.childList===null)&&!this._isLoading&&!forceSync;this.render(allowEffects);if(this.bExpanded&&this.parent&&opts.autoCollapse){var parents=this._parentList(false,true);for(var i=0,l=parents.length;i<l;i++){parents[i].collapseSiblings()}}if(opts.activeVisible&&this.tree.activeNode&&!this.tree.activeNode.isVisible()){this.tree.activeNode.deactivate()}if(bExpand&&this.data.isLazy&&this.childList===null&&!this._isLoading){this._loadContent();return}if(opts.onExpand){opts.onExpand.call(this.tree,bExpand,this)}},isExpanded:function(){return this.bExpanded},expand:function(flag){flag=(flag!==false);if(!this.childList&&!this.data.isLazy&&flag){return}else if(this.parent===null&&!flag){return}this._expand(flag)},scheduleAction:function(mode,ms){if(this.tree.timer){clearTimeout(this.tree.timer);this.tree.logDebug("clearTimeout(%o)",this.tree.timer)}var self=this;switch(mode){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){self.tree.logDebug("setTimeout: trigger expand");self.expand(true)},ms);break;case"activate":this.tree.timer=setTimeout(function(){self.tree.logDebug("setTimeout: trigger activate");self.activate()},ms);break;default:throw"Invalid mode "+mode}this.tree.logDebug("setTimeout(%s, %s): %s",mode,ms,this.tree.timer)},toggleExpand:function(){this.expand(!this.bExpanded)},collapseSiblings:function(){if(this.parent===null){return}var ac=this.parent.childList;for(var i=0,l=ac.length;i<l;i++){if(ac[i]!==this&&ac[i].bExpanded){ac[i]._expand(false)}}},_onClick:function(event){var targetType=this.getEventTargetType(event);if(targetType==="expander"){this.toggleExpand();this.focus()}else if(targetType==="checkbox"){this.toggleSelect();this.focus()}else{this._userActivate();var aTag=this.span.getElementsByTagName("a");if(aTag[0]){return true}}event.preventDefault()},_onDblClick:function(event){},_onKeydown:function(event){var handled=true,sib;switch(event.which){case 107:case 187:if(!this.bExpanded){this.toggleExpand()}break;case 109:case 189:if(this.bExpanded){this.toggleExpand()}break;case 32:this._userActivate();break;case 8:if(this.parent){this.parent.focus()}break;case 37:if(this.bExpanded){this.toggleExpand();this.focus()}else if(this.parent&&this.parent.parent){this.parent.focus()}break;case 39:if(!this.bExpanded&&(this.childList||this.data.isLazy)){this.toggleExpand();this.focus()}else if(this.childList){this.childList[0].focus()}break;case 38:sib=this.getPrevSibling();while(sib&&sib.bExpanded&&sib.childList){sib=sib.childList[sib.childList.length-1]}if(!sib&&this.parent&&this.parent.parent){sib=this.parent}if(sib){sib.focus()}break;case 40:if(this.bExpanded&&this.childList){sib=this.childList[0]}else{var parents=this._parentList(false,true);for(var i=parents.length-1;i>=0;i--){sib=parents[i].getNextSibling();if(sib){break}}}if(sib){sib.focus()}break;default:handled=false}if(handled){event.preventDefault()}},_onKeypress:function(event){},_onFocus:function(event){var opts=this.tree.options;if(event.type=="blur"||event.type=="focusout"){if(opts.onBlur){opts.onBlur.call(this.tree,this)}if(this.tree.tnFocused){$(this.tree.tnFocused.span).removeClass(opts.classNames.focused)}this.tree.tnFocused=null;if(opts.persist){util.createCookie(opts.cookieId+"-focus","")}}else if(event.type=="focus"||event.type=="focusin"){if(this.tree.tnFocused&&this.tree.tnFocused!==this){this.tree.logDebug("dtnode.onFocus: out of sync: curFocus: %o",this.tree.tnFocused);$(this.tree.tnFocused.span).removeClass(opts.classNames.focused)}this.tree.tnFocused=this;if(opts.onFocus){opts.onFocus.call(this.tree,this)}$(this.tree.tnFocused.span).addClass(opts.classNames.focused);if(opts.persist){util.createCookie(opts.cookieId+"-focus",this.data.key)}}},visit:function(fn,includeSelf){var res=true;if(includeSelf===true){res=fn(this);if(res===false||res=="skip"){return res}}if(this.childList){for(var i=0,l=this.childList.length;i<l;i++){res=this.childList[i].visit(fn,true);if(res===false){break}}}return res},visitParents:function(fn,includeSelf){if(includeSelf&&fn(this)===false){return false}var p=this.parent;while(p){if(fn(p)===false){return false}p=p.parent}return true},remove:function(){if(this===this.tree.root){throw"Cannot remove system root"}return this.parent.removeChild(this)},removeChild:function(tn){var ac=this.childList;if(ac.length==1){if(tn!==ac[0]){throw"removeChild: invalid child"}return this.removeChildren()}if(tn===this.tree.activeNode){tn.deactivate()}if(this.tree.options.persist){if(tn.bSelected){this.tree.persistence.clearSelect(tn.data.key)}if(tn.bExpanded){this.tree.persistence.clearExpand(tn.data.key)}}tn.removeChildren(true);this.ul.removeChild(tn.li);for(var i=0,l=ac.length;i<l;i++){if(ac[i]===tn){this.childList.splice(i,1);break}}},removeChildren:function(isRecursiveCall,retainPersistence){this.tree.logDebug("%s.removeChildren(%o)",this,isRecursiveCall);var tree=this.tree;var ac=this.childList;if(ac){for(var i=0,l=ac.length;i<l;i++){var tn=ac[i];if(tn===tree.activeNode&&!retainPersistence){tn.deactivate()}if(this.tree.options.persist&&!retainPersistence){if(tn.bSelected){this.tree.persistence.clearSelect(tn.data.key)}if(tn.bExpanded){this.tree.persistence.clearExpand(tn.data.key)}}tn.removeChildren(true,retainPersistence);if(this.ul){$("li",$(this.ul)).remove()}}this.childList=null}if(!isRecursiveCall){this._isLoading=false;this.render()}},setTitle:function(title){this.fromDict({title:title})},reload:function(force){throw"Use reloadChildren() instead"},reloadChildren:function(callback){if(this.parent===null){throw"Use tree.reload() instead"}else if(!this.data.isLazy){throw"node.reloadChildren() requires lazy nodes."}if(callback){var self=this;var eventType="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key;this.tree.$tree.bind(eventType,function(e,node,isOk){self.tree.$tree.unbind(eventType);self.tree.logDebug("loaded %o, %o, %o",e,node,isOk);if(node!==self){throw"got invalid load event"}callback.call(self.tree,node,isOk)})}this.removeChildren();this._loadContent()},_loadKeyPath:function(keyPath,callback){var tree=this.tree;tree.logDebug("%s._loadKeyPath(%s)",this,keyPath);if(keyPath===""){throw"Key path must not be empty"}var segList=keyPath.split(tree.options.keyPathSeparator);if(segList[0]===""){throw"Key path must be relative (don't start with '/')"}var seg=segList.shift();if(this.childList){for(var i=0,l=this.childList.length;i<l;i++){var child=this.childList[i];if(child.data.key===seg){if(segList.length===0){callback.call(tree,child,"ok")}else if(child.data.isLazy&&(child.childList===null||child.childList===undefined)){tree.logDebug("%s._loadKeyPath(%s) -> reloading %s...",this,keyPath,child);var self=this;child.reloadChildren(function(node,isOk){if(isOk){tree.logDebug("%s._loadKeyPath(%s) -> reloaded %s.",node,keyPath,node);callback.call(tree,child,"loaded");node._loadKeyPath(segList.join(tree.options.keyPathSeparator),callback)}else{tree.logWarning("%s._loadKeyPath(%s) -> reloadChildren() failed.",self,keyPath);callback.call(tree,child,"error")}})}else{callback.call(tree,child,"loaded");child._loadKeyPath(segList.join(tree.options.keyPathSeparator),callback)}return}}}callback.call(tree,undefined,"notfound",seg,segList.length===0);tree.logWarning("Node not found: "+seg);return},resetLazy:function(){if(this.parent===null){throw"Use tree.reload() instead"}else if(!this.data.isLazy){throw"node.resetLazy() requires lazy nodes."}this.expand(false);this.removeChildren()},_addChildNode:function(dtnode,beforeNode){var tree=this.tree,opts=tree.options,pers=tree.persistence;dtnode.parent=this;if(this.childList===null){this.childList=[]}else if(!beforeNode){if(this.childList.length>0){$(this.childList[this.childList.length-1].span).removeClass(opts.classNames.lastsib)}}if(beforeNode){var iBefore=$.inArray(beforeNode,this.childList);if(iBefore<0){throw"<beforeNode> must be a child of <this>"}this.childList.splice(iBefore,0,dtnode)}else{this.childList.push(dtnode)}var isInitializing=tree.isInitializing();if(opts.persist&&pers.cookiesFound&&isInitializing){if(pers.activeKey===dtnode.data.key){tree.activeNode=dtnode}if(pers.focusedKey===dtnode.data.key){tree.focusNode=dtnode}dtnode.bExpanded=($.inArray(dtnode.data.key,pers.expandedKeyList)>=0);dtnode.bSelected=($.inArray(dtnode.data.key,pers.selectedKeyList)>=0)}else{if(dtnode.data.activate){tree.activeNode=dtnode;if(opts.persist){pers.activeKey=dtnode.data.key}}if(dtnode.data.focus){tree.focusNode=dtnode;if(opts.persist){pers.focusedKey=dtnode.data.key}}dtnode.bExpanded=(dtnode.data.expand===true);if(dtnode.bExpanded&&opts.persist){pers.addExpand(dtnode.data.key)}dtnode.bSelected=(dtnode.data.select===true);if(dtnode.bSelected&&opts.persist){pers.addSelect(dtnode.data.key)}}if(opts.minExpandLevel>=dtnode.getLevel()){this.bExpanded=true}if(dtnode.bSelected&&opts.selectMode==3){var p=this;while(p){if(!p.hasSubSel){p._setSubSel(true)}p=p.parent}}if(tree.bEnableUpdate){this.render()}return dtnode},addChild:function(obj,beforeNode){if(typeof(obj)=="string"){throw"Invalid data type for "+obj}else if(!obj||obj.length===0){return}else if(obj instanceof DynaTreeNode){return this._addChildNode(obj,beforeNode)}if(!obj.length){obj=[obj]}var prevFlag=this.tree.enableUpdate(false);var tnFirst=null;for(var i=0,l=obj.length;i<l;i++){var data=obj[i];var dtnode=this._addChildNode(new DynaTreeNode(this,this.tree,data),beforeNode);if(!tnFirst){tnFirst=dtnode}if(data.children){dtnode.addChild(data.children,null)}}this.tree.enableUpdate(prevFlag);return tnFirst},append:function(obj){this.tree.logWarning("node.append() is deprecated (use node.addChild() instead).");return this.addChild(obj,null)},appendAjax:function(ajaxOptions){var self=this;this.removeChildren(false,true);this.setLazyNodeStatus(DTNodeStatus_Loading);if(ajaxOptions.debugLazyDelay){var ms=ajaxOptions.debugLazyDelay;ajaxOptions.debugLazyDelay=0;this.tree.logInfo("appendAjax: waiting for debugLazyDelay "+ms);setTimeout(function(){self.appendAjax(ajaxOptions)},ms);return}var orgSuccess=ajaxOptions.success,orgError=ajaxOptions.error,eventType="nodeLoaded.dynatree."+this.tree.$tree.attr("id")+"."+this.data.key;var options=$.extend({},this.tree.options.ajaxDefaults,ajaxOptions,{success:function(data,textStatus,jqXHR){var prevPhase=self.tree.phase;self.tree.phase="init";if(options.postProcess){data=options.postProcess.call(this,data,this.dataType)}else if(data&&data.hasOwnProperty("d")){data=(typeof data.d)=="string"?$.parseJSON(data.d):data.d}if(!$.isArray(data)||data.length!==0){self.addChild(data,null)}self.tree.phase="postInit";if(orgSuccess){orgSuccess.call(options,self,data,textStatus)}self.tree.logDebug("trigger "+eventType);self.tree.$tree.trigger(eventType,[self,true]);self.tree.phase=prevPhase;self.setLazyNodeStatus(DTNodeStatus_Ok);if($.isArray(data)&&data.length===0){self.childList=[];self.render()}},error:function(jqXHR,textStatus,errorThrown){self.tree.logWarning("appendAjax failed:",textStatus,":\n",jqXHR,"\n",errorThrown);if(orgError){orgError.call(options,self,jqXHR,textStatus,errorThrown)}self.tree.$tree.trigger(eventType,[self,false]);self.setLazyNodeStatus(DTNodeStatus_Error,{info:textStatus,tooltip:""+errorThrown})}});$.ajax(options)},move:function(targetNode,mode){var pos;if(this===targetNode){return}if(!this.parent){throw"Cannot move system root"}if(mode===undefined||mode=="over"){mode="child"}var prevParent=this.parent;var targetParent=(mode==="child")?targetNode:targetNode.parent;if(targetParent.isDescendantOf(this)){throw"Cannot move a node to it's own descendant"}if(this.parent.childList.length==1){this.parent.childList=this.parent.data.isLazy?[]:null;this.parent.bExpanded=false}else{pos=$.inArray(this,this.parent.childList);if(pos<0){throw"Internal error"}this.parent.childList.splice(pos,1)}if(this.parent.ul){this.parent.ul.removeChild(this.li)}this.parent=targetParent;if(targetParent.hasChildren()){switch(mode){case"child":targetParent.childList.push(this);break;case"before":pos=$.inArray(targetNode,targetParent.childList);if(pos<0){throw"Internal error"}targetParent.childList.splice(pos,0,this);break;case"after":pos=$.inArray(targetNode,targetParent.childList);if(pos<0){throw"Internal error"}targetParent.childList.splice(pos+1,0,this);break;default:throw"Invalid mode "+mode}}else{targetParent.childList=[this]}if(!targetParent.ul){targetParent.ul=document.createElement("ul");targetParent.ul.style.display="none";targetParent.li.appendChild(targetParent.ul)}if(this.li){targetParent.ul.appendChild(this.li)}if(!prevParent.isDescendantOf(targetParent)){prevParent.render()}if(!targetParent.isDescendantOf(prevParent)){targetParent.render()}},lastentry:undefined};var DynaTreeStatus=Class.create();DynaTreeStatus._getTreePersistData=function(cookieId,cookieOpts){var ts=new DynaTreeStatus(cookieId,cookieOpts);ts.read();return ts.toDict()};getDynaTreePersistData=DynaTreeStatus._getTreePersistData;DynaTreeStatus.prototype={initialize:function(cookieId,cookieOpts){if(cookieId===undefined){cookieId=$.ui.dynatree.prototype.options.cookieId}cookieOpts=$.extend({},$.ui.dynatree.prototype.options.cookie,cookieOpts);this.cookieId=cookieId;this.cookieOpts=cookieOpts;this.cookiesFound=undefined;this.activeKey=null;this.focusedKey=null;this.expandedKeyList=null;this.selectedKeyList=null},_log:function(msg){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)},read:function(){this.cookiesFound=false;var cookie=util.readCookie(this.cookieId+"-active");this.activeKey=(cookie===null)?"":cookie;if(cookie!==null){this.cookiesFound=true}cookie=util.readCookie(this.cookieId+"-focus");this.focusedKey=(cookie===null)?"":cookie;if(cookie!==null){this.cookiesFound=true}cookie=util.readCookie(this.cookieId+"-expand");this.expandedKeyList=(cookie===null)?[]:cookie.split(",");if(cookie!==null){this.cookiesFound=true}cookie=util.readCookie(this.cookieId+"-select");this.selectedKeyList=(cookie===null)?[]:cookie.split(",");if(cookie!==null){this.cookiesFound=true}},write:function(){util.createCookie(this.cookieId+"-active",(this.activeKey===null)?"":this.activeKey);util.createCookie(this.cookieId+"-focus",(this.focusedKey===null)?"":this.focusedKey);util.createCookie(this.cookieId+"-expand",(this.expandedKeyList===null)?"":this.expandedKeyList.join(","));util.createCookie(this.cookieId+"-select",(this.selectedKeyList===null)?"":this.selectedKeyList.join(","))},addExpand:function(key){if($.inArray(key,this.expandedKeyList)<0){this.expandedKeyList.push(key);util.createCookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts)}},clearExpand:function(key){var idx=$.inArray(key,this.expandedKeyList);if(idx>=0){this.expandedKeyList.splice(idx,1);util.createCookie(this.cookieId+"-expand",this.expandedKeyList.join(","))}},addSelect:function(key){if($.inArray(key,this.selectedKeyList)<0){this.selectedKeyList.push(key);util.createCookie(this.cookieId+"-select",this.selectedKeyList.join(","))}},clearSelect:function(key){var idx=$.inArray(key,this.selectedKeyList);if(idx>=0){this.selectedKeyList.splice(idx,1);util.createCookie(this.cookieId+"-select",this.selectedKeyList.join(","))}},isReloading:function(){return this.cookiesFound===true},toDict:function(){return{cookiesFound:this.cookiesFound,activeKey:this.activeKey,focusedKey:this.activeKey,expandedKeyList:this.expandedKeyList,selectedKeyList:this.selectedKeyList}},lastentry:undefined};var DynaTree=Class.create();DynaTree.version="$Version: 1.2.2$";DynaTree.prototype={initialize:function($widget){this.phase="init";this.$widget=$widget;this.options=$widget.options;this.$tree=$widget.element;this.timer=null;this.divTree=this.$tree.get(0);_initDragAndDrop(this)},_load:function(callback){var $widget=this.$widget;var opts=this.options,self=this;this.bEnableUpdate=true;this._nodeCount=1;this.activeNode=null;this.focusNode=null;if(opts.rootVisible!==undefined){this.logWarning("Option 'rootVisible' is no longer supported.")}if(opts.minExpandLevel<1){this.logWarning("Option 'minExpandLevel' must be >= 1.");opts.minExpandLevel=1}if(opts.classNames!==$.ui.dynatree.prototype.options.classNames){opts.classNames=$.extend({},$.ui.dynatree.prototype.options.classNames,opts.classNames)}if(opts.ajaxDefaults!==$.ui.dynatree.prototype.options.ajaxDefaults){opts.ajaxDefaults=$.extend({},$.ui.dynatree.prototype.options.ajaxDefaults,opts.ajaxDefaults)}if(opts.dnd!==$.ui.dynatree.prototype.options.dnd){opts.dnd=$.extend({},$.ui.dynatree.prototype.options.dnd,opts.dnd)}if(!opts.imagePath){$("script").each(function(){var _rexDtLibName=/.*dynatree[^\/]*\.js$/i;if(this.src.search(_rexDtLibName)>=0){if(this.src.indexOf("/")>=0){opts.imagePath=this.src.slice(0,this.src.lastIndexOf("/"))+"/skin/"}else{opts.imagePath="skin/"}self.logDebug("Guessing imagePath from '%s': '%s'",this.src,opts.imagePath);return false}})}this.persistence=new DynaTreeStatus(opts.cookieId,opts.cookie);if(opts.persist){this.persistence.read()}this.logDebug("DynaTree.persistence: %o",this.persistence.toDict());this.cache={tagEmpty:"<span class='"+opts.classNames.empty+"'></span>",tagVline:"<span class='"+opts.classNames.vline+"'></span>",tagExpander:"<span class='"+opts.classNames.expander+"'></span>",tagConnector:"<span class='"+opts.classNames.connector+"'></span>",tagNodeIcon:"<span class='"+opts.classNames.nodeIcon+"'></span>",tagCheckbox:"<span class='"+opts.classNames.checkbox+"'></span>",lastentry:undefined};if(opts.children||(opts.initAjax&&opts.initAjax.url)||opts.initId){$(this.divTree).empty()}var $ulInitialize=this.$tree.find(">ul:first").hide();this.tnRoot=new DynaTreeNode(null,this,{});this.tnRoot.bExpanded=true;this.tnRoot.render();this.divTree.appendChild(this.tnRoot.ul);var root=this.tnRoot,isReloading=(opts.persist&&this.persistence.isReloading()),isLazy=false,prevFlag=this.enableUpdate(false);this.logDebug("Dynatree._load(): read tree structure...");if(opts.children){root.addChild(opts.children)}else if(opts.initAjax&&opts.initAjax.url){isLazy=true;root.data.isLazy=true;this._reloadAjax(callback)}else if(opts.initId){this._createFromTag(root,$("#"+opts.initId))}else{this._createFromTag(root,$ulInitialize);$ulInitialize.remove()}this._checkConsistency();if(!isLazy&&opts.selectMode==3){root._updatePartSelectionState()}this.logDebug("Dynatree._load(): render nodes...");this.enableUpdate(prevFlag);this.logDebug("Dynatree._load(): bind events...");this.$widget.bind();this.logDebug("Dynatree._load(): postInit...");this.phase="postInit";if(opts.persist){this.persistence.write()}if(this.focusNode&&this.focusNode.isVisible()){this.logDebug("Focus on init: %o",this.focusNode);this.focusNode.focus()}if(!isLazy){if(opts.onPostInit){opts.onPostInit.call(this,isReloading,false)}if(callback){callback.call(this,"ok")}}this.phase="idle"},_reloadAjax:function(callback){var opts=this.options;if(!opts.initAjax||!opts.initAjax.url){throw"tree.reload() requires 'initAjax' mode."}var pers=this.persistence;var ajaxOpts=$.extend({},opts.initAjax);if(ajaxOpts.addActiveKey){ajaxOpts.data.activeKey=pers.activeKey}if(ajaxOpts.addFocusedKey){ajaxOpts.data.focusedKey=pers.focusedKey}if(ajaxOpts.addExpandedKeyList){ajaxOpts.data.expandedKeyList=pers.expandedKeyList.join(",")}if(ajaxOpts.addSelectedKeyList){ajaxOpts.data.selectedKeyList=pers.selectedKeyList.join(",")}if(ajaxOpts.success){this.logWarning("initAjax: success callback is ignored; use onPostInit instead.")}if(ajaxOpts.error){this.logWarning("initAjax: error callback is ignored; use onPostInit instead.")}var isReloading=pers.isReloading();ajaxOpts.success=function(dtnode,data,textStatus){if(opts.selectMode==3){dtnode.tree.tnRoot._updatePartSelectionState()}if(opts.onPostInit){opts.onPostInit.call(dtnode.tree,isReloading,false)}if(callback){callback.call(dtnode.tree,"ok")}};ajaxOpts.error=function(dtnode,XMLHttpRequest,textStatus,errorThrown){if(opts.onPostInit){opts.onPostInit.call(dtnode.tree,isReloading,true,XMLHttpRequest,textStatus,errorThrown)}if(callback){callback.call(dtnode.tree,"error",XMLHttpRequest,textStatus,errorThrown)}};this.logDebug("Dynatree._init(): send Ajax request...");this.tnRoot.appendAjax(ajaxOpts)},toString:function(){return"Dynatree '"+this.$tree.attr("id")+"'"},toDict:function(){return this.tnRoot.toDict(true)},serializeArray:function(stopOnParents){var nodeList=this.getSelectedNodes(stopOnParents),name=this.$tree.attr("name")||this.$tree.attr("id"),arr=[];for(var i=0,l=nodeList.length;i<l;i++){arr.push({name:name,value:nodeList[i].data.key})}return arr},getPersistData:function(){return this.persistence.toDict()},logDebug:function(msg){if(this.options.debugLevel>=2){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)}},logInfo:function(msg){if(this.options.debugLevel>=1){Array.prototype.unshift.apply(arguments,["info"]);_log.apply(this,arguments)}},logWarning:function(msg){Array.prototype.unshift.apply(arguments,["warn"]);_log.apply(this,arguments)},isInitializing:function(){return(this.phase=="init"||this.phase=="postInit")},isReloading:function(){return(this.phase=="init"||this.phase=="postInit")&&this.options.persist&&this.persistence.cookiesFound},isUserEvent:function(){return(this.phase=="userEvent")},redraw:function(){this.tnRoot.render(false,false)},renderInvisibleNodes:function(){this.tnRoot.render(false,true)},reload:function(callback){this._load(callback)},getRoot:function(){return this.tnRoot},enable:function(){this.$widget.enable()},disable:function(){this.$widget.disable()},getNodeByKey:function(key){var el=document.getElementById(this.options.idPrefix+key);if(el){return el.dtnode?el.dtnode:null}var match=null;this.visit(function(node){if(node.data.key==key){match=node;return false}},true);return match},getActiveNode:function(){return this.activeNode},reactivate:function(setFocus){var node=this.activeNode;if(node){this.activeNode=null;node.activate();if(setFocus){node.focus()}}},getSelectedNodes:function(stopOnParents){var nodeList=[];this.tnRoot.visit(function(node){if(node.bSelected){nodeList.push(node);if(stopOnParents===true){return"skip"}}});return nodeList},activateKey:function(key){var dtnode=(key===null)?null:this.getNodeByKey(key);if(!dtnode){if(this.activeNode){this.activeNode.deactivate()}this.activeNode=null;return null}dtnode.focus();dtnode.activate();return dtnode},loadKeyPath:function(keyPath,callback){var segList=keyPath.split(this.options.keyPathSeparator);if(segList[0]===""){segList.shift()}if(segList[0]==this.tnRoot.data.key){this.logDebug("Removed leading root key.");segList.shift()}keyPath=segList.join(this.options.keyPathSeparator);return this.tnRoot._loadKeyPath(keyPath,callback)},selectKey:function(key,select){var dtnode=this.getNodeByKey(key);if(!dtnode){return null}dtnode.select(select);return dtnode},enableUpdate:function(bEnable){if(this.bEnableUpdate==bEnable){return bEnable}this.bEnableUpdate=bEnable;if(bEnable){this.redraw()}return!bEnable},count:function(){return this.tnRoot.countChildren()},visit:function(fn,includeRoot){return this.tnRoot.visit(fn,includeRoot)},_createFromTag:function(parentTreeNode,$ulParent){var self=this;$ulParent.find(">li").each(function(){var $li=$(this),$liSpan=$li.find(">span:first"),$liA=$li.find(">a:first"),title,href=null,target=null,tooltip;if($liSpan.length){title=$liSpan.html()}else if($liA.length){title=$liA.html();href=$liA.attr("href");target=$liA.attr("target");tooltip=$liA.attr("title")}else{title=$li.html();var iPos=title.search(/<ul/i);if(iPos>=0){title=$.trim(title.substring(0,iPos))}else{title=$.trim(title)}}var data={title:title,tooltip:tooltip,isFolder:$li.hasClass("folder"),isLazy:$li.hasClass("lazy"),expand:$li.hasClass("expanded"),select:$li.hasClass("selected"),activate:$li.hasClass("active"),focus:$li.hasClass("focused"),noLink:$li.hasClass("noLink")};if(href){data.href=href;data.target=target}if($li.attr("title")){data.tooltip=$li.attr("title")}if($li.attr("id")){data.key=$li.attr("id")}if($li.attr("data")){var dataAttr=$.trim($li.attr("data"));if(dataAttr){if(dataAttr.charAt(0)!="{"){dataAttr="{"+dataAttr+"}"}try{$.extend(data,eval("("+dataAttr+")"))}catch(e){throw("Error parsing node data: "+e+"\ndata:\n'"+dataAttr+"'")}}}var childNode=parentTreeNode.addChild(data);var $ul=$li.find(">ul:first");if($ul.length){self._createFromTag(childNode,$ul)}})},_checkConsistency:function(){},_setDndStatus:function(sourceNode,targetNode,helper,hitMode,accept){var $source=sourceNode?$(sourceNode.span):null,$target=$(targetNode.span);if(!this.$dndMarker){this.$dndMarker=$("<div id='dynatree-drop-marker'></div>").hide().css({"z-index":1000}).prependTo($(this.divTree).parent())}if(hitMode==="after"||hitMode==="before"||hitMode==="over"){var markerOffset="0 0";switch(hitMode){case"before":this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-over");this.$dndMarker.addClass("dynatree-drop-before");markerOffset="0 -8";break;case"after":this.$dndMarker.removeClass("dynatree-drop-before dynatree-drop-over");this.$dndMarker.addClass("dynatree-drop-after");markerOffset="0 8";break;default:this.$dndMarker.removeClass("dynatree-drop-after dynatree-drop-before");this.$dndMarker.addClass("dynatree-drop-over");$target.addClass("dynatree-drop-target");markerOffset="8 0"}this.$dndMarker.show().position({my:"left top",at:"left top",of:$target,offset:markerOffset})}else{$target.removeClass("dynatree-drop-target");this.$dndMarker.hide()}if(hitMode==="after"){$target.addClass("dynatree-drop-after")}else{$target.removeClass("dynatree-drop-after")}if(hitMode==="before"){$target.addClass("dynatree-drop-before")}else{$target.removeClass("dynatree-drop-before")}if(accept===true){if($source){$source.addClass("dynatree-drop-accept")}$target.addClass("dynatree-drop-accept");helper.addClass("dynatree-drop-accept")}else{if($source){$source.removeClass("dynatree-drop-accept")}$target.removeClass("dynatree-drop-accept");helper.removeClass("dynatree-drop-accept")}if(accept===false){if($source){$source.addClass("dynatree-drop-reject")}$target.addClass("dynatree-drop-reject");helper.addClass("dynatree-drop-reject")}else{if($source){$source.removeClass("dynatree-drop-reject")}$target.removeClass("dynatree-drop-reject");helper.removeClass("dynatree-drop-reject")}},_onDragEvent:function(eventName,node,otherNode,event,ui,draggable){var opts=this.options,dnd=this.options.dnd,res=null,nodeTag=$(node.span),hitMode,enterResponse;switch(eventName){case"helper":var $helper=$("<div class='dynatree-drag-helper'><span class='dynatree-drag-helper-img' /></div>").append($(event.target).closest('a').clone());$("ul.dynatree-container",node.tree.divTree).append($helper);$helper.data("dtSourceNode",node);res=$helper;break;case"start":if(node.isStatusNode()){res=false}else if(dnd.onDragStart){res=dnd.onDragStart(node)}if(res===false){this.logDebug("tree.onDragStart() cancelled");ui.helper.trigger("mouseup");ui.helper.hide()}else{nodeTag.addClass("dynatree-drag-source")}break;case"enter":res=dnd.onDragEnter?dnd.onDragEnter(node,otherNode):null;if(!res){res=false}else{res={over:((res===true)||(res==="over")||$.inArray("over",res)>=0),before:((res===true)||(res==="before")||$.inArray("before",res)>=0),after:((res===true)||(res==="after")||$.inArray("after",res)>=0)}}ui.helper.data("enterResponse",res);break;case"over":enterResponse=ui.helper.data("enterResponse");hitMode=null;if(enterResponse===false){}else if(typeof enterResponse==="string"){hitMode=enterResponse}else{var nodeOfs=nodeTag.offset();var relPos={x:event.pageX-nodeOfs.left,y:event.pageY-nodeOfs.top};var relPos2={x:relPos.x/nodeTag.width(),y:relPos.y/nodeTag.height()};if(enterResponse.after&&relPos2.y>0.75){hitMode="after"}else if(!enterResponse.over&&enterResponse.after&&relPos2.y>0.5){hitMode="after"}else if(enterResponse.before&&relPos2.y<=0.25){hitMode="before"}else if(!enterResponse.over&&enterResponse.before&&relPos2.y<=0.5){hitMode="before"}else if(enterResponse.over){hitMode="over"}if(dnd.preventVoidMoves){if(node===otherNode){hitMode=null}else if(hitMode==="before"&&otherNode&&node===otherNode.getNextSibling()){hitMode=null}else if(hitMode==="after"&&otherNode&&node===otherNode.getPrevSibling()){hitMode=null}else if(hitMode==="over"&&otherNode&&otherNode.parent===node&&otherNode.isLastSibling()){hitMode=null}}ui.helper.data("hitMode",hitMode)}if(hitMode==="over"&&dnd.autoExpandMS&&node.hasChildren()!==false&&!node.bExpanded){node.scheduleAction("expand",dnd.autoExpandMS)}if(hitMode&&dnd.onDragOver){res=dnd.onDragOver(node,otherNode,hitMode);if(res==="over"||res==="before"||res==="after"){hitMode=res}}this._setDndStatus(otherNode,node,ui.helper,hitMode,res!==false&&hitMode!==null);break;case"drop":var isForbidden=ui.helper.hasClass("dynatree-drop-reject");hitMode=ui.helper.data("hitMode");if(hitMode&&dnd.onDrop&&!isForbidden){dnd.onDrop(node,otherNode,hitMode,ui,draggable)}break;case"leave":node.scheduleAction("cancel");ui.helper.data("enterResponse",null);ui.helper.data("hitMode",null);this._setDndStatus(otherNode,node,ui.helper,"out",undefined);if(dnd.onDragLeave){dnd.onDragLeave(node,otherNode)}break;case"stop":nodeTag.removeClass("dynatree-drag-source");if(dnd.onDragStop){dnd.onDragStop(node)}break;default:throw"Unsupported drag event: "+eventName}return res},cancelDrag:function(){var dd=$.ui.ddmanager.current;if(dd){dd.cancel()}},lastentry:undefined};$.widget("ui.dynatree",{_init:function(){if(parseFloat($.ui.version)<1.8){if(this.options.debugLevel>=0){_log("warn","ui.dynatree._init() was called; you should upgrade to jquery.ui.core.js v1.8 or higher.")}return this._create()}if(this.options.debugLevel>=2){_log("debug","ui.dynatree._init() was called; no current default functionality.")}},_create:function(){var opts=this.options;if(opts.debugLevel>=1){logMsg("Dynatree._create(): version='%s', debugLevel=%o.",$.ui.dynatree.version,this.options.debugLevel)}this.options.event+=".dynatree";var divTree=this.element.get(0);this.tree=new DynaTree(this);this.tree._load();this.tree.logDebug("Dynatree._init(): done.")},bind:function(){this.unbind();var eventNames="click.dynatree dblclick.dynatree";if(this.options.keyboard){eventNames+=" keypress.dynatree keydown.dynatree"}this.element.bind(eventNames,function(event){var dtnode=$.ui.dynatree.getNode(event.target);if(!dtnode){return true}var tree=dtnode.tree;var o=tree.options;tree.logDebug("event(%s): dtnode: %s",event.type,dtnode);var prevPhase=tree.phase;tree.phase="userEvent";try{switch(event.type){case"click":return(o.onClick&&o.onClick.call(tree,dtnode,event)===false)?false:dtnode._onClick(event);case"dblclick":return(o.onDblClick&&o.onDblClick.call(tree,dtnode,event)===false)?false:dtnode._onDblClick(event);case"keydown":return(o.onKeydown&&o.onKeydown.call(tree,dtnode,event)===false)?false:dtnode._onKeydown(event);case"keypress":return(o.onKeypress&&o.onKeypress.call(tree,dtnode,event)===false)?false:dtnode._onKeypress(event)}}catch(e){var _=null;tree.logWarning("bind(%o): dtnode: %o, error: %o",event,dtnode,e)}finally{tree.phase=prevPhase}});function __focusHandler(event){event=$.event.fix(event||window.event);var dtnode=$.ui.dynatree.getNode(event.target);return dtnode?dtnode._onFocus(event):false}var div=this.tree.divTree;if(div.addEventListener){div.addEventListener("focus",__focusHandler,true);div.addEventListener("blur",__focusHandler,true)}else{div.onfocusin=div.onfocusout=__focusHandler}},unbind:function(){this.element.unbind(".dynatree")},enable:function(){this.bind();$.Widget.prototype.enable.apply(this,arguments)},disable:function(){this.unbind();$.Widget.prototype.disable.apply(this,arguments)},getTree:function(){return this.tree},getRoot:function(){return this.tree.getRoot()},getActiveNode:function(){return this.tree.getActiveNode()},getSelectedNodes:function(){return this.tree.getSelectedNodes()},lastentry:undefined});if(parseFloat($.ui.version)<1.8){$.ui.dynatree.getter="getTree getRoot getActiveNode getSelectedNodes"}$.ui.dynatree.version="$Version: 1.2.2$";$.ui.dynatree.getNode=function(el){if(el instanceof DynaTreeNode){return el}if(el.selector!==undefined){el=el[0]}while(el){if(el.dtnode){return el.dtnode}el=el.parentNode}return null};$.ui.dynatree.getPersistData=DynaTreeStatus._getTreePersistData;$.ui.dynatree.prototype.options={title:"Dynatree",minExpandLevel:1,imagePath:null,children:null,initId:null,initAjax:null,autoFocus:true,keyboard:true,persist:false,autoCollapse:false,clickFolderMode:3,activeVisible:true,checkbox:false,selectMode:2,fx:null,noLink:false,onClick:null,onDblClick:null,onKeydown:null,onKeypress:null,onFocus:null,onBlur:null,onQueryActivate:null,onQuerySelect:null,onQueryExpand:null,onPostInit:null,onActivate:null,onDeactivate:null,onSelect:null,onExpand:null,onLazyRead:null,onCustomRender:null,onCreate:null,onRender:null,postProcess:null,dnd:{onDragStart:null,onDragStop:null,autoExpandMS:1000,preventVoidMoves:true,onDragEnter:null,onDragOver:null,onDrop:null,onDragLeave:null},ajaxDefaults:{cache:false,timeout:0,dataType:"json"},strings:{loading:"Loading&#8230;",loadError:"Load error!"},generateIds:false,idPrefix:"dynatree-id-",keyPathSeparator:"/",cookieId:"dynatree",cookie:{expires:null},classNames:{container:"dynatree-container",node:"dynatree-node",folder:"dynatree-folder",empty:"dynatree-empty",vline:"dynatree-vline",expander:"dynatree-expander",connector:"dynatree-connector",checkbox:"dynatree-checkbox",nodeIcon:"dynatree-icon",title:"dynatree-title",noConnector:"dynatree-no-connector",nodeError:"dynatree-statusnode-error",nodeWait:"dynatree-statusnode-wait",hidden:"dynatree-hidden",combinedExpanderPrefix:"dynatree-exp-",combinedIconPrefix:"dynatree-ico-",nodeLoading:"dynatree-loading",hasChildren:"dynatree-has-children",active:"dynatree-active",selected:"dynatree-selected",expanded:"dynatree-expanded",lazy:"dynatree-lazy",focused:"dynatree-focused",partsel:"dynatree-partsel",lastsib:"dynatree-lastsib"},debugLevel:1,lastentry:undefined};if(parseFloat($.ui.version)<1.8){$.ui.dynatree.defaults=$.ui.dynatree.prototype.options}$.ui.dynatree.nodedatadefaults={title:null,key:null,isFolder:false,isLazy:false,tooltip:null,href:null,icon:null,addClass:null,noLink:false,activate:false,focus:false,expand:false,select:false,hideCheckbox:false,unselectable:false,children:null,lastentry:undefined};function _initDragAndDrop(tree){var dnd=tree.options.dnd||null;if(dnd&&(dnd.onDragStart||dnd.onDrop)){_registerDnd()}if(dnd&&dnd.onDragStart){tree.$tree.draggable({addClasses:false,cancel:'.root',appendTo:"body",containment:false,handle:"span.dynatree-icon",delay:0,distance:4,revert:false,scroll:true,scrollSpeed:7,scrollSensitivity:10,connectToDynatree:true,helper:function(event){var sourceNode=$.ui.dynatree.getNode(event.target);if(!sourceNode){return"<div></div>"}return sourceNode.tree._onDragEvent("helper",sourceNode,null,event,null,null)},start:function(event,ui){var sourceNode=ui.helper.data("dtSourceNode");return!!sourceNode},_last:null})}}var didRegisterDnd=false;var _registerDnd=function(){if(didRegisterDnd){return}$.ui.plugin.add("draggable","connectToDynatree",{start:function(event,ui){var draggable=$(this).data("draggable"),sourceNode=ui.helper.data("dtSourceNode")||null;if(sourceNode){draggable.offset.click.top=-2;draggable.offset.click.left=+16;return sourceNode.tree._onDragEvent("start",sourceNode,null,event,ui,draggable)}},drag:function(event,ui){var draggable=$(this).data("draggable"),sourceNode=ui.helper.data("dtSourceNode")||null,prevTargetNode=ui.helper.data("dtTargetNode")||null,targetNode=$.ui.dynatree.getNode(event.target);if(event.target&&!targetNode){var isHelper=$(event.target).closest("div.dynatree-drag-helper,#dynatree-drop-marker").length>0;if(isHelper){return}}ui.helper.data("dtTargetNode",targetNode);if(prevTargetNode&&prevTargetNode!==targetNode){prevTargetNode.tree._onDragEvent("leave",prevTargetNode,sourceNode,event,ui,draggable)}if(targetNode&&!targetNode.data.root){if(!targetNode.tree.options.dnd.onDrop){}else if(targetNode===prevTargetNode){targetNode.tree._onDragEvent("over",targetNode,sourceNode,event,ui,draggable)}else{targetNode.tree._onDragEvent("enter",targetNode,sourceNode,event,ui,draggable)}}},stop:function(event,ui){var draggable=$(this).data("draggable"),sourceNode=ui.helper.data("dtSourceNode")||null,targetNode=ui.helper.data("dtTargetNode")||null,mouseDownEvent=draggable._mouseDownEvent,eventType=event.type,dropped=(eventType=="mouseup"&&event.which==1);if(!dropped){logMsg("Drag was cancelled")}if(targetNode&&!targetNode.data.root){if(dropped){targetNode.tree._onDragEvent("drop",targetNode,sourceNode,event,ui,draggable)}targetNode.tree._onDragEvent("leave",targetNode,sourceNode,event,ui,draggable)}if(sourceNode){sourceNode.tree._onDragEvent("stop",sourceNode,null,event,ui,draggable)}}});didRegisterDnd=true}}(jQuery));(function(){"use strict";window.s3.shop2=window.shop2={CACHE_KEY_PICKED_ORDER_ID:1,CACHE_KEY_PICKED_KIND_ID:1,_cache:{},setCacheVar:function(key,value){this._cache[key]=value},getCacheVar:function(key){return this._cache[key]},selectImportFile:function(form,parameters={},selector_type='file'){selector.open(selector_type,0,false,form,function(r){if(form){let pp=popupController.getPreviousPopup();let _u=pp.url,i;_u=util.urlParamReplace(_u,'file_id',r);if(parameters){for(let key in parameters){if(util.getUrlParam(_u,key)!==false){_u=util.urlParamReplace(_u,key,parameters[key])}else{_u+="&"+key+"="+parameters[key]}}}if(form.software){_u=util.urlParamReplace(_u,'software',$(form.software).val())}if(form.delim){_u=util.urlParamReplace(_u,'delim',$(form.delim).val())}popupController.reloadPreviousPopup(_u)}popupController.closeLastPopup();window.setTimeout(function(){util.centerElement(popupController.getLastPopup().form)},1)});return false},sendImportForm:function(obj,url,parameters,validateHandler,onSuccess,saveUrl=false){if(!obj){return false}let pp=popupController.getLastPopup();let _u=url||pp.url;if(parameters){for(let key in parameters){if(util.getUrlParam(_u,key)!==false){_u=util.urlParamReplace(_u,key,parameters[key])}else{_u+="&"+key+"="+parameters[key]}}}if(validateHandler&&!validateHandler()){return false}if(_processing_post_ajax_form){return false}_processing_post_ajax_form=1;let r=util.makePostRequest(_u,formcontents(obj));if(r.error==true){s3.alertHTML(s3.formatError(r.text));window.setTimeout("_processing_post_ajax_form=0",0)}else{if(saveUrl){popupController.getLastPopup().url=_u}if(onSuccess){onSuccess(r.text)}else{popupController.setLastPopupContent(r.text);let d=popupController.getPreviousPopup();if(d){popupController.reloadPreviousPopup(null)}else{s3.reloadContent()}}}window.setTimeout("_processing_post_ajax_form=0",0)},folderImportNextStep:function(form){var pp,_u;pp=popupController.getLastPopup();_u=pp.url;_u=util.urlParamReplace(_u,'step','choose');return postAjaxForm(_u,form)},openOrderListPopup:function(o){var shopId,getParams,url,popup,onClose;shopId=o.hasOwnProperty('shopId')?o.shopId:null;getParams=o.hasOwnProperty('getParams')?o.getParams:null;onClose=o.hasOwnProperty('onClose')?o.onClose:null;if(!shopId){return}url='/-/cms/v1/shop2/order/?shop_id='+shopId+'&ver_id='+window.ver_id+'&access='+window.access+'&popup=1';if(getParams){if(typeof getParams=='object'){for(var k in getParams){url+='&'+encodeURIComponent(k)+'='+encodeURIComponent(getParams[k])}}else{url+='&'+getParams}}popup=s3.openModalPopup(url);if(onClose){popup.onClose=onClose}},openCartListPopup:function(o){var shopId,getParams,url,popup,onClose;shopId=o.hasOwnProperty('shopId')?o.shopId:null;getParams=o.hasOwnProperty('getParams')?o.getParams:null;onClose=o.hasOwnProperty('onClose')?o.onClose:null;if(!shopId){return}url='/-/cms/v1/shop2/cart/?shop_id='+shopId+'&ver_id='+window.ver_id+'&access='+window.access+'&popup=1';if(getParams){if(typeof getParams=='object'){for(var k in getParams){url+='&'+encodeURIComponent(k)+'='+encodeURIComponent(getParams[k])}}else{url+='&'+getParams}}popup=s3.openModalPopup(url);if(onClose){popup.onClose=onClose}},openKindListPopup:function(o){var shopId,getParams,url,popup,onClose;shopId=o.hasOwnProperty('shopId')?o.shopId:null;getParams=o.hasOwnProperty('getParams')?o.getParams:null;onClose=o.hasOwnProperty('onClose')?o.onClose:null;if(!shopId){return}url='/-/cms/v1/shop2/select/product/?shop_id='+shopId+'&ver_id='+window.ver_id+'&access='+window.access+'&popup=1&act=for_all';if(getParams){if(typeof getParams=='object'){for(var k in getParams){url+='&'+encodeURIComponent(k)+'='+encodeURIComponent(getParams[k])}}else{url+='&'+getParams}}popup=s3.openModalPopup(url);if(onClose){popup.onClose=onClose}},openOrderChoosePopup:function(o){if(!o.hasOwnProperty('getParams')){o.getParams={pick:1}}else if(typeof o.getParams=='object'){o.getParams.pick=1}else if(typeof o.getParams=='string'){o.getParams+='&pick=1'}this.openOrderListPopup(o)},openCartChoosePopup:function(o){if(!o.hasOwnProperty('getParams')){o.getParams={pick:1}}else if(typeof o.getParams=='object'){o.getParams.pick=1}else if(typeof o.getParams=='string'){o.getParams+='&pick=1'}this.openCartListPopup(o)},openKindChoosePopup:function(o){if(!o.hasOwnProperty('getParams')){o.getParams={pick:1}}else if(typeof o.getParams=='object'){o.getParams.pick=1}else if(typeof o.getParams=='string'){o.getParams+='&pick=1'}this.openKindListPopup(o)},initCalendar:function(id_from,id_to){var dateFormat="dd.mm.yy",from=$(id_from).datepicker({defaultDate:"+1w",dateFormat:'dd.mm.yy',changeMonth:true,numberOfMonths:1,showOn:"button",buttonImage:"/my/s3/images/calendar/cal.gif",buttonImageOnly:true,buttonText:"Select date"}).on("change",function(){to.datepicker("option","minDate",getDate(this))}),to=$(id_to).datepicker({defaultDate:"+1w",dateFormat:'dd.mm.yy',changeMonth:true,numberOfMonths:1,showOn:"button",buttonImage:"/my/s3/images/calendar/cal.gif",buttonImageOnly:true,buttonText:"Select date"}).on("change",function(){from.datepicker("option","maxDate",getDate(this))});function getDate(element){var date;try{date=$.datepicker.parseDate(dateFormat,element.value)}catch(error){date=null}return date}}}})();$(function(){$(document).on("change",'#product-keyfield, #folder-keyfield, #vendor-keyfield',function(){var importMode=$('select[name=import_mode]');if($(this).find('option:selected').val()=='kind_id'||$(this).find('option:selected').val()=='folder_id'||$(this).find('option:selected').val()=='vendor_id'){importMode.find('option').eq(0).attr('disabled',true).trigger("chosen:updated");importMode.find('option').eq(1).attr('disabled',true).trigger("chosen:updated");importMode.find('option').eq(2).attr('selected',true).trigger("chosen:updated")}else{importMode.find('option').eq(0).attr('disabled',false).attr('selected',true).trigger("chosen:updated");importMode.find('option').eq(1).attr('disabled',false).trigger("chosen:updated")}importMode.trigger("liszt:updated")});$(document).on("change",'#reference-keyfield',function(){var importMode=$('#reference-importmode');if($(this).find('option:selected').val()=='name'){console.log('asd');importMode.find('option').eq(0).attr('disabled',false).attr('selected',true).trigger("chosen:updated");importMode.find('option').eq(1).attr('disabled',false).attr('selected',false).trigger("chosen:updated");importMode.find('option').eq(2).attr('disabled',false).attr('selected',false).trigger("chosen:updated")}else{importMode.find('option').eq(0).attr('disabled',true).attr('selected',false).trigger("chosen:updated");importMode.find('option').eq(1).attr('disabled',false).attr('selected',true).trigger("chosen:updated");importMode.find('option').eq(2).attr('disabled',true).attr('selected',false).trigger("chosen:updated")}importMode.trigger("liszt:updated")});$(document).on("change",".import_opts",function(){var val=$(this).val(),prev_val=$(this).attr('data-prev'),all_opts=$('.import_opts').not(this);if(val){if(prev_val){all_opts.each(function(){$(this).find('option[value='+prev_val+']').attr('disabled',false).trigger("chosen:updated");$(this).trigger("liszt:updated")})}$(this).attr('data-prev',val);all_opts.each(function(){$(this).find('option[value='+val+']').attr('disabled',true).trigger("chosen:updated");$(this).trigger("liszt:updated")})}else{all_opts.each(function(){$(this).find('option[value='+prev_val+']').attr('disabled',false).trigger("chosen:updated");$(this).trigger("liszt:updated")})}});$(document).on("submit",".folder-step-choose",function(){var o=this,key_field=$('#folder-keyfield').val(),import_mode=$('#folder-importmode').val(),mode=$(this).find('input[name=mode]').val();if(key_field=='folder_name'&&(import_mode=='insert_or_update'||import_mode=='update')&&mode!='import_folder_references'&&mode!='import_shop2_references'){s3.confirm(JS_FOLDER_IMPORT_UPDATE_MESSAGE,function(){popupController.closeLastPopup();return shop2.folderImportNextStep(o)});var p=popupController.getLastPopup();$(p.obj).find('#confirm_submit').html(JS_CONTINUE_ANYWAY+" <span class='s3-btn-note'> - Enter</span>");p.onClose=function(){$(p.obj).find('#confirm_submit').html(JS_YES+" <span class='s3-btn-note'> - Enter</span>")};return false}return shop2.folderImportNextStep(o)})});(function(){"use strict";window.s3.shop2=window.s3.shop2||{};window.s3.shop2.event={POPUP_MAIN:1,POPUP_EDIT:2,POPUP_TYPES:3,POPUP_TEST:4,POPUP_CHOOSE_ORDER:5,POPUP_CHOOSE_PREVIEW:6,EVENT_LIST_CONTAINER_ID:'shop2-event-list-container',EVENT_LIST_PLACEHOLDER_CLASS:'shop2-event-list-placeholder',EVENT_LIST_ITEM_TOGGLE_CLASS:'s3-jquery-toggles',EVENT_LIST_ROW_ID_PREFIX:'shop2-event-list-item-',EVENT_COMPLEX_CONTAINER_ITEM_CLASS:'s3-complex-container-item',EVENT_FORM_CONTAINER_ID:'shop2-event-form',MIN_EDITOR_WIDTH:596,_generateParams:function(form){var values=$(form).serializeArray(),params={},i=-1,k,v,rePlainArray=/\[\]$/;while(++i<values.length){k=values[i].name;v=values[i].value;if(rePlainArray.test(k)){k=k.replace(rePlainArray,'');if(params[k]==undefined){params[k]=[]}params[k].push(v)}else{params[k]=v}}return params},_mergeParamObjects:function(result,source){for(var k in source){var v=source[k];if(result[k]==undefined){result[k]=source[k]}else if($.isArray(result[k])){if($.isArray(v)){$.merge(result[k],v)}else{result[k].push(v)}}else if(typeof result[k]=='object'){if(typeof v=='object'){this._mergeParamObjects(result[k],v)}else{result[k]=[result[k],v]}}else{result[k]=[result[k],v]}}},_processParams:function(params){var result={},m;for(var k in params){if(m=k.match(/^([^\[]+)\[([^\]]+)\](.*)$/)){var newParams={},newKey=m[1];newParams[""+m[2]+m[3]]=params[k];if(result[newKey]==undefined){result[newKey]={}}this._mergeParamObjects(result[newKey],this._processParams(newParams))}else{result[k]=params[k]}}return result},_initToggles:function(container){var self=this;container.find('.'+self.EVENT_LIST_ITEM_TOGGLE_CLASS).on('toggle',function(e,active){self.setActive($(e.delegateTarget).data('object-id'),active)})},_replaceNode:function(container,html){var newContainer=$(html);$(container).replaceWith(newContainer);newContainer.S3ChangeControls();this._initToggles(newContainer);fadeController.init(newContainer.get(0))},openPopup:function(type,params){var url,self=this;switch(type){case this.POPUP_MAIN:url='/-/cms/v1/shop2/event/?';break;case this.POPUP_TYPES:url='/-/cms/v1/shop2/event/?act=types&';break;case this.POPUP_EDIT:url='/-/cms/v1/shop2/event/?act=edit&';break;case this.POPUP_TEST:url='/-/cms/v1/shop2/event/?act=test&id='+params.id+'&';params=null;break;case this.POPUP_CHOOSE_PREVIEW:url='/-/cms/v1/shop2/event/?act=choosePreview&';break;default:S3PopUp.open('alert','Unknown popup type '+type);return}function onPopupCollapse(e){e.data.o.css('width','auto')}S3Ajax.openAjaxPopup({type:'dynamic',link:url+window.access,payload:params,isReloaded:true,onOpen:function(popup){var p=$(popup);p.S3ChangeControls();ACLController.init(p);switch(type){case self.POPUP_MAIN:self._initToggles(p);break;case self.POPUP_EDIT:S3PopUp.verticalAlignByTop(S3PopUp.getLastPopup());var form=p.find('form:first');p.find('textarea.s3-template-editor').each(function(){var textarea=$(this);var textareaMinRows=textarea.attr('data-min-rows')?parseInt(textarea.attr('data-min-rows')):1;var textareaMaxRows=textarea.attr('data-max-rows')?parseInt(textarea.attr('data-max-rows')):20;var edDiv=$('<div>',{'class':textarea.attr('class')}).css({position:'relative',width:'auto',height:textarea.height(),top:8,left:8,right:8,bottom:8});textarea.hide();edDiv.insertBefore(textarea);var ed=ace.edit(edDiv[0]),session=ed.getSession();session.setValue(textarea.val());session.setMode('ace/mode/smarty');ed.renderer.setShowGutter(false);ed.setOption("minLines",textareaMinRows);session.setUseSoftTabs(false);ed.setShowPrintMargin(false);ed.setTheme('ace/theme/chrome');ed.setFontSize(14);ed.setOption("maxLines",textareaMaxRows);ed.on('change',function(e){textarea.html(ed.getSession().getValue());textarea.val(ed.getSession().getValue());textarea.countSms(textarea.next('.event-sms-counter'))});textarea.countSms(textarea.next('.event-sms-counter'));$(form).submit(function(){textarea.html(ed.getSession().getValue());textarea.val(ed.getSession().getValue())});edDiv.resizable({containment:'document',minWidth:150,minHeight:150,maxWidth:p.width(),resize:function(event,ui){ed.resize();edDiv.resizable('option','maxWidth',p.width())}});window.util.customEvent.on(S3PopUp.EV_COLLAPSE,null,{o:edDiv},onPopupCollapse)});$('#tabs .tab-handle').click(function(){var $this=$(this);$this.addClass('active').parent().siblings().find('a').removeClass('active');$($this.attr('href')).removeClass('hide').siblings().addClass('hide')});form.submit(function(){return Number(this.elements.event_id.value)!==0?self.edit(this):self.add(this)});break}}})},reloadLastPopup:function(type,params){var popup=S3PopUp.getLastPopup();popup.onClose=null;S3PopUp.closeLastPopup();this.openPopup(type,params)},openAddPopup:function(eventTypeId,eventReceiverId){this.openPopup(this.POPUP_EDIT,{typeId:eventTypeId,receiverId:eventReceiverId})},openEditPopup:function(node,eventId){this.openPopup(this.POPUP_EDIT,{id:eventId})},openTypesPopup:function(){this.openPopup(this.POPUP_TYPES)},openTestPopup:function(eventId){this.openPopup(this.POPUP_TEST,{id:eventId})},test:function(form){form.elements.test.disabled=true;$.ajax({url:'/-/cms/v1/shop2/event/?act=testSend&'+window.access,type:'POST',async:false,data:this._generateParams(form),contentType:'application/x-www-form-urlencoded; charset=UTF-8',success:function(response){if(response.hasOwnProperty('error')){self.onError(response);return}S3PopUp.closeLastPopup()},});return false},preview:function(src,data,onSuccess){$.ajax({url:'/-/cms/v1/shop2/event/?act=testSend&'+window.access,type:'POST',async:false,data:{src:src,data:data,preview:true},contentType:'application/x-www-form-urlencoded; charset=UTF-8',success:function(response){if(response.hasOwnProperty('error')){self.onError(response);return}if(typeof onSuccess==="function"){onSuccess(response)}},})},validateTestForm:function(form){var params=this._processParams(this._generateParams(form));if(isNaN(parseInt(params.order_id))&&isNaN(parseInt(params.cart_id))&&isNaN(parseInt(params.kind_id))){return false}var hasDestiantion=false;for(var k in params.to){if(params.to[k]){hasDestiantion=true;break}}return hasDestiantion},toggleTestFormSubmitButton:function(form){form.elements.test.disabled=!this.validateTestForm(form)},togglePreviewFormSubmitButton:function(form){form.elements.preview.disabled=false},openOrderChoosePopup:function(shopId,onChoose){var order;s3.shop2.openOrderChoosePopup({shopId:shopId,onClose:function(){if((order=s3.shop2.getCacheVar(s3.shop2.CACHE_KEY_PICKED_ORDER_ID))){onChoose(order)}}})},openCartChoosePopup:function(shopId,onChoose){var cartId;s3.shop2.openCartChoosePopup({shopId:shopId,onClose:function(){if((cartId=s3.shop2.getCacheVar(s3.shop2.CACHE_KEY_PICKED_CART_ID))){onChoose(cartId)}}})},openKindChoosePopup:function(shopId,onChoose){var kindId;s3.shop2.openKindChoosePopup({shopId:shopId,onClose:function(){if((kindId=s3.shop2.getCacheVar(s3.shop2.CACHE_KEY_PICKED_KIND_ID))){onChoose(kindId)}}})},chooseOrder:function(form,shopId){var self=this;this.openOrderChoosePopup(shopId,function(order){form.elements.choose_order_id.value=order.number+'('+order.order_id+')';form.elements.order_id.value=order.order_id;self.toggleTestFormSubmitButton(form)})},chooseCart:function(form,shopId){var self=this;this.openCartChoosePopup(shopId,function(cartId){form.elements.choose_cart_id.value=cartId;form.elements.cart_id.value=cartId;self.toggleTestFormSubmitButton(form)})},chooseKind:function(form,shopId){var self=this;this.openKindChoosePopup(shopId,function(kindId){form.elements.choose_kind_id.value=kindId;form.elements.kind_id.value=kindId;self.toggleTestFormSubmitButton(form)})},choosePreviewOrder:function(form,shopId){var self=this;this.openOrderChoosePopup(shopId,function(order){form.elements.choose_order_id.value=order.number+'('+order.order_id+')';form.elements.order_id.value=order.order_id;self.togglePreviewFormSubmitButton(form)})},choosePreviewCart:function(form,shopId){var self=this;this.openCartChoosePopup(shopId,function(cartId){form.elements.choose_cart_id.value=cartId;form.elements.cart_id.value=cartId;self.togglePreviewFormSubmitButton(form)})},choosePreviewKind:function(form,shopId){var self=this;this.openKindChoosePopup(shopId,function(kindId){form.elements.choose_kind_id.value=kindId;form.elements.kind_id.value=kindId;self.togglePreviewFormSubmitButton(form)})},setActive:function(eventId,active){$.ajax({url:'/-/cms/v1/shop2/event/?act=setActive&id='+eventId+'&active='+(active?1:0)+'&'+window.access,type:"GET",async:false,})},edit:function(form){var self=this;$.ajax({url:'/-/cms/v1/shop2/event/?act=editing&'+window.access,data:this._generateParams(form),type:"POST",async:false,contentType:'application/x-www-form-urlencoded; charset=UTF-8',success:function(response){if(response.hasOwnProperty('error')){self.onError(response);return}var container=$('#'+self.EVENT_LIST_CONTAINER_ID),id=form.elements.event_id.value;S3PopUp.closeLastPopup();self._replaceNode(container.find('#'+self.EVENT_LIST_ROW_ID_PREFIX+id),response)},});return false},add:function(form){var self=this;$.ajax({url:'/-/cms/v1/shop2/event/?act=editing&'+window.access,data:this._generateParams(form),type:"POST",async:false,contentType:'application/x-www-form-urlencoded; charset=UTF-8',success:function(response){if(response.hasOwnProperty('error')){self.onError(response);return}var container=$('#'+self.EVENT_LIST_CONTAINER_ID);container.find('.'+self.EVENT_LIST_PLACEHOLDER_CLASS).hide();S3PopUp.closeLastPopup();S3PopUp.closeLastPopup();var row=$(response);container.prepend(row);row.S3ChangeControls();row.find('.'+self.EVENT_LIST_ITEM_TOGGLE_CLASS).on('toggle',function(e,active){self.setActive($(e.delegateTarget).data('object-id'),active)});fadeController.init(row.get(0))},});return false},delete:function(node,eventId){jQuery_S3.deleteObject({obj:node,url:'/-/cms/v1/shop2/event/?act=delete&id='+eventId+'&'+window.access,parent:'tr',msg:JS_CONFIRM_DELETE,})},switchNotificationStatus:function(elem){var $this=$(elem),agreement_el=$this.parents('.shop2-event-edit').find('.event-agreement'),active_field=$this.parents('.shop2-event-edit').find('[name=active]'),siblingCheckbox=$this.parents('.shop2-event-edit').find('[name="notification_code[]"]').not($this),submit=$('#shop2-event-edit-submit-button');if($this.prop('checked')){active_field.val(1);if($this.val()=='sms'){agreement_el.addClass('focused');if(agreement_el.is(':hidden')){agreement_el.show()}if(!agreement_el.find('input').prop('checked')){submit.addClass('disabled')}}}else{if(!siblingCheckbox.filter(":checked").length){active_field.val(0)}if($this.val()=='sms'){agreement_el.removeClass('focused');submit.removeClass('disabled')}}},switchConfirmation:function(elem){var $this=$(elem),checkbox=$this.parents('.event-agreement').siblings('.s3-complex-container-item').find('[name=notification_code\\[\\]]'),submit=$('#shop2-event-edit-submit-button');if($this.prop('checked')&&checkbox.prop('checked')){submit.removeClass('disabled')}else if(checkbox.prop('checked')){submit.addClass('disabled')}},choosePreviewOrderView:function(code,title){this.openPopup(this.POPUP_CHOOSE_PREVIEW,{code:code,title:title})},openPreviewPopup:function(code,previewForm,title){function getId(elements){switch(elements.msg_type.value){case'group_cart':return elements.cart_id.value;case'group_product':return elements.kind_id.value;default:return elements.order_id.value}}var self=this,data={type:previewForm.elements.msg_type.value,id:getId(previewForm.elements)},eventForm=$('#'+self.EVENT_FORM_CONTAINER_ID);function onSuccess(response){s3.shop2.event.preview(response,data,function(r){S3PopUp.open('popup',{title:title,body:r})})}$.ajax({url:'/-/cms/v1/shop2/event/?act=preview&'+window.access,type:'POST',async:false,data:{code:code,fields:JSON.stringify(this._generateParams(eventForm))},contentType:'application/x-www-form-urlencoded; charset=UTF-8',success:function(response){if(response.hasOwnProperty('error')){self.onError(response);return}onSuccess(response)},});return false},onError:function(response){var errorMessage;if(window.isStaffUser){errorMessage='<b>'+JS_ERROR+(response.error.code?' #'+response.error.code:'')+'</b><br/><br/>'+response.error.message}else{errorMessage='<b>'+JS_ERROR+'</b><br/><br/>'+response.error.message}S3PopUp.open('alert',errorMessage)}}})();(function(){"use strict";window.s3.shop2=window.s3.shop2||{};window.s3.shop2.stats={POPUP_STATS_AMOUNT:1,POPUP_STATS_TOTAL:2,POPUP_STATS_BY_PRODUCTS:3,POPUP_STATS_BY_FOLDERS:4,STATS_AMOUNT:0,STATS_TOTAL:1,STATS_BY_PRODUCTS:"products",STATS_BY_FOLDERS:"folders",EVENT_FORM_CONTAINER_ID:'shop2-stats-filter',_generateParams:function(form){var values=$(form).serializeArray(),params={},i=-1,k,v,rePlainArray=/\[\]$/;while(++i<values.length){k=values[i].name;v=values[i].value;if(rePlainArray.test(k)){k=k.replace(rePlainArray,'');if(params[k]==undefined){params[k]=[]}params[k].push(v)}else{params[k]=v}}return params},openPopup:function(type,params){var url,self=this;switch(type){case this.POPUP_STATS_AMOUNT:url='/-/cms/v1/shop2/order/stats/?';if(params&&'total'in params){params.total=self.STATS_AMOUNT}break;case this.POPUP_STATS_TOTAL:url='/-/cms/v1/shop2/order/stats/?';if(params&&'total'in params){params.total=self.STATS_TOTAL}break;case this.POPUP_STATS_BY_PRODUCTS:url='/-/cms/v1/shop2/order/stats/?act=statsByPositions&';if(params&&'stats_type'in params){params.stats_type=self.STATS_BY_PRODUCTS}break;case this.POPUP_STATS_BY_FOLDERS:url='/-/cms/v1/shop2/order/stats/?act=statsByPositions&';if(params&&'stats_type'in params){params.stats_type=self.STATS_BY_FOLDERS}break;default:S3PopUp.open('alert','Unknown popup type '+type);return}function onPopupCollapse(e){e.data.o.css('width','auto')}S3Ajax.openAjaxPopup({type:'dynamic',link:url+window.access,payload:params,onOpen:function(popup){var p=$(popup);switch(type){case self.POPUP_STATS_AMOUNT:p.find('#'+self.EVENT_FORM_CONTAINER_ID+' input[name=total]').val(self.STATS_AMOUNT);break;case self.POPUP_STATS_TOTAL:p.find('#'+self.EVENT_FORM_CONTAINER_ID+' input[name=total]').val(self.STATS_TOTAL);break;case self.POPUP_STATS_BY_PRODUCTS:p.find('#'+self.EVENT_FORM_CONTAINER_ID+' input[name=stats_type]').val(self.STATS_BY_PRODUCTS);break;case self.POPUP_STATS_BY_FOLDERS:p.find('#'+self.EVENT_FORM_CONTAINER_ID+' input[name=stats_type]').val(self.STATS_BY_FOLDERS);break}}})},reloadLastPopup:function(type,params){var self=this;if(!params){params=this._generateParams($('#'+self.EVENT_FORM_CONTAINER_ID))}var popup=S3PopUp.getLastPopup();popup.onClose=null;S3PopUp.closeLastPopup();this.openPopup(type,params)},initShop2Stats:function(){nv.addGraph(function(){var chart=nv.models.lineChart().useInteractiveGuideline(true).x(function(d){return d[0]}).y(function(d){return d[1]}).color(d3.scale.category10().range());chart.dispatch.on('renderEnd',function(){console.log('render complete: cumulative line with guide line')});chart.xAxis.tickFormat(function(d){return d3.time.format('%d.%m')(new Date(d))}).ticks(5);chart.yAxis.tickFormat(d3.format('d'));d3.select('#chart1 svg').datum(cumulativeData()).call(chart);nv.utils.windowResize(chart.update);chart.dispatch.on('stateChange',function(e){nv.log('New State:',JSON.stringify(e))});chart.state.dispatch.on('change',function(state){nv.log('state',JSON.stringify(state))});return chart});function cumulativeData(){var data;data=$.map(JSON.parse($(".stats-data").text()),function(value){for(var i=0;i<value.values.length;i++){value.values[i][0]=value.values[i][0]*1000;value.values[i][1]=Math.floor(value.values[i][1])}return value});return data}}}})();(function(){"use strict";window.s3.shop2=window.s3.shop2||{};window.s3.shop2.digital_goods={POPUP_MAIN:1,DIGITAL_GOODS_LIST_CONTAINER_ID:'shop2-digital_goods-list-container',DIGITAL_GOODS_LIST_PLACEHOLDER_CLASS:'shop2-digital_goods-list-placeholder',DIGITAL_GOODS_LIST_ITEM_TOGGLE_CLASS:'s3-jquery-toggles',DIGITAL_GOODS_LIST_ROW_ID_PREFIX:'shop2-digital_goods-list-item-',DIGITAL_GOODS_COMPLEX_CONTAINER_ITEM_CLASS:'s3-complex-container-item',DIGITAL_GOODS_FORM_CONTAINER_ID:'shop2-digital_goods-form',MIN_EDITOR_WIDTH:596,_generateParams:function(form){var values=$(form).serializeArray(),params={},i=-1,k,v,rePlainArray=/\[\]$/;while(++i<values.length){k=values[i].name;v=values[i].value;if(rePlainArray.test(k)){k=k.replace(rePlainArray,'');if(params[k]==undefined){params[k]=[]}params[k].push(v)}else{params[k]=v}}return params},openPopup:function(type,digital_goods_id,kind_id){var rpcMethod,self=this;switch(type){case this.POPUP_MAIN:rpcMethod='popup_main';break;default:S3PopUp.open('alert','Unknown popup type '+type);return}function onPopupCollapse(e){e.data.o.css('width','auto')}S3Ajax.openAjaxPopup({type:'dynamic',link:'/-/cms/v1/shop2/?act=digitalGoods&digital_goods_id='+digital_goods_id+'&kind_id='+kind_id+'&'+window.access,isReloaded:true,onOpen:function(popup){var p=$(popup);p.S3ChangeControls();ACLController.init(p);switch(type){case self.POPUP_MAIN:break;case self.POPUP_EDIT:S3PopUp.verticalAlignByTop(S3PopUp.getLastPopup());var form=p.find('form:first');p.find('textarea.s3-template-editor').each(function(){var textarea=$(this);var textareaMinRows=textarea.attr('data-min-rows')?parseInt(textarea.attr('data-min-rows')):1;var textareaMaxRows=textarea.attr('data-max-rows')?parseInt(textarea.attr('data-max-rows')):20;var edDiv=$('<div>',{'class':textarea.attr('class')}).css({position:'relative',width:'auto',height:textarea.height(),top:8,left:8,right:8,bottom:8});textarea.hide();edDiv.insertBefore(textarea);var ed=ace.edit(edDiv[0]),session=ed.getSession();session.setValue(textarea.val());session.setMode('ace/mode/smarty');ed.renderer.setShowGutter(false);ed.setOption("minLines",textareaMinRows);session.setUseSoftTabs(false);ed.setShowPrintMargin(false);ed.setTheme('ace/theme/chrome');ed.setFontSize(14);ed.setOption("maxLines",textareaMaxRows);ed.on('change',function(e){textarea.html(ed.getSession().getValue());textarea.val(ed.getSession().getValue());textarea.countSms(textarea.next('.digital_goods-sms-counter'))});textarea.countSms(textarea.next('.digital_goods-sms-counter'));$(form).submit(function(){textarea.html(ed.getSession().getValue());textarea.val(ed.getSession().getValue())});edDiv.resizable({containment:'parent',minWidth:150,minHeight:150,maxWidth:p.width(),resize:function(digital_goods,ui){ed.resize();edDiv.resizable('option','maxWidth',p.width())}});window.util.customEvent.on(S3PopUp.EV_COLLAPSE,null,{o:edDiv},onPopupCollapse)});$('#tabs .tab-handle').click(function(){var $this=$(this);$this.addClass('active').parent().siblings().find('a').removeClass('active');$($this.attr('href')).removeClass('hide').siblings().addClass('hide')});form.submit(function(){return Number(this.elements.digital_goods_id.value)!==0?self.edit(this):self.add(this)});break}}})},reloadLastPopup:function(type,params){var popup=S3PopUp.getLastPopup();popup.onClose=null;S3PopUp.closeLastPopup();this.openPopup(type,params)},setActive:function(elem,kind_id){var hasClass=$(elem).hasClass('active');var $inp=$('.digital-input-wrap.kind-'+kind_id+' input');$(elem).closest('.digital-goods-wrapper').find('.digital-item').removeClass('active');if(!hasClass){$(elem).addClass('active');var id=$(elem).find('h4 span').text();$inp.val(id)}else{$inp.val("")}},switchNotificationStatus:function(elem){var $this=$(elem),agreement_el=$this.parents('.shop2-digital_goods-edit').find('.digital_goods-agreement'),active_field=$this.parents('.shop2-digital_goods-edit').find('[name=active]'),siblingCheckbox=$this.parents('.shop2-digital_goods-edit').find('[name=notification_code\\[\\]]').not($this),submit=$('#shop2-digital_goods-edit-submit-button');if($this.prop('checked')){active_field.val(1);if($this.val()=='sms'){agreement_el.addClass('focused');if(agreement_el.is(':hidden')){agreement_el.show()}if(!agreement_el.find('input').prop('checked')){submit.addClass('disabled')}}}else{if(!siblingCheckbox.prop('checked')){active_field.val(0)}if($this.val()=='sms'){agreement_el.removeClass('focused');submit.removeClass('disabled')}}},}})();(function(){"use strict";window.s3.event=window.s3.event||{};window.s3.event={POPUP_MAIN:1,POPUP_EDIT:2,POPUP_TYPES:3,EVENT_LIST_CONTAINER_ID:'shop2-event-list-container',EVENT_LIST_PLACEHOLDER_CLASS:'shop2-event-list-placeholder',EVENT_LIST_ITEM_TOGGLE_CLASS:'s3-jquery-toggles',EVENT_LIST_ROW_ID_PREFIX:'shop2-event-list-item-',EVENT_COMPLEX_CONTAINER_ITEM_CLASS:'s3-complex-container-item',EVENT_FORM_CONTAINER_ID:'shop2-event-form',MIN_EDITOR_WIDTH:596,_generateParams:function(form){var values=$(form).serializeArray(),params={},i=-1,k,v,rePlainArray=/\[\]$/;while(++i<values.length){k=values[i].name;v=values[i].value;if(rePlainArray.test(k)){k=k.replace(rePlainArray,'');if(params[k]==undefined){params[k]=[]}params[k].push(v)}else{params[k]=v}}return params},_initToggles:function(container){var self=this;container.find('.'+self.EVENT_LIST_ITEM_TOGGLE_CLASS).on('toggle',function(e,active){self.setActive($(e.delegateTarget).data('object-id'),active)})},_replaceNode:function(container,html){var newContainer=$(html);$(container).replaceWith(newContainer);newContainer.S3ChangeControls();this._initToggles(newContainer);fadeController.init(newContainer.get(0))},openPopup:function(type,params){var url,self=this;switch(type){case this.POPUP_MAIN:url='/-/cms/v1/event/?object_id='+params.object_id+'&object_type_id='+params.object_type_id+'&';params=null;break;case this.POPUP_TYPES:url='/-/cms/v1/event/?act=types&';break;case this.POPUP_EDIT:url='/-/cms/v1/event/?act=edit&';break;default:S3PopUp.open('alert','Unknown popup type '+type);return}function onPopupCollapse(e){e.data.o.css('width','auto')}S3Ajax.openAjaxPopup({type:'dynamic',link:url+window.access,isReloaded:true,payload:params,onOpen:function(popup){var p=$(popup);p.S3ChangeControls();switch(type){case self.POPUP_MAIN:self._initToggles(p);break;case self.POPUP_EDIT:S3PopUp.verticalAlignByTop(S3PopUp.getLastPopup());var form=p.find('form:first');p.find('textarea.s3-template-editor').each(function(){var textarea=$(this);var textareaMinRows=textarea.attr('data-min-rows')?parseInt(textarea.attr('data-min-rows')):1;var textareaMaxRows=textarea.attr('data-max-rows')?parseInt(textarea.attr('data-max-rows')):20;var edDiv=$('<div>',{'class':textarea.attr('class')}).css({position:'relative',width:'auto',height:textarea.height(),top:8,left:8,right:8,bottom:8});textarea.hide();edDiv.insertBefore(textarea);var ed=ace.edit(edDiv[0]),session=ed.getSession();session.setValue(textarea.val());session.setMode('ace/mode/smarty');ed.renderer.setShowGutter(false);ed.setOption("minLines",textareaMinRows);session.setUseSoftTabs(false);ed.setShowPrintMargin(false);ed.setTheme('ace/theme/chrome');ed.setFontSize(14);ed.setOption("maxLines",textareaMaxRows);ed.on('change',function(e){textarea.html(ed.getSession().getValue());textarea.val(ed.getSession().getValue());textarea.countSms(textarea.next('.event-sms-counter'))});textarea.countSms(textarea.next('.event-sms-counter'));$(form).submit(function(){textarea.html(ed.getSession().getValue());textarea.val(ed.getSession().getValue())});edDiv.resizable({containment:'parent',minWidth:150,minHeight:150,maxWidth:p.width(),resize:function(event,ui){ed.resize();edDiv.resizable('option','maxWidth',p.width())}});window.util.customEvent.on(S3PopUp.EV_COLLAPSE,null,{o:edDiv},onPopupCollapse)});form.submit(function(){return this.elements.hasOwnProperty('handler_id')?self.edit(this):self.add(this)});break}}})},reloadLastPopup:function(type,params){var popup=S3PopUp.getLastPopup();popup.onClose=null;S3PopUp.closeLastPopup();this.openPopup(type,params)},reloadContentLastPopup:function(type,params){var self=this,popup=S3PopUp.getLastPopup();function onSuccess(response){$(popup).find('.content').html($(response.result).find('.content').html()).S3ChangeControls()}$.ajax({url:'/-/cms/v1/event/?act=types&'+window.access,type:"POST",data:params,async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}$(popup).find('.content').html($(response).find('.content').html()).S3ChangeControls()})},openAddPopup:function(eventTypeId,eventReceiverId,eventObjectTypeId,eventObjectId,transportId){this.openPopup(this.POPUP_EDIT,{typeId:eventTypeId,receiverId:eventReceiverId,objectTypeId:eventObjectTypeId,objectId:eventObjectId,transportId:transportId})},openEditPopup:function(node,eventTypeId,eventReceiverId,eventObjectTypeId,eventObjectId,handlerId,transportId){this.openPopup(this.POPUP_EDIT,{typeId:eventTypeId,receiverId:eventReceiverId,objectTypeId:eventObjectTypeId,objectId:eventObjectId,handlerId:handlerId,transportId:transportId})},openTypesPopup:function($params){this.openPopup(this.POPUP_TYPES,$params)},edit:function(form){var self=this;var params=this._generateParams(form);$.ajax({url:'/-/cms/v1/event/?act=editing&'+window.access,type:"POST",data:params,async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}var container=$('#'+self.EVENT_LIST_CONTAINER_ID),id=form.elements.handler_id.value;S3PopUp.closeLastPopup();self._replaceNode(container.find('#'+self.EVENT_LIST_ROW_ID_PREFIX+id),response);if(((params.type_id==1&&params.object_type_id==14)||(params.type_id==2&&params.object_type_id==55))&&params.receiver_id==1&&form.elements.transport_code_email.value=='email'){if(params.transport_code&&params.transport_code[0]=="email"){$('#event-no-send-email-notice').hide()}else{$('#event-no-send-email-notice').show()}}});return false},add:function(form){var self=this;var params=this._generateParams(form);$.ajax({url:'/-/cms/v1/event/?act=editing&'+window.access,type:"POST",data:params,async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}var container=$('#'+self.EVENT_LIST_CONTAINER_ID);container.find('.'+self.EVENT_LIST_PLACEHOLDER_CLASS).hide();S3PopUp.closeLastPopup();S3PopUp.closeLastPopup();var row=$(response);container.prepend(row);row.S3ChangeControls();row.find('.'+self.EVENT_LIST_ITEM_TOGGLE_CLASS).on('toggle',function(e,active){self.setActive($(e.delegateTarget).data('object-id'),active)});fadeController.init(row.get(0));if(((params.type_id==1&&params.object_type_id==14)||(params.type_id==2&&params.object_type_id==55))&&params.receiver_id==1&&form.elements.transport_code_email.value=='email'){if(params.transport_code&&params.transport_code[0]=="email"){$('#event-no-send-email-notice').hide()}else{$('#event-no-send-email-notice').show()}}});return false},delete:function(node,eventTypeId,receiverId,objectTypeId,objectId,handlerId,parents){jQuery_S3.deleteObject({obj:node,url:'/-/cms/v1/event/?act=delete&'+window.access,parent:parents||'tr',msg:JS_CONFIRM_DELETE,payload:{eventTypeId:eventTypeId,receiverId:receiverId,objectTypeId:objectTypeId,objectId:objectId,handlerId:handlerId}})},confirm:function(msg){var errorText=s3.loc(JS_ERROR);S3PopUp.open('alert',msg);S3PopUp.setTitle(errorText)},switchTransportStatus:function(elem){var $this=$(elem),agreement_el=$this.parents('.shop2-event-edit').find('.event-agreement'),siblingCheckbox=$this.parents('.shop2-event-edit').find('[name=transport_code\\[\\]]').not($this),submit=$('#shop2-event-edit-submit-button');if($this.prop('checked')){if($this.val()=='sms'){agreement_el.addClass('focused');if(agreement_el.is(':hidden')){agreement_el.show()}if(!agreement_el.find('input').prop('checked')){submit.addClass('disabled')}}}else{if(!siblingCheckbox.prop('checked')){}if($this.val()=='sms'){agreement_el.removeClass('focused');submit.removeClass('disabled')}}},switchConfirmation:function(elem){var $this=$(elem),checkbox=$this.parents('.event-agreement').siblings('.s3-complex-container-item').find('[name=transport_code\\[\\]]'),submit=$('#shop2-event-edit-submit-button');if($this.prop('checked')&&checkbox.prop('checked')){submit.removeClass('disabled')}else if(checkbox.prop('checked')){submit.addClass('disabled')}},switchTypesBtn:function(elem){var $this=$(elem),btn=$('#event-add-btn'),confirm=$('#event-type-confirm');if($this.data('disabled')){btn.addClass('handler');btn.attr("data-handler_id",$this.data('handler_id'));confirm.show()}else{btn.removeClass('handler');confirm.hide()}},onError:function(response){var errorMessage;if(window.isStaffUser){errorMessage='<b>'+JS_ERROR+(response.error.code?' #'+response.error.code:'')+'</b><br/><br/>'+response.error.message}else{errorMessage='<b>'+JS_ERROR+'</b><br/><br/>'+response.error.message}S3PopUp.open('alert',errorMessage)}}})();s3Messenger={remove:function(node,chat_id,data_type){jQuery_S3.deleteObject({obj:node,url:'/-/cms/v1/messenger/telegram/?act=remove&chat_id='+chat_id+'&'+window.access,parent:'tr',msg:s3.loc('JS_CONFIRM_DELETE')});return false},removeControlItem:function(itemContainer,chat_id,input){var messenger_list=input.value.split(',');var i=messenger_list.indexOf(chat_id);if(i!=-1){messenger_list.splice(i,1).join(',');input.value=messenger_list}$(itemContainer).remove()},append:function(container,messenger_name){var self=this;var control=$(container).find('input:hidden:first');var onOpen=function(popup){var v=control.val();if(!v){return}var chats=v.split(',');popup.find(':checkbox').each(function(){if(chats.indexOf(this.value)!=-1){$(this).prop('checked',true)}})};var onClose=function(popup){var messenger_chats=[];popup.find(':checkbox').each(function(){if(this.checked){messenger_chats.push(this.value)}});$.ajax({url:'/-/cms/v1/messenger/telegram/?act=controlList&'+window.access,type:"POST",data:{messenger_chats:messenger_chats,control_name:control.attr('name')},async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}jQuery_S3.replaceNode(container,response)})};S3Ajax.openAjaxPopup({type:'dynamic',link:'/-/cms/v1/messenger/telegram/?'+window.access,isReloaded:true,onClose:onClose,onOpen:onOpen})},appendFromShowOnly:function(container,messenger_name){var onOpen=function(popup){};var onClose=function(popup){S3PopUp.reloadLastPopup()};S3Ajax.openAjaxPopup({type:'dynamic',link:'/-/cms/v1/messenger/telegram/?'+window.access,isReloaded:true,onClose:onClose,onOpen:onOpen})},add:function(form,container,messenger_name){var self=this,chat_id=form.chat_id.value.trim();if(chat_id==''){return false}$.ajax({url:'/-/cms/v1/messenger/telegram/?act=add&'+window.access,type:"POST",data:{chat_id:chat_id},async:false}).done(function(response){if(response.hasOwnProperty('error')){if(response.error.code==1){var textError=response.error.message,errorTextTitle=s3.loc(JS_ERROR);S3PopUp.open('alert',textError);S3PopUp.setTitle(errorTextTitle+' #'+response.error.code)}else{self.onError(response)}return}var newTr=$(response);$(container).find('.s3-placeholder').remove();$(container).append(newTr);newTr.S3ChangeControls();fadeController.init(newTr.get(0));form.reset()});return false},save:function(node,chat_id){var self=this,chat_id=document.getElementById('chat_id_'+chat_id).value.trim(),name=document.getElementById('name_'+chat_id).value.trim();if(chat_id==''){return false}$.ajax({url:'/-/cms/v1/messenger/telegram/?act=save&'+window.access,type:"POST",data:{name:name,chat_id:chat_id},async:false}).done(function(response){if(response.hasOwnProperty('error')){self.onError(response);return}$(node).removeClass("name-changed")});return false},onError:function(response){var errorMessage;if(window.isStaffUser){errorMessage='<b>'+JS_ERROR+(response.error.code?' #'+response.error.code:'')+'</b><br/><br/>'+response.error.message}else{errorMessage='<b>'+JS_ERROR+'</b><br/><br/>'+response.error.message}S3PopUp.open('alert',errorMessage)}};function JsonRpcProxy(url){this.url=url;this.id=0}JsonRpcProxy.prototype.generateNewId=function(){return++this.id};JsonRpcProxy.prototype._mergeParamObjects=function(result,source){for(var k in source){var v=source[k];if(result[k]==undefined){result[k]=source[k]}else if($.isArray(result[k])){if($.isArray(v)){$.merge(result[k],v)}else{result[k].push(v)}}else if(typeof result[k]=='object'){if(typeof v=='object'){this._mergeParamObjects(result[k],v)}else{result[k]=[result[k],v]}}else{result[k]=[result[k],v]}}};JsonRpcProxy.prototype._processParams=function(params){var result={},m;for(var k in params){if(m=k.match(/^([^\[]+)\[([^\]]+)\](.*)$/)){var newParams={},newKey=m[1];newParams[""+m[2]+m[3]]=params[k];if(result[newKey]==undefined){result[newKey]={}}this._mergeParamObjects(result[newKey],this._processParams(newParams))}else{result[k]=params[k]}}return result};JsonRpcProxy.prototype.generateParams=function(form){var values=$(form).serializeArray(),params={},i=-1,k,v,rePlainArray=/\[\]$/;while(++i<values.length){k=values[i].name;v=values[i].value;if(rePlainArray.test(k)){k=k.replace(rePlainArray,'');if(params[k]==undefined){params[k]=[]}params[k].push(v)}else{params[k]=v}}return params};JsonRpcProxy.prototype.makeRequest=function(method,opt){var request={jsonrpc:'2.0',method:method,id:this.generateNewId()};if(opt.hasOwnProperty('params')){request.params=this._processParams(opt.params)}return request};JsonRpcProxy.prototype.call=function(method,opt){var request,onSuccess,onError,onComplete;request=this.makeRequest(method,opt);onSuccess=opt.hasOwnProperty('onSuccess')?opt.onSuccess:(function(){util.msg(JS_DONE)});onError=opt.hasOwnProperty('onError')?opt.onError:(function(response){var errorMessage;if(isStaffUser){errorMessage='<b>'+JS_ERROR+' #'+response.error.code+'</b><br/><br/>'+response.error.message}else{errorMessage='<b>'+JS_ERROR+'</b><br/><br/>'+response.error.message}S3PopUp.open('alert',errorMessage)});if(opt.hasOwnProperty('onComplete')){onComplete=opt.onComplete}$.ajax({url:this.url,data:JSON.stringify(request),type:"POST",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(response){if(response.hasOwnProperty('result')){onSuccess(response)}else if(response.hasOwnProperty('error')){onError(response)}else{S3PopUp.open('alert',JS_ERROR+": "+response)}}).fail(function(err){if(typeof err=="object"){err=err.responseText}S3PopUp.open('alert',JS_ERROR+": "+err)}).complete(function(jqXHR,statusText){if(typeof onComplete=="function"){onComplete(jqXHR,statusText)}})};(function(){"use strict";window.s3.article2={initArticleBlock:function(container,block,warning){$(document).on('mouseover',container,function(){$(this).sortable({cursor:"move",placeholder:"s3_sortable_placeholder"})});this.articleBlockLimiter(container,block,warning)},initRecommendationType:function(container,dependent_block,mutual_block){var types=[];$(container+' option').each(function(){types.push($(this).val())});$(container).change(function(){var val=$(this).val();if(val==types[1]){$(dependent_block).hide();$(mutual_block).show()}else if(val==types[2]){$(dependent_block).show();$(mutual_block).hide()}else{$(dependent_block).hide();$(mutual_block).hide()}});var recommendation_type=$(container).val();switch(recommendation_type){case'auto':$(dependent_block).hide();$(mutual_block).hide();break;case'mutual':$(dependent_block).hide();$(mutual_block).show();break;case'dependent':$(dependent_block).show();$(mutual_block).hide();break}},articleBlockLimiter:function(container,block,warning){var blockAmount=$(container+' > li').size();if(blockAmount>=7){$(block).hide();$(warning).show()}else{$(block).show();$(warning).hide()}},addArticleToContainer:function(post_id,title,elem,container,localize_add,localize_max_article){var $container_name=$('#block-articles-container');var cls='selected-article';if(container!='articles'){var id_ar='#recommended_'+container;$container_name=$(id_ar);cls='recommended-article'}if($container_name.children().length>=50){alert(localize_max_article);return false}$(elem).replaceWith('<span style="float: right; color: #777777;">'+localize_add+'</span>');if($(cls+'-'+post_id).length){return false}if(container=='articles'){$container_name.append('<li class="'+cls+'" id="'+cls+'-'+post_id+'">'+'<ins class="selected-article__icon">&#8597;</ins>'+'<ins class="objectRemove"  onclick="removeArticleFromBlock(this)" >X</ins>'+'<span>'+'<input type="hidden" name="articles[]"  value="'+post_id+'">'+'<strong>'+title+'</strong>'+'</span>'+'</li>')}else{$container_name.append('<li class="'+cls+'" id="'+cls+'-'+post_id+'">'+'<span class="title">'+'<span class="s3-ico"></span><span class="name">'+title+'</span>'+'</span>'+'<span class="remove" onclick="removeArticleFromBlock(this)" >'+'<span class="s3-ico i-delete-svg"></span>'+'</span>'+'<input type="hidden" name="'+container+'[]" value="'+post_id+'">'+'</li>')}},verifySelected:function(container,id_name,localize_add){var selected_articles=[];$('#'+container+' li').each(function(i,e){selected_articles.push(e.id.replace(id_name,''))});for(var i in selected_articles){var regexp=/(\d+)_(\d+)/;if(selected_articles[i].match(regexp)){var matches=regexp.exec(selected_articles[i]);$('#article'+matches[1]+" option[value="+matches[2]+"]").attr("disabled",true)}else{var $el=$('#article'+selected_articles[i]);if($el.prop("tagName")=="SELECT"){$el.siblings(".objectAction").replaceWith($('<span>'+localize_add+'</span>').css({float:'right',color:'#777777'}))}else{$el.siblings(".objectAction").replaceWith($('<span>'+localize_add+'</span>').css({float:'right',color:'#777777'}))}}}}}})();$(function(){$(document).on('click','.s3-sort .context-menu ul li .s3-ico.i-asc',function(e){e.preventDefault();$(this).parent().find('.name').trigger('click');$('.main_sort_btn.i-asc').trigger('click')});$(document).on('click','.s3-sort .context-menu ul li .s3-ico.i-desc',function(e){e.preventDefault();$(this).parent().find('.name').trigger('click');$('.main_sort_btn.i-desc').trigger('click')});$(document).on('click','.s3-btn.actions_btn',function(){if($(this).hasClass('opened')){$(this).removeClass('opened');$('.news_actions_block').removeClass('active');$('.news_list_table .news_name').removeClass('active');$('.article2-pagination-wrap,.article-list-view-params,.s3-actions-panel-wrap,.s3-actions-panel,.tree-wrapper.article_redisegn,.news-pagination-wrap,.s3-sort,.s3-per-page-controller').removeClass('disabled');$('.article2_actions_block').removeClass('active');$('#article_container .post-name').removeClass('active')}else{$(this).addClass('opened');$('.news_actions_block').addClass('active');$('.news_list_table .news_name').addClass('active');$('.article2-pagination-wrap,.article-list-view-params,.s3-actions-panel-wrap,.s3-actions-panel,.tree-wrapper.article_redisegn,.news-pagination-wrap,.s3-sort,.s3-per-page-controller').addClass('disabled');$('.article2_actions_block').addClass('active');$('#article_container .post-name').addClass('active')}});$(document).on('click','.group-operation_name',function(){if($(this).hasClass('opened')){$(this).removeClass('opened');$(this).next().hide()}else{$(this).addClass('opened');$(this).next().show()}});$(document).on('click touchstart',function(e){if($(e.target).closest('.group-operation_name').length||$(e.target).closest('.article_group-operation-wrapper > ul').length){return}var $group_op_name=$('.group-operation_name');if($group_op_name.hasClass('opened')){$group_op_name.removeClass('opened');$('.article_group-operation-wrapper > ul').hide()}});$(document).on('click','.article_selector > label',function(){if(!$(this).hasClass('active')){$(this).addClass('active');$(this).parents('.article_selector').addClass('opened');$('.news_list_table .news_name .checked_article input').prop({'checked':true});$('#article_container .post-name .checked_article input').prop({'checked':true});$(this).parents('.mp_unload_content:first').find('.mp_container .col_checkbox .checked_mp input').prop({'checked':true});$(this).parents('.mp_list_content:first').find('.mp_container .col_checkbox .checked_mp input').prop({'checked':true})}else{$(this).removeClass('active');$(this).parents('.article_selector').removeClass('opened');$('.news_list_table .news_name .checked_article input').prop({'checked':false});$('#article_container .post-name .checked_article input').prop({'checked':false});$(this).parents('.mp_unload_content:first').find('.mp_container .col_checkbox .checked_mp input').prop({'checked':false});$(this).parents('.mp_list_content:first').find('.mp_container .col_checkbox .checked_mp input').prop({'checked':false})}});$(document).on('click','.news_list_table .news_name .checked_article input',function(){var checked_count=0;var $trs=$(this).parents('#news_container').find('tr');$trs.each(function(){if($(this).find('.checked_article input').is(':checked')){checked_count++}});if(checked_count==0){$(this).parents('.s3_news_wrapper').find('.article_group-operation-wrapper').removeClass('show')}else{$(this).parents('.s3_news_wrapper').find('.article_group-operation-wrapper').addClass('show')}if(checked_count==$trs.length){$(this).parents('.s3_news_wrapper').find('.article_selector > label').addClass('active')}else{$(this).parents('.s3_news_wrapper').find('.article_selector > label').removeClass('active')}});$(document).on('click','#article_container .post-name .checked_article input',function(){var checked_count=0;var $trs=$(this).parents('#article_container').find('tr');$trs.each(function(){if($(this).find('.checked_article input').is(':checked')){checked_count++}});if(checked_count==0){$(this).parents('.article2-items-wrapper:first').find('.article_group-operation-wrapper').removeClass('show')}else{$(this).parents('.article2-items-wrapper:first').find('.article_group-operation-wrapper').addClass('show')}if(checked_count==$trs.length){$(this).parents('.article2-items-wrapper:first').find('.article_selector > label').addClass('active')}else{$(this).parents('.article2-items-wrapper:first').find('.article_selector > label').removeClass('active')}});$(document).on('click','.mp_container .col_checkbox .checked_mp input',function(){var checked_count=0;var $trs=$(this).parents('.mp_container:first').find('tr');$trs.each(function(){if($(this).find('.checked_mp input').is(':checked')){checked_count++}});if(checked_count==0){$(this).parents('.mp_unload_content:first').find('.article_group-operation-wrapper').removeClass('show')}else{$(this).parents('.mp_unload_content:first').find('.article_group-operation-wrapper').addClass('show')}if(checked_count==$trs.length){$(this).parents('.mp_unload_content:first').find('.article_selector > label').addClass('active')}else{$(this).parents('.mp_unload_content:first').find('.article_selector > label').removeClass('active')}});$(document).on('click','.allcheck',function(){$(this).addClass('hide');$(this).next().addClass('active');$('.group-operation-wrapper').addClass('active')});$(document).on('click','.nocheck',function(){$(this).removeClass('active');$(this).prev().removeClass('hide');$('.group-operation-wrapper').removeClass('active')});$(document).on('click','.active-result',function(){$('.buttonBluepop').addClass('active')});$(document).on('click','#comment_container input.checkbox',function(){var show_controls=false;var checked_count=0;var $allcheck=$(this).parents().find('.news_checkbox_comments .allcheck');var $nocheck=$(this).parents().find('.news_checkbox_comments .nocheck');$(this).parents('#comment_container').find('tr').each(function(){if($(this).find('input.checkbox').is(':checked')){show_controls=true;checked_count++}});if(show_controls){$('.group-operation-wrapper').addClass('active')}else{$('.group-operation-wrapper').removeClass('active')}if($(this).parents('#comment_container').find('tr').length==checked_count){$allcheck.addClass('hide');$nocheck.addClass('active')}else{$allcheck.removeClass('hide');$nocheck.removeClass('active')}});$(document).on('click','.tables_comment_shop #comment_container input.checkbox',function(){let show_controls=false;let checked_count=0;const $allcheck=$(this).parents().find('.news_checkbox_comments .allcheck');const $nocheck=$(this).parents().find('.news_checkbox_comments .nocheck');$(this).parents('#comment_container').find('li').each(function(){if($(this).find('input.checkbox').is(':checked')){show_controls=true;checked_count++}});if(show_controls){$('.group-operation-wrapper').addClass('active')}else{$('.group-operation-wrapper').removeClass('active')}if($(this).parents('#comment_container').find('li').length==checked_count){$allcheck.addClass('hide');$nocheck.addClass('active')}else{$allcheck.removeClass('hide');$nocheck.removeClass('active')}})});!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){a.fn.jScrollPane=function(b){function c(b,c){function d(c){var f,h,j,k,l,o,p=!1,q=!1;if(N=c,void 0===O)l=b.scrollTop(),o=b.scrollLeft(),b.css({overflow:"hidden",padding:0}),P=b.innerWidth()+ra,Q=b.innerHeight(),b.width(P),O=a('<div class="jspPane" />').css("padding",qa).append(b.children()),R=a('<div class="jspContainer" />').css({width:P+"px",height:Q+"px"}).append(O).appendTo(b);else{if(b.css("width",""),p=N.stickToBottom&&A(),q=N.stickToRight&&B(),k=b.innerWidth()+ra!=P||b.outerHeight()!=Q,k&&(P=b.innerWidth()+ra,Q=b.innerHeight(),R.css({width:P+"px",height:Q+"px"})),!k&&sa==S&&O.outerHeight()==T)return void b.width(P);sa=S,O.css("width",""),b.width(P),R.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}O.css("overflow","auto"),S=c.contentWidth?c.contentWidth:O[0].scrollWidth,T=O[0].scrollHeight,O.css("overflow",""),U=S/P,V=T/Q,W=V>1,X=U>1,X||W?(b.addClass("jspScrollable"),f=N.maintainPosition&&($||ba),f&&(h=y(),j=z()),e(),g(),i(),f&&(w(q?S-P:h,!1),v(p?T-Q:j,!1)),F(),C(),L(),N.enableKeyboardNavigation&&H(),N.clickOnTrack&&m(),J(),N.hijackInternalLinks&&K()):(b.removeClass("jspScrollable"),O.css({top:0,left:0,width:R.width()-ra}),D(),G(),I(),n()),N.autoReinitialise&&!pa?pa=setInterval(function(){d(N)},N.autoReinitialiseDelay):!N.autoReinitialise&&pa&&clearInterval(pa),l&&b.scrollTop(0)&&v(l,!1),o&&b.scrollLeft(0)&&w(o,!1),b.trigger("jsp-initialised",[X||W])}function e(){W&&(R.append(a('<div class="jspVerticalBar" />').append(a('<div class="jspCap jspCapTop" />'),a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragTop" />'),a('<div class="jspDragBottom" />'))),a('<div class="jspCap jspCapBottom" />'))),ca=R.find(">.jspVerticalBar"),da=ca.find(">.jspTrack"),Y=da.find(">.jspDrag"),N.showArrows&&(ha=a('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",k(0,-1)).bind("click.jsp",E),ia=a('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",k(0,1)).bind("click.jsp",E),N.arrowScrollOnHover&&(ha.bind("mouseover.jsp",k(0,-1,ha)),ia.bind("mouseover.jsp",k(0,1,ia))),j(da,N.verticalArrowPositions,ha,ia)),fa=Q,R.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){fa-=a(this).outerHeight()}),Y.hover(function(){Y.addClass("jspHover")},function(){Y.removeClass("jspHover")}).bind("mousedown.jsp",function(b){a("html").bind("dragstart.jsp selectstart.jsp",E),Y.addClass("jspActive");var c=b.pageY-Y.position().top;return a("html").bind("mousemove.jsp",function(a){p(a.pageY-c,!1)}).bind("mouseup.jsp mouseleave.jsp",o),!1}),f())}function f(){da.height(fa+"px"),$=0,ea=N.verticalGutter+da.outerWidth(),O.width(P-ea-ra);try{0===ca.position().left&&O.css("margin-left",ea+"px")}catch(a){}}function g(){X&&(R.append(a('<div class="jspHorizontalBar" />').append(a('<div class="jspCap jspCapLeft" />'),a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragLeft" />'),a('<div class="jspDragRight" />'))),a('<div class="jspCap jspCapRight" />'))),ja=R.find(">.jspHorizontalBar"),ka=ja.find(">.jspTrack"),_=ka.find(">.jspDrag"),N.showArrows&&(na=a('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",k(-1,0)).bind("click.jsp",E),oa=a('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",k(1,0)).bind("click.jsp",E),N.arrowScrollOnHover&&(na.bind("mouseover.jsp",k(-1,0,na)),oa.bind("mouseover.jsp",k(1,0,oa))),j(ka,N.horizontalArrowPositions,na,oa)),_.hover(function(){_.addClass("jspHover")},function(){_.removeClass("jspHover")}).bind("mousedown.jsp",function(b){a("html").bind("dragstart.jsp selectstart.jsp",E),_.addClass("jspActive");var c=b.pageX-_.position().left;return a("html").bind("mousemove.jsp",function(a){r(a.pageX-c,!1)}).bind("mouseup.jsp mouseleave.jsp",o),!1}),la=R.innerWidth(),h())}function h(){R.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){la-=a(this).outerWidth()}),ka.width(la+"px"),ba=0}function i(){if(X&&W){var b=ka.outerHeight(),c=da.outerWidth();fa-=b,a(ja).find(">.jspCap:visible,>.jspArrow").each(function(){la+=a(this).outerWidth()}),la-=c,Q-=c,P-=b,ka.parent().append(a('<div class="jspCorner" />').css("width",b+"px")),f(),h()}X&&O.width(R.outerWidth()-ra+"px"),T=O.outerHeight(),V=T/Q,X&&(ma=Math.ceil(1/U*la),ma>N.horizontalDragMaxWidth?ma=N.horizontalDragMaxWidth:ma<N.horizontalDragMinWidth&&(ma=N.horizontalDragMinWidth),_.width(ma+"px"),aa=la-ma,s(ba)),W&&(ga=Math.ceil(1/V*fa),ga>N.verticalDragMaxHeight?ga=N.verticalDragMaxHeight:ga<N.verticalDragMinHeight&&(ga=N.verticalDragMinHeight),Y.height(ga+"px"),Z=fa-ga,q($))}function j(a,b,c,d){var e,f="before",g="after";"os"==b&&(b=/Mac/.test(navigator.platform)?"after":"split"),b==f?g=b:b==g&&(f=b,e=c,c=d,d=e),a[f](c)[g](d)}function k(a,b,c){return function(){return l(a,b,this,c),this.blur(),!1}}function l(b,c,d,e){d=a(d).addClass("jspActive");var f,g,h=!0,i=function(){0!==b&&ta.scrollByX(b*N.arrowButtonSpeed),0!==c&&ta.scrollByY(c*N.arrowButtonSpeed),g=setTimeout(i,h?N.initialDelay:N.arrowRepeatFreq),h=!1};i(),f=e?"mouseout.jsp":"mouseup.jsp",e=e||a("html"),e.bind(f,function(){d.removeClass("jspActive"),g&&clearTimeout(g),g=null,e.unbind(f)})}function m(){n(),W&&da.bind("mousedown.jsp",function(b){if(void 0===b.originalTarget||b.originalTarget==b.currentTarget){var c,d=a(this),e=d.offset(),f=b.pageY-e.top-$,g=!0,h=function(){var a=d.offset(),e=b.pageY-a.top-ga/2,j=Q*N.scrollPagePercent,k=Z*j/(T-Q);if(0>f)$-k>e?ta.scrollByY(-j):p(e);else{if(!(f>0))return void i();e>$+k?ta.scrollByY(j):p(e)}c=setTimeout(h,g?N.initialDelay:N.trackClickRepeatFreq),g=!1},i=function(){c&&clearTimeout(c),c=null,a(document).unbind("mouseup.jsp",i)};return h(),a(document).bind("mouseup.jsp",i),!1}}),X&&ka.bind("mousedown.jsp",function(b){if(void 0===b.originalTarget||b.originalTarget==b.currentTarget){var c,d=a(this),e=d.offset(),f=b.pageX-e.left-ba,g=!0,h=function(){var a=d.offset(),e=b.pageX-a.left-ma/2,j=P*N.scrollPagePercent,k=aa*j/(S-P);if(0>f)ba-k>e?ta.scrollByX(-j):r(e);else{if(!(f>0))return void i();e>ba+k?ta.scrollByX(j):r(e)}c=setTimeout(h,g?N.initialDelay:N.trackClickRepeatFreq),g=!1},i=function(){c&&clearTimeout(c),c=null,a(document).unbind("mouseup.jsp",i)};return h(),a(document).bind("mouseup.jsp",i),!1}})}function n(){ka&&ka.unbind("mousedown.jsp"),da&&da.unbind("mousedown.jsp")}function o(){a("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),Y&&Y.removeClass("jspActive"),_&&_.removeClass("jspActive")}function p(a,b){W&&(0>a?a=0:a>Z&&(a=Z),void 0===b&&(b=N.animateScroll),b?ta.animate(Y,"top",a,q):(Y.css("top",a),q(a)))}function q(a){void 0===a&&(a=Y.position().top),R.scrollTop(0),$=a||0;var c=0===$,d=$==Z,e=a/Z,f=-e*(T-Q);(ua!=c||wa!=d)&&(ua=c,wa=d,b.trigger("jsp-arrow-change",[ua,wa,va,xa])),t(c,d),O.css("top",f),b.trigger("jsp-scroll-y",[-f,c,d]).trigger("scroll")}function r(a,b){X&&(0>a?a=0:a>aa&&(a=aa),void 0===b&&(b=N.animateScroll),b?ta.animate(_,"left",a,s):(_.css("left",a),s(a)))}function s(a){void 0===a&&(a=_.position().left),R.scrollTop(0),ba=a||0;var c=0===ba,d=ba==aa,e=a/aa,f=-e*(S-P);(va!=c||xa!=d)&&(va=c,xa=d,b.trigger("jsp-arrow-change",[ua,wa,va,xa])),u(c,d),O.css("left",f),b.trigger("jsp-scroll-x",[-f,c,d]).trigger("scroll")}function t(a,b){N.showArrows&&(ha[a?"addClass":"removeClass"]("jspDisabled"),ia[b?"addClass":"removeClass"]("jspDisabled"))}function u(a,b){N.showArrows&&(na[a?"addClass":"removeClass"]("jspDisabled"),oa[b?"addClass":"removeClass"]("jspDisabled"))}function v(a,b){var c=a/(T-Q);p(c*Z,b)}function w(a,b){var c=a/(S-P);r(c*aa,b)}function x(b,c,d){var e,f,g,h,i,j,k,l,m,n=0,o=0;try{e=a(b)}catch(p){return}for(f=e.outerHeight(),g=e.outerWidth(),R.scrollTop(0),R.scrollLeft(0);!e.is(".jspPane");)if(n+=e.position().top,o+=e.position().left,e=e.offsetParent(),/^body|html$/i.test(e[0].nodeName))return;h=z(),j=h+Q,h>n||c?l=n-N.horizontalGutter:n+f>j&&(l=n-Q+f+N.horizontalGutter),isNaN(l)||v(l,d),i=y(),k=i+P,i>o||c?m=o-N.horizontalGutter:o+g>k&&(m=o-P+g+N.horizontalGutter),isNaN(m)||w(m,d)}function y(){return-O.position().left}function z(){return-O.position().top}function A(){var a=T-Q;return a>20&&a-z()<10}function B(){var a=S-P;return a>20&&a-y()<10}function C(){R.unbind(za).bind(za,function(a,b,c,d){ba||(ba=0),$||($=0);var e=ba,f=$,g=a.deltaFactor||N.mouseWheelSpeed;return ta.scrollBy(c*g,-d*g,!1),e==ba&&f==$})}function D(){R.unbind(za)}function E(){return!1}function F(){O.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(a){x(a.target,!1)})}function G(){O.find(":input,a").unbind("focus.jsp")}function H(){function c(){var a=ba,b=$;switch(d){case 40:ta.scrollByY(N.keyboardSpeed,!1);break;case 38:ta.scrollByY(-N.keyboardSpeed,!1);break;case 34:case 32:ta.scrollByY(Q*N.scrollPagePercent,!1);break;case 33:ta.scrollByY(-Q*N.scrollPagePercent,!1);break;case 39:ta.scrollByX(N.keyboardSpeed,!1);break;case 37:ta.scrollByX(-N.keyboardSpeed,!1)}return e=a!=ba||b!=$}var d,e,f=[];X&&f.push(ja[0]),W&&f.push(ca[0]),O.bind("focus.jsp",function(){b.focus()}),b.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(b){if(b.target===this||f.length&&a(b.target).closest(f).length){var g=ba,h=$;switch(b.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:d=b.keyCode,c();break;case 35:v(T-Q),d=null;break;case 36:v(0),d=null}return e=b.keyCode==d&&g!=ba||h!=$,!e}}).bind("keypress.jsp",function(a){return a.keyCode==d&&c(),!e}),N.hideFocus?(b.css("outline","none"),"hideFocus"in R[0]&&b.attr("hideFocus",!0)):(b.css("outline",""),"hideFocus"in R[0]&&b.attr("hideFocus",!1))}function I(){b.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp"),O.unbind(".jsp")}function J(){if(location.hash&&location.hash.length>1){var b,c,d=escape(location.hash.substr(1));try{b=a("#"+d+', a[name="'+d+'"]')}catch(e){return}b.length&&O.find(d)&&(0===R.scrollTop()?c=setInterval(function(){R.scrollTop()>0&&(x(b,!0),a(document).scrollTop(R.position().top),clearInterval(c))},50):(x(b,!0),a(document).scrollTop(R.position().top)))}}function K(){a(document.body).data("jspHijack")||(a(document.body).data("jspHijack",!0),a(document.body).delegate("a[href*=#]","click",function(b){var c,d,e,f,g,h,i=this.href.substr(0,this.href.indexOf("#")),j=location.href;if(-1!==location.href.indexOf("#")&&(j=location.href.substr(0,location.href.indexOf("#"))),i===j){c=escape(this.href.substr(this.href.indexOf("#")+1));try{d=a("#"+c+', a[name="'+c+'"]')}catch(k){return}d.length&&(e=d.closest(".jspScrollable"),f=e.data("jsp"),f.scrollToElement(d,!0),e[0].scrollIntoView&&(g=a(window).scrollTop(),h=d.offset().top,(g>h||h>g+a(window).height())&&e[0].scrollIntoView()),b.preventDefault())}}))}function L(){var a,b,c,d,e,f=!1;R.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(g){var h=g.originalEvent.touches[0];a=y(),b=z(),c=h.pageX,d=h.pageY,e=!1,f=!0}).bind("touchmove.jsp",function(g){if(f){var h=g.originalEvent.touches[0],i=ba,j=$;return ta.scrollTo(a+c-h.pageX,b+d-h.pageY),e=e||Math.abs(c-h.pageX)>5||Math.abs(d-h.pageY)>5,i==ba&&j==$}}).bind("touchend.jsp",function(a){f=!1}).bind("click.jsp-touchclick",function(a){return e?(e=!1,!1):void 0})}function M(){var a=z(),c=y();b.removeClass("jspScrollable").unbind(".jsp"),O.unbind(".jsp"),b.replaceWith(ya.append(O.children())),ya.scrollTop(a),ya.scrollLeft(c),pa&&clearInterval(pa)}var N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta=this,ua=!0,va=!0,wa=!1,xa=!1,ya=b.clone(!1,!1).empty(),za=a.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";"border-box"===b.css("box-sizing")?(qa=0,ra=0):(qa=b.css("paddingTop")+" "+b.css("paddingRight")+" "+b.css("paddingBottom")+" "+b.css("paddingLeft"),ra=(parseInt(b.css("paddingLeft"),10)||0)+(parseInt(b.css("paddingRight"),10)||0)),a.extend(ta,{reinitialise:function(b){b=a.extend({},N,b),d(b)},scrollToElement:function(a,b,c){x(a,b,c)},scrollTo:function(a,b,c){w(a,c),v(b,c)},scrollToX:function(a,b){w(a,b)},scrollToY:function(a,b){v(a,b)},scrollToPercentX:function(a,b){w(a*(S-P),b)},scrollToPercentY:function(a,b){v(a*(T-Q),b)},scrollBy:function(a,b,c){ta.scrollByX(a,c),ta.scrollByY(b,c)},scrollByX:function(a,b){var c=y()+Math[0>a?"floor":"ceil"](a),d=c/(S-P);r(d*aa,b)},scrollByY:function(a,b){var c=z()+Math[0>a?"floor":"ceil"](a),d=c/(T-Q);p(d*Z,b)},positionDragX:function(a,b){r(a,b)},positionDragY:function(a,b){p(a,b)},animate:function(a,b,c,d){var e={};e[b]=c,a.animate(e,{duration:N.animateDuration,easing:N.animateEase,queue:!1,step:d})},getContentPositionX:function(){return y()},getContentPositionY:function(){return z()},getContentWidth:function(){return S},getContentHeight:function(){return T},getPercentScrolledX:function(){return y()/(S-P)},getPercentScrolledY:function(){return z()/(T-Q)},getIsScrollableH:function(){return X},getIsScrollableV:function(){return W},getContentPane:function(){return O},scrollToBottom:function(a){p(Z,a)},hijackInternalLinks:a.noop,destroy:function(){M()}}),d(c)}return b=a.extend({},a.fn.jScrollPane.defaults,b),a.each(["arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){b[this]=b[this]||b.speed}),this.each(function(){var d=a(this),e=d.data("jsp");e?e.reinitialise(b):(a("script",d).filter('[type="text/javascript"],:not([type])').remove(),e=new c(d,b),d.data("jsp",e))})},a.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:void 0,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:3,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}});!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e:e(jQuery,window,document)}(function(e){!function(t){var o="function"==typeof define&&define.amd,a="undefined"!=typeof module&&module.exports,n="https:"==document.location.protocol?"https:":"http:",i="cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js";o||(a?require("jquery-mousewheel")(e):e.event.special.mousewheel||e("head").append(decodeURI("%3Cscript src="+n+"//"+i+"%3E%3C/script%3E"))),t()}(function(){var t,o="mCustomScrollbar",a="mCS",n=".mCustomScrollbar",i={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,documentTouchScroll:!0,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:"auto",autoUpdateTimeout:60},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},r=0,l={},s=window.attachEvent&&!window.addEventListener?1:0,c=!1,d=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],u={init:function(t){var t=e.extend(!0,{},i,t),o=f.call(this);if(t.live){var s=t.liveSelector||this.selector||n,c=e(s);if("off"===t.live)return void m(s);l[s]=setTimeout(function(){c.mCustomScrollbar(t),"once"===t.live&&c.length&&m(s)},500)}else m(s);return t.setWidth=t.set_width?t.set_width:t.setWidth,t.setHeight=t.set_height?t.set_height:t.setHeight,t.axis=t.horizontalScroll?"x":p(t.axis),t.scrollInertia=t.scrollInertia>0&&t.scrollInertia<17?17:t.scrollInertia,"object"!=typeof t.mouseWheel&&1==t.mouseWheel&&(t.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),t.mouseWheel.scrollAmount=t.mouseWheelPixels?t.mouseWheelPixels:t.mouseWheel.scrollAmount,t.mouseWheel.normalizeDelta=t.advanced.normalizeMouseWheelDelta?t.advanced.normalizeMouseWheelDelta:t.mouseWheel.normalizeDelta,t.scrollButtons.scrollType=g(t.scrollButtons.scrollType),h(t),e(o).each(function(){var o=e(this);if(!o.data(a)){o.data(a,{idx:++r,opt:t,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:o.css("direction"),cbOffsets:null,trigger:null,poll:{size:{o:0,n:0},img:{o:0,n:0},change:{o:0,n:0}}});var n=o.data(a),i=n.opt,l=o.data("mcs-axis"),s=o.data("mcs-scrollbar-position"),c=o.data("mcs-theme");l&&(i.axis=l),s&&(i.scrollbarPosition=s),c&&(i.theme=c,h(i)),v.call(this),n&&i.callbacks.onCreate&&"function"==typeof i.callbacks.onCreate&&i.callbacks.onCreate.call(this),e("#mCSB_"+n.idx+"_container img:not(."+d[2]+")").addClass(d[2]),u.update.call(null,o)}})},update:function(t,o){var n=t||f.call(this);return e(n).each(function(){var t=e(this);if(t.data(a)){var n=t.data(a),i=n.opt,r=e("#mCSB_"+n.idx+"_container"),l=e("#mCSB_"+n.idx),s=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")];if(!r.length)return;n.tweenRunning&&Q(t),o&&n&&i.callbacks.onBeforeUpdate&&"function"==typeof i.callbacks.onBeforeUpdate&&i.callbacks.onBeforeUpdate.call(this),t.hasClass(d[3])&&t.removeClass(d[3]),t.hasClass(d[4])&&t.removeClass(d[4]),l.css("max-height","none"),l.height()!==t.height()&&l.css("max-height",t.height()),_.call(this),"y"===i.axis||i.advanced.autoExpandHorizontalScroll||r.css("width",x(r)),n.overflowed=y.call(this),M.call(this),i.autoDraggerLength&&S.call(this),b.call(this),T.call(this);var c=[Math.abs(r[0].offsetTop),Math.abs(r[0].offsetLeft)];"x"!==i.axis&&(n.overflowed[0]?s[0].height()>s[0].parent().height()?B.call(this):(G(t,c[0].toString(),{dir:"y",dur:0,overwrite:"none"}),n.contentReset.y=null):(B.call(this),"y"===i.axis?k.call(this):"yx"===i.axis&&n.overflowed[1]&&G(t,c[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==i.axis&&(n.overflowed[1]?s[1].width()>s[1].parent().width()?B.call(this):(G(t,c[1].toString(),{dir:"x",dur:0,overwrite:"none"}),n.contentReset.x=null):(B.call(this),"x"===i.axis?k.call(this):"yx"===i.axis&&n.overflowed[0]&&G(t,c[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),o&&n&&(2===o&&i.callbacks.onImageLoad&&"function"==typeof i.callbacks.onImageLoad?i.callbacks.onImageLoad.call(this):3===o&&i.callbacks.onSelectorChange&&"function"==typeof i.callbacks.onSelectorChange?i.callbacks.onSelectorChange.call(this):i.callbacks.onUpdate&&"function"==typeof i.callbacks.onUpdate&&i.callbacks.onUpdate.call(this)),N.call(this)}})},scrollTo:function(t,o){if("undefined"!=typeof t&&null!=t){var n=f.call(this);return e(n).each(function(){var n=e(this);if(n.data(a)){var i=n.data(a),r=i.opt,l={trigger:"external",scrollInertia:r.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},s=e.extend(!0,{},l,o),c=Y.call(this,t),d=s.scrollInertia>0&&s.scrollInertia<17?17:s.scrollInertia;c[0]=X.call(this,c[0],"y"),c[1]=X.call(this,c[1],"x"),s.moveDragger&&(c[0]*=i.scrollRatio.y,c[1]*=i.scrollRatio.x),s.dur=ne()?0:d,setTimeout(function(){null!==c[0]&&"undefined"!=typeof c[0]&&"x"!==r.axis&&i.overflowed[0]&&(s.dir="y",s.overwrite="all",G(n,c[0].toString(),s)),null!==c[1]&&"undefined"!=typeof c[1]&&"y"!==r.axis&&i.overflowed[1]&&(s.dir="x",s.overwrite="none",G(n,c[1].toString(),s))},s.timeout)}})}},stop:function(){var t=f.call(this);return e(t).each(function(){var t=e(this);t.data(a)&&Q(t)})},disable:function(t){var o=f.call(this);return e(o).each(function(){var o=e(this);if(o.data(a)){o.data(a);N.call(this,"remove"),k.call(this),t&&B.call(this),M.call(this,!0),o.addClass(d[3])}})},destroy:function(){var t=f.call(this);return e(t).each(function(){var n=e(this);if(n.data(a)){var i=n.data(a),r=i.opt,l=e("#mCSB_"+i.idx),s=e("#mCSB_"+i.idx+"_container"),c=e(".mCSB_"+i.idx+"_scrollbar");r.live&&m(r.liveSelector||e(t).selector),N.call(this,"remove"),k.call(this),B.call(this),n.removeData(a),$(this,"mcs"),c.remove(),s.find("img."+d[2]).removeClass(d[2]),l.replaceWith(s.contents()),n.removeClass(o+" _"+a+"_"+i.idx+" "+d[6]+" "+d[7]+" "+d[5]+" "+d[3]).addClass(d[4])}})}},f=function(){return"object"!=typeof e(this)||e(this).length<1?n:this},h=function(t){var o=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],a=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],n=["minimal","minimal-dark"],i=["minimal","minimal-dark"],r=["minimal","minimal-dark"];t.autoDraggerLength=e.inArray(t.theme,o)>-1?!1:t.autoDraggerLength,t.autoExpandScrollbar=e.inArray(t.theme,a)>-1?!1:t.autoExpandScrollbar,t.scrollButtons.enable=e.inArray(t.theme,n)>-1?!1:t.scrollButtons.enable,t.autoHideScrollbar=e.inArray(t.theme,i)>-1?!0:t.autoHideScrollbar,t.scrollbarPosition=e.inArray(t.theme,r)>-1?"outside":t.scrollbarPosition},m=function(e){l[e]&&(clearTimeout(l[e]),$(l,e))},p=function(e){return"yx"===e||"xy"===e||"auto"===e?"yx":"x"===e||"horizontal"===e?"x":"y"},g=function(e){return"stepped"===e||"pixels"===e||"step"===e||"click"===e?"stepped":"stepless"},v=function(){var t=e(this),n=t.data(a),i=n.opt,r=i.autoExpandScrollbar?" "+d[1]+"_expand":"",l=["<div id='mCSB_"+n.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_vertical"+r+"'><div class='"+d[12]+"'><div id='mCSB_"+n.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+n.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_horizontal"+r+"'><div class='"+d[12]+"'><div id='mCSB_"+n.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],s="yx"===i.axis?"mCSB_vertical_horizontal":"x"===i.axis?"mCSB_horizontal":"mCSB_vertical",c="yx"===i.axis?l[0]+l[1]:"x"===i.axis?l[1]:l[0],u="yx"===i.axis?"<div id='mCSB_"+n.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",f=i.autoHideScrollbar?" "+d[6]:"",h="x"!==i.axis&&"rtl"===n.langDir?" "+d[7]:"";i.setWidth&&t.css("width",i.setWidth),i.setHeight&&t.css("height",i.setHeight),i.setLeft="y"!==i.axis&&"rtl"===n.langDir?"989999px":i.setLeft,t.addClass(o+" _"+a+"_"+n.idx+f+h).wrapInner("<div id='mCSB_"+n.idx+"' class='mCustomScrollBox mCS-"+i.theme+" "+s+"'><div id='mCSB_"+n.idx+"_container' class='mCSB_container' style='position:relative; top:"+i.setTop+"; left:"+i.setLeft+";' dir='"+n.langDir+"' /></div>");var m=e("#mCSB_"+n.idx),p=e("#mCSB_"+n.idx+"_container");"y"===i.axis||i.advanced.autoExpandHorizontalScroll||p.css("width",x(p)),"outside"===i.scrollbarPosition?("static"===t.css("position")&&t.css("position","relative"),t.css("overflow","visible"),m.addClass("mCSB_outside").after(c)):(m.addClass("mCSB_inside").append(c),p.wrap(u)),w.call(this);var g=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")];g[0].css("min-height",g[0].height()),g[1].css("min-width",g[1].width())},x=function(t){var o=[t[0].scrollWidth,Math.max.apply(Math,t.children().map(function(){return e(this).outerWidth(!0)}).get())],a=t.parent().width();return o[0]>a?o[0]:o[1]>a?o[1]:"100%"},_=function(){var t=e(this),o=t.data(a),n=o.opt,i=e("#mCSB_"+o.idx+"_container");if(n.advanced.autoExpandHorizontalScroll&&"y"!==n.axis){i.css({width:"auto","min-width":0,"overflow-x":"scroll"});var r=Math.ceil(i[0].scrollWidth);3===n.advanced.autoExpandHorizontalScroll||2!==n.advanced.autoExpandHorizontalScroll&&r>i.parent().width()?i.css({width:r,"min-width":"100%","overflow-x":"inherit"}):i.css({"overflow-x":"inherit",position:"absolute"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(i[0].getBoundingClientRect().right+.4)-Math.floor(i[0].getBoundingClientRect().left),"min-width":"100%",position:"relative"}).unwrap()}},w=function(){var t=e(this),o=t.data(a),n=o.opt,i=e(".mCSB_"+o.idx+"_scrollbar:first"),r=oe(n.scrollButtons.tabindex)?"tabindex='"+n.scrollButtons.tabindex+"'":"",l=["<a href='#' class='"+d[13]+"' "+r+" />","<a href='#' class='"+d[14]+"' "+r+" />","<a href='#' class='"+d[15]+"' "+r+" />","<a href='#' class='"+d[16]+"' "+r+" />"],s=["x"===n.axis?l[2]:l[0],"x"===n.axis?l[3]:l[1],l[2],l[3]];n.scrollButtons.enable&&i.prepend(s[0]).append(s[1]).next(".mCSB_scrollTools").prepend(s[2]).append(s[3])},S=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],l=[n.height()/i.outerHeight(!1),n.width()/i.outerWidth(!1)],c=[parseInt(r[0].css("min-height")),Math.round(l[0]*r[0].parent().height()),parseInt(r[1].css("min-width")),Math.round(l[1]*r[1].parent().width())],d=s&&c[1]<c[0]?c[0]:c[1],u=s&&c[3]<c[2]?c[2]:c[3];r[0].css({height:d,"max-height":r[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":c[0]+"px"}),r[1].css({width:u,"max-width":r[1].parent().width()-10})},b=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],l=[i.outerHeight(!1)-n.height(),i.outerWidth(!1)-n.width()],s=[l[0]/(r[0].parent().height()-r[0].height()),l[1]/(r[1].parent().width()-r[1].width())];o.scrollRatio={y:s[0],x:s[1]}},C=function(e,t,o){var a=o?d[0]+"_expanded":"",n=e.closest(".mCSB_scrollTools");"active"===t?(e.toggleClass(d[0]+" "+a),n.toggleClass(d[1]),e[0]._draggable=e[0]._draggable?0:1):e[0]._draggable||("hide"===t?(e.removeClass(d[0]),n.removeClass(d[1])):(e.addClass(d[0]),n.addClass(d[1])))},y=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=null==o.overflowed?i.height():i.outerHeight(!1),l=null==o.overflowed?i.width():i.outerWidth(!1),s=i[0].scrollHeight,c=i[0].scrollWidth;return s>r&&(r=s),c>l&&(l=c),[r>n.height(),l>n.width()]},B=function(){var t=e(this),o=t.data(a),n=o.opt,i=e("#mCSB_"+o.idx),r=e("#mCSB_"+o.idx+"_container"),l=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")];if(Q(t),("x"!==n.axis&&!o.overflowed[0]||"y"===n.axis&&o.overflowed[0])&&(l[0].add(r).css("top",0),G(t,"_resetY")),"y"!==n.axis&&!o.overflowed[1]||"x"===n.axis&&o.overflowed[1]){var s=dx=0;"rtl"===o.langDir&&(s=i.width()-r.outerWidth(!1),dx=Math.abs(s/o.scrollRatio.x)),r.css("left",s),l[1].css("left",dx),G(t,"_resetX")}},T=function(){function t(){r=setTimeout(function(){e.event.special.mousewheel?(clearTimeout(r),W.call(o[0])):t()},100)}var o=e(this),n=o.data(a),i=n.opt;if(!n.bindEvents){if(I.call(this),i.contentTouchScroll&&D.call(this),E.call(this),i.mouseWheel.enable){var r;t()}P.call(this),U.call(this),i.advanced.autoScrollOnFocus&&H.call(this),i.scrollButtons.enable&&F.call(this),i.keyboard.enable&&q.call(this),n.bindEvents=!0}},k=function(){var t=e(this),o=t.data(a),n=o.opt,i=a+"_"+o.idx,r=".mCSB_"+o.idx+"_scrollbar",l=e("#mCSB_"+o.idx+",#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,"+r+" ."+d[12]+",#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal,"+r+">a"),s=e("#mCSB_"+o.idx+"_container");n.advanced.releaseDraggableSelectors&&l.add(e(n.advanced.releaseDraggableSelectors)),n.advanced.extraDraggableSelectors&&l.add(e(n.advanced.extraDraggableSelectors)),o.bindEvents&&(e(document).add(e(!A()||top.document)).unbind("."+i),l.each(function(){e(this).unbind("."+i)}),clearTimeout(t[0]._focusTimeout),$(t[0],"_focusTimeout"),clearTimeout(o.sequential.step),$(o.sequential,"step"),clearTimeout(s[0].onCompleteTimeout),$(s[0],"onCompleteTimeout"),o.bindEvents=!1)},M=function(t){var o=e(this),n=o.data(a),i=n.opt,r=e("#mCSB_"+n.idx+"_container_wrapper"),l=r.length?r:e("#mCSB_"+n.idx+"_container"),s=[e("#mCSB_"+n.idx+"_scrollbar_vertical"),e("#mCSB_"+n.idx+"_scrollbar_horizontal")],c=[s[0].find(".mCSB_dragger"),s[1].find(".mCSB_dragger")];"x"!==i.axis&&(n.overflowed[0]&&!t?(s[0].add(c[0]).add(s[0].children("a")).css("display","block"),l.removeClass(d[8]+" "+d[10])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[0].css("display","none"),l.removeClass(d[10])):(s[0].css("display","none"),l.addClass(d[10])),l.addClass(d[8]))),"y"!==i.axis&&(n.overflowed[1]&&!t?(s[1].add(c[1]).add(s[1].children("a")).css("display","block"),l.removeClass(d[9]+" "+d[11])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[1].css("display","none"),l.removeClass(d[11])):(s[1].css("display","none"),l.addClass(d[11])),l.addClass(d[9]))),n.overflowed[0]||n.overflowed[1]?o.removeClass(d[5]):o.addClass(d[5])},O=function(t){var o=t.type,a=t.target.ownerDocument!==document&&null!==frameElement?[e(frameElement).offset().top,e(frameElement).offset().left]:null,n=A()&&t.target.ownerDocument!==top.document&&null!==frameElement?[e(t.view.frameElement).offset().top,e(t.view.frameElement).offset().left]:[0,0];switch(o){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return a?[t.originalEvent.pageY-a[0]+n[0],t.originalEvent.pageX-a[1]+n[1],!1]:[t.originalEvent.pageY,t.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var i=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],r=t.originalEvent.touches.length||t.originalEvent.changedTouches.length;return t.target.ownerDocument!==document?[i.screenY,i.screenX,r>1]:[i.pageY,i.pageX,r>1];default:return a?[t.pageY-a[0]+n[0],t.pageX-a[1]+n[1],!1]:[t.pageY,t.pageX,!1]}},I=function(){function t(e,t,a,n){if(h[0].idleTimer=d.scrollInertia<233?250:0,o.attr("id")===f[1])var i="x",s=(o[0].offsetLeft-t+n)*l.scrollRatio.x;else var i="y",s=(o[0].offsetTop-e+a)*l.scrollRatio.y;G(r,s.toString(),{dir:i,drag:!0})}var o,n,i,r=e(this),l=r.data(a),d=l.opt,u=a+"_"+l.idx,f=["mCSB_"+l.idx+"_dragger_vertical","mCSB_"+l.idx+"_dragger_horizontal"],h=e("#mCSB_"+l.idx+"_container"),m=e("#"+f[0]+",#"+f[1]),p=d.advanced.releaseDraggableSelectors?m.add(e(d.advanced.releaseDraggableSelectors)):m,g=d.advanced.extraDraggableSelectors?e(!A()||top.document).add(e(d.advanced.extraDraggableSelectors)):e(!A()||top.document);m.bind("contextmenu."+u,function(e){e.preventDefault()}).bind("mousedown."+u+" touchstart."+u+" pointerdown."+u+" MSPointerDown."+u,function(t){if(t.stopImmediatePropagation(),t.preventDefault(),ee(t)){c=!0,s&&(document.onselectstart=function(){return!1}),L.call(h,!1),Q(r),o=e(this);var a=o.offset(),l=O(t)[0]-a.top,u=O(t)[1]-a.left,f=o.height()+a.top,m=o.width()+a.left;f>l&&l>0&&m>u&&u>0&&(n=l,i=u),C(o,"active",d.autoExpandScrollbar)}}).bind("touchmove."+u,function(e){e.stopImmediatePropagation(),e.preventDefault();var a=o.offset(),r=O(e)[0]-a.top,l=O(e)[1]-a.left;t(n,i,r,l)}),e(document).add(g).bind("mousemove."+u+" pointermove."+u+" MSPointerMove."+u,function(e){if(o){var a=o.offset(),r=O(e)[0]-a.top,l=O(e)[1]-a.left;if(n===r&&i===l)return;t(n,i,r,l)}}).add(p).bind("mouseup."+u+" touchend."+u+" pointerup."+u+" MSPointerUp."+u,function(){o&&(C(o,"active",d.autoExpandScrollbar),o=null),c=!1,s&&(document.onselectstart=null),L.call(h,!0)})},D=function(){function o(e){if(!te(e)||c||O(e)[2])return void(t=0);t=1,b=0,C=0,d=1,y.removeClass("mCS_touch_action");var o=I.offset();u=O(e)[0]-o.top,f=O(e)[1]-o.left,z=[O(e)[0],O(e)[1]]}function n(e){if(te(e)&&!c&&!O(e)[2]&&(T.documentTouchScroll||e.preventDefault(),e.stopImmediatePropagation(),(!C||b)&&d)){g=K();var t=M.offset(),o=O(e)[0]-t.top,a=O(e)[1]-t.left,n="mcsLinearOut";if(E.push(o),W.push(a),z[2]=Math.abs(O(e)[0]-z[0]),z[3]=Math.abs(O(e)[1]-z[1]),B.overflowed[0])var i=D[0].parent().height()-D[0].height(),r=u-o>0&&o-u>-(i*B.scrollRatio.y)&&(2*z[3]<z[2]||"yx"===T.axis);if(B.overflowed[1])var l=D[1].parent().width()-D[1].width(),h=f-a>0&&a-f>-(l*B.scrollRatio.x)&&(2*z[2]<z[3]||"yx"===T.axis);r||h?(U||e.preventDefault(),b=1):(C=1,y.addClass("mCS_touch_action")),U&&e.preventDefault(),w="yx"===T.axis?[u-o,f-a]:"x"===T.axis?[null,f-a]:[u-o,null],I[0].idleTimer=250,B.overflowed[0]&&s(w[0],R,n,"y","all",!0),B.overflowed[1]&&s(w[1],R,n,"x",L,!0)}}function i(e){if(!te(e)||c||O(e)[2])return void(t=0);t=1,e.stopImmediatePropagation(),Q(y),p=K();var o=M.offset();h=O(e)[0]-o.top,m=O(e)[1]-o.left,E=[],W=[]}function r(e){if(te(e)&&!c&&!O(e)[2]){d=0,e.stopImmediatePropagation(),b=0,C=0,v=K();var t=M.offset(),o=O(e)[0]-t.top,a=O(e)[1]-t.left;if(!(v-g>30)){_=1e3/(v-p);var n="mcsEaseOut",i=2.5>_,r=i?[E[E.length-2],W[W.length-2]]:[0,0];x=i?[o-r[0],a-r[1]]:[o-h,a-m];var u=[Math.abs(x[0]),Math.abs(x[1])];_=i?[Math.abs(x[0]/4),Math.abs(x[1]/4)]:[_,_];var f=[Math.abs(I[0].offsetTop)-x[0]*l(u[0]/_[0],_[0]),Math.abs(I[0].offsetLeft)-x[1]*l(u[1]/_[1],_[1])];w="yx"===T.axis?[f[0],f[1]]:"x"===T.axis?[null,f[1]]:[f[0],null],S=[4*u[0]+T.scrollInertia,4*u[1]+T.scrollInertia];var y=parseInt(T.contentTouchScroll)||0;w[0]=u[0]>y?w[0]:0,w[1]=u[1]>y?w[1]:0,B.overflowed[0]&&s(w[0],S[0],n,"y",L,!1),B.overflowed[1]&&s(w[1],S[1],n,"x",L,!1)}}}function l(e,t){var o=[1.5*t,2*t,t/1.5,t/2];return e>90?t>4?o[0]:o[3]:e>60?t>3?o[3]:o[2]:e>30?t>8?o[1]:t>6?o[0]:t>4?t:o[2]:t>8?t:o[3]}function s(e,t,o,a,n,i){e&&G(y,e.toString(),{dur:t,scrollEasing:o,dir:a,overwrite:n,drag:i})}var d,u,f,h,m,p,g,v,x,_,w,S,b,C,y=e(this),B=y.data(a),T=B.opt,k=a+"_"+B.idx,M=e("#mCSB_"+B.idx),I=e("#mCSB_"+B.idx+"_container"),D=[e("#mCSB_"+B.idx+"_dragger_vertical"),e("#mCSB_"+B.idx+"_dragger_horizontal")],E=[],W=[],R=0,L="yx"===T.axis?"none":"all",z=[],P=I.find("iframe"),H=["touchstart."+k+" pointerdown."+k+" MSPointerDown."+k,"touchmove."+k+" pointermove."+k+" MSPointerMove."+k,"touchend."+k+" pointerup."+k+" MSPointerUp."+k],U=void 0!==document.body.style.touchAction&&""!==document.body.style.touchAction;I.bind(H[0],function(e){o(e)}).bind(H[1],function(e){n(e)}),M.bind(H[0],function(e){i(e)}).bind(H[2],function(e){r(e)}),P.length&&P.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind(H[0],function(e){o(e),i(e)}).bind(H[1],function(e){n(e)}).bind(H[2],function(e){r(e)})})})},E=function(){function o(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:0}function n(e,t,o){d.type=o&&i?"stepped":"stepless",d.scrollAmount=10,j(r,e,t,"mcsLinearOut",o?60:null)}var i,r=e(this),l=r.data(a),s=l.opt,d=l.sequential,u=a+"_"+l.idx,f=e("#mCSB_"+l.idx+"_container"),h=f.parent();f.bind("mousedown."+u,function(){t||i||(i=1,c=!0)}).add(document).bind("mousemove."+u,function(e){if(!t&&i&&o()){var a=f.offset(),r=O(e)[0]-a.top+f[0].offsetTop,c=O(e)[1]-a.left+f[0].offsetLeft;r>0&&r<h.height()&&c>0&&c<h.width()?d.step&&n("off",null,"stepped"):("x"!==s.axis&&l.overflowed[0]&&(0>r?n("on",38):r>h.height()&&n("on",40)),"y"!==s.axis&&l.overflowed[1]&&(0>c?n("on",37):c>h.width()&&n("on",39)))}}).bind("mouseup."+u+" dragend."+u,function(){t||(i&&(i=0,n("off",null)),c=!1)})},W=function(){function t(t,a){if(Q(o),!z(o,t.target)){var r="auto"!==i.mouseWheel.deltaFactor?parseInt(i.mouseWheel.deltaFactor):s&&t.deltaFactor<100?100:t.deltaFactor||100,d=i.scrollInertia;if("x"===i.axis||"x"===i.mouseWheel.axis)var u="x",f=[Math.round(r*n.scrollRatio.x),parseInt(i.mouseWheel.scrollAmount)],h="auto"!==i.mouseWheel.scrollAmount?f[1]:f[0]>=l.width()?.9*l.width():f[0],m=Math.abs(e("#mCSB_"+n.idx+"_container")[0].offsetLeft),p=c[1][0].offsetLeft,g=c[1].parent().width()-c[1].width(),v="y"===i.mouseWheel.axis?t.deltaY||a:t.deltaX;else var u="y",f=[Math.round(r*n.scrollRatio.y),parseInt(i.mouseWheel.scrollAmount)],h="auto"!==i.mouseWheel.scrollAmount?f[1]:f[0]>=l.height()?.9*l.height():f[0],m=Math.abs(e("#mCSB_"+n.idx+"_container")[0].offsetTop),p=c[0][0].offsetTop,g=c[0].parent().height()-c[0].height(),v=t.deltaY||a;"y"===u&&!n.overflowed[0]||"x"===u&&!n.overflowed[1]||((i.mouseWheel.invert||t.webkitDirectionInvertedFromDevice)&&(v=-v),i.mouseWheel.normalizeDelta&&(v=0>v?-1:1),(v>0&&0!==p||0>v&&p!==g||i.mouseWheel.preventDefault)&&(t.stopImmediatePropagation(),t.preventDefault()),t.deltaFactor<5&&!i.mouseWheel.normalizeDelta&&(h=t.deltaFactor,d=17),G(o,(m-v*h).toString(),{dir:u,dur:d}))}}if(e(this).data(a)){var o=e(this),n=o.data(a),i=n.opt,r=a+"_"+n.idx,l=e("#mCSB_"+n.idx),c=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")],d=e("#mCSB_"+n.idx+"_container").find("iframe");d.length&&d.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind("mousewheel."+r,function(e,o){t(e,o)})})}),l.bind("mousewheel."+r,function(e,o){t(e,o)})}},R=new Object,A=function(t){var o=!1,a=!1,n=null;if(void 0===t?a="#empty":void 0!==e(t).attr("id")&&(a=e(t).attr("id")),a!==!1&&void 0!==R[a])return R[a];if(t){try{var i=t.contentDocument||t.contentWindow.document;n=i.body.innerHTML}catch(r){}o=null!==n}else{try{var i=top.document;n=i.body.innerHTML}catch(r){}o=null!==n}return a!==!1&&(R[a]=o),o},L=function(e){var t=this.find("iframe");if(t.length){var o=e?"auto":"none";t.css("pointer-events",o)}},z=function(t,o){var n=o.nodeName.toLowerCase(),i=t.data(a).opt.mouseWheel.disableOver,r=["select","textarea"];return e.inArray(n,i)>-1&&!(e.inArray(n,r)>-1&&!e(o).is(":focus"))},P=function(){var t,o=e(this),n=o.data(a),i=a+"_"+n.idx,r=e("#mCSB_"+n.idx+"_container"),l=r.parent(),s=e(".mCSB_"+n.idx+"_scrollbar ."+d[12]);s.bind("mousedown."+i+" touchstart."+i+" pointerdown."+i+" MSPointerDown."+i,function(o){c=!0,e(o.target).hasClass("mCSB_dragger")||(t=1)}).bind("touchend."+i+" pointerup."+i+" MSPointerUp."+i,function(){c=!1}).bind("click."+i,function(a){if(t&&(t=0,e(a.target).hasClass(d[12])||e(a.target).hasClass("mCSB_draggerRail"))){Q(o);var i=e(this),s=i.find(".mCSB_dragger");if(i.parent(".mCSB_scrollTools_horizontal").length>0){if(!n.overflowed[1])return;var c="x",u=a.pageX>s.offset().left?-1:1,f=Math.abs(r[0].offsetLeft)-u*(.9*l.width())}else{if(!n.overflowed[0])return;var c="y",u=a.pageY>s.offset().top?-1:1,f=Math.abs(r[0].offsetTop)-u*(.9*l.height())}G(o,f.toString(),{dir:c,scrollEasing:"mcsEaseInOut"})}})},H=function(){var t=e(this),o=t.data(a),n=o.opt,i=a+"_"+o.idx,r=e("#mCSB_"+o.idx+"_container"),l=r.parent();r.bind("focusin."+i,function(){var o=e(document.activeElement),a=r.find(".mCustomScrollBox").length,i=0;o.is(n.advanced.autoScrollOnFocus)&&(Q(t),clearTimeout(t[0]._focusTimeout),t[0]._focusTimer=a?(i+17)*a:0,t[0]._focusTimeout=setTimeout(function(){var e=[ae(o)[0],ae(o)[1]],a=[r[0].offsetTop,r[0].offsetLeft],s=[a[0]+e[0]>=0&&a[0]+e[0]<l.height()-o.outerHeight(!1),a[1]+e[1]>=0&&a[0]+e[1]<l.width()-o.outerWidth(!1)],c="yx"!==n.axis||s[0]||s[1]?"all":"none";"x"===n.axis||s[0]||G(t,e[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:c,dur:i}),"y"===n.axis||s[1]||G(t,e[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:c,dur:i})},t[0]._focusTimer))})},U=function(){var t=e(this),o=t.data(a),n=a+"_"+o.idx,i=e("#mCSB_"+o.idx+"_container").parent();i.bind("scroll."+n,function(){0===i.scrollTop()&&0===i.scrollLeft()||e(".mCSB_"+o.idx+"_scrollbar").css("visibility","hidden")})},F=function(){var t=e(this),o=t.data(a),n=o.opt,i=o.sequential,r=a+"_"+o.idx,l=".mCSB_"+o.idx+"_scrollbar",s=e(l+">a");s.bind("contextmenu."+r,function(e){e.preventDefault()}).bind("mousedown."+r+" touchstart."+r+" pointerdown."+r+" MSPointerDown."+r+" mouseup."+r+" touchend."+r+" pointerup."+r+" MSPointerUp."+r+" mouseout."+r+" pointerout."+r+" MSPointerOut."+r+" click."+r,function(a){function r(e,o){i.scrollAmount=n.scrollButtons.scrollAmount,j(t,e,o)}if(a.preventDefault(),ee(a)){var l=e(this).attr("class");switch(i.type=n.scrollButtons.scrollType,a.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===i.type)return;c=!0,o.tweenRunning=!1,r("on",l);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===i.type)return;c=!1,i.dir&&r("off",l);break;case"click":if("stepped"!==i.type||o.tweenRunning)return;r("on",l)}}})},q=function(){function t(t){function a(e,t){r.type=i.keyboard.scrollType,r.scrollAmount=i.keyboard.scrollAmount,"stepped"===r.type&&n.tweenRunning||j(o,e,t)}switch(t.type){case"blur":n.tweenRunning&&r.dir&&a("off",null);break;case"keydown":case"keyup":var l=t.keyCode?t.keyCode:t.which,s="on";if("x"!==i.axis&&(38===l||40===l)||"y"!==i.axis&&(37===l||39===l)){if((38===l||40===l)&&!n.overflowed[0]||(37===l||39===l)&&!n.overflowed[1])return;"keyup"===t.type&&(s="off"),e(document.activeElement).is(u)||(t.preventDefault(),t.stopImmediatePropagation(),a(s,l))}else if(33===l||34===l){if((n.overflowed[0]||n.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type){Q(o);var f=34===l?-1:1;if("x"===i.axis||"yx"===i.axis&&n.overflowed[1]&&!n.overflowed[0])var h="x",m=Math.abs(c[0].offsetLeft)-f*(.9*d.width());else var h="y",m=Math.abs(c[0].offsetTop)-f*(.9*d.height());G(o,m.toString(),{dir:h,scrollEasing:"mcsEaseInOut"})}}else if((35===l||36===l)&&!e(document.activeElement).is(u)&&((n.overflowed[0]||n.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type)){if("x"===i.axis||"yx"===i.axis&&n.overflowed[1]&&!n.overflowed[0])var h="x",m=35===l?Math.abs(d.width()-c.outerWidth(!1)):0;else var h="y",m=35===l?Math.abs(d.height()-c.outerHeight(!1)):0;G(o,m.toString(),{dir:h,scrollEasing:"mcsEaseInOut"})}}}var o=e(this),n=o.data(a),i=n.opt,r=n.sequential,l=a+"_"+n.idx,s=e("#mCSB_"+n.idx),c=e("#mCSB_"+n.idx+"_container"),d=c.parent(),u="input,textarea,select,datalist,keygen,[contenteditable='true']",f=c.find("iframe"),h=["blur."+l+" keydown."+l+" keyup."+l];f.length&&f.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind(h[0],function(e){t(e)})})}),s.attr("tabindex","0").bind(h[0],function(e){t(e)})},j=function(t,o,n,i,r){function l(e){u.snapAmount&&(f.scrollAmount=u.snapAmount instanceof Array?"x"===f.dir[0]?u.snapAmount[1]:u.snapAmount[0]:u.snapAmount);var o="stepped"!==f.type,a=r?r:e?o?p/1.5:g:1e3/60,n=e?o?7.5:40:2.5,s=[Math.abs(h[0].offsetTop),Math.abs(h[0].offsetLeft)],d=[c.scrollRatio.y>10?10:c.scrollRatio.y,c.scrollRatio.x>10?10:c.scrollRatio.x],m="x"===f.dir[0]?s[1]+f.dir[1]*(d[1]*n):s[0]+f.dir[1]*(d[0]*n),v="x"===f.dir[0]?s[1]+f.dir[1]*parseInt(f.scrollAmount):s[0]+f.dir[1]*parseInt(f.scrollAmount),x="auto"!==f.scrollAmount?v:m,_=i?i:e?o?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",w=!!e;return e&&17>a&&(x="x"===f.dir[0]?s[1]:s[0]),G(t,x.toString(),{dir:f.dir[0],scrollEasing:_,dur:a,onComplete:w}),e?void(f.dir=!1):(clearTimeout(f.step),void(f.step=setTimeout(function(){l()},a)))}function s(){clearTimeout(f.step),$(f,"step"),Q(t)}var c=t.data(a),u=c.opt,f=c.sequential,h=e("#mCSB_"+c.idx+"_container"),m="stepped"===f.type,p=u.scrollInertia<26?26:u.scrollInertia,g=u.scrollInertia<1?17:u.scrollInertia;switch(o){case"on":if(f.dir=[n===d[16]||n===d[15]||39===n||37===n?"x":"y",n===d[13]||n===d[15]||38===n||37===n?-1:1],Q(t),oe(n)&&"stepped"===f.type)return;l(m);break;case"off":s(),(m||c.tweenRunning&&f.dir)&&l(!0)}},Y=function(t){var o=e(this).data(a).opt,n=[];return"function"==typeof t&&(t=t()),t instanceof Array?n=t.length>1?[t[0],t[1]]:"x"===o.axis?[null,t[0]]:[t[0],null]:(n[0]=t.y?t.y:t.x||"x"===o.axis?null:t,n[1]=t.x?t.x:t.y||"y"===o.axis?null:t),"function"==typeof n[0]&&(n[0]=n[0]()),"function"==typeof n[1]&&(n[1]=n[1]()),n},X=function(t,o){if(null!=t&&"undefined"!=typeof t){var n=e(this),i=n.data(a),r=i.opt,l=e("#mCSB_"+i.idx+"_container"),s=l.parent(),c=typeof t;o||(o="x"===r.axis?"x":"y");var d="x"===o?l.outerWidth(!1)-s.width():l.outerHeight(!1)-s.height(),f="x"===o?l[0].offsetLeft:l[0].offsetTop,h="x"===o?"left":"top";switch(c){case"function":return t();case"object":var m=t.jquery?t:e(t);if(!m.length)return;return"x"===o?ae(m)[1]:ae(m)[0];case"string":case"number":if(oe(t))return Math.abs(t);if(-1!==t.indexOf("%"))return Math.abs(d*parseInt(t)/100);if(-1!==t.indexOf("-="))return Math.abs(f-parseInt(t.split("-=")[1]));if(-1!==t.indexOf("+=")){var p=f+parseInt(t.split("+=")[1]);return p>=0?0:Math.abs(p)}if(-1!==t.indexOf("px")&&oe(t.split("px")[0]))return Math.abs(t.split("px")[0]);if("top"===t||"left"===t)return 0;if("bottom"===t)return Math.abs(s.height()-l.outerHeight(!1));if("right"===t)return Math.abs(s.width()-l.outerWidth(!1));if("first"===t||"last"===t){var m=l.find(":"+t);return"x"===o?ae(m)[1]:ae(m)[0]}return e(t).length?"x"===o?ae(e(t))[1]:ae(e(t))[0]:(l.css(h,t),void u.update.call(null,n[0]))}}},N=function(t){function o(){return clearTimeout(f[0].autoUpdate),0===l.parents("html").length?void(l=null):void(f[0].autoUpdate=setTimeout(function(){return c.advanced.updateOnSelectorChange&&(s.poll.change.n=i(),s.poll.change.n!==s.poll.change.o)?(s.poll.change.o=s.poll.change.n,void r(3)):c.advanced.updateOnContentResize&&(s.poll.size.n=l[0].scrollHeight+l[0].scrollWidth+f[0].offsetHeight+l[0].offsetHeight+l[0].offsetWidth,s.poll.size.n!==s.poll.size.o)?(s.poll.size.o=s.poll.size.n,void r(1)):!c.advanced.updateOnImageLoad||"auto"===c.advanced.updateOnImageLoad&&"y"===c.axis||(s.poll.img.n=f.find("img").length,s.poll.img.n===s.poll.img.o)?void((c.advanced.updateOnSelectorChange||c.advanced.updateOnContentResize||c.advanced.updateOnImageLoad)&&o()):(s.poll.img.o=s.poll.img.n,void f.find("img").each(function(){n(this)}))},c.advanced.autoUpdateTimeout))}function n(t){function o(e,t){return function(){return t.apply(e,arguments)}}function a(){this.onload=null,e(t).addClass(d[2]),r(2)}if(e(t).hasClass(d[2]))return void r();var n=new Image;n.onload=o(n,a),n.src=t.src}function i(){c.advanced.updateOnSelectorChange===!0&&(c.advanced.updateOnSelectorChange="*");var e=0,t=f.find(c.advanced.updateOnSelectorChange);return c.advanced.updateOnSelectorChange&&t.length>0&&t.each(function(){e+=this.offsetHeight+this.offsetWidth}),e}function r(e){clearTimeout(f[0].autoUpdate),u.update.call(null,l[0],e)}var l=e(this),s=l.data(a),c=s.opt,f=e("#mCSB_"+s.idx+"_container");return t?(clearTimeout(f[0].autoUpdate),void $(f[0],"autoUpdate")):void o()},V=function(e,t,o){return Math.round(e/t)*t-o},Q=function(t){var o=t.data(a),n=e("#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal");n.each(function(){Z.call(this)})},G=function(t,o,n){function i(e){return s&&c.callbacks[e]&&"function"==typeof c.callbacks[e]}function r(){return[c.callbacks.alwaysTriggerOffsets||w>=S[0]+y,c.callbacks.alwaysTriggerOffsets||-B>=w]}function l(){var e=[h[0].offsetTop,h[0].offsetLeft],o=[x[0].offsetTop,x[0].offsetLeft],a=[h.outerHeight(!1),h.outerWidth(!1)],i=[f.height(),f.width()];t[0].mcs={content:h,top:e[0],left:e[1],draggerTop:o[0],draggerLeft:o[1],topPct:Math.round(100*Math.abs(e[0])/(Math.abs(a[0])-i[0])),leftPct:Math.round(100*Math.abs(e[1])/(Math.abs(a[1])-i[1])),direction:n.dir}}var s=t.data(a),c=s.opt,d={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:c.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},n=e.extend(d,n),u=[n.dur,n.drag?0:n.dur],f=e("#mCSB_"+s.idx),h=e("#mCSB_"+s.idx+"_container"),m=h.parent(),p=c.callbacks.onTotalScrollOffset?Y.call(t,c.callbacks.onTotalScrollOffset):[0,0],g=c.callbacks.onTotalScrollBackOffset?Y.call(t,c.callbacks.onTotalScrollBackOffset):[0,0];if(s.trigger=n.trigger,0===m.scrollTop()&&0===m.scrollLeft()||(e(".mCSB_"+s.idx+"_scrollbar").css("visibility","visible"),m.scrollTop(0).scrollLeft(0)),"_resetY"!==o||s.contentReset.y||(i("onOverflowYNone")&&c.callbacks.onOverflowYNone.call(t[0]),s.contentReset.y=1),"_resetX"!==o||s.contentReset.x||(i("onOverflowXNone")&&c.callbacks.onOverflowXNone.call(t[0]),s.contentReset.x=1),"_resetY"!==o&&"_resetX"!==o){if(!s.contentReset.y&&t[0].mcs||!s.overflowed[0]||(i("onOverflowY")&&c.callbacks.onOverflowY.call(t[0]),s.contentReset.x=null),!s.contentReset.x&&t[0].mcs||!s.overflowed[1]||(i("onOverflowX")&&c.callbacks.onOverflowX.call(t[0]),s.contentReset.x=null),c.snapAmount){var v=c.snapAmount instanceof Array?"x"===n.dir?c.snapAmount[1]:c.snapAmount[0]:c.snapAmount;o=V(o,v,c.snapOffset)}switch(n.dir){case"x":var x=e("#mCSB_"+s.idx+"_dragger_horizontal"),_="left",w=h[0].offsetLeft,S=[f.width()-h.outerWidth(!1),x.parent().width()-x.width()],b=[o,0===o?0:o/s.scrollRatio.x],y=p[1],B=g[1],T=y>0?y/s.scrollRatio.x:0,k=B>0?B/s.scrollRatio.x:0;break;case"y":var x=e("#mCSB_"+s.idx+"_dragger_vertical"),_="top",w=h[0].offsetTop,S=[f.height()-h.outerHeight(!1),x.parent().height()-x.height()],b=[o,0===o?0:o/s.scrollRatio.y],y=p[0],B=g[0],T=y>0?y/s.scrollRatio.y:0,k=B>0?B/s.scrollRatio.y:0}b[1]<0||0===b[0]&&0===b[1]?b=[0,0]:b[1]>=S[1]?b=[S[0],S[1]]:b[0]=-b[0],t[0].mcs||(l(),i("onInit")&&c.callbacks.onInit.call(t[0])),clearTimeout(h[0].onCompleteTimeout),J(x[0],_,Math.round(b[1]),u[1],n.scrollEasing),!s.tweenRunning&&(0===w&&b[0]>=0||w===S[0]&&b[0]<=S[0])||J(h[0],_,Math.round(b[0]),u[0],n.scrollEasing,n.overwrite,{onStart:function(){n.callbacks&&n.onStart&&!s.tweenRunning&&(i("onScrollStart")&&(l(),c.callbacks.onScrollStart.call(t[0])),s.tweenRunning=!0,C(x),s.cbOffsets=r())},onUpdate:function(){n.callbacks&&n.onUpdate&&i("whileScrolling")&&(l(),c.callbacks.whileScrolling.call(t[0]))},onComplete:function(){if(n.callbacks&&n.onComplete){"yx"===c.axis&&clearTimeout(h[0].onCompleteTimeout);var e=h[0].idleTimer||0;h[0].onCompleteTimeout=setTimeout(function(){i("onScroll")&&(l(),c.callbacks.onScroll.call(t[0])),i("onTotalScroll")&&b[1]>=S[1]-T&&s.cbOffsets[0]&&(l(),c.callbacks.onTotalScroll.call(t[0])),i("onTotalScrollBack")&&b[1]<=k&&s.cbOffsets[1]&&(l(),c.callbacks.onTotalScrollBack.call(t[0])),s.tweenRunning=!1,h[0].idleTimer=0,C(x,"hide")},e)}}})}},J=function(e,t,o,a,n,i,r){function l(){S.stop||(x||m.call(),x=K()-v,s(),x>=S.time&&(S.time=x>S.time?x+f-(x-S.time):x+f-1,S.time<x+1&&(S.time=x+1)),S.time<a?S.id=h(l):g.call())}function s(){a>0?(S.currVal=u(S.time,_,b,a,n),w[t]=Math.round(S.currVal)+"px"):w[t]=o+"px",p.call()}function c(){f=1e3/60,S.time=x+f,h=window.requestAnimationFrame?window.requestAnimationFrame:function(e){return s(),setTimeout(e,.01)},S.id=h(l)}function d(){null!=S.id&&(window.requestAnimationFrame?window.cancelAnimationFrame(S.id):clearTimeout(S.id),S.id=null)}function u(e,t,o,a,n){switch(n){case"linear":case"mcsLinear":return o*e/a+t;case"mcsLinearOut":return e/=a,e--,o*Math.sqrt(1-e*e)+t;case"easeInOutSmooth":return e/=a/2,1>e?o/2*e*e+t:(e--,-o/2*(e*(e-2)-1)+t);case"easeInOutStrong":return e/=a/2,1>e?o/2*Math.pow(2,10*(e-1))+t:(e--,o/2*(-Math.pow(2,-10*e)+2)+t);case"easeInOut":case"mcsEaseInOut":return e/=a/2,1>e?o/2*e*e*e+t:(e-=2,o/2*(e*e*e+2)+t);case"easeOutSmooth":return e/=a,e--,-o*(e*e*e*e-1)+t;case"easeOutStrong":return o*(-Math.pow(2,-10*e/a)+1)+t;case"easeOut":case"mcsEaseOut":default:var i=(e/=a)*e,r=i*e;return t+o*(.499999999999997*r*i+-2.5*i*i+5.5*r+-6.5*i+4*e)}}e._mTween||(e._mTween={top:{},left:{}});var f,h,r=r||{},m=r.onStart||function(){},p=r.onUpdate||function(){},g=r.onComplete||function(){},v=K(),x=0,_=e.offsetTop,w=e.style,S=e._mTween[t];"left"===t&&(_=e.offsetLeft);var b=o-_;S.stop=0,"none"!==i&&d(),c()},K=function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},Z=function(){var e=this;e._mTween||(e._mTween={top:{},left:{}});for(var t=["top","left"],o=0;o<t.length;o++){var a=t[o];e._mTween[a].id&&(window.requestAnimationFrame?window.cancelAnimationFrame(e._mTween[a].id):clearTimeout(e._mTween[a].id),e._mTween[a].id=null,e._mTween[a].stop=1)}},$=function(e,t){try{delete e[t]}catch(o){e[t]=null}},ee=function(e){return!(e.which&&1!==e.which)},te=function(e){var t=e.originalEvent.pointerType;return!(t&&"touch"!==t&&2!==t)},oe=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},ae=function(e){var t=e.parents(".mCSB_container");return[e.offset().top-t.offset().top,e.offset().left-t.offset().left]},ne=function(){function e(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}var t=e();return t?document[t]:!1};e.fn[o]=function(t){return u[t]?u[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):u.init.apply(this,arguments)},e[o]=function(t){return u[t]?u[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):u.init.apply(this,arguments)},e[o].defaults=i,window[o]=!0,e(window).bind("load",function(){e(n)[o](),e.extend(e.expr[":"],{mcsInView:e.expr[":"].mcsInView||function(t){var o,a,n=e(t),i=n.parents(".mCSB_container");if(i.length)return o=i.parent(),a=[i[0].offsetTop,i[0].offsetLeft],a[0]+ae(n)[0]>=0&&a[0]+ae(n)[0]<o.height()-n.outerHeight(!1)&&a[1]+ae(n)[1]>=0&&a[1]+ae(n)[1]<o.width()-n.outerWidth(!1)},mcsInSight:e.expr[":"].mcsInSight||function(t,o,a){var n,i,r,l,s=e(t),c=s.parents(".mCSB_container"),d="exact"===a[3]?[[1,0],[1,0]]:[[.9,.1],[.6,.4]];if(c.length)return n=[s.outerHeight(!1),s.outerWidth(!1)],r=[c[0].offsetTop+ae(s)[0],c[0].offsetLeft+ae(s)[1]],i=[c.parent()[0].offsetHeight,c.parent()[0].offsetWidth],l=[n[0]<i[0]?d[0]:d[1],n[1]<i[1]?d[0]:d[1]],r[0]-i[0]*l[0][0]<0&&r[0]+n[0]-i[0]*l[0][1]>=0&&r[1]-i[1]*l[1][0]<0&&r[1]+n[1]-i[1]*l[1][1]>=0},mcsOverflow:e.expr[":"].mcsOverflow||function(t){var o=e(t).data(a);if(o)return o.overflowed[0]||o.overflowed[1]}})})})});(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory)}else if(typeof exports==='object'){module.exports=factory}else{factory(jQuery)}}(function($){var toFix=['wheel','mousewheel','DOMMouseScroll','MozMousePixelScroll'],toBind=('onwheel'in document||document.documentMode>=9)?['wheel']:['mousewheel','DomMouseScroll','MozMousePixelScroll'],slice=Array.prototype.slice,nullLowestDeltaTimeout,lowestDelta;if($.event.fixHooks){for(var i=toFix.length;i;){$.event.fixHooks[toFix[--i]]=$.event.mouseHooks}}var special=$.event.special.mousewheel={version:'3.1.12',setup:function(){if(this.addEventListener){for(var i=toBind.length;i;){this.addEventListener(toBind[--i],handler,false)}}else{this.onmousewheel=handler}$.data(this,'mousewheel-line-height',special.getLineHeight(this));$.data(this,'mousewheel-page-height',special.getPageHeight(this))},teardown:function(){if(this.removeEventListener){for(var i=toBind.length;i;){this.removeEventListener(toBind[--i],handler,false)}}else{this.onmousewheel=null}$.removeData(this,'mousewheel-line-height');$.removeData(this,'mousewheel-page-height')},getLineHeight:function(elem){var $elem=$(elem),$parent=$elem['offsetParent'in $.fn?'offsetParent':'parent']();if(!$parent.length){$parent=$('body')}return parseInt($parent.css('fontSize'),10)||parseInt($elem.css('fontSize'),10)||16},getPageHeight:function(elem){return $(elem).height()},settings:{adjustOldDeltas:true,normalizeOffset:true}};$.fn.extend({mousewheel:function(fn){return fn?this.bind('mousewheel',fn):this.trigger('mousewheel')},unmousewheel:function(fn){return this.unbind('mousewheel',fn)}});function handler(event){var orgEvent=event||window.event,args=slice.call(arguments,1),delta=0,deltaX=0,deltaY=0,absDelta=0,offsetX=0,offsetY=0;event=$.event.fix(orgEvent);event.type='mousewheel';if($(event.target).closest('.chzn-results').length){return false}if('detail'in orgEvent){deltaY=orgEvent.detail*-1}if('wheelDelta'in orgEvent){deltaY=orgEvent.wheelDelta}if('wheelDeltaY'in orgEvent){deltaY=orgEvent.wheelDeltaY}if('wheelDeltaX'in orgEvent){deltaX=orgEvent.wheelDeltaX*-1}if('axis'in orgEvent&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaX=deltaY*-1;deltaY=0}delta=deltaY===0?deltaX:deltaY;if('deltaY'in orgEvent){deltaY=orgEvent.deltaY*-1;delta=deltaY}if('deltaX'in orgEvent){deltaX=orgEvent.deltaX;if(deltaY===0){delta=deltaX*-1}}if(deltaY===0&&deltaX===0){return}if(orgEvent.deltaMode===1){var lineHeight=$.data(this,'mousewheel-line-height');delta*=lineHeight;deltaY*=lineHeight;deltaX*=lineHeight}else if(orgEvent.deltaMode===2){var pageHeight=$.data(this,'mousewheel-page-height');delta*=pageHeight;deltaY*=pageHeight;deltaX*=pageHeight}absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX));if(!lowestDelta||absDelta<lowestDelta){lowestDelta=absDelta;if(shouldAdjustOldDeltas(orgEvent,absDelta)){lowestDelta/=40}}if(shouldAdjustOldDeltas(orgEvent,absDelta)){delta/=40;deltaX/=40;deltaY/=40}delta=Math[delta>=1?'floor':'ceil'](delta/lowestDelta);deltaX=Math[deltaX>=1?'floor':'ceil'](deltaX/lowestDelta);deltaY=Math[deltaY>=1?'floor':'ceil'](deltaY/lowestDelta);if(special.settings.normalizeOffset&&this.getBoundingClientRect){var boundingRect=this.getBoundingClientRect();offsetX=event.clientX-boundingRect.left;offsetY=event.clientY-boundingRect.top}event.deltaX=deltaX;event.deltaY=deltaY;event.deltaFactor=lowestDelta;event.offsetX=offsetX;event.offsetY=offsetY;event.deltaMode=0;args.unshift(event,delta,deltaX,deltaY);if(nullLowestDeltaTimeout){clearTimeout(nullLowestDeltaTimeout)}nullLowestDeltaTimeout=setTimeout(nullLowestDelta,200);return($.event.dispatch||$.event.handle).apply(this,args)}function nullLowestDelta(){lowestDelta=null}function shouldAdjustOldDeltas(orgEvent,absDelta){return special.settings.adjustOldDeltas&&orgEvent.type==='mousewheel'&&absDelta%120===0}}));(function(document,window){"use strict";window.initNPS=function(){};window.addEventListener('load',function loadPage(){const nps=document.getElementById('nps-megagroup');if(!nps)return false;const NUMBER_OF_DAYS_SEND=3;const DAY_IN_MS=86400000;const storage={key:'nps-unsent-replies',getAll:function getAllStorage(){return JSON.parse(localStorage.getItem(storage.key))||{}},get:function getStorage(id){const data=storage.getAll();const strID=id.toString();return data[strID]?data[strID]:false},set:function setStorage(id,value){const data=storage.getAll();const strID=id.toString();data[strID]=value;localStorage.setItem(storage.key,JSON.stringify(data))},update:function setStorage(id,value){const data=storage.getAll();const strID=id.toString();if(data[strID]){data[strID]=value;localStorage.setItem(storage.key,JSON.stringify(data))}},remove:function removeStorage(id){let result={};const strID=id.toString();storage.forEach(function isRemoved(key,value){if(key!==strID){result[key]=value}});localStorage.setItem(storage.key,JSON.stringify(result))},forEach:function forEachItem(func){const data=storage.getAll();const keys=Object.keys(data);for(let i=0;i<keys.length;i++){const key=keys[i];func(key,data[key])}},};const backgroundTasks={init:function initBackgroundTasks(){storage.forEach(function checkTask(key,value){if(Date.now()-value.lastDateSend>DAY_IN_MS){let url='/-/cms/v2/nps/send?'+window.access,response=fetch(url,{method:'POST',headers:{'Content-type':'application/json',},body:JSON.stringify(value.params)}).then(function(response){return response.json()});response.then(function(response){if(response.error){backgroundTasks.onError(response.error)}else{backgroundTasks.onSuccess(response)}});value.sendAttemptNumber+=1;if(value.sendAttemptNumber>NUMBER_OF_DAYS_SEND){storage.remove(key)}else{value.lastDateSend=Date.now();storage.update(key,value)}}})},add:function addBackgroundTask(params){const{nps_id}=params;storage.set(nps_id,{params:params,sendAttemptNumber:1,lastDateSend:Date.now(),})},onSuccess:function onSuccessBackgroundTask(response){if(response&&response.nps_id){storage.remove(response.nps_id)}},onError:function onErrorBackgroundTask(error){console.warn(error)},};const RATING={dom:null,id:'mnps-rating',domNextStep:null,listNumber:null,idNextStep:'mnps-next-step',hoverClass:'mnps-number--hover',activeClass:'mnps-number--active',activeClassStep:'mnps-next-step--active',activeIndex:null,colorAttribute:'data-hover',indexAttribute:'data-index',init:function ratingInit(){const dom=RATING.dom=document.getElementById(RATING.id);const listNumber=RATING.listNumber=document.getElementById('mnps-rating').children;dom.addEventListener('mouseover',RATING.mouseover);dom.addEventListener('mouseout',RATING.mouseout);RATING.domNextStep=document.getElementById(RATING.idNextStep);for(let i=0;i<listNumber.length;i++){const element=listNumber[i];element.setAttribute(RATING.indexAttribute,i.toString());element.addEventListener('click',RATING.clickNumber)}},getIndex:function getPrevElementRating(element){return Number(element.getAttribute(RATING.indexAttribute))},getElementByIndex:function getPrevElementRating(index){return RATING.dom.querySelector(`[${RATING.indexAttribute}="${index}"]`)},getPrevElement:function getPrevElementRating(element){const index=RATING.getIndex(element);return RATING.getElementByIndex(index-1)},clickNumber:function clickNumberRating(event){if(event.target){const{activeClass,listNumber}=RATING;const element=event.target;const index=RATING.getIndex(element);const oldIndex=RATING.activeIndex;for(let i=0;i<listNumber.length;i++){listNumber[i].classList.remove(activeClass)}element.classList.add(activeClass);RATING.activeIndex=index;if(oldIndex!==null){RATING.mouseout({target:RATING.getElementByIndex(oldIndex)})}if(!commentHidden)RATING.visibleNextStep();else sendBtnClick()}},visibleNextStep:function visibleNextStepRating(){const{domNextStep,activeClassStep}=RATING;if(!domNextStep.classList.contains(activeClassStep)){domNextStep.classList.add(activeClassStep)}},mouseover:function mouseOverRating(event){const{colorAttribute}=RATING;if(event.target.hasAttribute(colorAttribute)){const element=event.target;const prevElement=RATING.getPrevElement(element);element.style.backgroundColor=element.getAttribute(colorAttribute).toString();element.classList.add(RATING.hoverClass);if(prevElement){RATING.mouseover({target:prevElement})}}},mouseout:function mouseOutRating(event){if(event.target.hasAttribute(RATING.colorAttribute)){const{activeIndex,activeClass}=RATING;const element=event.target;const index=RATING.getIndex(element);if(index>=activeIndex&&!element.classList.contains(activeClass)){const prevElement=RATING.getPrevElement(element);if(prevElement){RATING.mouseout({target:prevElement})}element.style.backgroundColor='#FFFFFF';element.classList.remove(RATING.hoverClass)}}},};const npsTitle=document.getElementById('mnps-title');const npsLastMessage=document.getElementById('mnps-message-wrapper');const closeBtnIco=document.getElementById('mnps-close-ico');const closeBtn=document.getElementById('mnps-close');const closeBtnMsg=document.getElementById('mnps-message-button');const sendBtn=document.getElementById('mnps-send');const comment=document.getElementById('mnps-comment');const commentLabel=document.getElementById('mnps-comment-label');const classVisible='mnps-visible';const classHidden='mnps-hidden';const classPlaceholder='mnps--placeholder';let idNps=null;let closeTimeout=null;let startTimeout=null;let commentHidden=null;RATING.init();closeBtnIco.addEventListener('click',closeBtnClick);closeBtn.addEventListener('click',closeBtnClick);closeBtnMsg.addEventListener('click',closeBtnMsgClick);sendBtn.addEventListener('click',sendBtnClick);comment.addEventListener('focus',focus);comment.addEventListener('blur',blur);window.initNPS=function initNPS(){if(nps.classList.contains(classVisible))return false;clearTimeout(startTimeout);startTimeout=setTimeout(function timeoutRunNps(){let url='/-/cms/v2/nps/get?'+window.access,response=fetch(url,{method:'GET',headers:{'Content-type':'application/json',}}).then(function(response){return response.json()});response.then(function(response){if(response.error){console.warn(response.error)}else{successGetNPS(response)}})},1000)};backgroundTasks.init();function successGetNPS(response){if(response&&response.nps_id&&!storage.get(response.nps_id)){visibleNPS(response)}}function visibleNPS(data){const{nps_id,question,comment_label,comment_hidden}=data;idNps=nps_id;commentHidden=Number(comment_hidden);comment.setAttribute('contenteditable',true);if(question)npsTitle.innerText=question;if(comment_label){commentLabel.innerText=comment_label}visiblePlaceholder(comment);visibleBlock(nps)}function focus(event){const element=event.target;hiddenPlaceholder(element)}function blur(event){const element=event.target;visiblePlaceholder(element)}function visiblePlaceholder(element){if(!element.classList.contains(classPlaceholder)&&element.innerText===''){const placeholder=element.getAttribute('placeholder');element.classList.add(classPlaceholder);element.innerText=placeholder}}function hiddenPlaceholder(element){if(element.classList.contains(classPlaceholder)){element.classList.remove(classPlaceholder);element.innerText=''}}function getTextComment(element){return element.classList.contains(classPlaceholder)?'':element.innerText}function visibleBlock(element){element.style.display='flex';setTimeout(function(){element.classList.add(classVisible)},500)}function hiddenBlock(element){return new Promise((resolve)=>{element.classList.add(classHidden);setTimeout(function(){element.style.display='none';resolve()},500)})}function closeBtnClick(){hiddenBlock(nps).then(function(){const key='nps-number-of-closures';let count=localStorage.getItem(key)||1;count=Number(count)+1;if(count>3){let url='/-/cms/v2/nps/send?'+window.access,response=fetch(url,{method:'POST',headers:{'Content-type':'application/json',},body:JSON.stringify(getParams(-1))}).then(function(response){return response.json()});response.then(function(response){if(response.error){errorSendNpsClose(response)}else{successSendNpsClose(response)}});localStorage.removeItem(key)}else if(count=1){let url='/-/cms/v2/nps/close?nps_id='+getParams()['nps_id']+'&'+window.access,response=fetch(url,{method:'GET',headers:{'Content-type':'application/json',}}).then(function(response){return response.json()});response.then(function(response){if(response.error){errorSendNpsClose(response)}else{successSendNpsClose(response)}})}else{localStorage.setItem(key,count)}})}function closeBtnMsgClick(){hiddenBlock(npsLastMessage);clearTimeout(closeTimeout)}function sendBtnClick(){hiddenBlock(nps).then(function(){let url='/-/cms/v2/nps/send?'+window.access;let response=fetch(url,{method:'POST',headers:{'Content-type':'application/json',},body:JSON.stringify(getParams())}).then(function(response){return response.json()});response.then(function(response){if(response.error){errorSendNps(response)}})});if(commentHidden)showLastMessage()}function errorSendNps(error){console.warn('errorSendNps',error);backgroundTasks.add(getParams());visibleBlock(npsLastMessage);closeTimeout=setTimeout(closeBtnMsgClick,3000)}function errorSendNpsClose(error){console.warn('errorSendNps',error);backgroundTasks.add(getParams())}function showLastMessage(){visibleBlock(npsLastMessage);closeTimeout=setTimeout(closeBtnMsgClick,3000)}function successSendNpsClose(response){}function getParams(rating){return{nps_id:idNps,result:rating?rating:RATING.activeIndex,comment:getTextComment(comment),}}})})(document,window);